WITH RankedSuppliers AS (
    SELECT 
        s.s_suppkey,
        s.s_name,
        s.s_acctbal,
        ROW_NUMBER() OVER (PARTITION BY s.s_nationkey ORDER BY s.s_acctbal DESC) as rnk
    FROM supplier s
),
TotalSales AS (
    SELECT 
        l.l_partkey,
        SUM(l.l_extendedprice * (1 - l.l_discount)) AS total_revenue
    FROM lineitem l
    JOIN orders o ON l.l_orderkey = o.o_orderkey
    WHERE o.o_orderdate >= DATE '1996-01-01' AND o.o_orderdate < DATE '1996-12-31'
    GROUP BY l.l_partkey
),
HighValueParts AS (
    SELECT 
        p.p_partkey,
        p.p_name,
        COALESCE(ts.total_revenue, 0) AS revenue
    FROM part p
    LEFT JOIN TotalSales ts ON p.p_partkey = ts.l_partkey
    WHERE p.p_size > 10
),
SupplierPartRevenue AS (
    SELECT 
        ps.ps_partkey,
        SUM(ps.ps_supplycost * ps.ps_availqty) AS supply_value
    FROM partsupp ps
    GROUP BY ps.ps_partkey
)
SELECT 
    p.p_name,
    p.revenue,
    COALESCE(sp.supply_value, 0) AS supply_value,
    r.r_name AS supplier_region,
    ROW_NUMBER() OVER (ORDER BY p.revenue DESC) AS revenue_rank
FROM HighValueParts p
LEFT JOIN SupplierPartRevenue sp ON p.p_partkey = sp.ps_partkey
JOIN RankedSuppliers s ON s.s_suppkey = (SELECT ps.ps_suppkey 
                                            FROM partsupp ps 
                                            WHERE ps.ps_partkey = p.p_partkey
                                            ORDER BY ps.ps_supplycost ASC
                                            LIMIT 1)
JOIN nation n ON s.s_nationkey = n.n_nationkey
JOIN region r ON n.n_regionkey = r.r_regionkey
WHERE p.revenue > 10000
ORDER BY p.revenue DESC, supply_value ASC
LIMIT 10;