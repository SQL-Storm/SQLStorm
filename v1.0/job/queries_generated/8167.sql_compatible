
SELECT c1.name AS actor_name,
       t.title AS movie_title,
       ARRAY_AGG(DISTINCT k.keyword) AS keywords,
       p.info AS person_info,
       COALESCE(cc.kind, 'Unknown') AS cast_type,
       cm.name AS company_name,
       cm.country_code AS company_country
FROM cast_info ci
JOIN aka_name c1 ON ci.person_id = c1.person_id
JOIN title t ON ci.movie_id = t.id
LEFT JOIN movie_keyword mk ON t.id = mk.movie_id
LEFT JOIN keyword k ON mk.keyword_id = k.id
LEFT JOIN person_info p ON ci.person_id = p.person_id
LEFT JOIN role_type rt ON ci.role_id = rt.id
LEFT JOIN movie_companies mc ON t.id = mc.movie_id
LEFT JOIN company_name cm ON mc.company_id = cm.id
LEFT JOIN company_type ct ON mc.company_type_id = ct.id
LEFT JOIN comp_cast_type cc ON ci.person_role_id = cc.id
WHERE t.production_year BETWEEN 2000 AND 2023
GROUP BY c1.name, t.title, p.info, cc.kind, cm.name, cm.country_code
ORDER BY t.production_year DESC, c1.name;
