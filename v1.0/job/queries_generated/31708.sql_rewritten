WITH RECURSIVE CTE_Movies AS (
    SELECT 
        t.id AS movie_id, 
        t.title, 
        t.production_year,
        1 AS level
    FROM 
        aka_title t
    WHERE 
        t.production_year >= 2000
    
    UNION ALL
    
    SELECT 
        t.id, 
        t.title, 
        t.production_year,
        cte.level + 1
    FROM 
        aka_title t
    JOIN 
        CTE_Movies cte ON t.episode_of_id = cte.movie_id
),
Ranked_Actors AS (
    SELECT 
        ci.person_id, 
        COUNT(DISTINCT cm.movie_id) AS movie_count,
        RANK() OVER (PARTITION BY ci.person_id ORDER BY COUNT(DISTINCT cm.movie_id) DESC) AS rank
    FROM 
        cast_info ci
    JOIN 
        complete_cast cc ON ci.movie_id = cc.movie_id
    LEFT JOIN 
        movie_companies mc ON mc.movie_id = ci.movie_id
    LEFT JOIN 
        title t ON t.id = ci.movie_id
    WHERE 
        cc.status_id = 1 
        AND t.production_year >= 2000
    GROUP BY 
        ci.person_id
),
Actors_Personal_Info AS (
    SELECT 
        a.id AS actor_id, 
        a.name,
        pi.info AS personal_info
    FROM 
        name a
    LEFT JOIN 
        person_info pi ON a.imdb_id = pi.person_id 
    WHERE 
        pi.info IS NOT NULL
)
SELECT 
    t.title AS movie_title,
    t.production_year,
    r.actor_id,
    a.name AS actor_name,
    COALESCE(a.personal_info, 'No Info') AS actor_info,
    r.movie_count AS actor_movie_count
FROM 
    CTE_Movies t
JOIN 
    cast_info ci ON t.movie_id = ci.movie_id
JOIN 
    Ranked_Actors r ON ci.person_id = r.person_id
JOIN 
    Actors_Personal_Info a ON r.actor_id = a.actor_id
WHERE 
    r.rank = 1
ORDER BY 
    t.production_year DESC, 
    r.movie_count DESC;