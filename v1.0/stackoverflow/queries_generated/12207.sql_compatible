
WITH PostStats AS (
    SELECT 
        PostTypeId,
        COUNT(*) AS TotalPosts,
        AVG(ViewCount) AS AvgViewCount,
        AVG(Score) AS AvgScore,
        AVG(AnswerCount) AS AvgAnswerCount,
        AVG(CommentCount) AS AvgCommentCount,
        AVG(FavoriteCount) AS AvgFavoriteCount
    FROM Posts
    WHERE CreationDate >= DATEADD(YEAR, -1, CURRENT_TIMESTAMP)  
    GROUP BY PostTypeId
),

UserStats AS (
    SELECT 
        COUNT(*) AS TotalUsers,
        AVG(Reputation) AS AvgReputation,
        AVG(Views) AS AvgViews,
        AVG(UpVotes) AS AvgUpVotes,
        AVG(DownVotes) AS AvgDownVotes
    FROM Users
    WHERE CreationDate >= DATEADD(YEAR, -1, CURRENT_TIMESTAMP)  
)

SELECT 
    ps.PostTypeId,
    ps.TotalPosts,
    ps.AvgViewCount,
    ps.AvgScore,
    ps.AvgAnswerCount,
    ps.AvgCommentCount,
    ps.AvgFavoriteCount,
    us.TotalUsers,
    us.AvgReputation,
    us.AvgViews,
    us.AvgUpVotes,
    us.AvgDownVotes
FROM PostStats ps CROSS JOIN UserStats us
ORDER BY ps.PostTypeId;
