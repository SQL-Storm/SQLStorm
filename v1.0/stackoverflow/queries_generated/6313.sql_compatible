
WITH UserBadgeCounts AS (
    SELECT UserId, COUNT(*) AS BadgeCount
    FROM Badges
    GROUP BY UserId
),
UserPostCounts AS (
    SELECT OwnerUserId AS UserId, COUNT(*) AS PostCount
    FROM Posts
    WHERE CreationDate >= TIMESTAMP '2024-10-01 12:34:56' - INTERVAL '1 year'
    GROUP BY OwnerUserId
),
PostVoteCounts AS (
    SELECT PostId, COUNT(*) AS VoteCount
    FROM Votes
    GROUP BY PostId
),
TopUsers AS (
    SELECT u.Id, u.DisplayName, u.Reputation, u.CreationDate, 
           COALESCE(ub.BadgeCount, 0) AS BadgeCount, 
           COALESCE(up.PostCount, 0) AS PostCount,
           COALESCE(pv.VoteCount, 0) AS TotalVotes
    FROM Users u
    LEFT JOIN UserBadgeCounts ub ON u.Id = ub.UserId
    LEFT JOIN UserPostCounts up ON u.Id = up.UserId
    LEFT JOIN PostVoteCounts pv ON u.Id = pv.UserId
    WHERE u.Reputation > 100
)
SELECT DisplayName, Reputation, CreationDate, BadgeCount, PostCount, TotalVotes
FROM TopUsers
ORDER BY Reputation DESC, PostCount DESC, TotalVotes DESC
LIMIT 10;
