WITH UserVotingStats AS (
    SELECT
        U.Id AS UserId,
        U.DisplayName,
        U.Reputation,
        COUNT(CASE WHEN V.VoteTypeId = 2 THEN 1 END) AS UpVotes,
        COUNT(CASE WHEN V.VoteTypeId = 3 THEN 1 END) AS DownVotes,
        COUNT(CASE WHEN V.VoteTypeId = 6 THEN 1 END) AS CloseVotes,
        COUNT(CASE WHEN V.VoteTypeId = 7 THEN 1 END) AS ReopenVotes
    FROM Users U
    LEFT JOIN Votes V ON U.Id = V.UserId
    GROUP BY U.Id, U.DisplayName, U.Reputation
),
TopUsers AS (
    SELECT UserId, DisplayName, Reputation, UpVotes, DownVotes, CloseVotes, ReopenVotes,
           RANK() OVER (ORDER BY Reputation DESC) AS ReputationRank,
           RANK() OVER (ORDER BY UpVotes DESC) AS UpVoteRank
    FROM UserVotingStats
),
PostStats AS (
    SELECT 
        P.Id AS PostId,
        P.Title,
        P.CreationDate,
        P.Score,
        P.ViewCount,
        COUNT(CASE WHEN C.Id IS NOT NULL THEN 1 END) AS CommentCount,
        COUNT(CASE WHEN PH.Id IS NOT NULL THEN 1 END) AS EditCount,
        U.DisplayName AS OwnerDisplayName
    FROM Posts P
    LEFT JOIN Comments C ON P.Id = C.PostId
    LEFT JOIN PostHistory PH ON P.Id = PH.PostId
    LEFT JOIN Users U ON P.OwnerUserId = U.Id
    WHERE P.CreationDate >= cast('2024-10-01 12:34:56' as timestamp) - INTERVAL '1 year'
    GROUP BY P.Id, P.Title, P.CreationDate, P.Score, P.ViewCount, U.DisplayName
),
TopPosts AS (
    SELECT PostId, Title, CreationDate, Score, ViewCount, CommentCount, EditCount, OwnerDisplayName,
           RANK() OVER (ORDER BY Score DESC) AS ScoreRank,
           RANK() OVER (ORDER BY ViewCount DESC) AS ViewRank
    FROM PostStats
)
SELECT 
    TU.DisplayName AS TopUser,
    TU.Reputation,
    TU.UpVotes,
    TU.DownVotes,
    TP.Title AS TopPostTitle,
    TP.Score AS PostScore,
    TP.ViewCount AS PostViewCount,
    TP.CommentCount AS PostCommentCount,
    TP.EditCount AS PostEditCount
FROM TopUsers TU
JOIN TopPosts TP ON TU.UserId = TP.OwnerDisplayName
WHERE TU.ReputationRank <= 10 AND TP.ScoreRank <= 10
ORDER BY TU.Reputation DESC, TP.Score DESC;