WITH PostStats AS (
    SELECT 
        p.PostTypeId,
        COUNT(*) AS TotalPosts,
        SUM(CASE WHEN p.Score > 0 THEN 1 ELSE 0 END) AS PositiveScorePosts,
        SUM(CASE WHEN p.ViewCount > 1000 THEN 1 ELSE 0 END) AS HighViewCountPosts,
        AVG(p.ViewCount) AS AvgViewCount,
        AVG(p.Score) AS AvgScore
    FROM 
        Posts p
    GROUP BY 
        p.PostTypeId
), UserStats AS (
    SELECT 
        u.Id,
        COUNT(b.Id) AS TotalBadges,
        SUM(CASE WHEN u.Reputation > 1000 THEN 1 ELSE 0 END) AS HighReputationUsers
    FROM 
        Users u
    LEFT JOIN 
        Badges b ON u.Id = b.UserId
    GROUP BY 
        u.Id
), CommentStats AS (
    SELECT 
        p.Id AS PostId,
        COUNT(c.Id) AS TotalComments
    FROM 
        Posts p
    LEFT JOIN 
        Comments c ON p.Id = c.PostId
    GROUP BY 
        p.Id
)

SELECT 
    pts.PostTypeId,
    pts.TotalPosts,
    pts.PositiveScorePosts,
    pts.HighViewCountPosts,
    pts.AvgViewCount,
    pts.AvgScore,
    us.TotalBadges,
    us.HighReputationUsers,
    cs.TotalComments
FROM 
    PostStats pts
JOIN 
    UserStats us ON us.Id IN (SELECT OwnerUserId FROM Posts WHERE PostTypeId = pts.PostTypeId)
JOIN 
    CommentStats cs ON cs.PostId IN (SELECT Id FROM Posts WHERE PostTypeId = pts.PostTypeId)
ORDER BY 
    pts.PostTypeId;