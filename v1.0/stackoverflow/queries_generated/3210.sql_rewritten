WITH UserStats AS (
    SELECT 
        u.Id,
        u.DisplayName,
        u.Reputation,
        u.CreationDate,
        COALESCE(SUM(v.BountyAmount), 0) AS TotalBounty,
        COUNT(DISTINCT b.Id) AS TotalBadges,
        COUNT(DISTINCT p.Id) AS TotalPosts,
        COUNT(DISTINCT c.Id) AS TotalComments
    FROM Users u
    LEFT JOIN Votes v ON u.Id = v.UserId
    LEFT JOIN Badges b ON u.Id = b.UserId
    LEFT JOIN Posts p ON u.Id = p.OwnerUserId
    LEFT JOIN Comments c ON u.Id = c.UserId
    GROUP BY u.Id, u.DisplayName, u.Reputation, u.CreationDate
),
PostActivity AS (
    SELECT 
        p.OwnerUserId,
        COUNT(DISTINCT p.Id) AS PostCount,
        COUNT(DISTINCT c.Id) AS CommentCount,
        AVG(p.Score) AS AverageScore
    FROM Posts p
    LEFT JOIN Comments c ON p.Id = c.PostId
    WHERE p.CreationDate >= cast('2024-10-01 12:34:56' as timestamp) - INTERVAL '1 year'
    GROUP BY p.OwnerUserId
),
TopUsers AS (
    SELECT 
        us.Id,
        us.DisplayName,
        us.Reputation,
        us.TotalBounty,
        us.TotalBadges,
        us.TotalPosts,
        pu.PostCount,
        pu.CommentCount,
        pu.AverageScore,
        RANK() OVER (ORDER BY us.Reputation DESC, us.TotalBounty DESC) AS ReputationRank
    FROM UserStats us
    JOIN PostActivity pu ON us.Id = pu.OwnerUserId
)

SELECT 
    tu.DisplayName,
    tu.Reputation,
    tu.TotalPosts,
    tu.TotalBadges,
    tu.TotalBounty,
    tu.PostCount,
    tu.CommentCount,
    tu.AverageScore
FROM TopUsers tu
WHERE tu.ReputationRank <= 10
ORDER BY tu.Reputation DESC, tu.TotalPosts DESC;