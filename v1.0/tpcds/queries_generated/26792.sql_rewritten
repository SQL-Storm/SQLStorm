WITH StringProcessing AS (
    SELECT 
        c.c_customer_id,
        CONCAT(c.c_first_name, ' ', c.c_last_name) AS full_name,
        TRIM(c.c_email_address) AS trimmed_email,
        LOWER(c.c_email_address) AS lower_email,
        LENGTH(c.c_first_name || ' ' || c.c_last_name) AS full_name_length,
        REGEXP_REPLACE(c.c_email_address, '^(.*)@(.*)$', '\\1[AT]\\2') AS obfuscated_email
    FROM 
        customer c
    WHERE 
        c.c_birth_year BETWEEN 1980 AND 1995
),
AggregatedResults AS (
    SELECT
        COUNT(*) AS total_customers,
        AVG(full_name_length) AS avg_full_name_length,
        COUNT(DISTINCT trimmed_email) AS unique_emails
    FROM 
        StringProcessing
)
SELECT 
    sr.total_customers,
    sr.avg_full_name_length,
    sr.unique_emails,
    d.d_year,
    d.d_month_seq
FROM 
    AggregatedResults sr
JOIN 
    date_dim d ON d.d_date_sk = cast('2002-10-01' as date)::DATE
WHERE 
    d.d_month_seq = EXTRACT(MONTH FROM cast('2002-10-01' as date))
ORDER BY 
    sr.total_customers DESC;