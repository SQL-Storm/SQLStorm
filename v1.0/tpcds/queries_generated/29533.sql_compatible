
WITH ranked_sales AS (
    SELECT 
        ws.web_site_sk,
        SUM(ws.ws_ext_sales_price) AS total_sales,
        COUNT(DISTINCT ws.ws_order_number) AS order_count,
        ROW_NUMBER() OVER (ORDER BY SUM(ws.ws_ext_sales_price) DESC) AS sales_rank
    FROM 
        web_sales ws
    JOIN 
        web_site w ON ws.ws_web_site_sk = w.web_site_sk
    JOIN 
        customer c ON ws.ws_bill_customer_sk = c.c_customer_sk
    WHERE 
        c.c_birth_year BETWEEN 1980 AND 2000
    GROUP BY 
        ws.web_site_sk
),
formatted_sales AS (
    SELECT 
        w.web_site_id,
        w.web_name,
        r.total_sales,
        r.order_count,
        CONCAT('Rank: ', r.sales_rank, ', Total Sales: $', CAST(r.total_sales AS DECIMAL(10, 2))) AS sales_summary
    FROM 
        ranked_sales r
    JOIN 
        web_site w ON r.web_site_sk = w.web_site_sk
    WHERE 
        r.order_count > 5
)
SELECT 
    fs.web_site_id,
    fs.web_name,
    fs.sales_summary
FROM 
    formatted_sales fs
ORDER BY 
    fs.total_sales DESC
FETCH FIRST 10 ROWS ONLY;
