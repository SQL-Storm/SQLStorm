WITH SalesSummary AS (
    SELECT 
        ws.ws_item_sk, 
        SUM(ws.ws_quantity) AS total_quantity_sold,
        SUM(ws.ws_ext_sales_price) AS total_sales,
        ROW_NUMBER() OVER (PARTITION BY ws.ws_item_sk ORDER BY SUM(ws.ws_ext_sales_price) DESC) AS sales_rank
    FROM 
        web_sales ws
    WHERE 
        ws.ws_sold_date_sk BETWEEN 10000 AND 20000
    GROUP BY 
        ws.ws_item_sk
),
InventoryStatus AS (
    SELECT 
        inv.inv_item_sk,
        SUM(inv.inv_quantity_on_hand) AS total_inventory
    FROM 
        inventory inv
    GROUP BY 
        inv.inv_item_sk
),
SalesInventory AS (
    SELECT 
        ss.ws_item_sk, 
        ss.total_quantity_sold, 
        ss.total_sales, 
        COALESCE(is.total_inventory, 0) AS total_inventory
    FROM 
        SalesSummary ss
    LEFT JOIN 
        InventoryStatus is ON ss.ws_item_sk = is.inv_item_sk
)
SELECT 
    si.ws_item_sk, 
    si.total_quantity_sold, 
    si.total_sales, 
    si.total_inventory,
    CASE 
        WHEN si.total_inventory = 0 THEN 'Out of Stock'
        WHEN si.total_quantity_sold >= si.total_inventory * 0.75 THEN 'High Demand'
        WHEN si.total_quantity_sold < si.total_inventory * 0.25 THEN 'Low Demand'
        ELSE 'Stable Demand'
    END AS demand_status
FROM 
    SalesInventory si
WHERE 
    si.sales_rank <= 5
ORDER BY 
    si.total_sales DESC;