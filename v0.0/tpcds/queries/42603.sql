
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '54712','84211','20558','25075','62541','78989',
                          '80401','80072','64338','81339','97066',
                          '92784','20817','84294','10503','88400',
                          '24852','97953','20480','17413','31292',
                          '40335','84838','63519','29077','64532',
                          '11178','38066','88081','42645','37053',
                          '50259','18395','39810','79150','82451',
                          '95529','60938','24876','84473','69012',
                          '82956','20333','66822','98901','24443',
                          '12334','27348','21893','54655','40878',
                          '46220','17808','88513','63266','29408',
                          '35739','38711','26418','60410','53302',
                          '49021','47748','97972','51690','27063',
                          '43746','11855','35897','81857','31175',
                          '59269','30977','14028','13372','20669',
                          '84914','76413','67582','12616','34618',
                          '41702','33123','39309','88405','20399',
                          '29519','46796','13601','68704','86320',
                          '13038','96035','72049','55212','55949',
                          '23612','65771','60507','10150','76937',
                          '79593','11656','61686','10030','16065',
                          '52333','10665','55230','55646','12910',
                          '71741','76378','16544','77462','72864',
                          '97802','39041','15539','84668','62652',
                          '19165','49529','32412','96673','57087',
                          '92583','63588','17717','97960','79084',
                          '12185','93751','96085','30140','19899',
                          '21740','16687','79754','92918','89366',
                          '35701','90261','71342','52105','22003',
                          '18573','74786','65581','18978','81045',
                          '85855','19766','89482','95744','55317',
                          '81195','38840','86894','55818','58829',
                          '27410','87807','34173','41786','81972',
                          '28621','99599','16310','67913','10375',
                          '38080','11904','16961','46512','29352',
                          '16867','87234','27638','34927','98792',
                          '99053','54382','39088','12722','82258',
                          '80618','26840','63310','53667','51557',
                          '82651','56653','86126','63299','35919',
                          '87622','13446','92283','23058','86096',
                          '95708','97281','58150','60835','58343',
                          '35443','85161','35722','37850','83687',
                          '75355','77599','27279','23905','13211',
                          '55182','59324','26711','33458','75811',
                          '69872','46739','34761','17619','13739',
                          '30453','19639','71176','43334','79222',
                          '30856','34801','68940','53596','20517',
                          '73656','66043','12460','39889','48362',
                          '29552','78599','22104','96347','14139',
                          '38837','25431','14612','17783','98029',
                          '57998','76055','42842','35866','32583',
                          '54289','50502','52304','90777','74223',
                          '61166','18802','43121','59989','93569',
                          '41205','65561','17885','36082','68517',
                          '68265','93414','41733','47372','90498',
                          '78369','82046','29459','69558','73994',
                          '29058','40043','55577','80790','90554',
                          '66903','78988','13358','58448','42700',
                          '29659','21046','54491','20769','11814',
                          '55989','55959','65063','18324','49977',
                          '16185','27232','30349','20455','95437',
                          '31601','63502','43106','28502','23331',
                          '11664','67799','53221','68450','34168',
                          '88195','51218','98275','15325','50994',
                          '26635','73518','97829','55665','97181',
                          '64313','96965','55266','53733','66619',
                          '73585','20590','24599','65668','77778',
                          '64262','31026','37530','51636','65855',
                          '47304','35098','15188','13880','13379',
                          '77920','82808','24270','93893','46864',
                          '84386','66262','14737','64426','25531',
                          '25793','90931','69867','34941','90923',
                          '95628','88197','88873','56804','72946',
                          '59590','14960','39495','33643','23595',
                          '15801','91194','33209','13119','74736',
                          '38282','21259','17571','54225','32714',
                          '33963','21277','62982','72404','11629',
                          '60140','98454','40561','45928','57387',
                          '54272','57195','31100','27728','54471',
                          '17149','51706','32136','48158')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
