
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '21114','24391','52473','79734','26924','42237',
                          '64623','75918','28782','49301','24668',
                          '12913','20887','63690','59436','33400',
                          '39103','16313','44305','29198','63934',
                          '17091','85568','63224','38754','56743',
                          '20826','96450','53636','41423','40334',
                          '87469','11875','64209','62501','61712',
                          '40894','47971','50855','36626','29230',
                          '18281','75217','37753','52959','95501',
                          '33059','50552','98967','54350','23233',
                          '32175','27454','82086','71307','83839',
                          '88250','27937','50723','99782','55384',
                          '58843','60914','26617','83062','38737',
                          '26428','34198','42297','78942','68423',
                          '87429','47333','50327','77065','15241',
                          '49734','71122','61374','93117','11134',
                          '10783','36443','60023','79525','38233',
                          '13992','24608','48670','54253','66473',
                          '81660','50756','45100','88560','30738',
                          '23436','64261','45837','65227','64321',
                          '40597','59647','39595','75657','33857',
                          '10368','30061','83824','96294','97219',
                          '36489','25945','30045','36045','73565',
                          '50152','73304','12744','48334','92623',
                          '25000','32002','28330','55521','21112',
                          '96041','54984','43074','25922','62672',
                          '92799','19667','77832','79948','73845',
                          '91454','75728','50267','15531','62702',
                          '47462','31618','43041','37140','29994',
                          '61529','34173','65000','40223','28669',
                          '99569','73055','75205','13748','47209',
                          '36965','17465','57212','42072','35884',
                          '69546','98350','27571','61238','91466',
                          '46933','13651','15559','67606','32414',
                          '90394','47610','55566','46892','66683',
                          '15538','47474','96102','33098','48145',
                          '23959','16172','51121','58972','46640',
                          '72094','86492','85744','66757','32859',
                          '50839','53344','58932','44179','82807',
                          '93609','10663','37695','54590','15629',
                          '89495','20896','27514','34874','61013',
                          '18071','52670','15368','58247','21942',
                          '76673','46532','26583','89437','63871',
                          '90157','11027','20612','19435','48545',
                          '66827','24500','48628','29683','54592',
                          '87950','91880','26017','58410','36400',
                          '11403','62454','60997','26963','13880',
                          '37763','34453','11385','90086','20965',
                          '21222','23662','50847','16002','11723',
                          '98911','46830','24434','75438','66249',
                          '44001','66949','77397','56552','94893',
                          '93335','12083','74012','97908','12651',
                          '58099','47293','46476','83589','45254',
                          '26906','34419','17587','89560','19457',
                          '94894','27912','69578','76725','90124',
                          '27606','69967','66247','18039','61745',
                          '31361','12806','94025','43727','54947',
                          '26166','36889','50811','39055','32133',
                          '85319','71477','67425','19325','13175',
                          '61729','86625','75394','90796','27485',
                          '34366','76962','58838','49515','14137',
                          '36838','17102','56211','70618','93273',
                          '77194','14123','94906','89798','80496',
                          '49401','21455','21270','38434','38045',
                          '67811','20141','19834','95525','72125',
                          '13941','57315','67039','72051','55056',
                          '12463','14428','32597','65452','11409',
                          '48934','79172','71604','18390','28807',
                          '23269','76146','24838','60435','47433',
                          '18992','84986','54163','38072','78575',
                          '66922','44035','51478','24532','79538',
                          '66724','38335','73532','75676','65180',
                          '61313','90215','74582','19455','54348',
                          '58029','60143','68468','21199','47605',
                          '50486','12847','53008','24232','11006',
                          '66315','76361','50575','75298','32627',
                          '65544','28819','75869','86855','12450',
                          '38745','10729','36507','83822','92139',
                          '76621','44836','73371','19558','52642',
                          '61730','32954','69377','98329')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
