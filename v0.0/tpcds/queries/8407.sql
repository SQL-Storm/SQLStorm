
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '85257','76339','39842','94025','60312','36898',
                          '96725','11170','76254','43164','11680',
                          '96639','93701','50079','11897','35340',
                          '15012','56614','69414','27852','67171',
                          '46678','35203','62506','50449','26796',
                          '78559','30726','36547','89546','65204',
                          '26361','51945','75276','42882','66930',
                          '52396','96789','26825','80151','64416',
                          '23740','84899','87353','42377','61540',
                          '11724','35966','78283','51224','93774',
                          '90561','40047','45233','97661','49651',
                          '30839','99488','63696','68035','18332',
                          '81502','74035','62283','19470','68610',
                          '77640','63807','61618','57041','38163',
                          '79831','63818','50687','15421','19183',
                          '33648','55632','94114','31383','90264',
                          '44395','91057','37251','11162','55650',
                          '67625','53886','10729','67814','89496',
                          '88269','97492','40248','13581','23053',
                          '87914','70060','43358','32281','45752',
                          '32900','26078','62933','21142','98054',
                          '27655','42245','14357','40208','14257',
                          '91652','18514','44479','28330','84759',
                          '55251','58243','14347','40831','95256',
                          '49195','72687','41874','11303','20089',
                          '78189','34714','67981','91187','35466',
                          '85705','32928','68366','61007','62868',
                          '55600','57696','32937','39522','92014',
                          '49066','88762','18146','34140','52006',
                          '43935','81886','65474','83474','33368',
                          '12598','84296','83157','35365','13572',
                          '22276','52867','81944','69768','71084',
                          '39922','86622','75343','35334','77363',
                          '40880','39438','66719','59836','48143',
                          '86144','12277','10285','75159','96615',
                          '50940','15701','89875','20655','12874',
                          '73225','41174','23466','39119','52438',
                          '93085','64567','45755','15047','67641',
                          '42437','95055','64082','72864','56327',
                          '36118','96057','30634','40550','22181',
                          '72322','88843','21364','43815','71622',
                          '56910','51130','10339','60486','75048',
                          '39309','28174','70008','19097','76910',
                          '65696','66143','77991','39351','91487',
                          '29377','11702','43847','97348','11619',
                          '45084','14705','25219','77131','40481',
                          '20367','64850','48826','48281','19500',
                          '22446','33985','84043','20550','55112',
                          '19703','38247','27071','72619','15139',
                          '40371','26294','28571','51839','66555',
                          '39685','44501','73389','42302','13471',
                          '79054','10706','33446','25221','70006',
                          '42891','31861','58657','37228','59997',
                          '33264','60814','57895','29546','45494',
                          '17411','27847','36665','83544','39290',
                          '21834','49616','25110','95695','87173',
                          '77398','58239','19725','59180','21877',
                          '84620','92516','13173','89306','30278',
                          '62861','28782','26724','21152','90265',
                          '30397','28957','18517','38032','25987',
                          '54876','27388','15999','79752','57827',
                          '93689','83140','73779','86090','14627',
                          '51936','94760','65681','30370','68674',
                          '18169','89643','27860','49833','17615',
                          '86350','42885','94225','35740','10445',
                          '43786','18661','15478','89068','73094',
                          '38641','84182','13983','29273','86239',
                          '28783','26295','70999','13321','56265',
                          '32682','54195','78394','29692','50590',
                          '92572','13133','48863','78726','52749',
                          '74133','70546','48763','85312','50699',
                          '72605','61621','17126','20418','12469',
                          '64096','43178','29469','36126','13348',
                          '63630','62938','10566','73938','49344',
                          '67497','85624','50943','29119','46946',
                          '25157','43458','58259','78526','79638',
                          '34332','84240','21451','28917','17329',
                          '75025','46426','27779','20926','93096',
                          '11792','56550','86462','29259','69523',
                          '60379','69005','52508','93039')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
