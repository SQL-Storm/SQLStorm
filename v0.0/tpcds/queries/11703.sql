
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '24655','64949','75582','36179','76915','13560',
                          '97640','37122','22253','73914','98336',
                          '36295','75231','65415','36183','74272',
                          '57231','42026','38876','80994','22966',
                          '86890','88672','96187','53571','55071',
                          '42363','92641','24322','65116','81353',
                          '20709','30001','34972','19406','99371',
                          '63238','20872','34507','78113','54248',
                          '33466','66664','94420','39127','31456',
                          '94645','36262','12556','51852','56621',
                          '31560','27495','37579','48718','49152',
                          '90692','23569','90293','44021','18794',
                          '98493','90542','88752','68636','79461',
                          '55241','34137','58797','87949','97453',
                          '90609','75823','94404','95191','22069',
                          '76163','81884','56286','25432','46933',
                          '92345','11510','13355','13836','76115',
                          '73115','80849','91365','28731','93454',
                          '35319','90311','62611','40071','44193',
                          '82348','33087','60822','37388','35789',
                          '45232','99347','52693','53047','92126',
                          '79582','16411','33304','28263','25836',
                          '36335','13542','16889','17449','73930',
                          '14567','41944','19107','16841','21975',
                          '22043','59652','47547','66688','42925',
                          '84609','71910','15801','77266','44009',
                          '53733','42007','94040','85870','66093',
                          '55059','21941','86157','15157','38137',
                          '76602','88658','60478','43313','95042',
                          '54905','37603','17991','85108','20144',
                          '31108','63919','67907','36790','67501',
                          '39953','96709','13101','58047','37564',
                          '30293','74364','22028','26426','28556',
                          '74396','26921','50583','62933','20841',
                          '26288','23900','54995','80168','52818',
                          '68761','40044','88351','26107','95471',
                          '32199','46112','44334','16086','37557',
                          '39479','40049','21366','62157','26578',
                          '24065','28485','44814','32337','52583',
                          '50618','11672','96816','94119','38031',
                          '62824','10875','55903','33144','45587',
                          '24200','16769','30291','13120','59161',
                          '31255','83508','82812','54712','90160',
                          '19820','25889','64195','35787','47519',
                          '68230','23472','68391','68086','75857',
                          '45630','20329','86227','47133','90037',
                          '61626','39611','70517','11425','43265',
                          '49402','28171','90972','11341','39183',
                          '85533','84881','80112','30129','86409',
                          '75976','11337','24928','36603','22809',
                          '39676','66284','74186','23969','58760',
                          '20252','31772','25297','57457','69457',
                          '59783','89328','83648','97927','91575',
                          '65642','12916','78264','30769','40554',
                          '39834','24827','89958','55156','75385',
                          '72162','14133','73542','59671','14986',
                          '91440','41080','80677','19022','53447',
                          '24465','96826','99760','58574','56346',
                          '69950','81557','17647','55380','41068',
                          '41247','94047','65920','37798','94261',
                          '87301','29201','49333','71572','93711',
                          '53573','29846','65013','73287','37763',
                          '10892','39988','63747','94283','89479',
                          '15236','26592','89638','30357','69985',
                          '87031','33560','63949','50168','72445',
                          '94367','11829','76987','95092','18924',
                          '16196','70281','45192','63152','50867',
                          '55749','99437','85282','39036','54405',
                          '88609','47794','89382','68825','11825',
                          '13932','25177','39828','53405','56188',
                          '80106','78563','18735','76517','11449',
                          '82259','79101','92962','22249','74907',
                          '48843','79930','78102','49843','11936',
                          '85798','15449','45928','97812','48675',
                          '19639','14596','22967','85146','97801',
                          '23473','19407','27613','54289','89459',
                          '21842','16824','47245','49385','75118',
                          '31304','85260','84998','53964','64409',
                          '92658','36801','10394','41835','68673',
                          '14934','16966','29194','58325')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
