
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '33853','74592','17991','27278','48661','67110',
                          '12244','85574','32138','41288','24759',
                          '43874','67651','61025','55966','34567',
                          '20605','14693','40634','86004','40002',
                          '49924','55811','24877','77622','29874',
                          '77361','22639','42199','33012','60549',
                          '80602','26197','76012','15062','34362',
                          '58739','45841','73215','67308','71548',
                          '53567','79344','30418','14992','63856',
                          '46293','11994','24420','16628','27365',
                          '97142','80201','15770','40502','56651',
                          '47385','23495','78517','19042','16686',
                          '88264','32647','85854','99011','55369',
                          '56091','64858','42809','13776','12328',
                          '19713','33328','34496','86213','15683',
                          '28081','80365','49425','85988','90304',
                          '48063','48466','66137','15761','57297',
                          '47592','56417','30443','14067','15710',
                          '42712','82515','48088','19904','87640',
                          '78726','86051','34835','68530','91902',
                          '84156','53885','55289','66718','21663',
                          '94445','87781','37180','53855','20884',
                          '90871','10667','25398','27882','14397',
                          '34616','21152','99508','49373','16006',
                          '29768','11394','12391','17721','30420',
                          '98196','17140','13607','16542','33604',
                          '76465','63390','81822','54650','63259',
                          '51697','86234','58616','87201','20482',
                          '48437','91859','51484','22752','84125',
                          '79931','90509','52867','51744','67660',
                          '65929','17656','99026','11221','56695',
                          '26832','67600','22924','75066','20320',
                          '30413','18277','93973','41524','55976',
                          '18725','37071','94304','85656','32278',
                          '47185','90966','55350','71180','68721',
                          '88413','33718','70742','94897','85881',
                          '23940','98945','71231','53731','69045',
                          '33849','59253','83239','13832','38433',
                          '26982','63876','57342','74336','24885',
                          '83497','93197','22579','18805','23749',
                          '59985','88608','52305','84627','39190',
                          '98678','83755','37468','63956','24512',
                          '20131','61545','97824','98921','45026',
                          '57233','85662','47584','35275','72827',
                          '94201','77708','14645','98085','63896',
                          '89391','11596','61101','26975','81657',
                          '44989','15037','16564','30901','60976',
                          '95329','89752','51157','27348','61441',
                          '56459','51641','67111','92540','57599',
                          '55544','88713','66481','92306','15620',
                          '82488','88105','20432','46976','41381',
                          '18408','56392','33476','19416','19147',
                          '88343','54474','87790','51266','41088',
                          '68757','15133','70993','47202','98949',
                          '63062','93440','92145','46908','57187',
                          '18213','19939','33305','52666','12519',
                          '18949','43335','10187','27921','11492',
                          '60330','45389','11288','23635','55627',
                          '72140','11560','41834','53410','92948',
                          '58679','70141','35444','88522','59182',
                          '38398','72222','37025','39614','26385',
                          '73027','43621','19992','88034','15519',
                          '60425','31793','66920','18293','36294',
                          '70815','21893','25926','20511','26280',
                          '38317','79411','73666','87990','15485',
                          '33629','27948','23010','46706','74794',
                          '22761','74350','40264','39544','55210',
                          '91319','41324','44425','23124','86472',
                          '55567','38534','87365','35224','63351',
                          '63497','81029','67963','68574','59110',
                          '12880','53363','13015','55902','90576',
                          '71377','11211','62417','40105','65509',
                          '36806','15813','68641','71478','39929',
                          '52338','85410','97575','27785','10644',
                          '43981','95787','45091','64481','55763',
                          '75193','77951','19981','20272','10048',
                          '30036','18828','47988','31208','16700',
                          '15360','58429','59565','87115','51630',
                          '88947','39149','33378','88993','64181',
                          '31888','40715','56555','17040')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
