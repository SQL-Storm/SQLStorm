
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '69509','46055','43920','62259','90529','35537',
                          '26372','73523','38710','86679','81671',
                          '74191','32940','32823','11725','53767',
                          '23344','86059','25266','44201','17178',
                          '10323','58940','47553','26848','65049',
                          '54242','62343','13566','66728','67015',
                          '33618','16408','43831','48753','24222',
                          '94045','76526','50125','38816','66322',
                          '61777','64826','80359','29420','60911',
                          '22440','26952','88116','17076','82748',
                          '68118','50843','18924','10544','42298',
                          '54361','21247','72678','34987','33738',
                          '97961','72376','81604','28836','64485',
                          '90257','64318','58283','27156','63333',
                          '21192','36978','88083','38680','26243',
                          '15124','17700','97152','60780','42623',
                          '34488','71333','16789','49843','57650',
                          '17647','98876','56025','75004','12775',
                          '77388','99454','14543','61256','12125',
                          '43048','43976','94406','82510','27309',
                          '58538','24841','30034','88215','61662',
                          '10177','35413','22803','69732','81633',
                          '66997','12238','89432','88026','12087',
                          '21305','13262','15525','19790','24698',
                          '89950','43949','70061','24366','36562',
                          '78455','54812','67454','37514','51301',
                          '39799','30962','19541','40627','42054',
                          '24691','72624','24029','53030','32784',
                          '78137','91646','62161','14678','13781',
                          '60199','22741','72545','71719','79653',
                          '72519','90027','87702','35656','91013',
                          '25112','59159','90969','10193','69319',
                          '18818','10629','76428','23894','28590',
                          '32501','72150','70035','56398','76659',
                          '89851','68255','15598','83243','68984',
                          '57553','38442','79339','51372','43873',
                          '19914','35520','16367','23241','58912',
                          '94931','13281','91660','64200','41637',
                          '63799','57909','17828','46519','51643',
                          '21216','21089','41369','65569','17793',
                          '25826','16753','82848','43251','72940',
                          '48821','80198','50985','31356','17414',
                          '96213','50618','98962','18015','15536',
                          '10346','99201','24162','32712','83399',
                          '76910','23731','41454','35930','70420',
                          '97235','27719','44585','29718','79532',
                          '45846','89538','85154','15079','10600',
                          '17000','27481','93922','11567','38471',
                          '80321','83419','79061','43823','52015',
                          '66652','77006','47681','94824','17787',
                          '20188','13142','24956','14459','38149',
                          '19739','48012','41579','60945','82729',
                          '70812','87094','19352','76268','75528',
                          '36523','38238','35321','82433','19423',
                          '29779','40660','34781','10467','28241',
                          '63969','57043','17259','42366','54543',
                          '65720','54513','64644','26161','50172',
                          '25526','64591','75239','12132','45856',
                          '62649','89370','29504','97742','52222',
                          '16624','52994','35433','62271','24201',
                          '38750','45129','54770','61096','18240',
                          '40347','76982','48703','64076','79430',
                          '23936','71097','65292','44904','45417',
                          '93116','87303','82480','23127','26403',
                          '45416','61020','47246','27908','51933',
                          '61926','34579','92097','97801','46575',
                          '97973','94834','73324','62177','51304',
                          '49080','74626','66980','34580','50576',
                          '65668','47426','27830','16693','82107',
                          '33392','88025','45794','92215','20205',
                          '23942','67045','84680','87346','24866',
                          '88764','86882','57475','71928','28403',
                          '48580','36164','41431','88381','73347',
                          '58881','34519','25682','11650','15658',
                          '97792','46478','15438','83264','66383',
                          '97460','68123','73306','54818','34306',
                          '80937','76646','27508','51859','56340',
                          '47453','94459','63149','68823','11489',
                          '18472','49718','99170','74135','21899',
                          '41119','42604','71255','74394')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
