
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '86759','64051','31301','29714','91438','37444',
                          '33094','36733','28714','68614','95155',
                          '85973','10616','29076','26730','95557',
                          '96162','39659','19887','26369','41733',
                          '32225','68710','55018','63189','86175',
                          '11366','65114','66299','66990','11340',
                          '10380','28017','18259','32137','38711',
                          '70257','71225','82971','51097','67996',
                          '94445','10108','92267','36277','67843',
                          '93749','89569','79614','28833','33906',
                          '15778','22559','23612','31795','19128',
                          '41607','66003','12725','32705','54984',
                          '22578','12388','81636','90135','80895',
                          '10779','19938','54166','83142','56401',
                          '38992','85690','73912','91683','49010',
                          '56566','47668','88818','46128','77228',
                          '61487','14635','25329','80813','75419',
                          '61822','95707','24434','38353','30947',
                          '46694','63658','94049','10903','31209',
                          '83683','61590','13924','47003','74285',
                          '91364','41180','76031','88489','37362',
                          '19664','22275','29249','64104','11817',
                          '45994','14422','56495','78466','53331',
                          '19598','10949','45064','41563','66689',
                          '97383','90342','14123','74177','52838',
                          '41033','55872','19948','51308','87266',
                          '88612','63931','29702','13135','32779',
                          '74512','62234','24649','25666','75329',
                          '37613','14703','44570','82436','51072',
                          '33404','37361','97203','80392','71359',
                          '57185','46353','69838','26120','12470',
                          '74620','18619','26998','32161','42548',
                          '28311','15384','94900','43330','53453',
                          '47985','38476','41738','32430','59039',
                          '10239','36171','17134','25050','59176',
                          '23271','53685','63412','23732','66963',
                          '98055','71280','73307','57108','12027',
                          '37591','58157','13788','51043','84891',
                          '28895','47630','89846','57284','93401',
                          '84380','37967','86079','69564','12988',
                          '42236','78213','80604','23051','68834',
                          '36946','19151','91501','24012','71196',
                          '45908','21221','38994','51889','37248',
                          '80569','26162','78413','17369','90997',
                          '76299','95709','50560','19389','65149',
                          '52034','39867','35404','55418','16925',
                          '58882','17791','91743','57067','50076',
                          '52655','58148','11745','11143','45676',
                          '23655','86679','82885','47338','91984',
                          '29724','40513','53746','98762','23523',
                          '49050','11967','59061','50654','96973',
                          '40238','61616','39195','37553','31720',
                          '16891','79068','53967','38585','25974',
                          '88934','87945','14675','55481','36440',
                          '77111','50767','26352','28828','56084',
                          '17298','41231','50774','18145','28389',
                          '54099','99151','45315','44688','93385',
                          '30077','29797','17055','37151','88989',
                          '46544','52481','76967','69549','30008',
                          '42658','39798','87455','33502','26682',
                          '39979','73814','33203','12265','18607',
                          '59232','56575','73707','68097','29940',
                          '96403','56730','82457','35473','94859',
                          '78876','54876','43893','36168','22255',
                          '77660','51568','61739','21028','27434',
                          '97550','10420','27365','49115','69174',
                          '13007','10126','12237','50207','38645',
                          '10109','17867','34639','96562','69179',
                          '28732','84291','81241','27392','31802',
                          '47664','13941','99718','88878','28390',
                          '29009','51259','26521','68873','11247',
                          '99699','34405','20645','44915','19741',
                          '67718','73723','49304','29507','65572',
                          '70037','67088','40183','49312','46156',
                          '63384','23253','21569','92880','70570',
                          '40010','29131','37797','53193','95114',
                          '51426','99558','28859','35167','32491',
                          '65463','73653','39454','99498','16380',
                          '86401','14724','35424','70847','23091',
                          '67882','12411','55598','19053')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
