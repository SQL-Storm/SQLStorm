
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '67456','29134','52830','50012','10570','40744',
                          '13508','60150','40289','46830','51758',
                          '39439','52864','38499','59795','37213',
                          '59377','52652','44205','36354','85676',
                          '36490','71835','45088','95096','96924',
                          '37982','26896','71285','55051','58670',
                          '24806','92807','20568','70150','30566',
                          '15194','85695','65645','31149','36456',
                          '62511','83056','14342','47685','79671',
                          '31936','97888','12105','91151','81133',
                          '29592','56064','70964','83888','71919',
                          '45569','72179','46716','79840','20902',
                          '10967','82087','12518','95861','23774',
                          '70077','59293','18836','27611','21862',
                          '41954','14762','65669','18845','97152',
                          '27188','74491','60333','74078','45667',
                          '52980','27543','64525','38372','97534',
                          '20671','14157','28062','71930','34236',
                          '57617','87632','85299','49000','56438',
                          '14997','10839','69978','42618','67614',
                          '18303','66707','13733','44303','58923',
                          '47661','98673','47628','65516','52817',
                          '60361','12629','38013','66295','99468',
                          '94315','85247','93925','62911','12610',
                          '53547','69870','64596','13595','95597',
                          '66454','42478','98236','32269','47807',
                          '90904','54231','58531','90328','99257',
                          '52068','26834','23059','71802','61580',
                          '28185','56651','90672','32984','56769',
                          '42854','17564','20882','35410','16090',
                          '93944','33413','32942','27578','30495',
                          '11148','42171','12543','71940','36458',
                          '14736','50299','40278','54785','83680',
                          '92069','79595','79744','34068','26464',
                          '10046','43352','20648','18292','12588',
                          '83354','55980','99607','62123','61607',
                          '48391','58168','86087','68375','60612',
                          '34528','67682','84056','70644','82109',
                          '65823','87601','47223','65043','94608',
                          '11458','52631','28286','30578','39348',
                          '45826','68422','57581','16572','48708',
                          '13808','68270','38062','10957','59572',
                          '47496','56503','71588','66997','80978',
                          '64187','44245','94086','69228','24147',
                          '76085','54547','99582','32495','98333',
                          '56676','16123','77829','61496','28920',
                          '78263','28191','22334','53916','56971',
                          '94180','71209','78273','94452','28684',
                          '79281','28111','13440','83703','71325',
                          '72322','45300','43363','62672','62840',
                          '70081','39151','95068','30513','79225',
                          '22096','40893','28871','24663','95310',
                          '94330','96977','58282','47367','20717',
                          '84606','38196','85274','17195','58754',
                          '37372','77083','25891','73142','76240',
                          '15270','69171','60192','99820','81784',
                          '96204','47923','74519','14364','75114',
                          '95779','16447','51571','98434','84019',
                          '45393','84048','44636','29563','31548',
                          '20970','52678','96396','81111','39340',
                          '76517','95840','53751','34568','31617',
                          '73067','31915','87828','54665','96936',
                          '34842','15183','33829','80273','12857',
                          '88680','79681','56997','41132','35342',
                          '19506','53171','16410','40230','42678',
                          '18810','94635','40964','36812','39045',
                          '10194','12790','99924','78984','79940',
                          '85036','46225','13315','54948','41329',
                          '87097','77715','64685','14461','60881',
                          '25387','35254','19575','65302','99664',
                          '93769','67229','81037','86202','15496',
                          '11780','70243','29420','96563','42964',
                          '25825','66109','62010','28208','97779',
                          '53435','11195','43956','55312','80957',
                          '97287','96509','59458','32731','77665',
                          '45717','17548','39283','44019','86743',
                          '64462','32350','38407','73915','96555',
                          '66006','28444','85511','94480','77188',
                          '50521','40562','20961','26868','32685',
                          '40176','10101','61003','17962')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
