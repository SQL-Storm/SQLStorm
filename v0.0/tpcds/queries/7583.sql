
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '96141','24114','32992','41979','56344','95956',
                          '76151','12592','33795','11480','31608',
                          '45422','33235','24854','71576','92756',
                          '30010','35185','78602','36732','54916',
                          '42365','76524','55989','75840','18261',
                          '90970','42812','76785','99708','74689',
                          '72587','40156','54202','74178','17880',
                          '45514','59139','52026','59438','66958',
                          '66974','26446','77796','62521','31897',
                          '84450','12604','73300','53484','27873',
                          '13723','71954','37789','40856','76735',
                          '69266','15348','97149','10884','11091',
                          '95556','27456','59403','55888','13725',
                          '17635','78681','67803','94314','82227',
                          '60968','70226','89309','27630','44138',
                          '10537','26569','24412','42407','72575',
                          '16948','13518','83403','52317','60442',
                          '35849','91425','73707','39012','71450',
                          '89214','35661','33624','47000','16272',
                          '70532','22151','60512','86819','49868',
                          '45412','34405','33413','29507','27688',
                          '21807','45643','37335','45164','47922',
                          '91457','76948','21946','35234','18378',
                          '53770','14146','31193','57915','75811',
                          '25818','32534','64021','61463','45799',
                          '89055','57525','87247','48699','13492',
                          '22631','15844','67966','32980','29511',
                          '54147','33251','55848','51233','15809',
                          '76340','73815','25069','89897','11685',
                          '57813','27045','22859','66869','17669',
                          '29260','77631','17860','40258','51471',
                          '69061','70989','78717','76411','13787',
                          '45873','52159','90858','60378','35037',
                          '27856','31851','66867','29667','19269',
                          '32153','82554','91465','34040','10488',
                          '26959','20359','51609','53437','94627',
                          '71008','34921','54880','36502','39287',
                          '62975','23098','30723','38916','40209',
                          '97921','47374','22435','19776','83443',
                          '66395','14086','43228','81644','34417',
                          '12072','61997','58065','63343','61667',
                          '30534','95992','47435','46651','63976',
                          '24475','52558','34102','94574','99626',
                          '98657','24878','14853','52088','82782',
                          '48218','15657','75268','11348','24737',
                          '57533','95692','30529','21266','89026',
                          '33910','88462','61758','79241','40326',
                          '17650','39722','63873','66264','14029',
                          '83489','71388','67817','82055','45084',
                          '57982','90889','39946','49126','51815',
                          '78359','45057','45925','72916','46408',
                          '49969','13512','27569','41013','39859',
                          '94328','38863','26923','51312','80928',
                          '77512','55183','46737','52017','17555',
                          '46677','40726','43724','72837','11218',
                          '60605','88853','23861','55882','49870',
                          '49243','55104','85284','97962','84661',
                          '57584','35958','93050','22189','41484',
                          '11614','32007','56719','94633','62545',
                          '52056','25295','26999','43082','41049',
                          '25112','39951','18529','44953','40822',
                          '72946','58696','82320','89978','16755',
                          '88312','17875','11771','91239','87561',
                          '39814','13910','16071','29664','56477',
                          '94536','49981','34437','60210','26878',
                          '35015','16225','95291','79011','86578',
                          '69903','98457','13827','63050','62163',
                          '83798','67654','21010','89050','29161',
                          '78452','90067','17636','20257','79574',
                          '94193','58925','13654','42367','64075',
                          '76108','28069','54236','76435','22308',
                          '58441','98787','31625','43811','32786',
                          '98614','24577','55127','86627','81812',
                          '21543','48626','52658','25641','50946',
                          '93702','12438','11491','17010','46886',
                          '82660','46614','62658','53938','22985',
                          '70358','94429','76286','11306','23070',
                          '83938','32832','49526','17269','16897',
                          '32532','18704','21055','12687','10545',
                          '99005','96072','52046','37394')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
