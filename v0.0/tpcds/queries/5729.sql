
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '45992','22546','97804','62077','64083','59747',
                          '59375','26983','40774','56382','42375',
                          '16102','72296','51800','28164','64442',
                          '64350','14454','79114','18186','19323',
                          '35747','81296','50864','89558','11850',
                          '14408','57174','64518','87102','13047',
                          '59819','47104','90842','37906','90365',
                          '64788','12936','64039','55769','75854',
                          '46345','17336','47820','90031','35393',
                          '60274','25426','38853','39549','11707',
                          '45113','45323','36067','23743','12003',
                          '51592','13731','70911','19561','77652',
                          '63415','74314','84903','43878','28298',
                          '10214','24137','11503','19090','55552',
                          '74476','50025','64781','80645','28022',
                          '98661','57443','90881','28050','62272',
                          '19459','45057','83806','58307','44120',
                          '40707','62103','19412','94341','27593',
                          '96667','43033','51764','19571','56725',
                          '94729','75964','82623','90427','12474',
                          '96064','56512','36584','38411','73210',
                          '22677','87390','89129','26688','18374',
                          '87955','68353','13754','27200','11962',
                          '48019','20659','21223','80053','49128',
                          '45160','10942','96439','24764','38004',
                          '85105','59696','86937','98279','13338',
                          '28068','53371','91635','12117','54372',
                          '45036','32956','44009','53594','93436',
                          '15225','93037','17657','29286','55329',
                          '72355','13575','37555','46287','76266',
                          '60435','20503','76283','39537','20638',
                          '51679','69517','84581','29524','18841',
                          '31796','75615','64335','52694','34998',
                          '21419','74027','46209','55314','31417',
                          '14585','53783','43413','84766','15263',
                          '46732','53923','39628','60012','21559',
                          '96461','21319','93056','82674','92318',
                          '67906','70556','77107','46334','73005',
                          '45228','17560','74641','35416','41141',
                          '79720','51486','25696','13987','29309',
                          '28727','48039','27331','83645','59956',
                          '96594','75932','17777','87787','36474',
                          '43905','55559','78590','61376','22016',
                          '22940','46376','31228','71437','42758',
                          '11131','19344','31043','43576','87521',
                          '81633','25853','60846','37975','41196',
                          '64469','31104','24756','50033','37658',
                          '58206','33097','21136','37297','90354',
                          '75954','54367','98813','96822','52686',
                          '80971','34603','25299','54404','95137',
                          '90706','63520','86837','59977','73693',
                          '80969','88302','44822','99197','52452',
                          '27285','91074','64845','73072','38970',
                          '77056','44465','18382','11403','22575',
                          '65785','57264','86017','10770','73135',
                          '18689','40787','25266','59924','84216',
                          '24708','55882','67083','25485','39572',
                          '19253','20720','42744','22043','34123',
                          '16731','33747','97527','12550','15308',
                          '55817','14900','11761','26213','45722',
                          '81079','61544','61150','76057','40422',
                          '23182','49284','48372','13628','71400',
                          '13077','44525','44125','76090','93250',
                          '38789','78293','29157','51115','22115',
                          '49126','48924','61585','79337','32378',
                          '30951','30632','45377','48408','21304',
                          '50438','51888','19935','51220','60018',
                          '91108','89823','18193','58773','72262',
                          '11861','14860','44004','61518','26132',
                          '14343','14993','27659','58162','67376',
                          '91632','21548','75414','24304','81723',
                          '91644','17467','68200','54716','12582',
                          '23820','96580','58373','90348','50095',
                          '37954','30571','24297','10171','23983',
                          '36049','27658','53982','29323','89352',
                          '51107','99383','29872','55998','80129',
                          '51566','96922','43341','62755','37290',
                          '20615','86517','34693','37125','49474',
                          '23090','19878','67612','66747','16088',
                          '35031','49567','30637','69660')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
