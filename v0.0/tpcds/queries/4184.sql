
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '18068','15169','21745','33071','78213','96047',
                          '59369','11897','84951','15918','67171',
                          '67987','51851','15078','75798','46606',
                          '81289','27876','14811','60750','25546',
                          '96543','50437','54889','30225','70111',
                          '40047','20041','21119','23790','75136',
                          '74269','67481','84462','38524','38163',
                          '15123','46355','11697','62448','90264',
                          '39300','62170','67625','35402','54999',
                          '50625','10331','35957','64904','45752',
                          '86704','16841','22025','98831','14257',
                          '28339','86466','55251','14347','85765',
                          '59439','11303','90246','93605','51475',
                          '62163','26787','74074','33521','71643',
                          '33732','48038','17359','66850','59592',
                          '79980','29640','63469','74119','68265',
                          '72198','88192','68590','92861','60760',
                          '18997','15594','93690','35731','23134',
                          '86642','58512','17916','52420','24541',
                          '96637','72018','63717','44446','73703',
                          '36334','97063','12899','59755','72750',
                          '73059','50770','11228','66928','91487',
                          '82919','11081','19554','12384','49333',
                          '60908','42341','17190','70416','69678',
                          '37253','86344','18454','12145','15110',
                          '89095','77025','14752','50594','61526',
                          '31861','65542','12792','28190','35461',
                          '39065','63661','30667','65778','47831',
                          '34019','59180','79684','27984','11223',
                          '71968','87767','30397','69585','74871',
                          '27388','71314','20853','22683','22043',
                          '94760','16624','31777','16229','82366',
                          '12477','62005','42672','13159','73094',
                          '80567','29273','30799','60703','56265',
                          '89896','66148','78102','86757','52749',
                          '43111','78196','80963','93091','49172',
                          '41613','19225','58557','10566','12992',
                          '67292','35752','36061','35605','72974',
                          '77559','28917','25218','53856','67340',
                          '62593','11157','54054','67026','94426',
                          '44340','94422','59935','57956','92264',
                          '76721','27389','18751','69526','22020',
                          '53152','71360','34163','59549','40279',
                          '12905','68681','88996','97665','31324',
                          '11717','16722','22245','39683','67832',
                          '24366','32768','56603','13935','70241',
                          '74182','82263','43307','40967','21337',
                          '88328','16093','74317','57099','58830',
                          '15283','39389','27203','43494','25817',
                          '34017','74328','10373','30920','31660',
                          '67621','55827','59997','22975','52110',
                          '24942','31995','88960','62611','15552',
                          '21710','14353','34329','65438','80621',
                          '48393','92449','37495','76100','78550',
                          '87633','37272','49418','50436','14538',
                          '40862','71632','70308','40406','26851',
                          '48309','79120','15715','94460','50374',
                          '33688','41181','63704','14295','96542',
                          '94732','61215','23378','76327','33582',
                          '40828','93179','20847','97859','86849',
                          '28821','97439','70058','59063','22971',
                          '51845','18639','69399','14861','63833',
                          '43959','81083','19324','24291','36161',
                          '78645','70439','20503','46096','36286',
                          '44999','95729','52113','16887','85213',
                          '23717','10419','54563','91358','79232',
                          '58170','88915','95070','63542','31739',
                          '34516','21802','11101','15777','81441',
                          '11553','77098','81051','87711','11732',
                          '38857','53129','41317','75119','28222',
                          '42067','69971','10918','67494','30350',
                          '69019','32019','17238','57033','71754',
                          '20267','86037','59844','41096','31516',
                          '30344','89033','11610','12131','63158',
                          '68706','63507','75472','51153','90620',
                          '38754','62402','20541','92694','53689',
                          '71892','43944','31860','57378','39594',
                          '23533','73235','18890','32128','47996',
                          '79761','31621','45523','24494','26950',
                          '35190','84503','28078','96520')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
