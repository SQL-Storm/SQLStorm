
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '70006','87137','58711','77013','36244','81200',
                          '29550','17912','61038','54812','49442',
                          '34908','14636','77403','13470','52198',
                          '12689','27211','25366','59703','55677',
                          '20722','96560','41466','43675','17514',
                          '51034','71269','57910','14504','83322',
                          '51558','44065','90932','11860','17184',
                          '47664','49339','85772','96078','51760',
                          '74883','68450','38631','78338','79412',
                          '86620','30507','61746','61957','25995',
                          '20052','44412','50320','77449','16777',
                          '80161','45931','13486','95096','83751',
                          '11560','67124','51745','78585','24277',
                          '24489','40800','33403','37578','86843',
                          '63418','12313','64470','51697','31394',
                          '85261','16365','60216','40072','48958',
                          '77927','31490','56397','88864','91416',
                          '57286','31068','59889','90839','57848',
                          '33262','20547','11784','38577','33952',
                          '83325','41153','26790','69549','58754',
                          '80219','54508','18776','79990','60020',
                          '54323','31742','42632','24911','92994',
                          '34941','10402','61274','48557','56706',
                          '68225','61240','25633','13432','99366',
                          '81593','73211','93255','80243','55955',
                          '57348','85872','78236','60092','63719',
                          '16228','73208','43158','79107','70491',
                          '13926','30593','77113','16099','89170',
                          '53661','23937','65493','58703','48682',
                          '70923','99104','57803','61974','13653',
                          '35561','86991','50648','59211','24815',
                          '42372','37116','85403','91901','20252',
                          '58561','29737','97359','35998','73845',
                          '73828','35943','49772','58419','37315',
                          '35262','78393','54353','55945','73983',
                          '50778','74605','46212','57961','44540',
                          '14564','38729','70639','12231','15910',
                          '38440','49817','42245','27221','69801',
                          '13050','29411','11926','59911','40485',
                          '83648','66104','52665','12415','39925',
                          '85235','78410','71703','93544','52231',
                          '54460','24476','83541','65011','83847',
                          '75473','99645','83477','26673','74353',
                          '56676','73388','94539','75735','25779',
                          '59001','47014','86322','65812','62505',
                          '61986','77116','11635','21305','21162',
                          '15810','67087','23150','52567','17005',
                          '10450','66077','95513','70703','57280',
                          '80102','96007','72276','31528','42568',
                          '24401','19397','94673','83155','92152',
                          '31770','23175','42553','23328','57031',
                          '28082','41693','17117','36681','92408',
                          '20209','45840','14201','28953','40148',
                          '56142','27842','22170','72238','18716',
                          '23243','48509','92594','64773','28526',
                          '41559','16987','15828','70884','40045',
                          '51969','48743','41857','69552','82840',
                          '77441','56108','68839','61570','38637',
                          '26656','70778','49025','46016','38021',
                          '31749','26907','49170','40773','75867',
                          '31745','55607','68940','94967','26979',
                          '35824','97188','85980','37045','39452',
                          '90985','46368','21821','16521','25171',
                          '26456','49740','11805','92531','32836',
                          '70798','48559','78786','73786','74101',
                          '86974','97251','97610','10976','62076',
                          '40748','17414','35010','14581','80301',
                          '13196','48784','16821','52205','18197',
                          '15224','99062','88485','52856','28459',
                          '17242','98309','89622','44158','10740',
                          '16066','69454','65921','67333','78651',
                          '49666','25030','16402','46709','66455',
                          '18021','63890','24994','22134','87973',
                          '99653','45346','25427','21962','98654',
                          '60783','23645','12898','59665','92987',
                          '44574','69305','10328','93679','14069',
                          '37914','10170','35487','71601','30980',
                          '67241','57225','13951','14585','89889',
                          '89891','49026','96692','57850','85683',
                          '21075','89481','83544','86972')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
