
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '22658','45220','99747','37383','66843','94482',
                          '14627','37906','68349','52604','18639',
                          '16383','13349','19354','17290','67132',
                          '78597','48948','27467','63362','82199',
                          '21654','87845','86586','69370','42851',
                          '83220','41254','84523','66635','71782',
                          '70789','73477','71819','35491','66476',
                          '60464','45453','27131','36479','17791',
                          '47362','27260','41693','39449','28837',
                          '33553','32271','49276','17077','82305',
                          '99416','36477','96463','53689','85958',
                          '21427','92945','11886','30423','97965',
                          '60054','83998','27804','67787','13658',
                          '14948','33986','46135','92142','36369',
                          '22121','32015','52237','64817','60497',
                          '32109','70082','71983','36639','93515',
                          '47626','71095','82562','96349','17496',
                          '18326','45644','69795','58507','16707',
                          '40418','14279','78668','35665','49576',
                          '34318','73782','22607','18865','37614',
                          '54871','52494','32028','18801','41863',
                          '86846','59996','15246','36183','44248',
                          '37975','56007','24073','49260','58827',
                          '90664','16642','20565','54875','25930',
                          '76097','23646','28923','53761','48000',
                          '11834','14337','31601','29513','59998',
                          '75637','22270','47338','76891','28598',
                          '34841','67649','19688','15949','25255',
                          '49361','14014','57512','36421','75521',
                          '19167','66397','36505','65694','21886',
                          '25784','45681','58327','62884','34716',
                          '73722','28574','12841','33163','99424',
                          '74187','95659','38258','52493','64468',
                          '67154','29861','38741','88248','37302',
                          '22686','45939','70061','30559','62812',
                          '95571','30277','12616','74812','78830',
                          '34306','16375','37756','21327','66749',
                          '95024','50894','39144','76225','27391',
                          '19267','30996','11653','30976','38806',
                          '51429','66583','30875','51388','37517',
                          '54839','36964','51165','22326','93911',
                          '69032','10796','54553','59369','28729',
                          '31460','44668','64473','61614','54689',
                          '77341','87193','74460','73975','25173',
                          '81432','77947','59119','57778','31275',
                          '16443','75180','22002','34458','78796',
                          '10524','53166','71790','26707','47513',
                          '10221','45079','64531','17434','74765',
                          '84816','11349','35407','34656','13483',
                          '35177','94020','90534','50333','59356',
                          '20841','94642','31323','10316','78039',
                          '37390','21633','30458','21553','40337',
                          '95832','30159','29104','25522','20214',
                          '31468','38318','73323','72603','15878',
                          '67133','12061','94351','16024','30087',
                          '83588','92473','72848','35226','32736',
                          '42478','18999','87867','77758','56544',
                          '45196','88137','62673','69092','81598',
                          '73488','85838','10194','47709','63871',
                          '52741','49061','85267','14869','90078',
                          '26713','81793','87184','46332','25106',
                          '57027','18607','34351','55417','43244',
                          '61593','16763','24454','69435','15175',
                          '47661','23213','42162','80718','93319',
                          '40570','21272','18512','19848','49142',
                          '96318','97561','31016','42485','32588',
                          '59941','70770','53490','38297','34874',
                          '27453','95545','89637','34302','27226',
                          '25164','92378','61819','57735','12431',
                          '15268','16933','78298','12272','78666',
                          '79245','76917','40489','17033','86998',
                          '46233','14622','68364','39827','28901',
                          '56656','91929','40566','54309','63640',
                          '11020','28591','30641','21904','50042',
                          '57535','97440','41133','69704','35803',
                          '34934','27075','46341','38282','33424',
                          '57777','29856','60356','15032','85516',
                          '36365','46494','74918','24209','14918',
                          '67919','19004','10410','38852','17930',
                          '33973','34704','16492','94302')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
