
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '50479','64666','68837','29772','41252','63725',
                          '50955','75765','61225','16400','37839',
                          '30357','25095','40582','56622','36544',
                          '96773','16725','31147','56736','52368',
                          '22565','33189','40654','15897','96597',
                          '80078','22818','20100','22514','42094',
                          '16437','57433','22455','20829','19081',
                          '37603','82697','67369','77809','52229',
                          '96475','12203','85108','33795','52349',
                          '86795','63905','73648','45246','58012',
                          '16746','23937','10022','19206','45191',
                          '35412','11463','59441','79294','49548',
                          '59523','28328','62838','60314','72449',
                          '43028','33942','59508','11106','38169',
                          '91358','33163','52601','16632','42738',
                          '59172','17190','29487','24948','60260',
                          '10840','69646','12451','71799','83710',
                          '45516','80334','64852','63718','98981',
                          '19613','23434','78704','99233','26424',
                          '41369','72925','74130','62581','69008',
                          '14363','13261','11786','84685','86630',
                          '10275','43530','57269','22199','63047',
                          '64967','29656','46162','95036','53006',
                          '84487','10244','75316','20883','71649',
                          '17098','18889','54537','98511','11780',
                          '50176','33589','98597','26775','23652',
                          '34131','98942','75026','71660','14208',
                          '63099','31537','77966','44072','35320',
                          '61844','10754','38502','10132','33865',
                          '58561','54877','53804','79999','83323',
                          '52965','80615','17187','76731','70264',
                          '31969','66755','52057','11364','80400',
                          '96607','42755','77614','25100','34892',
                          '57776','20817','53400','15386','45747',
                          '48606','60411','15477','29980','77022',
                          '44173','24656','83439','91020','52533',
                          '11723','53961','63564','84131','34761',
                          '72277','66993','59825','45482','19453',
                          '41919','88883','11330','92183','75283',
                          '35313','29588','34274','60609','61188',
                          '26312','46140','27874','40701','70327',
                          '25592','52918','13557','16299','19165',
                          '47652','23291','33516','34483','84007',
                          '77269','28804','23667','75505','80148',
                          '72191','49220','84486','14518','15541',
                          '65303','85717','22037','73679','29151',
                          '78635','25983','56604','37861','88703',
                          '52647','33474','16913','94812','29018',
                          '54671','53889','33230','51997','32822',
                          '21614','83944','83779','16338','35615',
                          '72578','60891','26914','27219','48268',
                          '80308','53097','69184','41224','15562',
                          '97538','92628','43182','87622','19459',
                          '15307','53639','77651','36366','45518',
                          '23552','40632','17965','94741','15365',
                          '66812','85525','17037','12681','32392',
                          '72788','46114','61460','98972','81909',
                          '55493','22172','92543','54207','12733',
                          '98950','29994','12895','64400','33291',
                          '14153','47574','21663','94517','22433',
                          '68144','51071','13915','96871','48901',
                          '49814','36846','29491','96360','40130',
                          '74163','77785','99384','28735','95593',
                          '29126','94643','17718','79104','75282',
                          '23992','19639','77973','45588','95699',
                          '52633','44703','25627','29396','94407',
                          '78073','49673','36858','46958','55827',
                          '32008','56666','71881','58829','32162',
                          '32494','14087','33250','76273','89174',
                          '19527','13950','22564','87244','20723',
                          '79352','19078','16308','64344','33144',
                          '20344','63957','56335','52916','32901',
                          '61770','58057','34044','96157','31115',
                          '79560','25024','43274','13445','46317',
                          '50303','41530','88530','94923','97929',
                          '41401','73670','40810','25287','64885',
                          '55218','24638','57808','49134','55439',
                          '75111','90665','22735','31792','61643',
                          '54570','23066','32151','45501','14242',
                          '47584','39982','78959','42965')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
