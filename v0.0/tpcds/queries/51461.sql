
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '90091','51677','11209','44994','62122','27683',
                          '14076','74919','46729','39532','26766',
                          '33561','57468','64076','33729','34490',
                          '82470','42818','53203','69962','37872',
                          '98250','67213','86960','57569','35082',
                          '43271','42280','46987','27109','85873',
                          '33853','22374','16672','87160','88707',
                          '28226','18207','53386','73558','30867',
                          '63939','70458','49154','52473','83997',
                          '25009','42691','90088','72555','41645',
                          '30199','64596','42728','75210','99445',
                          '54296','50414','10366','37033','29886',
                          '60585','87520','46727','75260','92988',
                          '38151','42746','73084','35149','53773',
                          '31544','21532','26041','73592','12971',
                          '37289','61909','83539','51423','43123',
                          '15895','13522','52993','72165','15531',
                          '57591','84769','18924','14373','27552',
                          '83168','99315','48269','34740','45111',
                          '93494','27095','38395','31844','79664',
                          '95967','19665','48231','40694','25070',
                          '20424','42737','27058','25399','13499',
                          '82497','70874','80255','30448','93989',
                          '16834','70877','51692','11585','78781',
                          '50993','36597','66912','95301','24562',
                          '52533','80970','91564','10871','69115',
                          '76644','18002','42984','88475','75480',
                          '89231','19066','51410','98122','44637',
                          '72829','11735','56023','65237','26098',
                          '83831','54372','20385','36362','83054',
                          '67912','23536','83429','10638','82815',
                          '36742','60929','65936','77374','11467',
                          '92440','58563','16689','27469','19833',
                          '95107','15098','86514','92342','32760',
                          '96262','96867','13344','67966','14378',
                          '44511','60961','19276','31486','14727',
                          '31562','18127','95166','97935','57245',
                          '18699','52494','59557','16968','76714',
                          '64731','47065','10982','37862','22606',
                          '62324','84430','47304','39194','55696',
                          '93072','92860','31307','80833','67856',
                          '29044','88343','32205','50393','23315',
                          '56240','91322','32372','20865','97290',
                          '83766','58725','57845','37760','22919',
                          '55632','85337','16287','46596','19592',
                          '63733','42479','22224','72966','59684',
                          '16600','83134','35255','56474','15372',
                          '18937','27692','97209','22040','16513',
                          '18608','62689','59747','31137','29503',
                          '84679','16135','90575','61974','33117',
                          '52751','81403','52884','33518','75135',
                          '18738','55776','79254','98235','56482',
                          '52271','10766','77195','45106','52946',
                          '60440','62995','82631','15192','24603',
                          '20947','14687','56612','24910','33730',
                          '80346','67894','89422','73545','24106',
                          '10618','14835','19360','13251','37532',
                          '27515','45875','32803','21719','18473',
                          '10471','46967','53777','75663','48092',
                          '33171','86893','10054','51858','22025',
                          '77525','62484','10137','44610','70760',
                          '11013','27355','28247','96294','22366',
                          '61556','45436','63370','35802','10972',
                          '43717','37514','61478','60124','80289',
                          '43021','51974','11604','29776','12695',
                          '41482','61988','14097','16421','66472',
                          '48090','57802','22705','22800','45837',
                          '19104','44440','19747','93302','32016',
                          '15571','65646','52393','31516','32959',
                          '71876','94836','50385','84926','15253',
                          '91305','70585','64670','26892','17229',
                          '28637','16536','48564','77777','37743',
                          '23294','74035','78188','90867','41065',
                          '26195','53755','45389','36716','17209',
                          '55296','67697','36153','40395','49846',
                          '20579','45746','39804','32520','22866',
                          '45773','50291','53200','70930','43338',
                          '61105','26560','50817','61849','64546',
                          '18581','36084','50864','68342','74191',
                          '35408','73311','78750','64761')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
