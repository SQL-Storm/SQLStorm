
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '39436','37218','71053','14608','26681','38379',
                          '13098','14494','86513','13511','54885',
                          '48236','25512','92155','93992','63922',
                          '40553','88422','95310','90697','14675',
                          '22254','96428','27512','99928','52219',
                          '42698','49797','26947','59839','36653',
                          '89699','45107','70013','23439','28329',
                          '51306','74147','79855','60628','37491',
                          '28204','26039','65605','26658','23816',
                          '12558','99801','41813','68471','26943',
                          '40124','48952','75144','50207','70250',
                          '98971','12169','40495','35726','45664',
                          '28666','26897','29612','57162','90337',
                          '95648','30460','11397','41555','12741',
                          '29590','66349','60038','70909','84146',
                          '12666','32955','98544','15343','43160',
                          '34615','45797','46256','48968','67463',
                          '29440','34395','82373','67336','98140',
                          '37032','35797','95774','88705','15991',
                          '92876','41507','63684','70321','45199',
                          '65269','46456','46389','63251','57631',
                          '26477','90576','72960','11558','17373',
                          '69158','14948','45166','47247','27934',
                          '67431','25317','53962','24114','88360',
                          '55195','32590','62837','25366','77198',
                          '29303','47321','90983','34642','52420',
                          '39418','31733','97566','87133','65800',
                          '41955','19801','39693','85846','13102',
                          '64910','38854','10690','79558','36177',
                          '34335','52596','14981','12393','66382',
                          '59792','51831','70727','23454','89024',
                          '20628','98225','59945','69794','82466',
                          '73417','57691','42630','36269','41457',
                          '99459','66401','43205','38359','80757',
                          '96397','13213','23792','40028','42959',
                          '52072','15812','89050','75214','10920',
                          '36425','23530','24807','15108','27493',
                          '23299','72545','83960','42260','35757',
                          '50408','21677','15949','80813','65729',
                          '55945','70675','85663','52158','82818',
                          '45902','26241','47243','15609','13951',
                          '33308','52157','46783','24928','51754',
                          '35106','68137','49833','73020','11433',
                          '60133','55882','21840','66637','66451',
                          '34686','38931','15177','65321','13399',
                          '40516','25016','61474','94412','33927',
                          '83728','41920','42709','61704','85743',
                          '33894','42228','60345','94918','29197',
                          '24403','97098','80273','48908','53663',
                          '78911','15951','91138','30415','30393',
                          '24637','12771','48039','25699','41684',
                          '12905','52571','21684','64289','62628',
                          '25941','67868','31308','12382','90399',
                          '95798','19093','60593','93486','37441',
                          '38688','94376','32517','53085','96943',
                          '39322','20433','26198','64319','90637',
                          '30412','68470','46176','70071','41369',
                          '14623','90300','48756','21702','16602',
                          '92087','52164','23943','10647','43267',
                          '74773','28662','21453','12970','85103',
                          '95566','44001','35947','65778','14799',
                          '29031','62259','51845','96379','49758',
                          '55033','26135','21688','46080','78871',
                          '33804','30665','77988','13500','23469',
                          '32651','94884','58673','68961','36401',
                          '12623','74100','87523','80739','47780',
                          '16360','17485','74242','90360','58074',
                          '60325','50827','35638','61608','60915',
                          '87989','10017','19349','71678','73486',
                          '12999','47131','60461','59533','36609',
                          '15896','47254','47653','81721','39804',
                          '52607','19858','27467','59294','16962',
                          '66179','34056','26759','63396','29822',
                          '90260','65925','11574','71175','79921',
                          '55227','41017','55025','28955','75221',
                          '90668','16626','38504','35267','77870',
                          '71663','12552','63316','78097','43087',
                          '20322','31655','86344','15015','55522',
                          '36818','12680','17445','49766','78652',
                          '63220','82068','31065','46848')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
