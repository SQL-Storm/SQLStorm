
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '71194','26713','32011','54321','92545','21287',
                          '40910','23953','36573','83286','79905',
                          '47297','29646','17527','12629','96527',
                          '37778','52301','96451','49880','34504',
                          '35701','14237','15429','91028','23951',
                          '35917','60593','41124','26130','25586',
                          '85239','60659','32207','89672','18142',
                          '33900','91591','46745','51852','20969',
                          '66064','83970','52036','57471','98896',
                          '25518','58847','75768','16827','27357',
                          '39642','89689','91002','89614','54723',
                          '36303','10747','65222','25146','50241',
                          '58825','36162','60874','59079','77137',
                          '15734','69842','25463','91411','64377',
                          '68832','56399','87047','53588','43878',
                          '50689','58368','24204','30461','82219',
                          '33945','27089','16858','47250','55341',
                          '22934','17068','28726','17861','46936',
                          '80102','32326','66326','59054','99858',
                          '32708','90426','69974','65006','56145',
                          '67081','27508','48568','67624','36694',
                          '35616','33220','25717','21397','51830',
                          '44810','15323','12199','42966','49245',
                          '17962','72966','88778','69542','25296',
                          '25503','62370','73152','67213','29886',
                          '37559','62745','16842','70007','36574',
                          '58305','58342','38485','15439','96629',
                          '69786','13984','92600','33410','95430',
                          '24228','16316','29539','92182','37611',
                          '99931','21147','41573','48420','43019',
                          '78553','93528','20431','82544','28813',
                          '78806','64869','18941','41270','63889',
                          '72028','98088','73665','87725','26267',
                          '62857','14020','29722','89125','27207',
                          '46043','66466','19919','68992','48605',
                          '41074','32195','48535','42979','75393',
                          '11270','50377','43975','42547','10138',
                          '99746','88217','60974','25656','60174',
                          '13377','91379','43095','59639','58634',
                          '33313','33188','85398','50656','40299',
                          '36735','21686','31384','13403','36638',
                          '26302','46830','73953','51410','68609',
                          '21887','49817','71647','15854','63953',
                          '30181','65428','14812','68142','78474',
                          '74063','70550','25609','81570','73162',
                          '92312','12261','80560','60805','77380',
                          '65259','84134','83905','16760','12139',
                          '52947','37079','68406','70809','41019',
                          '16126','21049','61120','74332','22439',
                          '62224','35101','60640','26849','70469',
                          '47882','74958','98137','19773','37580',
                          '99793','17151','40767','94279','55936',
                          '13098','13905','51502','36878','72391',
                          '18787','75421','43889','12803','87287',
                          '83183','45629','81937','20708','38626',
                          '45951','80771','59765','39026','15235',
                          '25493','60911','12865','28457','96761',
                          '22167','11566','11514','46176','54017',
                          '78551','25490','11279','36730','18084',
                          '68140','46589','57921','29574','79510',
                          '60375','35963','68008','70577','84203',
                          '34074','17309','54224','44215','17430',
                          '45064','88951','55488','55949','78624',
                          '41453','82429','71154','44190','71347',
                          '15777','54189','55504','86474','74980',
                          '98906','67363','46555','32925','62332',
                          '32471','24894','68294','50154','54744',
                          '75860','65348','26800','65172','24052',
                          '86516','13803','58203','47922','85930',
                          '84417','72205','13763','26353','78052',
                          '88666','89459','69993','29713','29272',
                          '80399','97387','78714','51399','39686',
                          '16171','83332','71123','19226','43229',
                          '67730','49580','14802','18932','19117',
                          '91821','80176','81442','58095','32275',
                          '39733','98284','13172','95010','20171',
                          '20888','60442','98860','30777','25135',
                          '51469','27285','59863','47932','16564',
                          '51787','61796','87793','72997','94511',
                          '55717','80568','52277','35894')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
