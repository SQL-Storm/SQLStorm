
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '44074','33498','55228','43284','23205','45886',
                          '60473','12083','16269','34961','53873',
                          '74179','29512','84652','48853','84474',
                          '76572','79894','73584','32877','22671',
                          '96887','17169','71396','81007','19559',
                          '68222','54412','20974','27088','76343',
                          '60782','84463','16021','71562','17266',
                          '44606','31373','40081','10004','84116',
                          '98831','30273','36187','23239','86093',
                          '76806','28465','11842','79411','35737',
                          '29479','53658','16985','30619','24157',
                          '24538','12803','55826','46767','55759',
                          '77489','11691','34729','84311','48109',
                          '68340','49740','91664','18014','10919',
                          '87150','34806','31050','29505','42080',
                          '84260','77318','11571','33805','86856',
                          '86870','36277','22063','22125','23531',
                          '54204','49157','11938','47552','48995',
                          '56708','72888','80433','27783','74024',
                          '79856','26878','63591','84094','56186',
                          '43298','16595','51099','60718','16411',
                          '35501','16597','93495','18321','97569',
                          '52741','84050','12019','21939','76991',
                          '78189','72233','80428','70832','52490',
                          '96273','42975','10781','22330','79405',
                          '24892','71271','68648','91826','14422',
                          '63839','96875','73854','83847','26124',
                          '61557','43316','21686','45007','21392',
                          '17241','63823','64512','31477','65512',
                          '25732','24785','33234','69575','53237',
                          '34944','13903','26126','99754','93424',
                          '23057','43245','24753','80552','30371',
                          '77952','14004','70320','52900','33225',
                          '17519','13405','45009','98718','21608',
                          '71914','21414','65764','20311','12727',
                          '13244','25035','26224','76987','93200',
                          '37179','28494','81237','38615','58142',
                          '58030','26956','95614','89814','11960',
                          '26107','63808','36835','46346','88879',
                          '38318','62734','84872','12485','57569',
                          '14718','20200','77931','53550','41158',
                          '97459','61536','58619','86108','26662',
                          '46228','12091','26394','87222','10705',
                          '88601','56473','30879','82436','18799',
                          '71142','42808','67602','10945','54723',
                          '69093','21786','43118','17225','14915',
                          '20270','30997','79054','41935','41370',
                          '60318','98062','41317','38648','72056',
                          '36165','39053','34470','76819','58249',
                          '25748','40590','44461','84378','60395',
                          '76462','85624','75469','35318','47303',
                          '85958','84927','13146','40967','46631',
                          '85256','73952','56287','12991','28742',
                          '17141','32188','56003','12473','98355',
                          '60613','94699','74699','99024','63711',
                          '62266','12643','63846','68912','91280',
                          '94074','43407','20897','92487','77211',
                          '97122','90927','28910','53681','43144',
                          '61950','51714','91193','24948','47269',
                          '97983','61055','62192','97484','67744',
                          '46011','36131','70994','64089','39086',
                          '71903','53453','38819','17282','18031',
                          '93314','43995','39737','66713','77991',
                          '41359','69559','45716','72013','77045',
                          '96291','27158','59877','42225','30735',
                          '96175','51989','12168','13031','14204',
                          '10209','23736','22706','71523','48481',
                          '24770','48748','35732','53520','78315',
                          '32136','78129','94039','58753','14391',
                          '98330','61024','51055','15797','49493',
                          '10853','71071','62605','98464','32251',
                          '97121','17531','51296','79510','31497',
                          '17419','84842','43375','23595','91570',
                          '67555','44977','40366','40278','96827',
                          '87143','22574','30181','38104','39133',
                          '24505','55230','76269','78945','51026',
                          '17384','89633','31391','13062','67309',
                          '16333','15173','57546','41803','59689',
                          '19430','46238','76050','97518','15865',
                          '99736','10101','44266','38901')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
