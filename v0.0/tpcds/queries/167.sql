
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '60795','82737','53736','32849','29038','86636',
                          '13523','54324','27892','31755','91110',
                          '54227','49876','57580','45944','63147',
                          '76984','23343','11459','60950','34433',
                          '23265','55389','10042','17824','12173',
                          '27287','68357','19410','52297','10526',
                          '39839','62441','19950','31390','33241',
                          '16425','29346','16051','81010','12036',
                          '62829','97709','88797','71121','94526',
                          '77746','12034','73982','33342','61298',
                          '78445','70740','13078','58256','98032',
                          '52042','13067','46067','80631','22266',
                          '30757','63281','10083','87734','18052',
                          '23230','14759','71045','10524','82625',
                          '33707','74257','98635','10148','69674',
                          '54407','20050','28545','15942','45306',
                          '46814','98289','85015','88657','96001',
                          '59294','89025','76105','34940','21528',
                          '46171','15878','39778','20931','19757',
                          '49997','41951','17414','83190','32656',
                          '68020','74880','94151','62856','55708',
                          '99587','70826','73710','24269','92737',
                          '29412','16200','46037','57248','86273',
                          '90424','38998','65772','58353','65695',
                          '22408','18451','20046','51576','44354',
                          '99469','31632','18798','27680','26732',
                          '83607','25247','37476','89736','45839',
                          '37318','53325','65326','72985','22407',
                          '87739','19023','35559','63432','27431',
                          '84843','72269','62828','13471','17346',
                          '50754','37793','21358','67073','43696',
                          '70487','61324','95820','60158','33811',
                          '26103','70052','59374','84221','85450',
                          '20139','94700','21704','95950','14117',
                          '86234','88655','97564','92938','79491',
                          '72294','63802','16391','95661','38646',
                          '28278','51144','49208','48405','55824',
                          '83048','61639','29906','12826','87113',
                          '19364','66269','39423','26791','25722',
                          '68166','89440','51817','51075','24380',
                          '18515','13835','42858','53208','95590',
                          '94207','35512','46841','29138','25240',
                          '48202','87527','17109','11439','43785',
                          '13567','11784','51633','15649','19743',
                          '40235','60823','31451','35503','40134',
                          '30302','90356','44288','33783','65843',
                          '36337','72824','26689','75831','14374',
                          '43273','30566','78385','21308','52142',
                          '32253','86951','76135','97392','98778',
                          '21672','55394','88146','47751','52300',
                          '83685','79072','10514','16324','52493',
                          '62083','67708','12806','22200','72120',
                          '12509','59630','82258','69485','75834',
                          '13018','27671','61502','49266','50698',
                          '10973','92217','36544','33379','20417',
                          '88720','62927','97634','43553','53106',
                          '19792','17453','21202','78054','84305',
                          '84260','75388','52767','22813','79676',
                          '98674','19112','48746','22196','96523',
                          '40890','55306','56047','58455','60891',
                          '32804','38966','25108','49608','36079',
                          '13979','32858','75963','35621','48761',
                          '19546','39788','59434','27378','71191',
                          '67325','91975','60717','20652','41660',
                          '79163','72767','24925','33329','91128',
                          '76296','45040','96235','69829','96137',
                          '41546','39583','90120','69078','39654',
                          '67520','23710','74944','29532','64795',
                          '40382','12937','21394','86169','32654',
                          '14498','36139','27828','69782','86625',
                          '20582','60416','74891','52960','28075',
                          '56302','39611','47391','86981','84773',
                          '14143','29883','58853','26848','59369',
                          '50729','25273','42289','52911','80904',
                          '15398','19806','87364','45903','43306',
                          '83103','16751','15551','52295','59878',
                          '53767','50803','60794','92530','48916',
                          '57161','94021','29261','83571','75358',
                          '15160','71917','88949','27040','96757',
                          '42168','24146','49801','99450')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
