
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '16091','86522','60637','39408','57907','89367',
                          '43297','84227','61459','38500','35469',
                          '16667','18755','47119','79550','19888',
                          '18987','53058','74188','80050','38689',
                          '54598','42007','89778','23043','12246',
                          '89451','98179','69948','39072','54446',
                          '61580','75554','87635','47641','27758',
                          '95407','66573','42700','74733','89199',
                          '55966','19059','71157','29480','12518',
                          '42308','37489','86821','61110','47771',
                          '38300','63725','13530','50168','82263',
                          '82639','23027','11023','57339','13365',
                          '18346','40739','35483','18406','31041',
                          '66748','26742','92712','18757','50341',
                          '84168','16736','70003','79964','74208',
                          '98393','14937','37934','51128','86921',
                          '20249','29098','36054','35346','72763',
                          '95520','27585','96444','26005','13455',
                          '21698','39009','89534','56255','20104',
                          '94021','85872','36349','46221','78149',
                          '58142','27393','83419','58880','80512',
                          '57131','65300','60022','37196','34824',
                          '90754','53787','72777','69728','49310',
                          '61377','40376','53826','85548','75604',
                          '24240','80254','24429','37680','67279',
                          '53531','15438','48592','39788','15669',
                          '10948','77257','96054','66587','70549',
                          '75393','63636','91215','10972','43692',
                          '90807','84258','37455','44831','44587',
                          '54940','70480','91766','59014','64165',
                          '98761','29230','19652','18268','44916',
                          '42549','50217','26149','13198','36158',
                          '22174','68816','53542','65172','48259',
                          '35368','12992','45120','24674','56211',
                          '25841','27564','46230','84354','56843',
                          '96770','90211','78496','44276','69246',
                          '62153','27206','47407','88193','72254',
                          '90942','40383','39226','21893','92977',
                          '16648','70964','35707','17124','72527',
                          '91451','18991','58435','64408','20796',
                          '61547','20483','62279','82247','48038',
                          '95782','19331','55635','72691','25047',
                          '72651','33267','96620','50867','82640',
                          '12908','66521','91341','53822','72301',
                          '67077','81431','64503','31808','29425',
                          '25645','79508','30257','44072','19621',
                          '12420','11069','20609','10405','15545',
                          '43329','46257','59477','25337','49751',
                          '86773','19339','86236','31892','32443',
                          '66076','84411','16013','91243','27162',
                          '22155','90181','70268','19698','41980',
                          '36178','32340','74650','70237','45675',
                          '33298','15980','95031','69555','29509',
                          '61805','15664','60890','16918','84799',
                          '37543','73939','80400','22233','24350',
                          '21017','10238','10302','30894','68707',
                          '33280','75873','83644','94893','47242',
                          '37285','68413','99234','14451','27431',
                          '44221','44660','10751','24964','25672',
                          '71821','12082','48262','33020','49809',
                          '85520','43201','20437','20666','31674',
                          '47263','23604','87618','19425','62692',
                          '44118','73145','71438','67020','64012',
                          '46956','74578','67215','45690','54708',
                          '53821','10294','77215','24470','21955',
                          '46185','86482','36163','25132','64937',
                          '43129','61497','28543','48159','28638',
                          '36976','83004','51489','24546','34594',
                          '35131','50719','62937','61685','61087',
                          '73733','73213','93903','21011','61637',
                          '54378','26757','37613','81087','55590',
                          '54031','56291','27064','17927','83905',
                          '82904','26516','74457','70485','58833',
                          '66575','76761','27149','89341','23334',
                          '97372','61740','12077','38009','62307',
                          '41247','67244','22276','58147','66816',
                          '31137','44875','71123','91565','80068',
                          '82175','17250','70291','72034','49069',
                          '43855','14984','52667','46401','40269',
                          '15277','62611','37541','48055')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
