
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '39893','16518','94164','25963','27744','34994',
                          '12935','37062','59713','70170','13935',
                          '62662','62684','19783','91237','80752',
                          '13829','20275','90697','20869','98214',
                          '41285','22924','25421','90836','20157',
                          '89705','33285','63255','88474','34335',
                          '21020','12155','43608','15441','48289',
                          '55923','12010','44870','19042','50199',
                          '29939','45548','30468','66524','50503',
                          '30815','79471','65506','89858','65484',
                          '57943','50580','26948','72477','64014',
                          '98897','83750','14470','46226','81857',
                          '99405','16075','78119','30771','41760',
                          '19382','79958','28677','18010','47444',
                          '18500','60374','99427','51253','62321',
                          '79286','20834','37156','10445','42870',
                          '21880','71109','21623','84169','50245',
                          '94454','88734','95570','22170','32717',
                          '91123','34938','44175','50346','40344',
                          '99465','64444','36840','86566','36053',
                          '51549','15683','20342','58867','45818',
                          '92195','66631','31515','17275','11189',
                          '97798','74764','19934','29550','40910',
                          '57550','23507','65144','91655','83245',
                          '41505','80416','61114','10217','62503',
                          '16947','83719','23765','53812','30016',
                          '19922','17260','34322','97674','33264',
                          '23996','61400','73480','95638','50457',
                          '65971','27452','20701','93837','53571',
                          '89562','92317','24633','99077','28192',
                          '16594','38529','46633','39647','22240',
                          '29867','95673','24047','91206','50804',
                          '18640','33742','15227','58080','19970',
                          '19283','19468','69721','88303','90255',
                          '93243','99326','14008','86942','64345',
                          '41831','18273','70679','97276','69479',
                          '26520','98717','86212','25316','28334',
                          '95760','76947','44352','93709','42872',
                          '70339','58318','62670','66168','79332',
                          '70416','77521','15255','16264','52292',
                          '16870','87084','58546','21929','75792',
                          '21679','28929','34809','18618','27193',
                          '91039','80521','49525','33536','33367',
                          '32003','85622','62511','17386','27222',
                          '66786','24156','32832','68640','98539',
                          '49152','66702','76457','69578','89994',
                          '13605','90537','12790','14345','49025',
                          '16533','18786','29468','92820','29809',
                          '14437','27696','39751','99380','56933',
                          '16834','71461','97555','22471','75469',
                          '94781','11099','90703','18991','36785',
                          '17200','80089','46889','72790','41826',
                          '75699','20754','33047','63319','53344',
                          '99912','54375','61005','43138','23200',
                          '29315','21058','59415','76841','73414',
                          '36720','36925','41730','50649','29226',
                          '11528','77597','52682','18429','96266',
                          '75680','87077','18047','99953','20652',
                          '33509','71246','68805','85474','80355',
                          '27775','26897','83134','55285','21853',
                          '44910','59097','84392','29089','81531',
                          '90884','23561','80460','65430','38208',
                          '53050','22833','23353','37195','17920',
                          '46093','47452','43066','30967','48206',
                          '99799','68849','97963','29592','18153',
                          '83872','13852','76171','80694','55321',
                          '30900','43575','77002','28447','27123',
                          '40755','65677','23037','72768','13505',
                          '33057','36936','20325','48039','16688',
                          '72551','51826','67330','11519','36491',
                          '44799','54619','73758','81680','84786',
                          '24501','30165','47400','22291','25437',
                          '67843','79824','10623','62966','27387',
                          '73038','40970','62468','14823','42457',
                          '76287','42993','86989','11384','21587',
                          '67609','84655','53945','86217','34723',
                          '15978','92554','42629','36086','49166',
                          '54115','40076','50458','27912','14819',
                          '90508','95397','96859','53023','22881',
                          '83567','35043','51300','18645')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
