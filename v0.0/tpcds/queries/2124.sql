
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '40730','49414','31941','12538','26229','57641',
                          '60678','71031','21248','39438','63837',
                          '69374','12502','68548','76163','51795',
                          '92323','46857','22286','72201','24695',
                          '24194','17044','27824','96879','77412',
                          '31239','28400','31921','79478','36228',
                          '66517','10780','61646','10755','47893',
                          '58416','32201','39927','55717','91740',
                          '23630','68353','45889','73114','91250',
                          '93971','79524','11223','26376','68164',
                          '82818','50875','73181','81066','59122',
                          '26087','65439','96636','42809','54113',
                          '33825','19120','70251','96139','45946',
                          '41514','82851','14036','91198','67273',
                          '33385','44258','22368','26697','40846',
                          '58330','95159','62831','49617','83236',
                          '96891','90647','35661','29822','20143',
                          '51748','80925','68986','49702','12274',
                          '79915','98523','37145','53825','79121',
                          '21171','75476','11972','15662','46923',
                          '97294','80961','27634','41013','42572',
                          '34921','62316','99703','65526','13128',
                          '11969','30268','55666','16353','63968',
                          '63362','25262','25950','23126','86425',
                          '29987','38395','58507','56768','14138',
                          '16361','88490','35817','57134','16600',
                          '34520','64816','88781','85714','91370',
                          '90776','40315','13118','99039','85495',
                          '56960','19288','22832','98262','44781',
                          '37195','72057','74331','36991','99968',
                          '29021','78557','88135','70977','81903',
                          '26943','17893','91042','73666','47066',
                          '84628','76646','93421','30135','77895',
                          '14354','40898','76045','45810','62134',
                          '52231','72195','30381','24462','89136',
                          '22981','50560','13406','91347','92755',
                          '84247','28969','14676','47512','24178',
                          '39826','99415','22619','41922','91611',
                          '88132','13796','67991','14593','29178',
                          '16439','90073','22599','58611','87858',
                          '47241','30671','24921','18931','53092',
                          '96341','94161','15385','90656','74630',
                          '71058','65544','72622','73732','56086',
                          '40025','19335','39667','51364','61307',
                          '74835','49154','82589','59538','69305',
                          '44922','64371','77203','27517','61196',
                          '16000','63775','35383','83922','49881',
                          '50382','71787','33924','76873','27186',
                          '45814','56147','53386','14503','59380',
                          '61161','39804','61818','59608','34705',
                          '30963','30025','89417','20371','15515',
                          '85178','68182','63304','21648','37972',
                          '63236','58341','22796','55390','65569',
                          '18498','75287','79919','82080','35496',
                          '71560','79892','37878','39802','32804',
                          '48590','31548','13343','61284','67611',
                          '83847','39010','55444','46381','31546',
                          '88728','96454','82877','14175','25532',
                          '86880','19903','20566','39702','23052',
                          '18040','14986','31748','81474','29754',
                          '96205','89007','20660','50499','16210',
                          '36430','12055','98014','40417','63551',
                          '67871','35503','42663','52088','48084',
                          '26374','20386','27931','99404','24456',
                          '20241','97611','45671','79311','48129',
                          '20573','10721','37511','58388','77642',
                          '16793','57457','14082','63343','56511',
                          '16800','24765','26432','50430','61540',
                          '42590','41112','25219','33073','56913',
                          '66990','27741','28579','44129','27546',
                          '25392','11228','13826','11485','49735',
                          '19943','81959','71343','72204','74792',
                          '98288','19174','36214','32767','52424',
                          '81185','41181','20191','38822','81156',
                          '26377','45633','15489','68150','24774',
                          '44577','73994','31008','61651','58799',
                          '84436','41764','38274','56516','51359',
                          '48299','29820','83584','38407','24426',
                          '35716','19396','42061','20155','22254',
                          '53394','26700','63691','30111')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
