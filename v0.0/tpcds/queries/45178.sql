
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '73082','93786','46239','66213','98851','47519',
                          '53073','24710','46665','48802','99754',
                          '66962','81995','40809','93080','15551',
                          '80772','60863','85447','24311','37663',
                          '10763','91058','29461','16434','72012',
                          '76165','58438','15900','22271','15420',
                          '78132','90785','53819','28223','12884',
                          '51467','80278','71900','57533','17236',
                          '88282','74587','90524','14254','51207',
                          '38966','78544','26689','44596','90690',
                          '61096','22126','39029','73863','94311',
                          '49534','84476','63136','41338','92380',
                          '81886','38719','94673','58582','45500',
                          '51320','95096','74616','21170','38446',
                          '46418','10553','23278','60237','35888',
                          '56049','63945','90115','10727','87680',
                          '98016','14341','50584','84472','83674',
                          '62225','29760','17878','32956','12751',
                          '85901','40980','13639','31023','14166',
                          '59205','36254','71562','39733','54342',
                          '29243','27908','12856','18675','81629',
                          '86432','66180','93451','25842','68429',
                          '93746','22805','76670','47917','60945',
                          '71427','38212','82689','95604','75417',
                          '69203','27692','85690','82556','82613',
                          '92286','57545','26844','82448','40952',
                          '54660','14318','69938','72090','41472',
                          '78616','43244','56565','17532','19793',
                          '71752','23036','58277','73581','42264',
                          '56233','33519','30425','48815','77278',
                          '24149','34219','94507','20857','75801',
                          '59350','51363','28701','47629','78649',
                          '39102','35911','15134','43066','90409',
                          '50429','42685','64878','72983','49578',
                          '96860','42743','25346','92786','76720',
                          '27257','64071','30290','18266','14428',
                          '82322','24305','24589','33118','73283',
                          '52188','14391','81624','70243','39089',
                          '67060','55806','45258','14052','54527',
                          '35878','67498','90021','32677','44592',
                          '18672','28334','29844','83909','11602',
                          '27877','60917','12002','86916','27609',
                          '40007','67619','26174','27996','88473',
                          '11629','15796','86784','41694','11096',
                          '80290','78350','36943','17875','28704',
                          '41944','57064','66529','68743','69725',
                          '12615','37327','39338','91363','70522',
                          '77969','78467','42798','94768','87284',
                          '43857','83242','49894','51987','46075',
                          '37132','20520','55425','26923','87349',
                          '94812','68031','86453','16281','23759',
                          '32660','56468','97839','23456','13134',
                          '14693','47295','17714','40261','70503',
                          '83610','86660','77185','36308','91759',
                          '38262','13930','12694','63841','68582',
                          '66245','42151','83986','38469','37667',
                          '81196','31010','14142','55811','18492',
                          '93440','23335','81503','77873','69871',
                          '17610','59435','76871','63863','68434',
                          '10417','98944','80521','86725','11515',
                          '93050','53362','63170','32591','34522',
                          '61005','36656','43466','63473','40946',
                          '14369','18146','50486','24315','71445',
                          '51922','20776','41689','16656','19916',
                          '89066','85566','15704','74255','40269',
                          '59330','93039','78806','54515','13707',
                          '10538','85762','52005','62700','96581',
                          '43780','41276','48085','47806','44169',
                          '51990','94582','65812','42948','96525',
                          '33939','43421','27705','78998','19960',
                          '71075','34711','93737','36133','18883',
                          '91570','59527','15421','63141','40268',
                          '14356','21811','65512','50014','24255',
                          '46673','21615','35341','36662','55077',
                          '76641','20120','59245','16205','88816',
                          '13382','21458','28053','14328','36236',
                          '30522','50538','67328','96041','68937',
                          '71233','13596','94926','23743','96167',
                          '59033','44604','41467','27568','29531',
                          '94078','31006','79714','50804')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
