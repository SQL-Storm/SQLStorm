
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '97717','20349','11858','34469','88615','54814',
                          '47907','60501','83341','54423','97898',
                          '98332','33485','29989','61775','19854',
                          '24785','68376','27867','26292','32426',
                          '21114','28682','58432','25691','35336',
                          '33723','67086','68446','92383','87135',
                          '56060','30694','52551','43997','34850',
                          '14256','61706','33319','87063','55284',
                          '39020','19366','47572','82309','36869',
                          '73404','11819','87645','29484','52191',
                          '72659','11365','26662','17235','26366',
                          '77557','38979','79259','63331','56970',
                          '21001','16998','21218','15195','33500',
                          '95796','21975','75299','13004','23694',
                          '52200','34985','86187','19735','71160',
                          '21635','85247','92893','39681','68233',
                          '42464','57309','36876','38195','32362',
                          '27137','96588','55032','53773','40013',
                          '27436','89582','26173','62480','16582',
                          '14439','42004','43131','80453','15449',
                          '12801','77410','38384','17566','17555',
                          '27362','37214','50727','43685','92915',
                          '98549','81709','28745','65037','78512',
                          '34879','89158','73885','36318','55043',
                          '57326','35154','72353','81734','72107',
                          '52849','33026','93635','26783','36454',
                          '38182','22077','10215','99095','16765',
                          '53722','71947','32271','59743','18157',
                          '10604','84513','14361','62157','44702',
                          '10263','28127','15820','64965','14767',
                          '21806','23127','51705','66001','47217',
                          '55765','52127','61756','56302','35421',
                          '90266','70175','36957','22500','66906',
                          '90798','64945','15430','34995','15608',
                          '52487','23086','23833','49118','28339',
                          '81382','15805','19639','37344','10179',
                          '90214','95803','59449','55475','85509',
                          '58218','28412','51791','80089','21377',
                          '43338','17772','14772','14645','74449',
                          '36389','82085','12711','84607','43420',
                          '36379','92283','27462','20567','78185',
                          '88646','53562','95472','14523','90478',
                          '45148','30993','54048','89928','34665',
                          '35156','88284','38604','31568','27059',
                          '54512','24367','97291','94954','31934',
                          '13781','38501','57461','67329','70157',
                          '82450','79484','92937','39496','86577',
                          '55359','86467','15013','59735','94703',
                          '25985','78656','87585','32504','51559',
                          '70148','54986','59987','19897','23539',
                          '33158','13534','14151','72124','90510',
                          '88109','34153','57412','96380','58271',
                          '18241','21994','80455','10895','35349',
                          '32793','20281','43188','35913','22519',
                          '93973','40221','31458','94836','29229',
                          '27130','24299','27609','14878','80575',
                          '90315','72471','12716','34852','57591',
                          '79798','15281','67340','56319','33899',
                          '10268','56364','57124','64124','14379',
                          '83375','88045','70868','58409','38784',
                          '93600','37649','81315','11073','86012',
                          '20491','36540','48229','25806','85048',
                          '53811','81418','38477','47517','62295',
                          '75679','99477','69282','63684','26245',
                          '35849','26124','20324','57328','67795',
                          '15131','50963','56087','62106','18608',
                          '72843','87622','59677','88773','39795',
                          '87079','21725','59719','96276','54292',
                          '43633','56409','41397','28152','25398',
                          '55357','33590','14505','37683','11328',
                          '67266','56132','46134','50897','90213',
                          '48607','80161','37195','54428','21220',
                          '22547','34808','95856','71635','26196',
                          '99607','42551','19308','14842','80627',
                          '39508','61236','64917','95785','31122',
                          '52896','11593','52736','63689','35214',
                          '48411','18109','35049','11055','49998',
                          '73727','26736','71461','72494','43762',
                          '81676','55864','18293','82457','22385',
                          '77624','50164','15313','37832')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
