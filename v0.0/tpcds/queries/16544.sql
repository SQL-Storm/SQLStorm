
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '80387','46862','91716','25216','17271','59712',
                          '61819','81192','63545','29920','43332',
                          '53312','69412','66912','16479','32313',
                          '36315','20446','69598','18394','14369',
                          '96932','25863','15172','86578','31451',
                          '46960','88456','91958','16990','10580',
                          '31726','10383','47711','58728','78176',
                          '49408','89752','52728','50091','15548',
                          '30922','78819','41690','69632','66382',
                          '48236','67246','92417','42160','63850',
                          '13792','63390','72004','29053','10416',
                          '46303','64784','26432','24658','56967',
                          '85005','55798','30440','50628','50569',
                          '96377','77768','99436','14017','66746',
                          '17749','25276','91920','59038','84776',
                          '53066','31761','35669','48605','87080',
                          '78980','88287','20761','55957','17299',
                          '42117','60693','50690','46165','94328',
                          '42107','32252','31202','84103','87938',
                          '38576','38205','50149','31601','18168',
                          '46050','12784','87689','14392','62418',
                          '11987','85318','68592','57325','21897',
                          '10173','26011','25777','59310','72683',
                          '14548','12922','35571','65097','16594',
                          '42153','26210','90866','21077','55171',
                          '63528','36533','26883','92017','65221',
                          '68625','39719','53036','11609','53293',
                          '32360','85978','33186','19567','20906',
                          '76373','24300','20762','49963','42130',
                          '10606','24432','21724','18857','88807',
                          '98605','25109','23432','40838','23509',
                          '47409','30087','41848','43700','55867',
                          '31500','91655','40202','12194','44309',
                          '21492','56590','23761','85869','36028',
                          '36421','33984','70590','81701','88839',
                          '21632','83071','20691','21165','97130',
                          '30397','33425','28915','62610','73076',
                          '98522','45679','24254','61204','32268',
                          '42606','40861','13735','21128','12082',
                          '86940','35785','32299','45549','25436',
                          '93120','33287','87682','70955','29750',
                          '13706','95816','84954','28321','13964',
                          '23153','61099','70668','64795','14992',
                          '92277','84497','73745','73706','55453',
                          '38794','13501','31559','32403','18733',
                          '92272','83779','23818','95191','14898',
                          '53810','14639','97218','12639','96267',
                          '47991','43923','34908','65977','50963',
                          '25255','34715','14906','33685','66669',
                          '32967','79434','36242','56849','39488',
                          '95739','47961','68823','57463','99492',
                          '31828','53240','87643','57613','39946',
                          '54346','91196','54738','27446','80382',
                          '96430','49356','38067','86842','67816',
                          '25534','61367','91046','63804','24081',
                          '50772','54842','44144','77162','79658',
                          '16895','77611','21827','78219','37157',
                          '12380','28774','47300','35418','69056',
                          '71760','64708','58618','22187','86059',
                          '42133','79680','21414','50128','10198',
                          '50714','20821','56195','21021','55026',
                          '30057','28817','48740','96137','28782',
                          '11565','57478','12616','73106','41915',
                          '93582','84971','84994','75008','38290',
                          '52603','52905','76979','63197','14669',
                          '88406','58415','56297','27040','22725',
                          '25604','29196','15430','38414','14459',
                          '23358','57451','58678','15103','10262',
                          '22195','20166','14873','38333','38427',
                          '12481','96040','77806','16072','36795',
                          '14002','97292','72147','16578','16746',
                          '40274','60915','45498','95365','21586',
                          '75721','58798','22144','68586','69328',
                          '71769','19046','52941','20795','38261',
                          '46273','36929','69017','82347','68563',
                          '46709','75985','66308','83610','48497',
                          '27324','94167','48840','19322','23144',
                          '22678','28979','68020','45860','66777',
                          '20832','38390','91201','17432','76173',
                          '65683','25401','73962','10761')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
