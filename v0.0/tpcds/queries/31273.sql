
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '87549','41823','35518','23433','75556','65866',
                          '23294','52432','37663','24556','89207',
                          '24242','55138','42987','26211','26311',
                          '15289','28857','39707','80958','30913',
                          '25122','77872','66930','86635','49834',
                          '15752','38026','70492','43008','29095',
                          '76784','64400','42969','71183','91779',
                          '51471','11928','32180','38318','65108',
                          '41775','56442','96191','15283','75685',
                          '63273','99841','88180','74648','12578',
                          '11727','97703','39995','52382','62012',
                          '85239','76414','71916','14653','39802',
                          '63718','83381','15596','13447','70458',
                          '23248','52422','31839','29444','95324',
                          '58948','71850','52958','46946','91021',
                          '14135','48642','64106','37085','63310',
                          '92291','19923','47343','13120','87144',
                          '82041','91674','81207','27830','84324',
                          '88104','91553','22721','57075','96024',
                          '94866','41769','47865','30120','57430',
                          '55486','67372','13631','43467','31707',
                          '37093','40087','11985','30622','92816',
                          '72269','34253','48332','64185','38949',
                          '62196','76559','58242','23632','68591',
                          '13913','62992','74556','85454','44364',
                          '31843','29327','63578','36593','63368',
                          '75622','12925','43275','34436','50168',
                          '46639','21286','76409','85924','36472',
                          '84872','37698','50315','39987','32834',
                          '51280','62077','27493','93268','64948',
                          '58502','46607','99911','61755','89752',
                          '13685','99693','87369','63280','63778',
                          '38922','80468','96520','90154','85192',
                          '77593','55121','88752','54333','61126',
                          '47648','18264','78192','66759','63903',
                          '14097','33497','99066','26918','57921',
                          '82599','96636','86804','66816','81685',
                          '19796','16392','47693','28364','44794',
                          '43748','27174','31834','87471','13006',
                          '58619','10421','67741','12278','18618',
                          '88910','25766','94400','92290','91299',
                          '40789','10267','32893','76250','29373',
                          '97964','39005','38826','21875','18443',
                          '17975','42894','51459','62296','26402',
                          '21918','51145','39771','59718','32397',
                          '53425','51509','70450','41681','31683',
                          '35054','52609','18192','16634','98705',
                          '69264','11586','36088','99339','92237',
                          '31678','42408','21881','96206','84372',
                          '63274','87738','49758','40454','42038',
                          '93593','15055','36222','77249','28375',
                          '13690','98057','29992','47399','46138',
                          '37714','73024','25776','57389','24646',
                          '38377','48721','10476','33985','29358',
                          '73040','82418','67046','72532','49955',
                          '70192','53205','20112','50679','57118',
                          '16424','26916','72984','94057','29677',
                          '55008','76358','82740','26787','96577',
                          '60211','76211','63535','96319','12943',
                          '48897','42239','69543','81835','86812',
                          '18835','91201','19286','30844','82493',
                          '35117','67449','39037','12940','23412',
                          '96673','27400','72876','37024','50413',
                          '49080','23207','38131','93979','94524',
                          '13451','72771','20024','69359','57802',
                          '28828','75700','70748','13862','62087',
                          '17903','88696','22909','21477','67730',
                          '15203','46943','25127','68016','19918',
                          '11072','53508','45919','13667','42789',
                          '23813','84040','16402','79007','72709',
                          '56510','13046','20852','67377','75547',
                          '16063','22699','46995','61241','15621',
                          '24205','83245','73685','59617','20646',
                          '34244','90882','86157','27057','83937',
                          '44173','87671','62750','54452','49345',
                          '14017','78149','34074','32330','54595',
                          '49022','68214','55130','67731','59779',
                          '29150','21294','29993','52216','69231',
                          '32611','63225','14396','99878','69701',
                          '19473','76277','46769','91571')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
