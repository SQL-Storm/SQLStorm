
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '13484','45550','48011','48768','30831','10512',
                          '22164','10774','84809','88254','75541',
                          '15750','34469','50279','98119','71705',
                          '21636','54226','45573','35107','61860',
                          '42627','59934','10646','82143','97567',
                          '79720','15332','30302','43466','44093',
                          '12683','55601','79238','22438','74374',
                          '94783','31151','29327','93689','35366',
                          '58851','40075','39657','70510','20775',
                          '78170','31660','52381','34617','61739',
                          '96099','26385','38629','45686','99653',
                          '25113','63502','28837','37144','64701',
                          '29908','99548','42125','34375','61137',
                          '10705','20106','65545','45557','74695',
                          '64131','73647','53287','20124','10143',
                          '26297','62207','85651','16287','81966',
                          '73818','36849','17518','12653','92949',
                          '66150','57884','10797','18104','28044',
                          '38023','15063','14253','90369','52705',
                          '24387','76686','52440','43185','36658',
                          '67394','81551','68457','57486','15592',
                          '97751','26408','87983','13220','51347',
                          '68563','29297','42844','22347','86166',
                          '72116','99216','85014','46539','29967',
                          '35906','25279','18631','63526','83864',
                          '69933','75646','29862','25787','13154',
                          '98174','38105','82094','41256','14451',
                          '53807','85016','74876','94041','28422',
                          '60716','26346','72430','63563','19635',
                          '31665','56588','56335','68121','53705',
                          '49278','86156','92113','65154','93254',
                          '59643','17963','31426','26141','38989',
                          '24450','24053','13932','47847','43574',
                          '30082','29509','40366','75377','41502',
                          '85848','42312','17553','80345','81310',
                          '54138','31805','78190','61976','80966',
                          '17136','50299','96563','55186','14345',
                          '13956','22456','14706','30537','64797',
                          '21111','96963','55608','76572','58512',
                          '75274','74274','72192','91107','35960',
                          '86403','19069','71611','33897','13450',
                          '18937','43388','62798','41532','55378',
                          '20774','22624','21678','28525','10582',
                          '33668','24475','80993','49132','74200',
                          '90679','92241','16795','38820','29287',
                          '25488','30701','18812','47408','46384',
                          '27641','44009','37488','83445','69666',
                          '13999','59852','93543','93229','10856',
                          '60888','51078','10387','23791','14894',
                          '41044','25709','46743','30288','68310',
                          '89912','26386','41047','51357','77841',
                          '29583','80724','85566','34242','69178',
                          '50456','41693','39404','18956','81795',
                          '32275','49243','25816','73230','90301',
                          '55995','22322','95656','94310','94929',
                          '56599','19515','12073','86002','48558',
                          '59715','46152','97116','25551','52160',
                          '59579','93585','36482','33790','93986',
                          '79928','19768','79257','68803','17218',
                          '80923','57495','77553','99294','22968',
                          '83804','10648','70491','18757','94974',
                          '39443','68594','93588','49817','29840',
                          '42299','27173','48503','22550','62504',
                          '68926','11650','56951','61043','31742',
                          '94788','63486','80889','97940','61473',
                          '62546','95800','77549','62306','56884',
                          '98742','23777','32591','75203','68703',
                          '78008','69772','24874','53292','62870',
                          '71138','34550','98667','39977','64594',
                          '42287','68533','85827','44000','15085',
                          '37000','44944','36521','35779','53427',
                          '39257','22602','87862','82187','34015',
                          '49930','93380','96994','42721','88539',
                          '68180','45713','23165','68840','38595',
                          '98765','17799','14420','59465','77253',
                          '42638','57625','85857','20648','34509',
                          '25552','34912','54682','80564','28760',
                          '73811','65755','81780','37901','14844',
                          '70978','12374','49834','42773','96605',
                          '76249','23382','71526','16162')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
