
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '66377','54430','59773','75374','97744','85993',
                          '15156','64211','62276','85442','26373',
                          '63072','45760','27412','40805','63070',
                          '74206','20495','47635','55907','31106',
                          '67154','65630','31861','82717','70605',
                          '32219','36300','86213','67875','33023',
                          '25768','40562','38708','40150','18444',
                          '94902','74112','62334','41603','76890',
                          '26520','70459','88158','73521','49629',
                          '19239','20640','57025','41888','28468',
                          '49079','32743','10595','30970','13862',
                          '54838','54045','66252','23238','66509',
                          '39493','93048','18734','58996','19469',
                          '15466','26259','17563','32259','47218',
                          '63560','57221','10472','50452','52728',
                          '31399','58145','74091','73862','59526',
                          '34320','53298','55351','34388','57598',
                          '40397','84952','65046','57139','62898',
                          '17162','94166','80832','35991','34955',
                          '30248','47530','33131','21262','81316',
                          '54278','17091','37947','55207','56134',
                          '86287','35178','47215','70431','62866',
                          '20287','26471','19955','87119','28125',
                          '95969','49098','78642','78211','37792',
                          '11875','40870','68454','29896','14914',
                          '32938','67434','66471','63749','68647',
                          '69257','92283','93155','92817','46552',
                          '15044','45540','65912','78736','33666',
                          '18027','59442','23103','28525','44639',
                          '70786','42353','36684','89885','85047',
                          '77339','71176','49662','67585','21208',
                          '74553','24935','42291','65293','66130',
                          '76201','76966','49269','61191','44008',
                          '59952','84593','65643','48609','71695',
                          '42661','15555','44440','45872','80784',
                          '19515','14715','18998','54674','45789',
                          '66613','41706','32604','28579','44170',
                          '72857','72938','61391','23542','11894',
                          '25609','25303','36656','43339','93943',
                          '61720','36884','41316','97220','47330',
                          '97455','75870','13070','31601','55457',
                          '17260','45936','34976','34344','69574',
                          '30203','11077','46877','68659','93379',
                          '24340','74870','82492','10907','25992',
                          '19854','78366','47313','47767','25186',
                          '46559','35260','21373','32915','32643',
                          '56022','67284','24009','88850','97001',
                          '24311','36939','23247','39306','54817',
                          '25496','65225','51793','85490','56632',
                          '21999','69530','13075','71876','85866',
                          '55722','51906','20449','14457','18992',
                          '82084','39990','36463','56546','65052',
                          '72529','66453','50524','37362','95713',
                          '68801','60272','56743','40820','34102',
                          '11609','92663','29038','40097','91548',
                          '51033','13413','80133','23512','72279',
                          '75886','15554','85260','53996','99248',
                          '86168','91102','81831','22405','44409',
                          '99235','45174','17536','75173','99092',
                          '80039','21576','76183','21524','81646',
                          '52362','13144','91214','57605','80676',
                          '27377','67711','17979','17037','46770',
                          '12485','13225','99862','98947','27622',
                          '64248','37479','35096','64574','45823',
                          '27755','83899','15042','46854','13632',
                          '79584','39323','98060','30654','86716',
                          '84508','10395','49301','19230','69950',
                          '48536','10438','34607','65640','47237',
                          '57289','14326','65607','12587','60235',
                          '54956','17883','47396','65929','57302',
                          '27237','24591','39399','71774','15027',
                          '13301','28611','28179','18541','69340',
                          '45521','43132','99292','96668','44682',
                          '14847','49850','25043','21812','76946',
                          '13407','93413','43312','19630','46578',
                          '52637','79624','30485','72550','58465',
                          '34101','80421','55868','30969','54767',
                          '44445','11606','17647','87961','45895',
                          '53908','35056','84067','73354','30933',
                          '95709','51894','20961','15931')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
