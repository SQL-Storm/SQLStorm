
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '75405','92715','44894','21193','20684','88169',
                          '87386','88253','12413','28184','25498',
                          '63826','97560','44811','93158','51580',
                          '30351','22076','39187','16014','20747',
                          '57545','43647','33778','10263','91854',
                          '97298','28904','36502','22839','30821',
                          '27440','43079','68993','29350','18387',
                          '79753','40325','14568','59132','63703',
                          '90086','15551','31849','16973','87744',
                          '17464','46873','16027','28321','52122',
                          '28860','74206','42890','62126','54887',
                          '11268','67149','95393','33993','12146',
                          '26476','29592','27506','34242','21745',
                          '19421','65612','27294','55783','58278',
                          '73156','88924','21434','26368','13417',
                          '58351','25789','50710','22552','29802',
                          '80464','77468','40975','14523','16984',
                          '53253','39213','79069','81402','63022',
                          '71469','71929','94470','60818','15158',
                          '19430','37425','20168','48871','33798',
                          '59434','84378','16994','88940','81442',
                          '40936','83884','62686','53103','11535',
                          '13063','15993','94088','22551','74638',
                          '75363','24269','68204','72711','42756',
                          '76457','37021','54041','88419','34830',
                          '73135','66198','30749','29959','41134',
                          '37484','30492','64419','52142','40099',
                          '79673','15123','21150','77608','61228',
                          '55196','62058','95223','49084','10858',
                          '86287','91975','80768','23318','59176',
                          '75864','19878','97778','32028','57170',
                          '73367','47833','61997','36736','60070',
                          '18812','20453','32971','38500','82314',
                          '99206','24685','11838','19472','97879',
                          '48235','44353','41938','31324','90149',
                          '48832','36202','15051','57128','30582',
                          '81005','25503','16553','13033','31520',
                          '32648','11775','12500','75321','51629',
                          '60089','71584','61107','39427','35206',
                          '71770','23530','83674','15564','20084',
                          '72130','15678','25249','88157','47247',
                          '52966','70177','48570','29947','32719',
                          '70561','98124','14431','81648','73753',
                          '27898','13067','27949','53060','35221',
                          '22079','85582','40965','80481','39963',
                          '14922','60789','31616','84336','31040',
                          '19711','84902','93032','53491','59959',
                          '19983','45938','49872','43908','45238',
                          '11428','61150','23476','21965','25694',
                          '23270','19978','38629','17741','67067',
                          '97360','28014','34440','59356','55073',
                          '44885','25065','98095','60112','21268',
                          '22670','62443','60040','46442','59217',
                          '52532','56868','10331','30075','81494',
                          '23658','57574','26282','82338','50166',
                          '51467','68965','39688','51441','68809',
                          '14789','51980','54989','93493','59118',
                          '28257','48968','19218','12817','58549',
                          '13299','59984','43858','26424','70098',
                          '70608','64085','57369','25870','58673',
                          '36249','78931','47811','37039','43002',
                          '18810','84282','11884','48003','67854',
                          '10063','37493','43048','32901','39038',
                          '60865','64220','10925','48632','85713',
                          '50774','56424','27565','45612','24405',
                          '15262','76441','78571','14199','48094',
                          '26007','16051','65322','68584','38825',
                          '97054','41201','30923','65929','39248',
                          '17533','46293','53366','79111','76096',
                          '28535','30670','52691','41109','30170',
                          '98656','61090','57283','80494','34052',
                          '56813','59235','32873','76199','25186',
                          '25278','13743','94747','23538','58711',
                          '30204','64416','29105','79848','57923',
                          '72930','37494','90148','31066','15938',
                          '38439','44054','72223','89522','30890',
                          '42410','17045','43402','49027','96636',
                          '53049','71573','60091','38994','43246',
                          '47120','31692','57977','94304','31976',
                          '39789','99808','51020','41093')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
