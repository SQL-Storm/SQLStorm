
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '52614','94719','43056','66717','40323','60258',
                          '85391','27756','27073','44637','22967',
                          '39541','52862','68861','99923','43770',
                          '76664','26534','48776','85209','15228',
                          '49870','18753','34582','16172','74025',
                          '36497','32648','69874','87302','84578',
                          '48071','21910','67560','38285','29264',
                          '11199','56703','40120','24673','67369',
                          '26050','55311','29686','60696','42706',
                          '38443','26402','16899','88872','76022',
                          '39825','60206','50359','31759','49425',
                          '71639','35409','78131','77061','27040',
                          '46835','25522','85774','31237','13537',
                          '54399','46133','20622','40658','15116',
                          '73263','74978','74050','58906','24682',
                          '29928','88060','29599','57916','39772',
                          '93407','58152','13257','51613','20387',
                          '84610','87019','45362','13027','27812',
                          '41042','62699','39709','25831','37719',
                          '97566','98706','73040','53184','45048',
                          '69810','44627','22450','99069','26031',
                          '45925','53116','18700','47893','65429',
                          '51833','70465','19969','35735','13998',
                          '84660','46164','84664','45579','51181',
                          '63757','94035','93687','72324','76745',
                          '65552','29137','63765','19065','64252',
                          '80870','83827','23659','12195','95021',
                          '50050','49173','25759','95711','12992',
                          '80568','46907','80425','86432','50264',
                          '40260','68563','42331','90710','30445',
                          '70238','19765','90597','62229','27693',
                          '12736','85289','39184','34021','98336',
                          '76874','89667','37290','44524','66302',
                          '41934','73863','89764','41977','45347',
                          '95552','34419','53448','88240','86572',
                          '75807','72322','39565','54786','86378',
                          '67445','65817','18037','30086','43317',
                          '32506','81897','97954','78719','47408',
                          '84214','83436','11181','18105','99403',
                          '68842','28659','68215','11446','37080',
                          '55069','62790','64937','41851','42632',
                          '21883','77514','13260','66970','61941',
                          '54678','24381','21744','64060','31963',
                          '25939','22789','83901','62640','50799',
                          '98162','70367','61341','33863','31462',
                          '25098','58002','37952','22209','28981',
                          '12756','96059','58596','16530','81602',
                          '20075','36177','31038','34695','49573',
                          '65602','89500','62146','26965','31744',
                          '53253','62125','42630','92068','45728',
                          '14677','73221','38102','50226','58977',
                          '67608','66873','39519','16126','78320',
                          '84891','54835','65028','17096','63696',
                          '98227','66475','48647','18614','13913',
                          '21260','78168','45207','58948','15283',
                          '64410','29095','84555','24730','29383',
                          '68024','48544','21754','16855','20049',
                          '68831','62408','90817','18593','62834',
                          '84482','39012','78790','40470','23476',
                          '96351','61086','80832','69585','77354',
                          '35495','97724','60654','12019','21713',
                          '30055','64617','55556','78144','63508',
                          '77231','56762','57516','99754','76248',
                          '26366','78193','51127','69285','22868',
                          '50266','87102','92824','47383','82824',
                          '16340','42652','74274','13099','58233',
                          '22132','84793','80331','44465','61404',
                          '54867','54406','15958','17677','84142',
                          '22803','51937','33934','46976','54547',
                          '99052','90495','27647','62122','34219',
                          '91690','66962','92084','46937','50336',
                          '44758','94182','58092','24687','99680',
                          '51130','21847','24645','54228','40478',
                          '11754','85801','37464','33418','66391',
                          '97258','74223','67015','78787','51806',
                          '48496','55934','50012','58277','36698',
                          '77548','14204','75788','30957','41044',
                          '73419','74091','16472','84750','48864',
                          '98347','15741','12449','26535','34798',
                          '55204','84958','51092','91680')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
