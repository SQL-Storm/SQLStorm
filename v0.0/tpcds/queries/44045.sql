
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '42319','67763','50902','22531','86976','26210',
                          '97198','27890','66234','75199','18558',
                          '25694','51202','73415','24113','10422',
                          '71734','41380','61827','49562','69147',
                          '55336','65418','73555','72178','24252',
                          '58386','44623','51183','59256','57221',
                          '44989','92500','11767','39645','28219',
                          '70856','83041','36006','17272','40769',
                          '12666','14932','18371','43123','18995',
                          '64078','71299','37370','38685','98987',
                          '65010','71939','56730','34701','91039',
                          '16609','79687','12632','20219','57141',
                          '12323','84738','65247','34010','31216',
                          '63913','56539','94106','65593','87518',
                          '12006','92336','21699','63403','75235',
                          '17079','62164','61487','97484','45857',
                          '30465','22175','34125','35923','71728',
                          '71618','78097','18928','45644','26911',
                          '80646','65355','33852','60186','28699',
                          '94464','31054','59518','27579','30762',
                          '80197','60654','10410','29943','97779',
                          '63297','73424','80567','41854','78684',
                          '48095','71475','97575','89306','55619',
                          '88075','11678','58901','13720','48632',
                          '26438','25828','29290','45937','15845',
                          '88859','32097','21534','32045','41835',
                          '61536','64068','93770','12956','63459',
                          '24690','25026','18049','52138','69991',
                          '41868','47654','44565','78828','11842',
                          '45146','16496','59076','11866','31058',
                          '62526','25533','36870','34100','53559',
                          '42043','47063','83039','56419','19013',
                          '54247','62387','25789','50880','39780',
                          '11147','23786','71034','99843','39766',
                          '60343','73381','25314','54579','81796',
                          '66025','15065','13946','19187','69749',
                          '30668','14462','57735','39606','63310',
                          '31137','34310','85048','12871','27689',
                          '43901','31374','46548','29006','37697',
                          '45832','44216','24718','98247','64961',
                          '64770','39541','21598','18457','52878',
                          '27979','54603','17179','34937','29321',
                          '75510','42549','32272','70158','37661',
                          '13045','15598','82894','22507','76016',
                          '30058','53898','68689','72415','29294',
                          '65109','61544','99774','15241','14544',
                          '96893','60820','54578','15300','58156',
                          '30271','53767','98625','91713','56971',
                          '79602','84605','33745','50898','99138',
                          '51675','30546','77963','79580','92694',
                          '10482','38611','84784','85885','35773',
                          '39154','28193','32714','81612','25515',
                          '43350','81657','61139','44664','53331',
                          '49227','35745','39674','59107','18412',
                          '33568','43109','46026','39132','58105',
                          '49496','10939','37672','61127','34098',
                          '86287','15118','80102','25241','41959',
                          '80532','59177','82520','88339','17291',
                          '33985','25312','22327','89387','16701',
                          '15223','11201','65503','97853','71590',
                          '37485','19206','13761','60965','56454',
                          '24876','12451','72910','72951','24496',
                          '86405','35970','90428','98614','88547',
                          '71228','22786','23794','44927','82677',
                          '44451','19241','37001','39477','46664',
                          '61733','82086','41610','75553','81263',
                          '43459','96219','49919','50507','50638',
                          '90199','70540','19217','52824','58548',
                          '33876','29063','15626','92671','31629',
                          '59465','35572','98773','88198','62796',
                          '54492','63472','86648','47090','17633',
                          '65096','63962','70471','13850','42214',
                          '17804','34754','78466','59632','10317',
                          '30145','39540','79863','76662','68914',
                          '15205','87689','41789','82273','29105',
                          '15706','37037','56774','99032','44433',
                          '34452','79882','83418','33857','23320',
                          '99581','19726','28397','55056','32635',
                          '97562','76792','24591','40467','69746',
                          '74924','85032','14313','63069')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
