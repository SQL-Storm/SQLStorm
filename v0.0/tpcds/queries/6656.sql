
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '11003','75418','71050','29011','56472','84702',
                          '95766','96248','54750','53751','14566',
                          '74311','11264','29424','26805','78599',
                          '86101','73944','11889','67550','58754',
                          '76358','69680','43890','26815','12195',
                          '39275','79263','73828','85173','96302',
                          '24448','66572','53604','60289','89243',
                          '65616','78317','16209','62501','71406',
                          '13789','31490','69650','24407','40502',
                          '72362','91510','31132','95555','93969',
                          '66197','46964','32222','78277','73942',
                          '51971','26729','26481','87241','28845',
                          '26011','70132','17289','37411','44522',
                          '95517','33946','42131','38224','30028',
                          '10213','92001','32045','42904','81080',
                          '19691','11634','13388','51143','31068',
                          '19261','57484','41781','39461','33325',
                          '74433','33242','69498','14875','31866',
                          '91354','34600','22644','66248','35222',
                          '39074','48706','61487','87843','91218',
                          '70738','75303','24103','86330','98196',
                          '65371','31681','18709','39967','35228',
                          '30230','33587','90551','11789','92585',
                          '48285','37969','90024','12811','16989',
                          '22676','65822','28787','29327','15392',
                          '82711','35701','72487','78746','26832',
                          '68874','21445','34565','93848','17298',
                          '27630','60620','54730','41453','15839',
                          '27031','62803','30629','97371','85550',
                          '33583','78643','67122','37976','89109',
                          '55221','61260','12492','54558','88869',
                          '67204','77411','81649','33433','25986',
                          '87011','18887','37521','68781','47595',
                          '62306','54675','84659','88830','11382',
                          '40387','26052','93329','72807','99699',
                          '51499','90980','12892','20894','58093',
                          '95462','98387','21188','44325','77708',
                          '46147','83162','69817','34762','13131',
                          '37708','53911','68058','31030','37734',
                          '69130','35900','65748','51573','28885',
                          '62743','39883','42619','71898','74755',
                          '49533','12721','86856','22219','97414',
                          '78202','29196','45681','13118','36742',
                          '15387','48313','38627','20967','25797',
                          '95505','63335','13992','13038','51716',
                          '46039','20344','20713','17891','86832',
                          '14061','72080','54080','40300','63184',
                          '25524','17519','21162','45462','24644',
                          '84173','59701','76641','46028','31410',
                          '87383','25018','69950','51765','73698',
                          '46739','71515','60837','97637','61711',
                          '60948','36244','51985','22095','41909',
                          '26612','35971','73234','74797','64518',
                          '35490','78200','72529','99943','92189',
                          '16242','95110','44795','47738','27193',
                          '50487','29280','29421','16670','63457',
                          '98685','84897','11444','26624','26750',
                          '41595','82986','22897','51569','14112',
                          '34760','28580','94418','25064','75714',
                          '80566','17149','76457','79325','28182',
                          '65690','58535','66285','95254','85622',
                          '17732','35063','87938','97919','84879',
                          '19509','40362','73961','10118','12475',
                          '34268','19716','37213','97971','36023',
                          '48763','17861','25456','38234','44571',
                          '29586','31711','34783','43765','80522',
                          '73273','34179','56716','28991','10763',
                          '89114','88585','96995','79878','36590',
                          '22714','42381','26185','99766','86677',
                          '85280','99191','11185','22514','32185',
                          '91724','93793','10395','92193','84645',
                          '64902','16921','98681','22587','72532',
                          '82230','57402','56750','14858','30888',
                          '95265','24986','26381','55687','54478',
                          '21544','33585','55948','27653','11007',
                          '18707','30358','16200','65686','15512',
                          '50186','49023','10971','13542','89543',
                          '99938','33240','82716','38531','28633',
                          '28536','64291','65245','65549','71085',
                          '22018','80596','93796','54706')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
