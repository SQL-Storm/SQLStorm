
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '51569','77530','31742','36532','43532','82526',
                          '30312','37335','86202','23029','62498',
                          '64298','90697','31843','95629','29286',
                          '28130','45097','16583','90707','37866',
                          '18224','41571','21211','26506','21117',
                          '43135','58912','62861','27119','33402',
                          '44929','65506','20146','60591','77396',
                          '86739','37279','13177','34187','29279',
                          '31593','93699','51528','44634','13839',
                          '20926','52292','35261','65802','46289',
                          '60831','91170','54498','49534','13892',
                          '76335','98273','26297','69014','25820',
                          '67486','22463','47776','81730','53483',
                          '37679','71058','15683','68164','76650',
                          '57525','43583','70647','30149','44881',
                          '99185','40328','17282','90461','29796',
                          '80038','24721','56157','13681','68948',
                          '63562','36223','20070','47679','13180',
                          '62403','60126','82184','65971','19299',
                          '42518','70354','55776','23408','78931',
                          '65582','24280','86260','14696','36611',
                          '94797','38391','29102','26825','10793',
                          '29601','16943','43562','43424','19544',
                          '51272','51917','24759','45566','91086',
                          '82848','89062','43290','37254','45128',
                          '47587','96311','43265','48262','79332',
                          '14799','88795','94687','37029','37365',
                          '99120','32401','24575','89612','46151',
                          '94709','16126','41873','47606','24417',
                          '60924','60643','32493','25026','35531',
                          '78585','66793','30179','13605','33374',
                          '56688','98755','42991','46163','12565',
                          '48047','69765','57326','69936','82030',
                          '12268','31849','58923','34320','22191',
                          '93378','46889','78624','11593','18691',
                          '97506','39287','45825','52502','79653',
                          '83922','18880','86573','73713','16755',
                          '35056','39011','47343','97924','38657',
                          '49128','18047','72996','88059','36497',
                          '70396','57132','71439','38141','23743',
                          '92747','41759','24638','15829','21744',
                          '56388','50502','96144','73951','53749',
                          '74028','71805','27723','11896','39533',
                          '32415','11616','48834','45730','49364',
                          '75052','22276','79705','21889','73684',
                          '78155','95608','84402','43970','27612',
                          '20542','41410','24500','44799','44532',
                          '42734','49791','15048','71394','54454',
                          '46320','10714','38792','69587','78185',
                          '15661','49750','96462','32098','19411',
                          '66521','92641','29683','71401','14030',
                          '65353','58844','58193','24607','84555',
                          '81733','70032','43016','63768','25930',
                          '31900','27294','11886','61418','48101',
                          '96260','58634','40826','34441','50030',
                          '85696','60068','89036','23002','97242',
                          '24467','55065','97771','76361','99070',
                          '23787','61162','58513','16388','35708',
                          '17207','40088','45260','52170','54786',
                          '41279','50637','11216','86352','61598',
                          '61156','13278','85275','95552','25570',
                          '56425','64494','40284','96126','86665',
                          '50752','72769','21020','51959','98803',
                          '96391','80299','26966','16162','26965',
                          '14121','59313','72579','43111','23982',
                          '18133','74686','55566','92734','12271',
                          '54545','39162','40368','37039','99524',
                          '36418','18566','16574','49728','37086',
                          '47105','85840','82340','49821','23630',
                          '21701','82594','46841','28588','15838',
                          '14794','42517','50388','87787','17865',
                          '34452','88541','93987','80312','11283',
                          '19067','11280','91610','54591','80987',
                          '71895','97397','28767','31083','38613',
                          '13188','43527','87091','58862','63549',
                          '85884','61888','68617','88694','54420',
                          '66105','13003','31753','71181','66111',
                          '20585','13337','11908','53162','67312',
                          '42883','10053','92303','34447','38839',
                          '73014','33212','67200','23325')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
