
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '41302','57243','87082','54550','84072','64439',
                          '35277','35859','84952','52234','61500',
                          '53469','26983','85705','81805','38027',
                          '23630','94500','56447','32950','93305',
                          '16856','44938','23827','27103','66212',
                          '80116','77124','32305','28770','32308',
                          '68455','57611','88499','15763','93030',
                          '16298','82592','99609','62172','20319',
                          '72323','52030','33267','81824','66186',
                          '96215','79377','11296','65027','44978',
                          '33466','87119','30879','79896','12737',
                          '20449','32055','12720','71296','25389',
                          '21795','52293','76403','14078','10321',
                          '27157','93065','25504','12047','52140',
                          '77169','74115','72957','83546','33394',
                          '11453','96301','69219','77577','61144',
                          '11821','14855','96254','11668','44826',
                          '19702','12068','78382','81785','32761',
                          '56725','23994','42663','78553','39967',
                          '17428','10451','14118','31561','25602',
                          '14463','78023','40263','12405','44573',
                          '53286','78438','19835','38806','92935',
                          '65437','21112','86101','40597','11983',
                          '28730','11841','52730','89500','41845',
                          '17358','14622','21768','89578','46984',
                          '63885','57861','98486','77613','40899',
                          '38429','15675','35579','67314','97802',
                          '20674','12520','32043','26976','62018',
                          '45945','19683','26305','26245','94626',
                          '42619','64576','91482','22706','20636',
                          '34758','15961','91858','88292','44429',
                          '58940','62545','59407','99518','19652',
                          '78041','57345','46365','33293','11627',
                          '91273','24330','31362','18551','95572',
                          '19059','35776','35875','48911','15789',
                          '92404','28755','75338','63553','63674',
                          '15253','89430','73174','81168','50857',
                          '61165','18960','46054','43735','65768',
                          '66271','17676','75693','34340','56404',
                          '17353','16600','30547','47814','21559',
                          '81578','63066','84020','40394','10023',
                          '98271','89019','77336','19158','86015',
                          '69546','20999','20955','73716','94828',
                          '23283','21653','14612','55381','76402',
                          '52683','53201','50423','59451','42008',
                          '72439','86094','25838','52468','72714',
                          '44861','38737','55635','25896','47095',
                          '67319','92886','23195','12953','82368',
                          '51096','29062','39921','25994','64370',
                          '19638','86243','33203','60508','73976',
                          '18248','54732','30817','52966','84383',
                          '84161','19993','54166','19172','40702',
                          '43533','76438','17969','17934','34822',
                          '65862','25487','34996','61209','37020',
                          '11224','99838','18355','23467','26728',
                          '57555','34457','47091','87572','82817',
                          '12027','73719','55219','36255','82484',
                          '91765','56112','21058','92256','21571',
                          '16389','12141','17182','67641','73541',
                          '32187','23702','71424','32899','27927',
                          '25466','60827','46495','27584','18632',
                          '93085','71439','14275','13790','65404',
                          '13107','67158','12424','16378','57042',
                          '80814','22726','69665','94228','28983',
                          '19991','34175','87783','52147','66449',
                          '67949','97844','36237','15092','31312',
                          '47609','78046','91293','77246','78867',
                          '15512','46493','74999','12388','87895',
                          '81072','40261','17360','54899','44076',
                          '54097','15985','48010','99069','85731',
                          '29686','87337','27051','41681','11795',
                          '76341','21265','51084','19928','40341',
                          '15344','37249','39966','34623','73939',
                          '42162','79286','19871','79558','16534',
                          '59156','89253','80043','48826','80232',
                          '39338','76311','52875','65466','73182',
                          '84010','67889','96910','30322','13156',
                          '57385','19729','98826','40142','62421',
                          '68515','61349','76772','26438','75278',
                          '26698','51146','72743','79397')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
