
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '69966','41347','81009','82377','12893','19189',
                          '47992','86450','15943','97374','38892',
                          '21265','38719','20835','35903','88167',
                          '13405','36885','11947','85164','93857',
                          '36246','53585','97546','85108','57422',
                          '65133','88759','36723','14839','29762',
                          '57120','38826','17199','76511','83176',
                          '59037','84017','36754','75819','72677',
                          '73499','38880','92670','41867','12955',
                          '17793','18338','82097','56370','35093',
                          '86115','60191','31362','26596','36062',
                          '92605','78704','62094','35981','53689',
                          '67798','32617','20274','23388','44573',
                          '32063','69377','69355','55262','10028',
                          '40160','42779','20231','25337','21886',
                          '18243','22010','53594','62517','55444',
                          '47505','96881','59047','81341','16086',
                          '42261','31294','32598','57352','74523',
                          '11204','70498','34967','53249','67203',
                          '16087','18344','76231','29203','37146',
                          '74564','16812','91143','31372','62007',
                          '53493','79930','24917','52762','51567',
                          '57516','35924','72059','56964','59871',
                          '28497','30911','80565','91117','22630',
                          '31653','18193','51135','93911','18736',
                          '83775','10581','59971','44054','28867',
                          '85437','88714','97576','23948','37656',
                          '11703','80040','20128','40484','16520',
                          '11078','62593','22746','47706','54141',
                          '16741','48046','98553','81761','10626',
                          '33882','63239','94043','26361','32931',
                          '66126','97042','15316','76962','36409',
                          '16458','10570','11556','86183','23072',
                          '23344','35968','31637','12555','69644',
                          '80713','28185','43304','68828','89472',
                          '32730','26643','19857','16868','26177',
                          '82626','48443','18791','27096','88202',
                          '83836','42732','52752','89697','21778',
                          '49082','84907','64549','83744','51647',
                          '31046','80714','50931','58952','98431',
                          '54238','68174','39869','31429','31643',
                          '11168','29496','56195','84206','22804',
                          '22240','39060','91526','48171','54846',
                          '75785','68550','42497','53405','61869',
                          '45171','49823','60263','42287','68765',
                          '40980','41473','67475','12756','34411',
                          '98015','79692','40296','47580','80419',
                          '97664','29418','47972','35085','90474',
                          '68399','79448','51854','72034','77969',
                          '45919','33878','44855','27581','45185',
                          '57940','57038','17259','47970','89374',
                          '38455','94477','75063','75461','89728',
                          '91261','15392','30229','29106','39300',
                          '21386','39114','74827','93827','58495',
                          '19362','12539','89067','40726','29877',
                          '62411','62429','63952','16726','23210',
                          '68769','32769','39884','57441','90332',
                          '55972','47238','51868','62387','95964',
                          '73623','31628','88087','55071','90501',
                          '19332','59580','75922','27249','63911',
                          '66329','79987','34874','18050','29382',
                          '46096','22771','11386','63047','51736',
                          '49065','76090','76928','46350','37120',
                          '93173','20386','70062','18345','97084',
                          '48384','66409','58585','21359','55964',
                          '30414','45280','45761','74759','61635',
                          '46019','95051','70701','14354','42904',
                          '43387','48678','12884','73561','34211',
                          '39479','64712','18065','30525','76333',
                          '41585','77087','42418','48955','80143',
                          '22530','26113','84627','75810','16556',
                          '37068','83036','35228','67657','57493',
                          '82407','34732','25715','63224','41856',
                          '62449','10975','60920','27099','38807',
                          '48280','57578','45455','57606','33874',
                          '64278','27936','55754','17143','13024',
                          '40896','60295','70163','94595','74402',
                          '52130','75074','61770','13116','84935',
                          '73116','10457','78117','61763','24957',
                          '37435','45953','79405','54017')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
