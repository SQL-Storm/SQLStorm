
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '17719','97465','54377','12547','31875','76848',
                          '48675','21705','32421','31580','26346',
                          '33400','82701','36252','13423','64863',
                          '24907','63602','20279','93311','72361',
                          '17041','37226','39335','40414','53627',
                          '30355','34530','39730','53786','10897',
                          '18193','16423','74666','20636','97499',
                          '81223','56574','97341','87898','50383',
                          '85752','16086','16893','97160','74958',
                          '29342','13240','98323','34062','65182',
                          '71949','24816','20343','25497','49815',
                          '53104','91550','97166','38951','27095',
                          '19918','65404','37276','32623','14600',
                          '92183','11580','62671','50349','11198',
                          '51451','21318','18952','21500','21042',
                          '73439','10565','83422','55595','31568',
                          '56407','38095','15122','64475','53609',
                          '46098','74872','30518','31281','13136',
                          '53352','43917','21185','77626','69372',
                          '28279','53929','19461','37278','67304',
                          '76260','39890','53090','39651','27257',
                          '56201','99049','58243','15553','51305',
                          '36049','42636','37106','13728','57580',
                          '29193','83312','27923','20268','19637',
                          '92737','11376','25728','42749','69133',
                          '43669','75136','12566','60335','61627',
                          '68215','48503','12497','57036','71660',
                          '36529','68521','89236','13403','43459',
                          '98276','77782','14829','24779','43559',
                          '94237','29279','17195','85086','83279',
                          '82652','81600','31454','83211','35072',
                          '59692','90650','73972','17059','15479',
                          '70633','53300','80123','18104','32148',
                          '25220','31495','12402','28109','33706',
                          '78280','74161','65079','45697','61606',
                          '32143','88876','46547','15382','87660',
                          '60613','12928','43517','77650','59687',
                          '35163','94865','25382','77530','44272',
                          '93181','54391','27541','32488','86682',
                          '49679','14772','16850','18586','28306',
                          '37644','19879','53907','99246','37371',
                          '19954','56200','48121','49295','40816',
                          '81432','14797','30538','81819','12672',
                          '56613','51645','16186','65700','76836',
                          '37541','47121','23459','29894','85259',
                          '27392','48630','95222','76194','17939',
                          '22858','22870','95325','10079','38686',
                          '16332','46354','68383','70985','23386',
                          '63574','38971','38910','54072','60276',
                          '48822','96638','26037','21441','30346',
                          '90983','49776','39823','31804','68081',
                          '78396','26061','67500','39819','51597',
                          '29283','58622','12909','16790','91438',
                          '97425','63285','81086','93665','84677',
                          '58008','85142','58300','20275','37592',
                          '39365','48693','55213','21050','75315',
                          '92851','31386','47284','98827','65121',
                          '21570','69896','25263','43396','46389',
                          '43486','31113','69677','28199','40141',
                          '96679','47075','75727','39237','94913',
                          '32215','83005','68817','52989','86875',
                          '33511','12994','17093','49630','14242',
                          '23060','53500','40905','74703','21319',
                          '30397','58005','86691','86041','17247',
                          '52044','50524','11383','85515','77412',
                          '27719','20299','16323','95304','95336',
                          '11847','25715','59586','73510','81920',
                          '96257','66715','62075','59477','80946',
                          '58066','84160','54946','60541','65206',
                          '14839','48284','15389','46359','36524',
                          '23979','87964','49554','31862','27454',
                          '41349','30323','42963','53900','27604',
                          '41830','39749','43191','93836','77062',
                          '62163','64543','12696','58745','89249',
                          '22721','78534','83355','56840','31555',
                          '23787','43628','49990','78328','42538',
                          '19225','85369','71444','93673','76633',
                          '91410','14494','58688','47058','12637',
                          '22532','52087','25084','99324','19340',
                          '66912','55376','79604','59932')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
