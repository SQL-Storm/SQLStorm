
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12421','98008','32158','82982','87801','13868',
                          '12362','47992','57746','13911','17188',
                          '68324','67918','55690','24393','33205',
                          '63352','29700','84644','23401','15975',
                          '47473','37526','40695','23371','64714',
                          '14637','37113','35880','44356','46526',
                          '54438','92929','58480','78198','16648',
                          '20340','69601','14155','46486','73367',
                          '77506','57863','46308','64481','44486',
                          '31327','93285','81668','51811','26019',
                          '24860','90875','19932','68503','73710',
                          '12964','69758','76163','13258','46927',
                          '59049','23819','42880','94741','70011',
                          '20758','16599','62303','76219','45202',
                          '21175','89061','96259','86057','32244',
                          '36186','35269','75490','51906','60449',
                          '14100','47484','11741','29646','58356',
                          '72684','25485','79629','88676','66052',
                          '38636','10402','58643','40751','29078',
                          '68045','29579','56178','19293','40725',
                          '23323','18785','57156','30520','89728',
                          '20726','44124','61859','52823','71667',
                          '85333','44117','26296','53029','60148',
                          '46049','15312','73003','10830','60408',
                          '35165','44134','98335','53262','35777',
                          '76859','72656','23270','43814','94290',
                          '92846','41723','56174','70771','90921',
                          '71861','87986','30965','68335','62733',
                          '53890','42458','69116','43482','22474',
                          '96040','82112','36472','96839','14176',
                          '79346','31938','24906','94398','61158',
                          '26663','95789','87926','85158','79909',
                          '73583','87395','45289','34573','58516',
                          '58700','48466','18450','53773','92503',
                          '67609','23799','20993','71642','63157',
                          '18478','24653','13686','43037','66899',
                          '61916','38666','19643','13517','23833',
                          '93991','71859','16681','52788','51455',
                          '35956','74537','44428','69408','89488',
                          '84816','69333','21771','11472','49136',
                          '53861','97699','39235','12130','66255',
                          '56977','79437','49041','29824','99571',
                          '25501','11330','73646','10204','26370',
                          '10847','36279','87918','68117','43439',
                          '36073','22239','32192','11824','58925',
                          '16917','65543','36806','66390','98523',
                          '76621','25922','75466','46007','12822',
                          '33989','18495','29107','99714','22081',
                          '92086','63328','10485','50445','36683',
                          '43040','33185','15661','96409','27243',
                          '55411','46708','10184','11102','47886',
                          '86369','43155','45355','16860','70979',
                          '33432','76199','68829','19681','75014',
                          '88269','43557','31133','30831','60427',
                          '81255','33114','52278','84249','76206',
                          '23028','70129','37460','48304','26167',
                          '46081','39693','20972','42130','78325',
                          '48444','63903','81441','69678','30530',
                          '70147','90565','96574','10908','11066',
                          '30169','74756','24152','33986','52595',
                          '44961','42731','34047','88025','75482',
                          '68609','66165','36408','42418','27485',
                          '85328','26956','81223','85467','48002',
                          '45412','61868','86854','23864','52521',
                          '11736','33553','54012','83931','92314',
                          '13913','41018','15981','52047','79365',
                          '79327','11863','19303','36187','28475',
                          '58286','48454','34769','94602','83682',
                          '73164','22078','41290','83967','75436',
                          '47789','86848','47488','32622','91612',
                          '28537','21763','56856','61389','89161',
                          '59900','51871','66551','24402','29776',
                          '77108','61583','50605','25834','64494',
                          '68560','99394','75150','36847','70348',
                          '95937','17423','48016','57644','62788',
                          '73721','44204','96309','94261','20681',
                          '76466','44916','22439','18017','66407',
                          '90680','53150','37282','59236','59132',
                          '81948','83562','75582','86446','15635',
                          '60326','14785','80451','20759')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
