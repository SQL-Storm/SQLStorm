
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '96577','12164','37943','88056','31757','17326',
                          '71854','54093','93762','15783','92093',
                          '59343','42652','39825','94060','75624',
                          '60702','31349','23778','64154','26551',
                          '58872','55889','70369','93495','81814',
                          '62818','98219','51390','56350','17587',
                          '41378','88575','72775','14841','21865',
                          '42674','58058','71756','34267','44717',
                          '21117','49817','53935','12571','44027',
                          '46888','28365','68007','81851','94668',
                          '18285','49708','62048','75350','84960',
                          '61882','52888','84774','51025','61559',
                          '86298','16778','33446','93370','25705',
                          '55952','65744','18429','57581','82545',
                          '77014','33716','69844','21175','92313',
                          '63266','79333','91150','83570','23214',
                          '56090','28776','17945','80101','88710',
                          '76163','19425','59077','28791','56746',
                          '31155','45248','30329','78036','91702',
                          '63497','90776','12372','57047','96443',
                          '74636','85747','50531','50576','64870',
                          '24595','96984','73969','93638','29062',
                          '17201','50897','13163','72067','45593',
                          '38586','48757','71208','43433','76018',
                          '80113','43158','37967','82758','51425',
                          '11087','37322','40015','93818','66758',
                          '88577','59160','33525','82889','16512',
                          '32901','68309','66200','32700','76086',
                          '51909','28431','54051','19655','43508',
                          '60428','73724','61899','47672','86790',
                          '68900','77596','11551','35445','71950',
                          '84976','30008','68564','19423','64039',
                          '77886','93913','21165','81194','75292',
                          '37112','12234','94967','87363','57978',
                          '53797','32070','32783','86509','60188',
                          '57401','62212','74853','84390','89662',
                          '34235','20147','61257','19323','42422',
                          '24854','27164','91053','97480','50280',
                          '90895','15144','41812','84138','61596',
                          '57353','92828','58232','15395','22120',
                          '47641','59614','14364','44439','98729',
                          '11115','58766','61803','97394','13801',
                          '12282','75903','25355','39302','54480',
                          '97930','45825','65245','43248','20663',
                          '12641','50161','31332','73034','36583',
                          '12897','51753','83219','13840','79305',
                          '72264','67323','91297','79170','27357',
                          '38327','82277','42202','75186','13230',
                          '89323','99695','29235','12806','33786',
                          '70914','64593','78568','15234','28228',
                          '70552','23745','74328','54618','95073',
                          '88100','75457','23038','88878','90942',
                          '10054','60723','23877','25178','22762',
                          '13477','60952','55845','31209','98532',
                          '34692','12038','37031','66308','42210',
                          '47309','13783','56037','25643','48755',
                          '18425','66067','51928','84011','32080',
                          '87787','25462','59410','19233','83927',
                          '35484','39353','45617','99716','56244',
                          '47930','76110','95736','99638','24685',
                          '34500','28528','81692','72800','16622',
                          '44513','24163','63668','28042','56730',
                          '27421','11172','88375','15996','21110',
                          '77480','34445','26580','32449','29125',
                          '62008','26378','35352','54749','63133',
                          '19675','39078','61448','96760','39873',
                          '72596','86478','14382','52226','41449',
                          '41259','56109','86884','64523','31032',
                          '16141','38255','12803','69128','62661',
                          '27140','31119','77416','37172','49408',
                          '81723','75240','26950','71783','59409',
                          '94458','83147','51493','47449','71672',
                          '99049','30946','63964','25299','49003',
                          '92114','11552','78167','17137','17149',
                          '15568','61579','84856','85727','80236',
                          '57366','37202','70977','54343','37945',
                          '70581','10616','74181','86363','60741',
                          '14588','87709','51848','52504','12514',
                          '71957','82099','33294','11351','95683',
                          '21128','95942','16338','74095')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
