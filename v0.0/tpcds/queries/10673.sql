
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '73116','83015','81113','29420','61115','92252',
                          '34081','43147','47765','28070','67208',
                          '85165','62899','59421','38158','38801',
                          '95355','98041','44987','73703','11062',
                          '54929','34446','82016','20859','86107',
                          '22812','84734','73583','98471','39754',
                          '57271','15048','26131','91199','10038',
                          '44985','67213','18746','93448','47167',
                          '35595','88458','34923','48265','99169',
                          '26852','38423','31354','96088','26934',
                          '96189','69512','28186','48379','38330',
                          '47781','83029','68004','69190','13260',
                          '45669','79826','23256','19060','14502',
                          '90183','12967','35862','40627','78343',
                          '35737','30080','65008','63568','43310',
                          '95272','21467','12703','45646','23453',
                          '20820','86147','24849','66868','68827',
                          '25408','63916','55008','27652','77613',
                          '26621','18804','93330','62715','18667',
                          '45666','57017','55778','78184','57545',
                          '84932','57519','32632','89859','34831',
                          '62593','99421','79050','72562','10062',
                          '42209','45480','39628','76259','82755',
                          '19174','80871','49137','20280','65779',
                          '46968','50701','27479','48088','43970',
                          '27756','78046','24589','89313','50388',
                          '56176','26771','56400','83055','44317',
                          '35011','67310','15755','86652','41475',
                          '91249','29145','99547','14876','69762',
                          '63550','25337','50313','45453','64923',
                          '82454','42641','73360','32095','76495',
                          '21152','84682','31807','27691','19914',
                          '95259','40948','17562','79914','33103',
                          '22685','26887','42607','35203','25565',
                          '39327','24383','80220','61573','84059',
                          '63390','89033','26203','11971','45044',
                          '45425','81825','48503','64840','33581',
                          '90917','69740','51887','38265','38650',
                          '77225','31619','15240','70965','26187',
                          '18227','40095','44174','55975','45489',
                          '78764','67015','96114','26897','61219',
                          '13657','24967','26832','68091','89349',
                          '85895','12869','27112','12957','94887',
                          '39694','97785','94347','39768','35423',
                          '41808','60606','99139','95519','36857',
                          '43805','32004','44809','76625','65342',
                          '90887','74598','40519','12103','89516',
                          '31654','60571','26588','17720','95280',
                          '79912','33335','90383','75493','73465',
                          '98542','24704','53190','35820','15648',
                          '25727','19694','59759','29301','55437',
                          '18658','71330','67343','44240','27779',
                          '47437','18207','11898','53370','94687',
                          '49146','44726','90759','28963','27242',
                          '92310','39006','19042','64168','21670',
                          '25861','65332','85711','37379','80668',
                          '17999','23648','78808','45135','35574',
                          '54073','45136','71717','45328','12244',
                          '92853','87640','75248','90643','70307',
                          '77708','20988','80278','98551','35920',
                          '52073','30396','85626','60979','56548',
                          '68880','19810','95183','24045','20824',
                          '35113','39308','22752','16220','83934',
                          '63204','88857','21839','63364','22505',
                          '25335','32692','69123','74933','53666',
                          '14965','80737','76762','65294','31564',
                          '14575','56308','32825','48293','88125',
                          '15437','16823','58916','89616','23679',
                          '22857','32841','35378','82941','43548',
                          '81391','77543','31134','84114','99916',
                          '10946','51118','22472','73320','64481',
                          '97338','18753','26434','82280','88092',
                          '15865','38742','78133','33767','44778',
                          '43920','26759','41449','63713','12976',
                          '63311','49006','98289','28465','32545',
                          '28987','88104','12961','48806','11552',
                          '15679','25779','32768','63694','23627',
                          '22389','48404','15545','20702','48370',
                          '30000','13737','50892','95230','98234',
                          '82838','96712','34285','55296')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
