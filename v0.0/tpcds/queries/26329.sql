
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '66834','88526','66453','46052','68680','12041',
                          '77657','57920','27537','94512','35128',
                          '64459','35888','15424','92668','52448',
                          '38067','35310','87022','68333','33943',
                          '12465','71558','18021','18668','57011',
                          '58319','66713','62583','37138','77432',
                          '30840','68015','94940','61716','10489',
                          '66508','48844','97105','10301','89598',
                          '55246','80958','12348','17328','91673',
                          '66164','70791','65959','62231','59094',
                          '97052','48663','25061','71769','24048',
                          '88817','12273','46706','81829','32756',
                          '49436','53452','23248','91261','13967',
                          '16064','21191','75942','83618','42268',
                          '87080','84363','49065','17963','91324',
                          '35035','55668','50089','79040','41351',
                          '97303','56035','17931','10193','25656',
                          '81039','51086','60046','40830','31411',
                          '31522','87398','42210','35139','22590',
                          '29361','55954','27510','32236','31254',
                          '71457','45424','22853','64509','71043',
                          '31631','68472','41243','48984','25271',
                          '50179','12525','31717','94298','15167',
                          '30220','74339','50339','83465','51533',
                          '80263','50186','74217','94884','16552',
                          '31089','21600','92824','70289','84017',
                          '88813','67652','40802','13358','72035',
                          '83849','48535','85609','66190','18561',
                          '98314','16294','60789','25942','76189',
                          '63613','86678','13994','32819','20643',
                          '42870','54788','31627','30512','18846',
                          '14156','84528','34955','84053','30900',
                          '69854','29633','43195','87570','72826',
                          '56029','13351','89970','29580','25174',
                          '18549','52179','90893','89952','59619',
                          '34830','93951','43338','40544','63206',
                          '88356','38319','51528','41214','13649',
                          '63621','13074','20060','14292','27507',
                          '28160','88382','94561','83831','24427',
                          '55587','47427','50878','60290','40029',
                          '76395','21109','93816','17628','48933',
                          '18023','16355','39223','11610','39599',
                          '25315','53502','20286','24737','44479',
                          '78994','12623','61812','60959','88252',
                          '88377','36178','38224','58261','48193',
                          '27742','11592','47511','22962','11738',
                          '90370','40759','14767','27176','33987',
                          '22487','40858','15308','20547','62991',
                          '29604','35724','27019','71158','87460',
                          '35179','47406','42543','18269','94156',
                          '50052','34204','48142','17925','67381',
                          '73349','63001','15077','18795','12617',
                          '66446','30944','92666','59312','74360',
                          '40974','37214','30851','29050','17974',
                          '30653','13822','34538','17575','19988',
                          '15502','71594','94305','95825','15221',
                          '39743','93349','39387','80785','10794',
                          '79071','34736','48878','67002','69752',
                          '10596','32841','73682','26263','52875',
                          '44421','19520','80074','39492','90689',
                          '69520','61409','89467','13037','44604',
                          '33461','15468','41507','92055','36735',
                          '28943','63399','49378','53922','67382',
                          '65433','46120','17417','36513','11744',
                          '53690','85892','98797','81707','85036',
                          '25282','30637','53390','19048','18123',
                          '45837','10612','88004','68418','64122',
                          '45658','55137','79610','49396','42557',
                          '30855','16922','86586','16142','23885',
                          '86662','81010','46543','15294','58713',
                          '62489','82958','15772','14122','27255',
                          '13687','45105','14739','73196','71439',
                          '76701','40549','16189','20773','44990',
                          '19889','47294','30398','59947','19835',
                          '16083','44683','37899','22894','83714',
                          '80555','32480','48724','79752','30334',
                          '68416','68827','10759','95297','17500',
                          '83619','45206','82095','20797','50168',
                          '62389','18968','56036','93465','53866',
                          '78564','45863','24585','98642')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
