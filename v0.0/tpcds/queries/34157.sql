
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '25667','60022','21616','24698','47015','25135',
                          '12758','42583','25836','48176','13106',
                          '96893','93441','55903','94572','23647',
                          '22265','33013','49015','28891','93553',
                          '28746','28664','66180','78627','40524',
                          '20657','17341','28969','53100','49979',
                          '34552','68931','71513','88312','95257',
                          '74322','25076','43162','18225','72931',
                          '23304','95995','92230','87569','18094',
                          '92502','76561','91191','86726','30174',
                          '19138','80034','10098','86071','64447',
                          '90614','64962','72170','52174','44971',
                          '89169','81402','62042','55332','91658',
                          '36027','26568','14790','24622','76531',
                          '79439','57570','54384','51634','95134',
                          '20996','81586','14546','19195','67133',
                          '60262','88354','45509','87244','35369',
                          '70909','12452','45654','25000','27973',
                          '41437','67214','71470','34765','47770',
                          '10342','14974','11691','90911','25881',
                          '11590','30520','44922','97231','15135',
                          '99903','80398','28919','36982','93826',
                          '98241','40316','40255','67026','43873',
                          '92396','60047','11761','21832','34198',
                          '55113','81021','64892','44659','34443',
                          '24395','87573','33765','52046','53061',
                          '10955','20434','31367','66055','53784',
                          '99947','93746','56818','52964','50791',
                          '60216','91268','13234','99786','12161',
                          '89469','46383','46522','22668','81883',
                          '37393','15341','40443','89551','51136',
                          '90631','90804','21171','77243','34708',
                          '62889','99499','33687','30998','36376',
                          '36781','31675','63152','18131','14872',
                          '20066','41237','21337','17318','43385',
                          '24318','93315','38341','35868','64342',
                          '56441','61566','33570','73543','52450',
                          '24984','11716','25533','69472','88833',
                          '31890','68587','52570','18245','65806',
                          '24897','96093','87358','14271','50638',
                          '27034','97159','42432','85430','62400',
                          '20206','21103','54995','80682','49583',
                          '29037','12742','19468','84491','81558',
                          '66116','19258','34279','44915','26812',
                          '39314','23964','76619','57506','82772',
                          '92841','14855','56366','97443','97098',
                          '20490','23020','54236','40097','43251',
                          '97002','76605','28418','16461','47834',
                          '73045','41649','29468','48058','46281',
                          '66316','53688','87589','47328','78291',
                          '78761','41555','26129','57237','32765',
                          '46637','33911','71249','24338','20612',
                          '31395','79595','64251','99266','37467',
                          '48068','90759','53638','99203','10369',
                          '94816','13979','87613','56502','59876',
                          '60183','36078','65618','64565','52402',
                          '97230','56916','73326','56799','96029',
                          '88765','28294','70678','32412','55947',
                          '21187','50355','55363','17989','84483',
                          '83240','69603','44836','85705','20720',
                          '86519','13320','56270','34261','23797',
                          '37505','44233','16941','42413','47298',
                          '25012','38900','51291','45974','32485',
                          '84185','55223','43288','93108','67326',
                          '87699','54210','66239','46376','67374',
                          '45236','89776','43436','92278','22984',
                          '41679','67808','53132','35880','65510',
                          '85632','14915','84776','70392','73113',
                          '95872','69482','78155','19819','25343',
                          '29205','17400','94214','18518','58910',
                          '77143','31859','92305','37356','45202',
                          '53708','71432','29236','82269','28945',
                          '19389','39711','23072','71168','68834',
                          '38395','27533','57028','44487','82811',
                          '27468','84345','77554','77786','99168',
                          '68184','22978','40833','21395','89659',
                          '69305','86392','39340','67598','85061',
                          '65842','12171','48692','12984','32793',
                          '14370','48818','51678','20975','67448',
                          '16825','10660','79629','57267')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
