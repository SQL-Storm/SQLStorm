
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12090','56607','39009','41224','57640','87675',
                          '45953','33034','26254','41825','16949',
                          '80883','70725','48599','55335','48621',
                          '59424','11482','34185','12231','53890',
                          '78615','79262','86837','82080','77677',
                          '75060','16682','71265','97624','76971',
                          '43736','12370','41074','54760','46405',
                          '25028','44540','45845','21472','10952',
                          '33810','21422','59098','49113','36575',
                          '78879','25821','65439','79826','92021',
                          '61961','46496','29756','50679','95313',
                          '11620','37133','44965','95143','60810',
                          '70035','56055','94876','32796','22456',
                          '66782','90562','50731','74044','93195',
                          '99040','48524','17865','56051','66531',
                          '19546','40149','49143','55849','63143',
                          '46557','43724','41882','25701','12011',
                          '92554','36068','94245','33282','49330',
                          '84068','68513','32213','96480','17094',
                          '23156','40487','77883','68635','30029',
                          '31280','51593','41648','45209','41626',
                          '23932','16267','42723','68944','23899',
                          '71524','92690','21119','51962','30524',
                          '52835','29481','36458','85191','61798',
                          '39212','10413','17718','53068','35300',
                          '77656','89843','24253','64463','11216',
                          '27671','25623','51714','73002','28865',
                          '57370','24045','12870','37364','98395',
                          '45993','90530','28957','10326','70205',
                          '71986','54679','53268','48050','78552',
                          '45302','38871','31248','15339','32141',
                          '68591','84405','79772','10550','26382',
                          '31983','94264','64565','31278','71719',
                          '70993','35100','45638','68327','92285',
                          '34857','90882','71953','13821','22673',
                          '17210','82305','77400','17708','30364',
                          '95811','33364','56850','68450','37000',
                          '63205','57710','11718','52949','67845',
                          '96836','60026','91004','15937','39880',
                          '48770','33798','66902','51894','75626',
                          '99577','32932','64586','21682','24186',
                          '85870','32318','74547','38866','97316',
                          '52046','16422','97271','56561','97945',
                          '69004','83131','61794','93858','88932',
                          '20944','20610','55878','29428','81336',
                          '31165','35344','93010','53024','88181',
                          '20543','16131','30100','62094','20284',
                          '86294','22032','16260','34620','84208',
                          '60371','12387','86955','41746','35099',
                          '13121','63863','65590','89384','60596',
                          '40508','57115','37195','28346','47800',
                          '41035','74342','40741','42579','70648',
                          '14585','15369','78752','88624','61789',
                          '11067','83092','23939','44078','34864',
                          '61588','63990','93186','59864','41076',
                          '84878','47659','67523','38262','30178',
                          '41374','68646','29894','85429','61836',
                          '57203','92779','78152','87084','62947',
                          '75900','29141','23457','28618','54500',
                          '58801','85899','22275','86496','85716',
                          '51898','63201','68514','52823','85571',
                          '96755','47104','16857','51615','21339',
                          '20678','30028','52036','44303','94994',
                          '47591','44950','82977','86605','78044',
                          '56550','28443','52860','27386','90736',
                          '64141','98885','64509','14703','66159',
                          '74327','67430','79153','48355','32534',
                          '69882','50263','40454','96996','17001',
                          '34586','24433','13677','51627','48039',
                          '34897','58904','65706','46106','30509',
                          '57637','76392','49278','58237','87886',
                          '49071','51547','43070','52045','87232',
                          '11396','42346','19500','37465','15110',
                          '72690','27962','59725','67659','83066',
                          '62354','71978','32081','14100','26619',
                          '63694','27354','90149','26151','21613',
                          '51345','46035','67233','74344','56097',
                          '17824','87300','71341','21751','34929',
                          '51299','23772','13165','43260','57677',
                          '10462','36641','43476','41111')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
