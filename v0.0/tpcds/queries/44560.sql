
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '84125','52736','58001','71703','51152','33907',
                          '84577','70651','97550','27565','28603',
                          '32286','73216','31412','23080','71827',
                          '16653','94256','61626','17664','17621',
                          '88082','51660','82939','85242','26390',
                          '44172','28920','55444','25964','71760',
                          '28596','21696','11035','78250','19996',
                          '55491','67258','59794','93371','19062',
                          '43541','15050','14510','10894','16220',
                          '23215','28205','52062','47689','13726',
                          '84593','71532','78691','27731','86472',
                          '97058','51737','47926','62810','53469',
                          '22743','67621','26209','38794','40143',
                          '63332','31186','42781','80885','43211',
                          '52594','17903','28578','52744','92453',
                          '83306','78475','61608','52680','27891',
                          '40278','89601','76483','41380','25431',
                          '13899','12974','40283','75796','26285',
                          '19258','63583','29093','81880','73341',
                          '26124','99882','63282','54108','34524',
                          '16127','55592','51457','29656','92929',
                          '74968','69118','21454','86572','20605',
                          '17656','16164','28859','50405','72724',
                          '19818','42081','23916','63417','55473',
                          '17560','40613','25285','46000','14555',
                          '16325','50704','21482','20826','67562',
                          '66199','29160','92138','37998','24416',
                          '30938','55273','67184','52334','16595',
                          '95999','78915','49629','43424','34308',
                          '53004','99516','83374','13546','49722',
                          '94631','55899','83600','35251','10074',
                          '80249','12475','82116','76157','92364',
                          '27332','87342','27074','71347','60483',
                          '23471','57354','62604','10630','19103',
                          '35455','57722','73751','38641','56094',
                          '50691','13260','66696','64959','84281',
                          '23186','16782','36732','19494','32776',
                          '83153','14672','28032','11416','26956',
                          '46150','90441','36456','34788','78310',
                          '51747','17492','45160','19834','51953',
                          '36983','10479','17184','43081','96380',
                          '34451','90731','25632','10628','72583',
                          '20719','52350','51759','57529','36664',
                          '28765','67531','10554','49893','37064',
                          '36923','16894','95616','77546','22572',
                          '38022','47166','10666','90005','36292',
                          '85295','60627','49026','50670','25580',
                          '26412','14767','68289','92087','87382',
                          '44480','46696','38827','19757','48955',
                          '20094','12986','12259','33356','19897',
                          '36088','38282','47755','31866','59125',
                          '73238','79866','60790','27433','12102',
                          '84463','48390','15181','81167','53127',
                          '31872','73694','60321','37277','11258',
                          '23002','41921','20251','24945','21393',
                          '44788','34794','84489','17808','51694',
                          '29831','98654','87725','31652','33578',
                          '50663','91289','70553','44633','85396',
                          '39223','42413','59416','77716','36776',
                          '46118','64393','13324','28676','26675',
                          '51447','19335','10433','96867','62271',
                          '36365','80322','18570','14588','82375',
                          '83048','41987','35616','35375','70978',
                          '47244','37321','67197','36620','63313',
                          '35050','62035','77525','51106','84670',
                          '41494','21130','23727','41300','12490',
                          '63033','72380','18453','23093','94334',
                          '13686','94753','49751','64226','32488',
                          '45364','31486','84392','18189','57666',
                          '89961','75650','20428','31559','12754',
                          '15249','66087','81710','45512','41370',
                          '38388','95845','11389','17077','65886',
                          '87032','47501','69682','50015','79661',
                          '32877','44760','91695','45535','60838',
                          '52341','22787','52974','75482','46487',
                          '81908','91527','96264','54419','96925',
                          '28640','11306','19806','11559','41260',
                          '45166','52101','37146','60327','85349',
                          '23636','66841','20217','41241','40025',
                          '29868','31929','81056','12994')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
