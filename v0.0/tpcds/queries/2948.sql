
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '81435','62821','34442','64328','75467','81235',
                          '15525','11894','31438','59781','72636',
                          '10193','57189','29207','32062','15618',
                          '99530','22931','93663','12350','51977',
                          '56049','49881','25590','71488','90887',
                          '87291','81527','42941','27063','65006',
                          '36441','28238','54043','58175','70099',
                          '38104','45970','56671','14217','82845',
                          '90385','69220','26485','41723','81496',
                          '24010','87656','16717','82112','12801',
                          '36145','14073','45762','70172','88189',
                          '18184','59231','25037','24354','57405',
                          '24800','32972','26800','66130','85769',
                          '56960','72389','42176','29299','72520',
                          '99508','11221','98445','42631','48848',
                          '44525','57087','59713','11386','19742',
                          '83202','26652','54321','57968','16634',
                          '32104','56451','42801','60843','40578',
                          '67054','27247','75590','98486','13523',
                          '84995','75112','40624','91355','82463',
                          '43525','35410','17416','84469','14162',
                          '56358','38190','53452','90105','13891',
                          '69614','51181','53043','52300','85985',
                          '22017','67536','94446','42296','19356',
                          '45369','45773','67576','17423','28539',
                          '77347','30886','28648','36518','13971',
                          '93524','29796','26085','58140','34431',
                          '43765','18916','73363','12363','14452',
                          '82513','48096','27587','54692','27419',
                          '33965','51372','47411','47640','71773',
                          '33116','44907','97846','17579','77167',
                          '80420','45512','87024','90866','61186',
                          '27883','65799','12186','76074','48699',
                          '26651','39114','38582','74541','71178',
                          '64370','48236','37793','77939','25602',
                          '74432','65279','39501','81013','85604',
                          '64715','15918','61874','67427','72494',
                          '30477','26385','11683','66607','47596',
                          '22537','67830','12032','56032','54905',
                          '84159','46636','31839','15690','15469',
                          '94613','52359','34588','16390','45042',
                          '11279','30041','50865','10875','67740',
                          '73050','91611','30017','66827','58889',
                          '47177','14525','58771','17155','73350',
                          '66219','77275','95563','77486','31342',
                          '56140','82477','54702','98227','41493',
                          '50403','80432','26980','21464','86744',
                          '47997','17685','82452','37913','20573',
                          '47821','81402','39918','90330','83502',
                          '86700','47729','49248','62321','41513',
                          '81563','50119','20852','37326','24974',
                          '58449','39102','76406','41299','60327',
                          '64897','15777','52074','91049','54351',
                          '37259','27452','22799','83047','14232',
                          '51022','42646','90513','96785','18192',
                          '60384','82311','95805','99647','86792',
                          '96041','34408','73658','44708','58762',
                          '60472','48054','89579','82720','17936',
                          '27932','20400','91282','40521','71486',
                          '14606','54519','16260','17996','40612',
                          '29616','24397','22409','66009','69086',
                          '86212','54487','37511','22906','11904',
                          '35110','98267','30870','30186','22668',
                          '94729','79882','51504','30039','49189',
                          '16793','68734','84985','11211','62272',
                          '40968','38420','62224','73656','23831',
                          '90992','68504','35813','41596','48162',
                          '14608','14808','51051','63966','21817',
                          '86820','40906','65665','36335','90705',
                          '52025','80255','80379','14389','83935',
                          '24862','88254','43200','86710','81126',
                          '93272','81840','29397','57025','74210',
                          '93955','15055','56889','97943','71325',
                          '66430','14600','90813','29794','51622',
                          '49660','23582','21089','49542','83689',
                          '51954','23274','50532','57384','14666',
                          '62156','23527','74147','12673','88803',
                          '69645','96409','89455','48863','68240',
                          '91896','60286','68937','70558','30246',
                          '86776','83280','40219','54876')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
