
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '18265','24794','87375','37274','90991','49241',
                          '43543','20195','76184','53404','85191',
                          '75662','51110','11968','35324','50763',
                          '69743','94387','31685','23856','36407',
                          '13856','32795','55100','54760','24472',
                          '61701','37215','72089','58424','59199',
                          '16814','20676','76939','47261','53182',
                          '75984','10187','96721','85103','82609',
                          '85999','94273','82565','18521','16428',
                          '61945','62749','54039','10145','23969',
                          '61447','53605','28033','53552','35834',
                          '41971','45698','84857','84220','87614',
                          '87364','51364','87065','71954','71148',
                          '27012','24275','62374','16460','28002',
                          '10190','15257','69971','68796','78356',
                          '94294','34235','47094','26802','12901',
                          '43258','37674','30995','57059','37240',
                          '64278','16763','42460','28897','16489',
                          '80921','66547','96081','19702','15630',
                          '56576','77779','37841','99322','77375',
                          '40860','36991','35885','36918','35079',
                          '60516','37136','85177','23302','65872',
                          '15703','59913','70068','80702','33368',
                          '48268','18330','81199','96534','34348',
                          '23194','18891','70366','57293','25564',
                          '17389','33930','67824','49218','97486',
                          '20435','41562','44445','45351','39026',
                          '78415','32875','17517','19897','71608',
                          '93188','37865','19543','58717','92285',
                          '79313','88343','75272','95113','36625',
                          '87003','96283','52198','56617','76833',
                          '48486','41091','36204','27724','49608',
                          '59877','24518','76752','27908','96049',
                          '33863','71689','41664','25500','85292',
                          '49517','42264','99145','34180','28697',
                          '26745','52889','84762','27475','24848',
                          '17598','48875','46110','34405','15107',
                          '92637','73985','37806','99110','65468',
                          '77685','31547','76761','33098','34843',
                          '67217','40635','10896','74460','42894',
                          '18248','92234','70907','44335','57312',
                          '65747','76526','74405','13370','35095',
                          '77754','89358','23992','46935','20649',
                          '21579','31283','45936','15417','68065',
                          '31957','10199','22331','25412','19380',
                          '64882','41862','20331','34922','18840',
                          '78073','89050','26002','69001','20960',
                          '26168','54706','37714','66121','37055',
                          '97560','98992','91510','17981','72613',
                          '20687','41299','16544','33720','87387',
                          '59011','99193','27173','86521','27722',
                          '97154','76063','45712','28644','83842',
                          '14627','42982','93409','12819','74358',
                          '13059','49201','76759','48503','34187',
                          '85408','99257','30773','32097','65424',
                          '35906','50894','16726','82127','31193',
                          '66746','60798','59572','90794','14919',
                          '17262','76924','93440','40903','56531',
                          '69067','89525','78507','44236','34989',
                          '95176','16402','76672','40410','26121',
                          '24660','93439','60055','20033','43459',
                          '17996','72582','71537','66153','33065',
                          '78233','14649','59645','33233','17900',
                          '19877','51530','61380','44238','31863',
                          '42337','64619','46990','28005','35400',
                          '15112','75282','51067','16152','96544',
                          '88583','96989','97532','28776','63661',
                          '42004','66703','42098','32394','57750',
                          '92521','91507','30605','66634','81059',
                          '91359','59860','31513','77271','43984',
                          '94806','51046','63911','12745','44412',
                          '99161','52025','64443','26406','92182',
                          '62598','29840','19835','96651','75863',
                          '49253','43713','86892','83146','78048',
                          '11394','94464','29089','90231','49072',
                          '57052','94331','14168','15337','23617',
                          '98494','46287','21334','89000','71527',
                          '34853','68046','21104','72991','57094',
                          '86046','43794','33943','21278','67092',
                          '44119','91775','13931','88699')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
