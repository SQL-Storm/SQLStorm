
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '90983','18634','19109','67087','84357','95614',
                          '12121','13353','93674','11097','23275',
                          '83665','35513','77978','43982','60457',
                          '26469','85527','22412','38538','18931',
                          '34010','57227','37324','55652','17906',
                          '48966','96605','96790','79241','62365',
                          '98658','99552','12089','19126','96996',
                          '50993','38213','42231','55619','58883',
                          '41348','14284','65610','72582','89746',
                          '15587','45852','57444','22494','17797',
                          '19233','44140','16828','45452','34529',
                          '54750','32769','45196','83918','99291',
                          '57483','79765','14472','11096','42942',
                          '59586','15549','11819','12191','98497',
                          '19323','20830','93368','62971','15412',
                          '17881','97255','16211','38261','95070',
                          '66853','47331','58814','92162','18012',
                          '44756','47699','82854','24896','82391',
                          '32574','19455','17252','40607','53663',
                          '94611','91332','11102','27860','46358',
                          '38039','21468','25068','61356','89542',
                          '37591','26787','36965','13363','69600',
                          '59701','91456','35978','89414','71596',
                          '17177','25777','42969','71616','82010',
                          '63070','28343','57517','24302','44268',
                          '50154','15082','23355','20955','18606',
                          '93442','65445','42826','29100','99964',
                          '75169','23971','67319','71186','10528',
                          '18902','95212','89809','70088','84156',
                          '31322','79231','50284','16877','30110',
                          '51310','15033','50113','10518','23345',
                          '67689','32054','56406','19841','47547',
                          '25993','72203','77564','28388','57683',
                          '56362','82966','58229','26901','12750',
                          '71811','92799','44068','25055','12410',
                          '42411','20670','43853','98379','16241',
                          '40665','59727','26235','95681','23874',
                          '15870','28403','15462','76014','26811',
                          '37254','34962','48036','19203','34955',
                          '12022','58432','13722','73956','75261',
                          '40045','78065','70639','76082','30400',
                          '56190','84742','12637','17915','64618',
                          '12030','23204','59388','50879','87285',
                          '45345','28004','22059','45455','13487',
                          '50815','50891','29940','66054','59104',
                          '39365','73077','83531','84290','17934',
                          '53487','13613','69268','73859','88602',
                          '39540','68980','71697','49334','14236',
                          '88891','23313','46079','92172','88068',
                          '96937','58910','82350','85219','88260',
                          '78883','29146','57367','18865','37990',
                          '44748','26408','33172','98521','10718',
                          '16105','79721','40386','26018','65138',
                          '29673','17662','62849','29647','40538',
                          '81855','51781','37863','94160','78075',
                          '42462','68906','66099','13356','39513',
                          '77077','11147','39788','19771','57431',
                          '10935','31843','44888','69095','58154',
                          '67008','78613','95955','68522','72389',
                          '85721','81232','43360','16096','57949',
                          '43881','10060','35053','43368','18407',
                          '16287','36568','77293','18370','12542',
                          '11969','18577','29065','95290','40024',
                          '40570','16339','43316','43824','30956',
                          '37774','19653','40176','49943','75582',
                          '32134','21361','45155','91510','66354',
                          '92905','55183','36449','14270','37100',
                          '44798','49239','72758','63863','85857',
                          '68733','52433','61051','72766','89680',
                          '28719','23390','65381','81111','72342',
                          '54432','94077','63672','12598','14237',
                          '63468','66915','14199','73518','52036',
                          '34468','64533','79950','62600','13874',
                          '17612','56174','71710','76083','76752',
                          '57933','91442','86402','31860','32725',
                          '19061','54868','85159','19050','17291',
                          '68940','27280','90695','20034','80945',
                          '50189','11394','58777','26761','69484',
                          '22150','86118','65811','65661','59155',
                          '29069','44147','76942','66768')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
