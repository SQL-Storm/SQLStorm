
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '83024','60181','20123','45497','58026','29259',
                          '37040','55725','74782','42734','16879',
                          '70490','53725','10781','17217','47765',
                          '24393','58329','21769','96814','53642',
                          '24262','34179','98598','77288','75223',
                          '66814','73813','54422','75779','56336',
                          '41979','58845','24199','80204','10318',
                          '32410','28205','58859','35603','99766',
                          '98839','56425','80054','30965','70214',
                          '43799','21642','63317','40668','38078',
                          '66053','49326','25909','69582','24362',
                          '91261','31274','68607','46910','77006',
                          '85536','99959','45962','58101','76895',
                          '14022','67309','87171','91088','16875',
                          '81614','92803','49121','71762','88438',
                          '19151','27852','69874','67988','24594',
                          '93611','60225','55727','47778','59200',
                          '81074','19690','81296','24347','71491',
                          '43732','91653','32973','48281','21438',
                          '15691','84754','78085','43644','51835',
                          '17946','79711','80329','50383','10610',
                          '25402','68616','95345','69359','56199',
                          '58170','31939','34054','17055','38547',
                          '39712','54423','89771','17459','69445',
                          '41568','92403','22025','76959','44719',
                          '46770','92678','66782','72635','71268',
                          '99257','51578','26496','32016','83952',
                          '96214','76001','84446','51808','30307',
                          '16660','15317','40625','52846','73544',
                          '29558','47263','32774','39291','95061',
                          '37936','48213','94742','94654','71608',
                          '23631','56713','44674','31705','64420',
                          '43474','92457','47337','78368','70371',
                          '53610','35107','13268','62133','36193',
                          '10565','55373','49499','46683','26632',
                          '66925','24748','51215','21277','62586',
                          '85841','13681','91280','17648','63006',
                          '65591','72221','21131','68486','20052',
                          '70096','64952','94914','67399','72401',
                          '40361','66837','88137','32298','29586',
                          '74140','46043','48795','70071','25267',
                          '76333','57286','30771','56127','24309',
                          '63117','41820','16618','56645','96528',
                          '83415','27659','23968','67486','96928',
                          '88636','20812','56211','24868','11390',
                          '46379','73242','94499','79229','59925',
                          '59312','32483','34941','15726','55077',
                          '10779','46719','32288','78066','49308',
                          '11445','97465','31509','16344','68910',
                          '42940','38141','10071','13131','41400',
                          '54010','61014','77747','14302','23198',
                          '52319','46866','57670','85226','18864',
                          '38617','62569','59810','81970','31451',
                          '43559','17283','49878','14188','73360',
                          '26326','23716','63261','31784','17589',
                          '60532','72540','50591','36046','55920',
                          '47627','50108','96890','23896','52956',
                          '59715','73855','62595','11432','16489',
                          '51456','51697','96695','67991','24863',
                          '59007','28888','74912','53792','76741',
                          '11549','25230','31966','16931','41685',
                          '25414','39426','23372','27261','63197',
                          '76340','15703','85209','11530','46577',
                          '79470','44322','92333','90810','34217',
                          '85258','16550','22362','33336','58112',
                          '13679','26256','59462','84623','99688',
                          '38024','36077','74023','95660','30233',
                          '46268','95466','50792','22656','34350',
                          '12087','42957','88111','42422','50433',
                          '92309','35593','96637','56637','69252',
                          '65480','74365','17696','73566','33977',
                          '79045','42193','83235','56354','34774',
                          '10701','87847','38128','17736','26984',
                          '99508','40665','47907','77247','12089',
                          '87620','75686','46809','93642','80875',
                          '97131','24159','12191','13989','44802',
                          '15320','27532','25968','94729','96078',
                          '13391','82479','31475','86702','78103',
                          '36071','18355','27691','64248','15427',
                          '39180','83927','22612','20993')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
