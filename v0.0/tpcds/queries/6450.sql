
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '76610','81682','83101','17612','40840','21053',
                          '78385','19826','50743','11188','42314',
                          '61826','84947','60575','38825','25453',
                          '38234','30569','53209','16601','65195',
                          '20259','56522','97587','90635','61460',
                          '22215','39880','68452','54122','58289',
                          '86958','95641','11998','34809','59650',
                          '53803','81167','40643','68548','83406',
                          '36774','83590','32250','74932','28516',
                          '88264','21797','91463','21043','15324',
                          '55909','31767','30396','49549','91030',
                          '44646','32249','99728','19245','58690',
                          '94179','49285','17104','69244','11514',
                          '32439','25777','55436','41932','57893',
                          '63099','36357','91390','21952','14489',
                          '11361','85475','98811','45202','15589',
                          '90671','71939','50414','28127','49219',
                          '45242','49126','51250','86014','86042',
                          '60912','90846','37970','64179','32903',
                          '11863','28445','25789','11171','18494',
                          '40496','98011','29655','74829','24067',
                          '87632','55869','53415','74513','13653',
                          '83247','56535','29423','20588','20278',
                          '54720','32237','68742','62082','36989',
                          '73705','18353','82887','67342','90475',
                          '19506','58118','35942','61400','23478',
                          '14109','57454','93016','23283','94352',
                          '73855','17296','12467','38565','56483',
                          '60878','88936','71035','49504','62288',
                          '91583','21521','84411','42148','10691',
                          '32979','58714','37206','87203','71464',
                          '51754','15421','79477','17811','31196',
                          '59641','56552','21362','84848','60266',
                          '35766','46381','25247','14095','89106',
                          '85636','40924','28716','28994','18377',
                          '50654','41678','13424','18881','92092',
                          '59092','90569','36732','17959','98136',
                          '99139','42636','56948','61590','12013',
                          '31138','16843','12537','60689','41576',
                          '94612','95671','35402','80397','15342',
                          '55962','25994','25306','14036','94467',
                          '89138','82674','95756','87995','94692',
                          '25643','51592','95999','52899','81271',
                          '81184','45345','15352','56796','98454',
                          '94787','56579','87288','18234','15251',
                          '23087','83939','34231','43060','17420',
                          '75998','21969','30571','72931','52458',
                          '66272','41999','20830','63209','87502',
                          '33793','42955','34341','81523','95889',
                          '15674','51317','85139','18256','53302',
                          '72562','15699','59515','99974','85909',
                          '49515','18623','15976','80330','27979',
                          '93063','21956','42905','28014','66636',
                          '39535','63137','94218','19824','99192',
                          '14678','79313','48341','99404','35919',
                          '89032','87348','15470','88542','15537',
                          '24468','27629','57195','29006','24046',
                          '21607','40780','99568','67101','77922',
                          '25727','70119','93987','30720','78381',
                          '57272','77923','11981','57126','13597',
                          '97848','40130','26939','66473','37469',
                          '11060','30577','16746','27824','15579',
                          '23830','38004','25961','94807','99309',
                          '12428','51494','17543','20916','74772',
                          '25825','94422','27011','43627','47091',
                          '47284','44413','77157','42045','13128',
                          '67248','33610','21885','48669','43653',
                          '36751','54817','28577','37072','87324',
                          '30474','55744','17507','89090','57571',
                          '66609','99880','13864','21947','27058',
                          '56473','70721','50317','60636','22911',
                          '31967','19090','20753','78126','16836',
                          '93784','37520','35135','37390','59976',
                          '68209','79744','55190','79247','49819',
                          '21130','71905','41569','63900','49099',
                          '58993','34686','89740','24027','66395',
                          '88633','81836','94805','38937','27045',
                          '69434','39220','19312','18908','53276',
                          '78619','27406','16181','62626','79894',
                          '14743','77259','32670','54985')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
