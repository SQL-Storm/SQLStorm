
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '36175','42661','30759','94816','15100','54478',
                          '11196','18572','73851','29024','47770',
                          '85887','99520','75980','30452','74342',
                          '44713','69310','65214','36860','44035',
                          '73300','10407','77954','83254','33407',
                          '11368','20444','94857','12395','49802',
                          '62049','51240','99722','66940','96618',
                          '41495','37420','39806','90810','84115',
                          '90633','12854','14429','57599','16161',
                          '68298','58844','20593','64911','65898',
                          '11976','13505','53826','61847','88414',
                          '19375','69174','57754','45309','53521',
                          '12014','21975','30065','92717','44722',
                          '90405','25236','79267','85126','68353',
                          '94175','57516','74812','43721','19986',
                          '17237','67820','28843','96868','17919',
                          '32700','82073','10335','43036','87586',
                          '21697','66090','17593','48287','32246',
                          '53205','59277','29467','61454','39651',
                          '40773','62380','70071','99743','25714',
                          '95158','96150','43622','33750','34286',
                          '52075','35075','71622','25215','36940',
                          '79634','16299','82285','60173','78339',
                          '89854','63667','36872','97336','97245',
                          '26155','54641','64443','21899','73297',
                          '90691','61278','52295','83904','16764',
                          '65437','22354','37062','73613','82021',
                          '79583','16715','94377','14836','11589',
                          '58266','77886','71036','41338','95850',
                          '21089','96401','70634','27898','69946',
                          '47142','97317','20033','41509','37145',
                          '53903','31734','19107','20806','99734',
                          '17335','91015','46223','41440','85733',
                          '11577','95566','38471','61911','37261',
                          '28491','13454','72707','17567','26128',
                          '25423','13364','18062','44365','24968',
                          '19330','24643','82028','14637','63032',
                          '44853','64789','84104','12585','74303',
                          '95279','82679','16651','91003','46219',
                          '13019','99256','80091','81863','50306',
                          '16303','76567','22538','71030','38162',
                          '84034','64808','76913','90779','53544',
                          '51517','59017','34140','16663','75069',
                          '92276','41603','39920','57410','75245',
                          '60905','83817','87997','13106','91370',
                          '77271','23170','43995','16096','42005',
                          '54736','12050','44120','17438','95000',
                          '94733','16068','86801','41396','42878',
                          '41807','89215','69373','74720','74893',
                          '86519','80104','94245','61688','84763',
                          '13751','64846','44272','14294','64161',
                          '76529','26168','86404','53661','48577',
                          '85127','50756','21007','75067','31742',
                          '24922','79100','14445','98015','56728',
                          '48961','22522','24485','25434','67195',
                          '85231','80148','69278','75747','86454',
                          '28822','47620','11624','70138','15535',
                          '88639','51411','27398','54490','45132',
                          '78025','58538','53817','52184','34344',
                          '27717','13179','45409','17326','62920',
                          '14363','96036','62287','78639','30984',
                          '98877','10232','26988','19467','68067',
                          '76451','13208','45298','45306','32591',
                          '33290','51746','26739','45359','91269',
                          '11490','92912','95619','31920','19772',
                          '82677','14554','24706','79168','12091',
                          '19614','31995','11270','33160','45873',
                          '40442','87549','37386','51618','15909',
                          '88719','14002','58249','30155','41347',
                          '54831','23411','44561','13869','60395',
                          '55391','59499','70447','26897','72622',
                          '77969','46829','36483','42470','51032',
                          '88013','81054','30405','10614','39459',
                          '77659','50942','52668','81171','58497',
                          '34667','65014','24394','59606','69305',
                          '31866','63009','52763','49205','74775',
                          '48773','75674','52879','80338','49187',
                          '37986','56011','24401','11431','31925',
                          '14347','61547','26878','99066','11312',
                          '28803','36905','99147','77211')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
