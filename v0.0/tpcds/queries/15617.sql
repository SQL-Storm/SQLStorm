
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '93775','35518','94082','90322','38772','34757',
                          '55625','33154','83744','83405','49604',
                          '79295','20419','45061','68412','99783',
                          '36360','82701','50197','12382','91270',
                          '19303','44446','63273','42160','75284',
                          '40229','34954','72018','10687','89534',
                          '75339','34024','26485','85592','95890',
                          '75955','15090','14135','65983','99685',
                          '98103','30045','49103','50808','42843',
                          '16517','99921','90914','57639','42161',
                          '22731','22373','37093','75193','56167',
                          '27589','13973','13969','76417','21725',
                          '39215','91691','51609','35446','41748',
                          '75349','79341','26462','46057','24146',
                          '31538','11999','44277','18641','22120',
                          '49633','71339','13685','87369','33479',
                          '39577','58953','59437','44954','99887',
                          '70506','80818','13151','16067','43986',
                          '38105','24333','19796','16090','94836',
                          '49257','49420','28933','42847','50796',
                          '29567','99129','29896','72798','38959',
                          '39005','21543','37441','36582','15865',
                          '93038','34638','53079','19641','69475',
                          '68149','43280','43304','26920','39296',
                          '80808','78320','98543','49758','51068',
                          '15055','87581','71883','68297','72388',
                          '62035','50882','11480','29741','95040',
                          '95843','85921','36066','44786','10235',
                          '35072','65673','11355','82740','89798',
                          '76211','92225','13093','49198','69611',
                          '17486','28304','87209','84650','42352',
                          '41944','97339','61777','33464','20987',
                          '21168','67389','68588','91901','35707',
                          '38984','23858','57892','47114','29158',
                          '11225','61474','20674','16113','72709',
                          '93212','53030','22350','87703','33961',
                          '91300','32647','46224','32717','22788',
                          '70988','55020','20314','64662','69221',
                          '34829','49298','54609','67413','71967',
                          '34310','25051','35272','25770','47260',
                          '91279','34863','39086','47969','39376',
                          '14367','81131','74902','10716','30834',
                          '56043','58047','87402','65707','31901',
                          '37856','23271','79063','16200','91837',
                          '66908','75573','49731','48879','14524',
                          '89624','26909','12754','25275','37852',
                          '24614','93498','30689','14487','81891',
                          '41584','50889','64868','99670','20174',
                          '65828','48391','28237','49927','17643',
                          '53429','90693','70797','47784','61911',
                          '51797','52133','11934','88625','41964',
                          '98195','99029','96252','25482','57158',
                          '16377','83336','42168','16664','57619',
                          '24189','12195','62824','32363','16503',
                          '38344','50765','45363','55614','54013',
                          '95000','16263','16849','47187','42858',
                          '60043','55368','78471','18035','14055',
                          '80038','31004','94337','18680','97559',
                          '86183','38849','22182','25971','49306',
                          '17087','71120','35984','38871','68422',
                          '16458','85982','92050','15788','48889',
                          '57676','83725','28611','81167','19647',
                          '11189','29170','83262','32377','47404',
                          '16981','95676','24066','69260','42080',
                          '12349','78364','17793','10422','38715',
                          '61238','25439','17596','53755','73237',
                          '31343','47952','16455','23768','92853',
                          '64860','39249','78258','80832','86379',
                          '41084','68550','40262','58300','21052',
                          '97595','20814','72554','25917','36103',
                          '20260','92248','57250','14125','37381',
                          '13032','89228','28498','89896','92307',
                          '59126','91623','18726','25077','52023',
                          '21871','19689','19369','69200','29771',
                          '27087','95678','77707','91256','30224',
                          '53357','40327','18861','84740','30080',
                          '30854','16974','74389','44328','63208',
                          '84617','22464','83034','57729','52545',
                          '85587','47852','92105','43907','48987',
                          '49481','58603','16660','91174')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
