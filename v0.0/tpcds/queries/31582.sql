
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '80348','26098','99591','25240','14657','11776',
                          '56241','45412','38778','23216','52881',
                          '93401','26172','20264','72603','61030',
                          '12338','12034','52504','23968','74530',
                          '11454','38772','87767','97621','13857',
                          '25437','93856','40516','85991','24867',
                          '11787','99694','52162','60344','77006',
                          '18404','17231','17470','37940','72660',
                          '30982','28456','38346','11621','25649',
                          '40336','61067','47365','20380','49133',
                          '55879','75550','44899','80369','83068',
                          '46584','85168','81015','76461','18003',
                          '61214','13195','88967','75737','79574',
                          '25582','22901','32392','36409','44541',
                          '44391','51666','15895','53570','91986',
                          '46378','75523','98275','10467','65917',
                          '52137','32962','79304','62883','16479',
                          '21728','57514','22123','45451','31134',
                          '84730','69187','34178','57171','12268',
                          '95419','50515','10181','50917','37602',
                          '17044','68943','84340','46514','58444',
                          '93749','12039','69592','81657','17479',
                          '64083','90750','15231','44126','42136',
                          '58566','77801','63344','37091','83708',
                          '18730','66121','56489','36170','69602',
                          '38398','84422','40103','42923','15033',
                          '62012','94395','36815','24024','59047',
                          '12373','53180','79707','10475','82559',
                          '77892','50514','35693','92334','34905',
                          '28543','13249','34158','83397','36437',
                          '76965','41002','26489','78758','38422',
                          '12607','32030','54370','85711','22050',
                          '27327','37178','27582','42944','47123',
                          '43032','32913','10658','84524','28187',
                          '48218','10811','12476','57336','53398',
                          '68916','68164','23222','71761','33934',
                          '94763','45045','71892','36326','66591',
                          '33793','80594','63949','82030','31815',
                          '87970','24918','42163','60613','39764',
                          '20396','94107','18721','17772','46031',
                          '82963','53759','28054','85753','88345',
                          '22748','90765','14389','24483','62581',
                          '73082','17683','30161','88056','98134',
                          '78093','84226','78648','64462','63543',
                          '68173','88009','24689','52971','89366',
                          '84653','40197','73704','12325','45801',
                          '52350','36691','97886','52637','27970',
                          '40332','81558','21610','72455','36239',
                          '15330','10105','39418','61161','77980',
                          '20649','62651','38741','20596','40024',
                          '17687','11271','69166','36243','31496',
                          '96706','52794','72224','76245','94674',
                          '65308','15644','89129','81195','12628',
                          '34575','45411','36699','46362','52760',
                          '29498','11705','85299','25372','10972',
                          '31254','69620','41212','21022','67653',
                          '28288','47413','62869','64313','42313',
                          '46516','24559','32117','74457','43213',
                          '48542','95583','65838','16676','14555',
                          '22735','52145','46081','64516','21431',
                          '19650','72118','11792','18297','19541',
                          '11513','41117','62928','32063','52369',
                          '11956','65288','15202','21122','52198',
                          '26300','65032','30558','14159','70014',
                          '29488','10024','53933','26004','57296',
                          '21193','18604','71452','79000','65193',
                          '23397','47594','31647','21545','10614',
                          '44455','40080','12914','61842','61669',
                          '94408','23820','39008','52224','88730',
                          '23253','99189','69577','16936','54577',
                          '55133','19040','50225','21470','27651',
                          '19510','25668','46988','43378','14841',
                          '11727','34794','73345','45267','21664',
                          '79734','88288','74978','27139','68088',
                          '31926','61198','90987','55890','80739',
                          '74172','83933','87399','93254','43348',
                          '12199','25718','99713','63334','55758',
                          '61243','16077','20236','83179','91306',
                          '97456','56035','18390','65342','32573',
                          '25171','59014','93292','11982')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
