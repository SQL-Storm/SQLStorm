
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '47677','82789','25867','88654','48624','17856',
                          '29013','21585','57217','37333','72219',
                          '35964','21008','80563','58416','97140',
                          '33512','55982','56297','43309','97801',
                          '98418','41182','36803','33035','23168',
                          '50543','59314','17868','20395','42891',
                          '15087','97168','13464','23949','90852',
                          '50099','13718','18620','87533','30501',
                          '60980','69075','27548','91888','42759',
                          '48824','75258','54652','79213','39963',
                          '13521','33380','62210','42046','67133',
                          '47544','25440','13044','31821','79651',
                          '21532','90356','83434','50538','58447',
                          '62786','37751','37087','80660','20035',
                          '63382','84089','18595','86439','15563',
                          '98217','22887','15722','81235','29157',
                          '94098','85674','71614','38390','11283',
                          '51115','61559','17881','58952','26054',
                          '40687','12848','96405','20669','43942',
                          '87907','64782','33486','86143','36748',
                          '27431','26643','81248','16907','81261',
                          '83478','17882','90032','21322','62476',
                          '64855','73116','72668','67139','13819',
                          '12943','10429','27979','11128','16780',
                          '53290','49859','96474','26207','56846',
                          '97105','47301','46059','78182','74506',
                          '91076','66412','83444','31838','57904',
                          '33929','53467','74329','15549','72053',
                          '67834','66585','13661','16412','29744',
                          '35823','55839','22350','19149','15233',
                          '85586','59302','73165','61265','36345',
                          '11971','86350','46053','25999','51641',
                          '91359','21007','73599','38455','27804',
                          '45215','33874','52850','38703','75180',
                          '20672','42945','69682','80124','38491',
                          '79469','18922','69592','51407','68460',
                          '99488','29761','92533','41743','32288',
                          '42900','10764','12074','36277','40863',
                          '70828','52712','59248','93356','55686',
                          '37353','48113','59913','55843','72818',
                          '55357','70643','99153','44231','15895',
                          '44997','22061','89124','76606','17270',
                          '59579','12813','22948','78999','96547',
                          '41581','75811','37060','84716','39850',
                          '68160','28494','90931','91069','18058',
                          '22401','18017','50056','67083','35648',
                          '83882','64119','43049','93965','21327',
                          '75991','27135','39579','22943','68964',
                          '44856','75644','33268','44251','47299',
                          '58811','41906','35438','17709','12530',
                          '71421','13069','63665','14463','19407',
                          '23836','10051','46517','23219','78559',
                          '37533','85613','42789','65226','18736',
                          '42794','77918','89411','72150','49726',
                          '26000','36361','88703','38447','63045',
                          '27301','81915','50341','38072','61986',
                          '11662','48165','11372','23092','87758',
                          '52350','97075','37470','66676','35931',
                          '31146','64138','35900','48160','16627',
                          '40227','65967','24973','77535','74172',
                          '82249','77440','38418','21352','10419',
                          '62172','24890','97934','14264','11821',
                          '45398','98707','62370','87564','23451',
                          '45796','60492','37231','65825','58374',
                          '31563','29908','95628','60647','24720',
                          '96379','27839','74571','17960','12296',
                          '14570','17500','18254','24361','75069',
                          '14604','69346','92651','16808','18385',
                          '43446','96212','43901','70222','58496',
                          '28318','67395','15956','47949','38560',
                          '20512','73783','86248','31250','42146',
                          '76926','66626','31057','67466','76904',
                          '19730','93465','69821','43969','39259',
                          '55258','66193','47704','65508','62959',
                          '65920','12308','87734','92958','58996',
                          '63192','14073','58288','33725','91608',
                          '36407','13026','45540','66953','80956',
                          '84555','64174','31407','93478','53910',
                          '59950','13108','44125','16625','73971',
                          '49629','32660','79777','73678')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
