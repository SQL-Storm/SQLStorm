
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '48464','66972','94133','55598','52865','44783',
                          '33069','78186','37457','78063','17375',
                          '48990','48069','10584','77608','11027',
                          '54238','23853','67369','26741','36105',
                          '48039','28910','15793','27474','16518',
                          '42686','27125','78297','10020','27982',
                          '58811','27981','90238','83615','16633',
                          '57398','26448','58653','87918','20568',
                          '38824','90846','43244','15972','13798',
                          '44074','42825','97059','47860','41091',
                          '40743','49751','88870','16857','29179',
                          '36791','13046','11500','92385','72652',
                          '19589','88463','62633','93084','30675',
                          '11391','55823','63744','62126','75798',
                          '94576','86068','30960','49658','17092',
                          '72018','37255','41941','69305','40686',
                          '11973','56636','59942','16080','39787',
                          '44880','65100','63192','65228','34487',
                          '10024','42381','30463','15167','32912',
                          '89534','75855','34190','35029','64864',
                          '91759','24427','16793','85151','95973',
                          '53370','23687','32807','21664','50437',
                          '82457','24873','15802','99411','26429',
                          '95214','78986','90454','46860','22750',
                          '43173','38069','77678','10175','15711',
                          '51824','49234','45948','16305','18271',
                          '25614','47262','46980','32720','29193',
                          '87190','43890','73694','24051','38210',
                          '29005','29426','46713','16269','69135',
                          '96194','73287','58517','97129','77948',
                          '64670','25268','65622','86117','13351',
                          '31818','30687','64511','47442','30885',
                          '37178','49128','12996','77999','73178',
                          '21890','37424','61796','87023','32137',
                          '74888','15983','88053','69401','60263',
                          '50504','62693','36919','35572','93341',
                          '18769','22128','15784','36646','12577',
                          '59086','51373','28633','98556','80278',
                          '32693','83673','96785','16744','93522',
                          '17998','90922','95167','61538','40451',
                          '36803','34327','15380','33782','47655',
                          '13037','26000','86143','88037','45483',
                          '35303','41562','87332','47668','54389',
                          '43422','34304','69856','25507','45675',
                          '24934','11077','18429','30774','53992',
                          '21809','60519','30287','32745','21619',
                          '85051','68393','11641','94479','49533',
                          '80315','96508','37552','78197','93205',
                          '36363','35616','87695','88515','33407',
                          '13174','18700','77648','30949','34649',
                          '73852','46017','88703','93930','38623',
                          '19891','41919','97231','99404','66837',
                          '46912','87177','26007','32410','27655',
                          '41020','97946','10125','44492','88562',
                          '47797','84905','21216','33489','14257',
                          '40879','73568','77113','71780','80637',
                          '46953','98302','15905','10308','23241',
                          '26078','61082','17931','51859','26944',
                          '88487','22682','89592','65584','88799',
                          '74136','13253','62365','49317','30580',
                          '35365','15679','39789','71545','74851',
                          '17436','50681','49697','62047','44269',
                          '28015','11764','44793','80310','76213',
                          '21118','29106','87923','23182','22931',
                          '17697','63558','46914','43374','11111',
                          '66365','12091','78223','48908','17227',
                          '93895','58824','56574','12986','92633',
                          '12490','57089','13450','91758','45875',
                          '68182','75486','88190','30433','20436',
                          '84605','69184','28915','72304','43970',
                          '53058','90800','84002','85020','26339',
                          '97957','31445','49402','56498','52522',
                          '13694','97026','42680','53978','42216',
                          '12250','69086','75818','43560','22751',
                          '83896','17594','73709','15018','39835',
                          '44615','64373','17308','49490','52486',
                          '13249','31485','72522','83656','90068',
                          '53816','97130','79488','14073','39035',
                          '26926','31355','93556','29029','29581',
                          '92127','82565','57456','99609')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
