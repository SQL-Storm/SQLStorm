
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '66542','99682','26681','85896','20875','40946',
                          '15434','93992','94240','38202','38236',
                          '35789','32953','22318','65101','16934',
                          '45107','34691','83843','66825','64999',
                          '47305','55392','94917','51788','76110',
                          '11532','29899','34898','75182','74365',
                          '94850','70098','22514','28959','26855',
                          '66767','21534','78147','83155','50343',
                          '21227','79856','82803','75805','54230',
                          '63192','99253','92876','35423','27701',
                          '94188','44479','26477','41601','81649',
                          '14948','11085','72774','11835','88360',
                          '51223','49551','62011','27884','30844',
                          '73020','11339','67727','52032','52936',
                          '38854','79558','58555','80072','66382',
                          '11898','39806','66993','76751','20025',
                          '23874','78588','40100','50628','70554',
                          '61544','25800','83490','99100','50894',
                          '56433','37216','73486','71607','72633',
                          '19242','81604','55945','85663','72600',
                          '26241','21974','78715','86909','56060',
                          '47931','42473','90397','68320','70628',
                          '15908','84620','40516','39012','58667',
                          '11834','98188','33894','61138','32151',
                          '77598','46187','78911','67615','85423',
                          '63287','13860','45530','76943','96415',
                          '81977','36964','34439','21026','24325',
                          '52980','44277','24847','96894','82605',
                          '65238','63444','73149','48756','68089',
                          '67168','10647','58231','62837','20190',
                          '31720','79468','36536','11724','39342',
                          '20067','12985','52221','40918','56958',
                          '36584','95351','61693','83511','11197',
                          '95290','47003','26603','32141','41160',
                          '40428','48413','21480','98301','12293',
                          '43769','27955','69252','31744','74188',
                          '23213','27302','90260','11574','95073',
                          '28998','40697','90668','21194','77870',
                          '58403','98690','54713','54026','38668',
                          '59730','35313','99162','33130','43233',
                          '23016','81998','28622','10386','36724',
                          '18635','31079','28392','15426','15271',
                          '19377','69014','53416','80020','65987',
                          '80067','45495','12744','33673','72531',
                          '12563','13821','39785','71583','11700',
                          '36470','59332','77994','46188','28646',
                          '70278','93742','87214','94953','20569',
                          '94623','48755','19426','68140','50929',
                          '27765','49713','84062','19348','24469',
                          '41211','30541','53432','56032','18453',
                          '32929','25042','37119','87899','52704',
                          '77371','91974','94151','57405','51212',
                          '17214','86572','25703','28575','26254',
                          '70808','38300','68008','69365','88805',
                          '69518','94012','65059','45470','28556',
                          '52889','43505','31276','37160','83655',
                          '10796','12849','35888','79797','22411',
                          '47286','18649','89642','15099','78460',
                          '79456','32873','28157','53630','57544',
                          '89535','87988','45317','15360','92552',
                          '76457','73164','83535','10407','67380',
                          '22621','43427','10366','48962','47735',
                          '11486','41352','65520','16719','36561',
                          '42659','51183','48494','76513','20284',
                          '19923','44500','83906','88412','44654',
                          '56312','74357','81570','41031','25714',
                          '66425','81528','35614','23987','91550',
                          '11202','75414','73483','32628','32249',
                          '49755','59099','97868','65106','92289',
                          '12337','17166','46659','74896','68305',
                          '25622','32269','22367','90861','66726',
                          '56070','38849','93608','21458','46763',
                          '53824','40152','75385','78522','49610',
                          '48447','16102','33246','33188','44961',
                          '28182','51692','83105','19478','72761',
                          '27819','55971','74627','85932','26690',
                          '89665','61727','22986','33904','15162',
                          '62675','64209','44996','23976','11425',
                          '21563','58903','70673','40351','15947',
                          '61738','48247','96264','36894')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
