
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '95543','73722','93679','79550','11514','24601',
                          '27272','37133','93670','58124','17485',
                          '29562','27081','48487','34034','95523',
                          '11364','55226','38772','31903','77649',
                          '77297','37912','54154','59109','65158',
                          '47693','83915','54269','72788','68945',
                          '26173','84026','35678','12402','96565',
                          '28920','62332','52497','92026','11673',
                          '73673','51052','25448','87406','50418',
                          '92823','67486','22539','58160','16762',
                          '32424','22796','14098','38362','67975',
                          '50238','26489','91881','76415','39981',
                          '99923','86358','83345','74723','99171',
                          '67952','13941','93425','21469','19425',
                          '66012','17653','62684','50347','71660',
                          '70332','46988','23046','10969','83964',
                          '23440','10250','37418','28731','10240',
                          '29638','38851','43064','10001','28649',
                          '23045','28897','31272','31620','17433',
                          '19932','64764','40943','77403','53012',
                          '82911','96409','85656','28289','92591',
                          '82743','45451','56678','85190','37336',
                          '10354','79602','57242','17099','65126',
                          '28549','41601','29199','32910','65615',
                          '37923','55524','67686','49205','13424',
                          '65124','98615','86883','33208','59918',
                          '10656','47161','85086','53438','95703',
                          '46554','67260','81776','41692','59564',
                          '38547','20198','12114','49358','65887',
                          '99686','31722','81880','38587','50245',
                          '91778','17464','95915','88569','10372',
                          '25222','51361','57949','56107','40157',
                          '54690','12847','58928','40633','60161',
                          '84534','36607','81780','51912','47775',
                          '10309','45156','65195','62276','69471',
                          '69352','18239','60051','15126','76139',
                          '10999','83103','31080','49742','56052',
                          '55952','29222','80276','55689','13405',
                          '41993','26012','96325','48052','35085',
                          '86087','36028','22719','40982','21842',
                          '46008','99079','17995','41432','34206',
                          '42372','96577','23546','33921','91664',
                          '68714','53755','15856','43090','36791',
                          '53674','26535','14340','33451','40509',
                          '65743','37905','84202','69556','23906',
                          '84166','55175','53106','46306','14094',
                          '16113','23844','70845','39063','19951',
                          '21244','16247','18449','60712','62996',
                          '64434','54806','72951','36401','14118',
                          '37270','71959','80712','12906','78686',
                          '52098','35005','57353','36943','71692',
                          '44867','11134','65500','12539','27415',
                          '37204','48099','42627','37075','59897',
                          '31742','56430','37811','57507','35725',
                          '19256','94993','40111','56576','79052',
                          '36255','68627','58265','14642','36241',
                          '46067','66571','84399','19472','93386',
                          '59603','24910','29839','88624','18694',
                          '77324','23356','65184','31940','37285',
                          '84751','30948','91695','28360','11706',
                          '88036','47066','44055','28162','16681',
                          '95417','31187','72615','54053','99521',
                          '26018','75753','25588','56886','77149',
                          '43484','78443','20900','72805','21115',
                          '18764','44786','27127','39743','40899',
                          '92586','22642','32248','59325','94438',
                          '80977','52347','47054','42254','18825',
                          '93454','27420','19412','89572','25497',
                          '18575','61274','21049','30303','18551',
                          '81594','80715','35300','33498','28475',
                          '48173','27597','55097','12272','28385',
                          '47204','43083','75514','31719','94994',
                          '53733','66140','53226','14230','52185',
                          '74112','82879','41791','34942','12134',
                          '75772','87502','16928','13887','49437',
                          '19093','18275','81461','22737','81753',
                          '31795','73504','53628','42858','25018',
                          '16048','64847','23763','82444','57122',
                          '33055','55351','45105','27642','75088',
                          '46476','20217','47186','61197')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
