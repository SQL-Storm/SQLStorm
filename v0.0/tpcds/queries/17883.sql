
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '43441','59815','98008','50544','66261','90111',
                          '42972','49642','11806','68311','88712',
                          '33743','42188','14997','85413','62762',
                          '49883','28221','24536','46235','21949',
                          '40281','65320','18818','18923','85016',
                          '23896','54064','35900','11859','13652',
                          '33372','42823','23312','50634','23169',
                          '29000','71227','10932','10612','15109',
                          '83827','26635','57442','68265','62431',
                          '23114','32284','23371','69142','48390',
                          '19209','76331','73819','54901','86423',
                          '68046','65597','26415','40106','24425',
                          '15757','13835','28247','92929','78309',
                          '77344','14743','14643','38577','31468',
                          '87104','87395','92517','70453','63960',
                          '31063','71680','24704','10164','98470',
                          '24619','84967','31870','38103','23064',
                          '46308','98800','47192','39816','38456',
                          '55372','93573','69676','93285','48155',
                          '36089','66033','83240','40275','53887',
                          '17659','24860','95898','53127','79455',
                          '25533','66310','17033','58899','94416',
                          '17778','77081','30018','21370','34059',
                          '29360','20623','73869','11659','19774',
                          '36318','71564','82836','11662','20527',
                          '14449','51664','34196','95558','24187',
                          '28533','51477','66084','41220','72934',
                          '18212','54250','96980','36669','45202',
                          '68814','21765','43513','76121','52879',
                          '92079','76938','92170','11556','90887',
                          '36674','43046','78652','88795','72056',
                          '56697','97930','68017','49842','23239',
                          '34065','43874','26055','65498','30414',
                          '19976','58173','92962','95196','47252',
                          '94525','96551','31985','30260','32666',
                          '52483','76125','88676','82426','45384',
                          '85291','14413','68401','18946','43190',
                          '49210','50070','69425','42778','55571',
                          '79371','78671','28540','59322','26474',
                          '90869','45018','33541','19134','50491',
                          '37227','21563','21098','58175','37580',
                          '14163','65226','30520','29674','99141',
                          '27529','56691','33426','31992','51384',
                          '34514','62557','48168','65631','11893',
                          '86927','47927','23775','44117','14752',
                          '88345','45309','21912','93648','58021',
                          '50184','46484','74663','33330','22656',
                          '97638','13828','16896','15780','60408',
                          '19040','52081','43898','35359','35955',
                          '45874','56369','83609','85686','35777',
                          '55478','83415','84374','19270','73106',
                          '33982','39218','40149','43201','94290',
                          '94789','24667','37657','41723','49576',
                          '56174','62358','99647','27748','77527',
                          '17199','22587','13848','87986','58764',
                          '56154','25626','55736','15489','46537',
                          '75733','66443','38296','80612','65896',
                          '69116','71025','62881','86688','76670',
                          '40293','97707','78131','37232','50676',
                          '56690','41774','13078','44270','30063',
                          '69456','80266','42264','39805','73515',
                          '64055','13617','62815','15521','53184',
                          '47737','25009','28607','70933','74462',
                          '68369','14233','73707','74051','58331',
                          '71215','22905','37708','10002','57723',
                          '38770','25927','95935','24429','34288',
                          '69383','58700','65353','90514','76222',
                          '71274','31766','26615','48066','75382',
                          '57768','75740','83917','63649','32207',
                          '39274','16778','71642','36329','30359',
                          '61523','11140','67288','47205','49534',
                          '39182','36189','43282','13911','49551',
                          '10783','90329','32648','75090','38520',
                          '19643','54524','42260','38759','78630',
                          '70701','55891','35053','44280','83691',
                          '80783','59372','11575','10185','99609',
                          '59284','19949','13610','56242','39166',
                          '39630','78449','36313','60830','57825',
                          '70248','24321','17103','64042','40934',
                          '27004','12346','43380','30177')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
