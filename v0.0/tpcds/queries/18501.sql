
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '24947','14465','28714','17982','11061','52598',
                          '11468','71771','69883','84745','63503',
                          '74812','78460','34246','63255','42200',
                          '66711','33756','37213','33259','50690',
                          '22916','65073','44398','79844','85838',
                          '42129','90152','98897','46061','71683',
                          '16075','22287','19382','27596','99368',
                          '45886','56324','82577','37156','30100',
                          '93695','52738','85986','95570','94943',
                          '82900','44736','79237','61871','17790',
                          '48444','16010','81886','60973','20784',
                          '11575','64192','83671','62979','26257',
                          '99703','82024','50851','61402','11605',
                          '20070','78907','80006','94367','27049',
                          '20012','98214','17046','62202','81161',
                          '50223','17593','29317','76413','68259',
                          '57764','54765','58727','13660','30123',
                          '77006','86942','78943','32954','97782',
                          '58102','37090','27088','66733','21365',
                          '54733','50307','68547','33808','84990',
                          '87084','21929','14933','43958','56555',
                          '51098','86962','20758','22619','10595',
                          '76786','68640','11759','19993','41643',
                          '53366','82047','23336','29468','76163',
                          '21362','42032','58748','97555','68246',
                          '79874','75820','15833','46889','68379',
                          '30413','44035','50237','50661','78473',
                          '97752','30467','24400','45621','56437',
                          '73532','18334','27969','18047','52418',
                          '79222','96159','11613','10548','15920',
                          '71338','20578','72620','79386','57819',
                          '19934','84605','54067','71805','21032',
                          '68849','32415','77251','76171','25006',
                          '53212','28447','40755','97244','13505',
                          '96622','81572','37380','47798','26839',
                          '95973','14137','47251','47400','77870',
                          '44530','91901','16820','62468','17532',
                          '30718','88474','98867','51855','16312',
                          '60258','46709','88285','50458','52933',
                          '62368','88761','35154','19635','81229',
                          '29403','50122','31097','10604','38747',
                          '12410','64465','95133','61615','90811',
                          '21159','97525','77456','63592','14664',
                          '95677','89635','75110','31587','41290',
                          '47440','26097','39779','33585','14328',
                          '35440','72618','34773','40953','64854',
                          '53838','39696','42992','72063','47729',
                          '66418','78205','57198','23318','22610',
                          '50757','90211','87946','51514','38639',
                          '43569','18901','38937','53476','87735',
                          '97391','13949','13895','78430','37812',
                          '24755','45045','68645','29985','35113',
                          '25019','77259','16004','36660','73496',
                          '11861','34452','80503','15216','29810',
                          '64658','27993','34708','17000','16506',
                          '65184','23463','67689','27526','45559',
                          '61179','50644','50152','14771','94538',
                          '68403','36839','57756','62481','54635',
                          '41082','60373','82738','66486','48630',
                          '39749','82372','59675','48251','57855',
                          '69279','14931','29368','28201','26102',
                          '67319','81393','55180','51818','12398',
                          '14160','61417','92484','23598','47483',
                          '73047','21311','18450','54415','59215',
                          '18344','66878','28928','78320','53066',
                          '91286','14320','99886','12367','77661',
                          '51184','85672','94244','65493','34692',
                          '46043','85513','16519','24971','36952',
                          '50480','39103','60163','83463','53949',
                          '99849','21034','24031','71952','36686',
                          '32688','25487','58251','28849','60431',
                          '66949','18133','99632','61146','27624',
                          '58624','28153','92953','62767','60064',
                          '39192','22991','39100','90136','84080',
                          '70001','88668','15003','16973','50162',
                          '42825','57603','11988','20055','67362',
                          '54813','54869','61664','53789','63284',
                          '57439','66862','16053','24246','12290',
                          '83930','62597','55848','78685','57932',
                          '41932','67522','59680','22681')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
