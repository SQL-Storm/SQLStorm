
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '80552','99067','56416','24244','40289','21018',
                          '99024','46620','24449','86955','85676',
                          '22950','73256','99956','31602','38488',
                          '50357','39680','25785','65001','54364',
                          '15555','31281','18018','49372','81133',
                          '10563','83888','45569','32526','29027',
                          '48907','96404','70077','81899','38149',
                          '29512','18845','59226','86357','33106',
                          '19197','23725','27473','25931','34236',
                          '12888','13687','76572','50937','42037',
                          '49199','16602','55249','39570','17239',
                          '48148','85323','36250','86744','96291',
                          '96516','94187','90104','52931','27806',
                          '61112','83070','87334','34199','25480',
                          '46368','63113','63849','64878','14372',
                          '97053','87246','34780','12543','48207',
                          '73314','11535','22063','57180','50591',
                          '43352','36715','51790','20345','31047',
                          '60122','37245','47650','52465','75043',
                          '84463','65043','11458','30237','87927',
                          '68422','38354','56001','67183','82587',
                          '54145','74239','20052','79582','29557',
                          '35181','32495','56676','45815','81566',
                          '58496','53916','62502','36456','88273',
                          '28111','81759','27220','45382','65454',
                          '80051','80182','95942','75476','35384',
                          '87868','90623','57727','63717','68161',
                          '30540','66362','15270','85506','45466',
                          '30799','34639','47160','46486','16399',
                          '15452','15865','42752','91461','65178',
                          '59339','21707','97226','29936','77866',
                          '20208','26086','48505','41654','39127',
                          '53171','55916','21963','97488','88664',
                          '62419','78984','25025','18858','60056',
                          '59235','83234','79841','40931','58990',
                          '67229','88168','54804','81680','80804',
                          '20027','43668','79790','25191','77130',
                          '96509','76603','10556','65167','43442',
                          '32350','63790','14698','61025','23656',
                          '31720','78200','60967','66056','86091',
                          '94144','83781','66797','91164','48379',
                          '85023','80085','65855','57248','67874',
                          '70572','78825','13039','24430','84656',
                          '65801','72123','93867','55376','49251',
                          '14159','84409','56732','53091','31091',
                          '70028','58062','46110','72046','62857',
                          '46696','25545','94842','11495','39015',
                          '50896','13355','44137','78285','35391',
                          '47384','19863','40369','10651','66131',
                          '82095','26515','22357','56905','37096',
                          '31575','48572','75643','33565','57470',
                          '57872','55281','19436','25673','20850',
                          '50582','21854','79611','60236','34211',
                          '32950','12721','35870','10686','12854',
                          '20510','96801','88325','64843','87484',
                          '28479','30921','26668','55806','47355',
                          '94926','32157','87260','83812','30962',
                          '52890','58827','75786','14853','51553',
                          '74922','45140','25902','61278','44511',
                          '18242','27217','53391','90556','99125',
                          '88259','17490','96730','58706','47139',
                          '15707','29708','71577','22487','34091',
                          '92646','40617','21915','90137','36353',
                          '43237','34134','35501','22390','74841',
                          '35768','28737','62550','29379','21901',
                          '76180','52318','22306','91964','46625',
                          '57351','64057','52741','51858','48121',
                          '32417','14729','11658','29298','11412',
                          '51819','85583','82935','17269','19509',
                          '17694','64451','50024','15465','38477',
                          '96885','76866','22421','95390','89204',
                          '52295','47605','30351','98282','52490',
                          '42491','64784','32829','60928','19817',
                          '47098','59644','23802','48555','90479',
                          '40821','20016','82664','12906','89470',
                          '25537','10598','56656','14144','93372',
                          '79055','18376','14785','96841','35075',
                          '13090','16046','15908','31222','15925',
                          '38288','22227','64586','15258','83449',
                          '12701','51024','36532','38795')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
