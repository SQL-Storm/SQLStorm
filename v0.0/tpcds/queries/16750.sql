
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '30579','76418','14971','41340','94755','62434',
                          '22508','12077','14963','69796','51712',
                          '54521','59966','63167','47651','85459',
                          '40023','12975','50247','20934','59786',
                          '37785','56082','79520','72778','44458',
                          '51748','31735','35976','78595','86254',
                          '28496','27093','55801','67817','11416',
                          '28569','33181','18861','49506','30737',
                          '24382','36630','41432','40752','26430',
                          '39769','30249','72751','98531','93452',
                          '11229','48529','77391','52935','66441',
                          '45733','57274','14435','14368','48582',
                          '62822','99288','35212','44714','92992',
                          '79836','13188','19135','30343','29825',
                          '41455','94697','15248','22149','12990',
                          '12340','39164','24265','96606','92307',
                          '41684','16102','62603','60085','19652',
                          '28795','43031','84962','26775','85977',
                          '15616','75049','90286','43394','63209',
                          '59323','93926','82841','54862','58401',
                          '68613','58267','33806','37110','24478',
                          '96488','17996','98495','35596','38963',
                          '33694','27104','15142','40061','55470',
                          '14727','51358','41587','21811','18681',
                          '22928','99027','29100','26182','94951',
                          '46810','58164','64212','15040','24739',
                          '70385','99356','89745','44755','94921',
                          '38614','66909','11964','84649','71055',
                          '54310','25294','21585','43466','47204',
                          '18552','75104','71687','75862','71661',
                          '75116','39223','48493','38546','64599',
                          '39390','95712','58423','10210','97458',
                          '35495','89836','45782','98586','56402',
                          '90478','36774','27426','34375','13847',
                          '37539','88149','74506','76587','33986',
                          '33174','54970','70860','89873','84344',
                          '13216','21018','82490','78945','78403',
                          '44544','52545','16467','85853','17396',
                          '96235','73693','53080','37918','73656',
                          '31794','27999','58706','27052','34778',
                          '32051','53333','27964','62525','77014',
                          '62496','61533','26581','26292','11666',
                          '54875','25475','91495','30075','35803',
                          '65327','27401','75644','82889','45060',
                          '34676','27682','89596','43297','18868',
                          '25367','65663','48804','70022','36255',
                          '11860','69991','85810','52885','16993',
                          '15991','56060','93638','66423','52482',
                          '54785','28018','59749','25503','71799',
                          '71480','87711','45998','21735','33942',
                          '33852','53995','10057','13295','91508',
                          '77444','25184','71377','52781','56551',
                          '14013','57178','54766','24103','24570',
                          '14810','56276','89568','91583','69310',
                          '15751','42207','70836','84508','68924',
                          '93837','97857','60555','54854','42711',
                          '57973','19104','50373','18144','41601',
                          '21743','16825','33609','39830','95882',
                          '68975','45875','12256','34292','58752',
                          '85065','18492','73813','48768','16478',
                          '30929','19889','78370','60975','87098',
                          '29111','58027','68020','75688','84592',
                          '44772','39614','56263','78387','13105',
                          '26493','93269','70578','11670','36136',
                          '49000','13514','39999','67225','12149',
                          '73788','80977','29191','13651','94564',
                          '44842','83389','24800','84954','35617',
                          '75769','12941','39974','88194','14266',
                          '34471','12873','29610','51908','17405',
                          '86714','16522','76353','31123','31583',
                          '51019','84154','77304','31259','38631',
                          '45959','28537','80890','32276','33307',
                          '74108','85611','46021','52838','95041',
                          '76331','72395','16684','21210','29981',
                          '45921','13588','68355','69891','28069',
                          '23593','30636','36151','35904','83321',
                          '63057','60885','15986','65626','88484',
                          '50014','53633','87280','78700','70587',
                          '15358','99311','52979','95798','22745',
                          '41443','44323','23762','45245')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
