
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '74582','94625','88874','27019','45045','55849',
                          '76640','77568','29090','37559','96915',
                          '98493','64995','21604','51679','85022',
                          '34734','88503','31928','25204','17781',
                          '30296','35459','76306','95807','91118',
                          '15290','70081','14158','16127','51033',
                          '28599','29568','16987','16452','82312',
                          '28443','33250','77474','94153','50200',
                          '14790','57590','54723','21216','63163',
                          '80178','62953','10906','34675','46340',
                          '43514','45041','62248','39753','25889',
                          '53473','56491','10352','68716','22387',
                          '86598','98281','17767','73047','14900',
                          '27575','89734','85712','32925','21049',
                          '24279','35208','66229','74798','21250',
                          '36832','63653','33207','16268','91104',
                          '17739','99103','45106','76704','15625',
                          '43314','56768','54261','58061','52451',
                          '33899','17493','37814','92363','41060',
                          '66274','89549','68418','51139','38732',
                          '89689','34678','37962','96392','20969',
                          '68853','35881','58765','68651','67155',
                          '25582','66713','47733','99071','94522',
                          '63811','32073','17399','47108','85147',
                          '34045','31813','58645','76767','25667',
                          '19607','24958','21544','75551','38455',
                          '72304','17495','13260','16121','59627',
                          '24973','51823','71886','90504','76705',
                          '58968','65204','95679','59724','13745',
                          '75352','78331','11743','47089','85540',
                          '61466','21742','52086','51014','13732',
                          '95374','57182','16332','27902','29516',
                          '22073','31598','42910','57046','36154',
                          '72377','95775','22264','68275','16297',
                          '91083','17417','64238','77022','22902',
                          '24380','94455','43260','66864','69050',
                          '54947','66626','61095','34982','20067',
                          '77255','35999','45744','27971','94606',
                          '14737','27128','23710','91388','44375',
                          '12533','11975','45589','89443','48614',
                          '11643','65842','73754','99350','45861',
                          '25237','21079','34393','34845','21712',
                          '99607','11457','69896','72352','31967',
                          '49460','55622','34670','35661','84987',
                          '29505','87948','30785','52419','95417',
                          '17324','14087','59743','79094','16956',
                          '87975','14860','32867','60377','62697',
                          '11025','75650','87773','76633','87830',
                          '29183','36612','38347','95554','60686',
                          '96869','52740','86912','54314','65170',
                          '38661','37743','62726','42557','55759',
                          '96634','28720','90502','45483','12766',
                          '15996','95315','50780','61556','29626',
                          '12550','24260','38556','65394','34768',
                          '72792','95656','70876','91326','36633',
                          '21915','20769','39231','43814','79698',
                          '99612','40337','62440','17591','83908',
                          '64385','17436','67111','16933','51440',
                          '33086','60336','26710','46802','43923',
                          '49332','58551','52251','55663','29047',
                          '72795','66645','51875','14410','53882',
                          '79335','83867','31306','72312','59287',
                          '52916','42091','46188','98909','41598',
                          '39700','79002','61377','28993','44446',
                          '38724','28427','56665','31285','47032',
                          '32673','10748','17036','91703','17268',
                          '57413','62044','51297','30152','63412',
                          '40541','10830','51593','58620','66940',
                          '42093','65756','17597','77735','68279',
                          '94154','66807','14479','64240','15387',
                          '29695','22158','43199','84836','75919',
                          '69027','21284','43732','54052','52842',
                          '53149','34971','34493','22484','31654',
                          '62934','32156','67700','29990','68271',
                          '10176','56847','69706','18209','51905',
                          '41649','31846','42903','48394','63829',
                          '75399','81202','39605','97016','60722',
                          '32772','57270','58024','79908','81006',
                          '52007','47644','16234','82782','73935',
                          '88880','55909','18653','49122')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
