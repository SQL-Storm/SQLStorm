
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '76176','25120','18783','78599','35016','74126',
                          '31294','66413','57491','69638','12691',
                          '51607','42241','47068','70036','11717',
                          '26840','10401','13599','42362','13380',
                          '39345','97007','54470','47093','64929',
                          '48638','27310','13300','14593','97348',
                          '27439','67369','10655','58572','49901',
                          '17656','32807','91255','13653','12185',
                          '93962','50318','49922','47516','72325',
                          '51851','42543','20372','94368','81309',
                          '11637','45520','77950','20324','58408',
                          '56886','31635','86261','25010','62225',
                          '91836','40384','16369','57545','16304',
                          '12215','52537','10824','95785','88392',
                          '16005','63163','48006','63819','89294',
                          '30178','62429','34213','26142','11429',
                          '33201','14128','82670','41343','33895',
                          '79343','35019','62150','48369','37111',
                          '58032','79286','41991','13816','23197',
                          '45501','17114','59124','36764','87637',
                          '17450','90458','59628','66081','24715',
                          '28447','70150','45053','74601','54723',
                          '64954','25241','58988','57540','87573',
                          '38770','88837','62002','70124','17687',
                          '17869','86573','45834','52249','32380',
                          '25043','26844','16607','50387','98127',
                          '63194','78866','79897','36190','59495',
                          '62428','56707','44809','12030','32264',
                          '61923','33449','18943','61348','81572',
                          '83648','72471','69497','11941','74992',
                          '72087','24503','22924','32782','27858',
                          '45823','26069','71800','50549','95202',
                          '56188','31447','83656','38641','42953',
                          '16334','29698','54355','43374','69256',
                          '85694','96336','61163','85531','35666',
                          '15168','89916','13648','85057','15391',
                          '50662','41235','13792','47788','10768',
                          '31906','19946','15941','16684','77294',
                          '46974','82740','78103','32907','71077',
                          '80719','49282','22451','47410','44827',
                          '58956','13333','85046','28172','16837',
                          '95551','56758','23094','91529','40013',
                          '39147','23600','31897','80968','33056',
                          '15078','79689','45083','51743','96239',
                          '40756','82780','28566','38326','73117',
                          '19357','49398','12702','17685','10573',
                          '18067','56406','70672','88407','49169',
                          '70669','29484','96690','12016','13938',
                          '83529','31495','56423','43446','85679',
                          '79998','51245','79067','30785','40536',
                          '17012','70705','54798','22211','54375',
                          '68631','28340','33537','49260','99897',
                          '90641','13301','30652','28465','64146',
                          '19523','35307','65272','75495','43980',
                          '32244','24377','18106','28083','52354',
                          '45087','64859','40300','26966','61201',
                          '65693','64058','57249','30774','67163',
                          '13439','94509','96502','41940','51712',
                          '41366','78896','68292','16660','54342',
                          '90191','14567','45347','86833','50495',
                          '52252','26258','19960','48654','73951',
                          '23180','65041','52026','68627','79055',
                          '20684','75776','18763','85064','81501',
                          '51981','41779','35964','57913','64159',
                          '45866','21483','81183','33850','37971',
                          '71512','90763','80752','41989','35652',
                          '52351','53372','44294','20617','77076',
                          '36461','20166','38728','45244','14229',
                          '96160','62711','10219','19211','52468',
                          '52072','22829','79262','20404','79867',
                          '21727','31196','99503','43196','67470',
                          '61840','34619','89317','11526','60798',
                          '57485','11451','57439','36623','54141',
                          '64377','72712','58286','78725','78237',
                          '38324','24525','31619','12843','58978',
                          '35105','17600','50496','53462','74724',
                          '71215','19495','36309','20018','47939',
                          '35396','77002','39428','29138','66016',
                          '70071','57789','91070','82285','80198',
                          '45097','29653','14539','76820')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
