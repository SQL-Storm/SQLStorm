
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '44647','26509','96843','84560','92098','37270',
                          '93041','66185','87499','23460','10518',
                          '64894','71972','14721','93531','10487',
                          '94450','52567','11240','82260','76604',
                          '70782','78876','34619','32573','42960',
                          '41100','42196','63850','21049','31997',
                          '81017','43403','27560','46578','60950',
                          '10095','85891','61195','10181','19698',
                          '57618','18380','46994','76035','74699',
                          '85869','55096','26789','40113','17420',
                          '76451','16125','95423','98278','30487',
                          '63559','95002','47652','71130','11750',
                          '42684','60923','80972','26726','71614',
                          '27175','46929','35906','59456','35978',
                          '46917','16562','30380','29097','18307',
                          '14262','40766','35115','69196','61048',
                          '83652','40250','45630','23496','89676',
                          '72622','32610','60650','43105','92480',
                          '50503','69659','98652','39666','80301',
                          '23872','20501','77884','81620','48440',
                          '15825','34585','46804','12165','64583',
                          '32127','39728','32178','31167','85948',
                          '77000','93434','97699','31124','85612',
                          '95161','51889','61714','15661','12971',
                          '27625','66210','12892','94988','19273',
                          '46065','10466','43822','45521','89079',
                          '71043','24026','18955','68818','10571',
                          '54549','55574','67057','76287','38829',
                          '70627','54393','28178','78754','24502',
                          '84428','54520','24275','63141','60437',
                          '28681','83310','14196','85162','50002',
                          '56415','47825','30072','88967','53065',
                          '63231','99271','61308','62518','73094',
                          '14461','68441','64139','47333','27490',
                          '55912','78374','27751','29751','68349',
                          '45590','14421','94674','47005','17073',
                          '34241','12110','93998','90303','26251',
                          '13466','86320','85086','25479','79216',
                          '80272','14704','38179','19487','55932',
                          '21511','89635','66868','80882','29039',
                          '91200','36637','64646','39399','50936',
                          '51805','37648','14604','27022','29145',
                          '45183','29388','25478','19939','40341',
                          '99534','23480','21579','98223','42607',
                          '86224','87244','38677','46164','54873',
                          '73872','97524','65487','11070','44393',
                          '38256','10709','49564','37090','65153',
                          '52402','11768','22030','54965','51430',
                          '30561','36103','66783','46625','19507',
                          '72410','12993','58894','76382','45124',
                          '15824','22402','16965','81869','46527',
                          '34372','93362','59452','41450','90153',
                          '55630','72278','46438','26681','95617',
                          '19644','11722','73456','71569','49052',
                          '28855','17620','10649','83440','75339',
                          '29742','24527','59494','75446','47227',
                          '31787','32850','59778','15290','17663',
                          '12580','74433','11609','77085','46521',
                          '49077','99661','80762','77150','73320',
                          '74763','57552','13104','93009','59970',
                          '30257','39045','34902','58612','86992',
                          '48383','86418','52607','16317','35223',
                          '46727','64950','40995','56510','15254',
                          '10218','34827','14112','65819','21300',
                          '70454','95641','81665','49556','45354',
                          '87020','82305','45376','21530','18019',
                          '95561','50370','60662','20141','56242',
                          '12685','72361','44274','14174','22519',
                          '48039','69227','70089','80483','72554',
                          '70342','43136','13136','37583','32551',
                          '30556','53539','20435','99180','79395',
                          '80216','18139','77565','18536','21606',
                          '15796','57687','16853','82596','21860',
                          '71167','96201','65351','51398','64255',
                          '23562','72574','14633','22167','10062',
                          '28819','39229','24272','94370','96273',
                          '82095','13524','12519','69625','69758',
                          '80971','21678','60530','15126','57278',
                          '86050','62372','55773','23428','96737',
                          '53498','70887','19613','21893')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
