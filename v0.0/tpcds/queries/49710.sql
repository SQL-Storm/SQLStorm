
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '41159','30584','50616','68352','50157','14856',
                          '21072','37419','95035','16119','34124',
                          '56287','16245','94824','44884','14743',
                          '41682','14338','98792','26013','85374',
                          '20066','31579','32082','53607','61397',
                          '60808','51119','82225','30968','24444',
                          '42358','56034','53076','30313','40879',
                          '39476','75607','63905','95137','89998',
                          '82181','58305','39498','76503','89811',
                          '37547','91736','56339','19215','40730',
                          '69789','80168','28716','81483','76117',
                          '60756','42628','59294','60325','19526',
                          '67719','81549','12928','54588','39137',
                          '75310','44058','79272','15172','79704',
                          '33245','99036','75758','46349','28031',
                          '42826','99224','89056','71993','28140',
                          '82904','64859','98893','28590','38248',
                          '18300','72077','48421','28622','89335',
                          '22672','15112','90558','12429','95173',
                          '15729','55753','76819','12591','40855',
                          '91013','79258','56359','15350','76830',
                          '33489','68658','24843','82002','77675',
                          '25022','42713','84070','80634','24400',
                          '75805','15022','93064','19005','42486',
                          '16457','45798','30922','86905','34241',
                          '80582','64437','62494','94955','18488',
                          '42400','24263','22101','64929','49877',
                          '22984','50753','79556','77302','49069',
                          '41823','41520','58952','39887','49256',
                          '13318','85311','27749','26662','63850',
                          '18519','63703','23700','27126','50525',
                          '62678','15003','19836','76491','96967',
                          '80851','15010','75220','73907','29278',
                          '50827','70515','51358','32565','12121',
                          '81987','96588','18121','54435','93636',
                          '97098','43224','36644','56199','11483',
                          '11110','15970','70939','29931','71385',
                          '95564','39384','31660','30440','70850',
                          '16644','65948','73015','43382','65801',
                          '88087','32958','92067','27846','76915',
                          '51978','79859','63044','71425','74091',
                          '33598','93799','89104','97981','66451',
                          '28982','72563','35178','14886','50274',
                          '12318','22205','35849','34246','31057',
                          '27379','23765','96770','36911','22016',
                          '56700','90685','18051','98277','39730',
                          '63273','39638','73917','82495','11505',
                          '29343','48605','34079','10635','37845',
                          '64750','34564','18759','93759','33666',
                          '13363','49367','12133','20761','17236',
                          '17048','18417','75848','88853','21180',
                          '87594','62424','75633','60321','28767',
                          '81517','82919','76081','75322','47497',
                          '71176','67862','33405','60524','16152',
                          '82211','38692','89904','41544','66148',
                          '35976','24402','51417','10464','45016',
                          '81340','27660','18808','80186','66719',
                          '39281','77261','48880','48346','47249',
                          '69094','26182','47183','39864','58175',
                          '30639','29908','44240','70959','69468',
                          '31371','81648','64996','49675','36794',
                          '95044','72802','38138','25978','18484',
                          '97253','21018','44451','15158','70355',
                          '58345','75589','75032','33752','95888',
                          '13432','40492','19278','42125','36711',
                          '47726','21459','12584','61118','26103',
                          '57448','36367','38994','66287','25600',
                          '37202','80879','78738','66385','84322',
                          '76608','40674','72620','13080','72234',
                          '23480','51047','38241','17875','27386',
                          '52032','14580','19624','87110','23533',
                          '85072','79831','11903','92446','44756',
                          '94179','66392','66083','28484','97378',
                          '21658','50554','83961','90866','22452',
                          '51003','48584','63028','17513','10556',
                          '52113','26395','24031','57181','52355',
                          '77982','24157','10849','44317','22665',
                          '13717','62484','18077','80125','65221',
                          '72857','83146','69921','23859','28517',
                          '23337','77779','21884','52408')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
