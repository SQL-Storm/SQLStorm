
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '33487','33472','53765','11402','17039','93203',
                          '65404','78466','87375','40006','34713',
                          '89527','41569','95152','56942','15424',
                          '87443','11021','12024','93711','97746',
                          '79694','84804','21503','60819','96982',
                          '34676','54185','81387','52807','57142',
                          '23889','50813','47413','89232','41621',
                          '26132','33735','47865','69309','32406',
                          '23972','53049','92542','12412','39990',
                          '76951','31416','78905','89021','48046',
                          '51266','87918','15613','74160','15994',
                          '23477','27083','40797','54764','20077',
                          '17070','78947','51423','17572','24056',
                          '64182','15198','80948','97184','87973',
                          '35386','76539','55341','28555','19873',
                          '35492','14507','41451','67188','62191',
                          '24109','75561','35264','73190','78952',
                          '96757','98228','78137','91657','61344',
                          '36918','93867','13073','73595','22103',
                          '99866','14533','51040','99247','83132',
                          '21387','18483','16897','13311','84178',
                          '25001','18159','83885','84391','24665',
                          '25350','39327','43871','85909','41545',
                          '88225','45237','29729','11752','26038',
                          '43525','95826','28912','83830','72853',
                          '59451','18799','37875','90663','44013',
                          '77253','43239','58506','26323','62521',
                          '50913','46243','17850','37991','81912',
                          '19195','22741','94360','95675','30885',
                          '39804','26268','42133','19459','12779',
                          '47502','42431','24875','36198','56081',
                          '91206','73814','90912','32407','44709',
                          '14774','83879','40746','79494','69132',
                          '16974','64520','99869','12491','97546',
                          '70956','27854','15147','81660','30541',
                          '32183','10198','49297','33228','58326',
                          '13189','92839','45111','33920','55684',
                          '66298','29387','52608','14358','86039',
                          '83982','35431','69607','73554','55601',
                          '12684','90416','56230','62217','91690',
                          '64681','12028','16054','33397','56505',
                          '55338','80977','34658','21172','42958',
                          '49864','24919','51941','17976','96439',
                          '15877','53220','62250','44087','99593',
                          '14641','94994','97380','31896','31364',
                          '51100','44713','35449','45950','26402',
                          '47813','33238','53975','42906','23962',
                          '26214','58328','66080','85603','47892',
                          '32238','80978','65447','78679','77028',
                          '93328','94546','72580','15070','71052',
                          '11983','42837','23356','15903','46605',
                          '91797','30880','15078','52408','83990',
                          '20715','67056','25120','31635','24747',
                          '60934','47845','15435','11374','79376',
                          '77891','59315','91529','20926','65899',
                          '20787','54290','54496','71672','15257',
                          '71258','81699','50743','10950','24390',
                          '24770','25186','23976','60784','75562',
                          '70712','13119','79292','73260','33423',
                          '22595','10445','35467','31931','58174',
                          '82915','18961','55510','16260','10318',
                          '14389','90387','63319','32390','22879',
                          '78630','68775','34934','40387','26398',
                          '26193','57910','90833','93324','71962',
                          '55353','62028','69621','37419','47294',
                          '51836','91242','63977','34898','70906',
                          '31052','24405','11176','82641','43252',
                          '27627','67718','41322','38100','48663',
                          '76531','75441','18828','73945','33387',
                          '31867','22616','85484','77786','63304',
                          '20989','60877','73429','99139','98780',
                          '18501','53732','46798','10832','33564',
                          '26107','17426','12531','59352','82336',
                          '24630','69286','15948','94398','82253',
                          '88587','64658','79044','14744','96104',
                          '82755','48182','39713','94391','10903',
                          '32877','57257','27104','47409','58641',
                          '21253','56066','74958','44292','32712',
                          '27471','57521','13765','14182','96537',
                          '30263','13084','46583','63921')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
