
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '74683','48157','98211','51072','57873','18942',
                          '33736','68007','15524','40849','42343',
                          '87809','55707','49265','32033','21328',
                          '21236','62182','42669','80295','62823',
                          '93120','46647','57596','53942','78173',
                          '68620','39807','24439','26870','94533',
                          '59128','99196','12536','29429','50013',
                          '48447','24198','30285','78336','30903',
                          '30313','36856','48846','21189','22258',
                          '48325','31454','16892','23977','14928',
                          '54580','24045','89353','11250','36348',
                          '91479','42707','43204','33564','30417',
                          '66275','63214','90339','16095','49405',
                          '80273','77623','51843','49390','85299',
                          '31199','66164','49750','79468','13391',
                          '77299','72931','82368','41044','37415',
                          '84861','18295','80034','75257','49138',
                          '31493','13182','35936','90978','15347',
                          '81276','70558','38542','93569','75268',
                          '56310','58502','18486','10066','38415',
                          '83239','31061','93827','22727','10857',
                          '23811','10738','60804','36510','42530',
                          '68028','48720','67169','83457','98554',
                          '10653','61604','14884','76241','72835',
                          '53542','15147','64966','50394','94012',
                          '95149','42636','85530','28227','79551',
                          '53321','14267','57790','16200','68122',
                          '76163','22228','64014','37899','18839',
                          '19213','38797','28309','61739','29158',
                          '57415','80682','62578','27055','39086',
                          '84133','30999','28230','68453','75599',
                          '24146','60287','48366','51076','34812',
                          '16382','85908','78453','36747','63955',
                          '64562','42687','58096','86516','28560',
                          '46725','27542','52607','19166','16237',
                          '55846','87112','36453','16268','31685',
                          '35891','86054','47399','49980','22143',
                          '19386','13780','41257','26577','86722',
                          '73806','77573','51635','47280','47217',
                          '85425','82256','83499','75950','55810',
                          '43026','39417','75640','94923','31259',
                          '38450','30488','55031','44135','58590',
                          '79206','41418','17502','17161','28558',
                          '70083','85226','64639','12265','94561',
                          '42254','97699','39432','30309','50828',
                          '18546','67505','98923','87840','28821',
                          '16395','92257','30182','56192','44170',
                          '79440','63748','26168','59823','32383',
                          '60067','87141','72831','25046','63479',
                          '54223','57713','23736','85891','61290',
                          '26454','54131','75038','16088','23140',
                          '43223','28299','79923','12447','59577',
                          '22292','87220','98689','77969','51610',
                          '26616','37758','56136','29676','39918',
                          '14740','95825','52614','19362','67620',
                          '44068','69484','16666','52109','36297',
                          '19703','11683','13929','21407','10727',
                          '37125','99948','35195','57522','41832',
                          '56535','75520','21192','54622','10480',
                          '25892','95042','17883','90193','71889',
                          '68571','64538','92875','10271','22889',
                          '12645','62812','16716','40033','22887',
                          '20066','19271','72384','14258','45618',
                          '64242','74118','24371','54118','98404',
                          '73116','65701','17686','35216','18561',
                          '32998','81395','29698','84578','50484',
                          '83822','97171','78180','41482','86982',
                          '67578','12644','88541','87941','59369',
                          '19219','42907','75008','53897','74844',
                          '10841','39907','95784','21579','47713',
                          '41788','46887','61989','43147','65333',
                          '70213','16942','63442','82246','51986',
                          '60831','62728','64978','43269','45640',
                          '68020','25110','98321','33730','96633',
                          '60074','66808','38204','86662','69705',
                          '26637','68946','38282','10585','48105',
                          '56322','11181','10886','53004','59018',
                          '36016','95472','96169','64263','18716',
                          '79254','37284','57794','68686','70139',
                          '72581','17740','36065','97779')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
