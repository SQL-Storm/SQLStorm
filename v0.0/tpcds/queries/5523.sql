
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '19673','20412','90496','41083','26372','54701',
                          '41994','46532','11126','96442','14747',
                          '18026','12910','23098','10323','11296',
                          '31541','10883','98465','55664','14381',
                          '91453','30199','68024','52494','80314',
                          '83900','36459','53155','47819','18902',
                          '23628','15493','31403','19439','77364',
                          '83590','25353','20306','93363','59340',
                          '95568','68433','81574','52947','73941',
                          '28391','90624','24608','41155','12928',
                          '39631','74785','42367','64226','63430',
                          '37251','97623','64867','52423','13163',
                          '31021','14543','29854','50440','14206',
                          '63505','37134','24841','24096','68557',
                          '44417','70604','89938','94514','86034',
                          '62969','66394','65984','53938','91749',
                          '76424','21709','92439','80302','13082',
                          '17216','69251','46870','70644','12825',
                          '71034','76574','82680','39495','29634',
                          '51208','73163','33668','46177','45914',
                          '54684','61010','35639','99426','21150',
                          '78639','90895','80781','17704','25638',
                          '26860','73610','51562','82539','36045',
                          '78186','85656','20055','29891','56672',
                          '10122','50555','80041','36451','87298',
                          '73167','92156','46090','32234','66045',
                          '94357','81693','99260','40199','82476',
                          '16558','79632','50956','61474','58516',
                          '77883','29212','54471','46582','95499',
                          '63441','66766','15105','76911','93412',
                          '89634','91234','29684','40004','76943',
                          '32316','34013','90700','71417','15311',
                          '45879','66032','72019','77354','44339',
                          '34923','34701','73590','79611','69238',
                          '67036','50175','76985','47982','21913',
                          '11352','34430','26885','57999','13764',
                          '29995','37887','75115','14289','36988',
                          '42366','10127','50849','70630','48157',
                          '24974','74646','45219','62649','69732',
                          '35634','14753','20834','48644','78408',
                          '50551','93402','83986','18148','27384',
                          '12388','86799','97270','76598','18770',
                          '42928','35978','17845','96059','36054',
                          '35777','75841','87663','30045','58590',
                          '61161','73324','58852','87614','82417',
                          '99268','21488','13691','34977','64112',
                          '31780','95587','90103','85220','10544',
                          '96638','80478','91713','63914','88981',
                          '96031','61064','51689','58736','31259',
                          '43533','98075','72395','21930','20183',
                          '27218','42095','79971','14389','51508',
                          '49748','17973','61053','41846','90604',
                          '62301','57161','30286','84281','92170',
                          '70569','93210','59039','25558','99309',
                          '14145','51652','23832','23254','87897',
                          '68772','48769','22225','22557','55847',
                          '61882','86152','39411','64075','16468',
                          '68023','55019','83625','41331','31967',
                          '81690','94214','19433','15546','25107',
                          '53230','52640','49362','49069','59443',
                          '15461','61783','99847','30097','57938',
                          '58114','46906','48579','30129','26287',
                          '25072','48614','42910','27633','86602',
                          '52103','76264','27539','67966','28141',
                          '15357','17563','46665','94132','68235',
                          '16264','37609','42790','10652','21299',
                          '18893','47373','73362','70111','17479',
                          '68012','11946','78874','43856','67051',
                          '62053','34065','14779','92697','62904',
                          '56707','38405','86210','97547','56206',
                          '75141','69759','49283','28641','59838',
                          '42258','11378','47655','49168','93910',
                          '49682','52386','43440','39348','50114',
                          '44233','47365','33022','26114','19324',
                          '73136','96141','59658','71768','64212',
                          '98307','30252','66150','97351','64754',
                          '85174','70620','30354','79090','56111',
                          '34969','42054','71607','19532','15758',
                          '12418','77294','41490','51819','47933',
                          '44178','44622','41646','23752')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
