
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '10423','86496','65961','95059','63763','56140',
                          '20668','26230','22981','44132','78666',
                          '44075','14294','29149','26132','88882',
                          '61449','18659','89065','67974','46940',
                          '85960','50705','66471','17744','48251',
                          '19062','16514','53391','38736','36844',
                          '43866','48025','81012','18524','66042',
                          '42344','25225','31178','19051','32616',
                          '85661','91482','10075','45980','26762',
                          '51205','83497','19224','55265','18844',
                          '45267','36915','91499','89799','63054',
                          '80331','88159','36169','13752','57648',
                          '92802','31472','44014','52563','14630',
                          '42613','40423','14276','42692','29758',
                          '64624','43636','99538','30427','18183',
                          '14714','19753','49218','62023','22067',
                          '19461','26483','43091','36710','94155',
                          '85339','66818','27827','11235','99518',
                          '51772','66326','43181','12503','66381',
                          '22272','31707','95990','41825','23814',
                          '16429','25824','47336','81202','38993',
                          '59458','55520','55590','75067','68038',
                          '13137','14665','34830','47298','75207',
                          '34475','83837','85355','74145','24474',
                          '97495','51005','31325','43768','12966',
                          '54648','60855','29376','83722','44315',
                          '27268','34772','40844','18869','55866',
                          '13222','52110','39622','31906','83211',
                          '68147','27547','22442','54849','70636',
                          '48654','88124','80684','40456','68705',
                          '82533','32662','61244','41019','55664',
                          '37890','48678','35694','54385','62988',
                          '86105','33022','26390','80176','89717',
                          '34615','97653','15957','64208','10716',
                          '96382','41361','53702','56675','51043',
                          '50276','19256','79899','90461','11128',
                          '78846','27338','14991','20876','16509',
                          '47891','75487','29935','67252','98059',
                          '39859','39862','55786','62514','12080',
                          '50823','35349','64375','92597','78043',
                          '24487','98044','84275','86967','20619',
                          '24980','44547','77278','97513','32374',
                          '38855','96898','33190','59535','40518',
                          '31692','50309','16041','97916','40343',
                          '25516','73681','90674','42771','34431',
                          '74002','48006','11319','56651','17251',
                          '76754','51151','54841','17428','11511',
                          '14420','21227','18195','59327','30567',
                          '26554','12145','43287','31145','30005',
                          '22480','52401','97674','19678','76488',
                          '83621','15743','24465','90544','39532',
                          '20331','75141','55211','13401','87543',
                          '60947','96621','53878','20431','34458',
                          '21313','83530','63751','41081','70284',
                          '67733','95821','65558','83008','47083',
                          '16481','73021','36245','76243','84161',
                          '70443','49999','15197','41661','33000',
                          '82393','28515','88175','41067','77921',
                          '74565','87044','11134','94292','37401',
                          '26605','68722','13544','77414','34423',
                          '35758','57401','57252','26374','81827',
                          '38961','93846','55281','54513','92464',
                          '10712','99214','27026','81758','94333',
                          '80584','21937','24289','66582','54102',
                          '33647','78953','99843','71582','39009',
                          '73101','89796','31720','93580','96098',
                          '75286','42727','65466','72453','21727',
                          '78692','24383','10992','19744','14932',
                          '25357','90098','94031','85786','90253',
                          '55685','69814','41473','25535','25931',
                          '76144','20716','91747','81533','99572',
                          '38563','31568','61093','91177','48215',
                          '84338','94158','55337','96502','10931',
                          '28908','65687','43762','19898','65905',
                          '34616','99357','28409','76664','50290',
                          '31187','76186','75828','78760','91739',
                          '54161','90437','77941','49069','99987',
                          '13324','88877','42475','68074','23922',
                          '51222','48127','42911','45091','21855',
                          '18144','79902','47086','78104')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
