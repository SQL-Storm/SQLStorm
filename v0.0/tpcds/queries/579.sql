
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '69027','44698','87752','95020','67818','90143',
                          '13323','96769','34822','90109','75291',
                          '29390','53734','15027','81140','36856',
                          '43656','61329','50827','20521','99120',
                          '47889','61055','15974','86077','55623',
                          '24186','18955','40818','28984','79207',
                          '96033','33024','22034','30649','21280',
                          '64562','30105','51542','91004','40580',
                          '53318','55625','79095','13361','83576',
                          '15158','16100','34650','92730','14092',
                          '41953','44242','97103','79865','35060',
                          '46124','12131','28199','14908','96117',
                          '45226','83544','91501','53644','30230',
                          '95240','51787','64958','92958','22636',
                          '13877','38893','17887','11141','77977',
                          '39991','97710','25862','80877','12285',
                          '68357','47507','65715','44726','10707',
                          '60488','99105','77147','79877','69327',
                          '81984','57382','29567','25798','28842',
                          '62441','57794','65186','63735','59636',
                          '16764','94561','67681','96705','18324',
                          '33816','55273','84336','67709','74687',
                          '72808','12841','11963','57431','23283',
                          '71270','89779','18979','20673','21583',
                          '48628','37082','52842','38430','47113',
                          '29218','22004','10998','47581','46553',
                          '58668','86206','89751','19121','35079',
                          '56093','67689','61728','18953','21277',
                          '43638','74782','18649','32898','57701',
                          '56808','45167','72377','54094','15104',
                          '16828','78321','64639','95059','97957',
                          '56885','53105','93811','54910','15328',
                          '71793','69634','68310','65367','37047',
                          '36959','50191','93537','54206','27849',
                          '71406','86970','99043','45261','46396',
                          '84046','38862','41877','14644','31441',
                          '29615','67015','76530','32668','70176',
                          '54765','18525','82422','27816','21609',
                          '31426','50890','76517','66724','18052',
                          '17202','47391','19411','81220','78347',
                          '12262','27856','38163','80574','93121',
                          '95325','13972','43939','16252','95637',
                          '29289','65441','95924','64305','21353',
                          '82865','30726','49880','43903','91324',
                          '62496','34829','97967','86507','30705',
                          '85258','18992','54407','42463','31884',
                          '34561','76687','83960','21018','35826',
                          '35114','10834','53433','79905','25953',
                          '92364','86580','41109','44084','12685',
                          '44716','11115','70789','36124','46898',
                          '45151','43567','24246','61195','10169',
                          '64061','18529','19907','65947','88251',
                          '27836','34043','47150','19043','26434',
                          '18249','36479','74504','37524','31375',
                          '36903','13555','33801','12265','80708',
                          '17043','44169','96418','25749','76982',
                          '70795','32357','20050','59653','52913',
                          '52778','32515','49997','23790','21175',
                          '64959','12995','21049','57297','88150',
                          '16759','52621','70845','65363','72671',
                          '45688','92931','59922','41630','80783',
                          '30563','20939','34240','45732','48987',
                          '30914','28567','64334','24192','13571',
                          '14679','88629','63254','25918','14978',
                          '43840','79196','82663','12901','86088',
                          '59991','24269','88703','36731','47021',
                          '72396','17030','37200','74293','11080',
                          '33120','97473','58537','16582','25634',
                          '17497','57248','79826','99863','77960',
                          '24166','43157','26351','68136','78392',
                          '65827','88644','34993','27378','18231',
                          '84698','64990','14033','25081','74383',
                          '14410','20360','11265','31101','23588',
                          '10981','68523','40222','21024','92505',
                          '87716','23669','54949','48457','32622',
                          '42451','90800','13356','22329','20313',
                          '14108','68271','57071','78662','80889',
                          '67834','47937','12531','63417','26072',
                          '31831','20841','58964','90585','70970',
                          '75307','94528','45754','30823')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
