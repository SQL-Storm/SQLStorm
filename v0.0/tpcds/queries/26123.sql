
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15392','12384','98665','50216','77438','33950',
                          '47054','40930','21715','70833','85110',
                          '62238','79660','32739','97829','64627',
                          '11622','12435','86188','36805','33255',
                          '64039','47692','72237','22307','71594',
                          '67561','94703','51220','83573','53570',
                          '13079','36798','30929','23988','58977',
                          '50178','19869','40955','96209','87057',
                          '63035','55032','55606','18477','29355',
                          '49857','42663','52536','24848','15886',
                          '41760','51450','72585','29098','82839',
                          '23328','91516','57560','13773','89954',
                          '19701','77996','96755','21273','39937',
                          '86570','29505','17882','80003','87697',
                          '17406','83927','96354','95185','25298',
                          '48356','59342','16495','50897','38162',
                          '15847','95568','31902','62329','72713',
                          '36252','60617','47080','20934','16385',
                          '68502','19253','35195','22171','74192',
                          '30723','24004','32108','47396','51099',
                          '66186','32477','86011','34161','26522',
                          '33664','17503','38290','38077','18492',
                          '64111','80282','71205','48110','73749',
                          '50131','35742','31631','98113','70713',
                          '72589','70918','39369','22924','51913',
                          '38790','46721','43846','29889','99536',
                          '16826','15875','18202','22936','70877',
                          '51898','77513','58694','93206','64748',
                          '71789','33553','96571','80682','91144',
                          '41339','41859','42558','34726','12313',
                          '12355','90304','38617','11728','75151',
                          '78994','26852','39136','62015','41610',
                          '77584','81145','81146','67177','32750',
                          '52491','31249','69591','80022','79596',
                          '35127','70478','25626','37241','27326',
                          '46613','72555','20666','60762','73211',
                          '30294','60102','79631','40534','22940',
                          '31797','84241','78739','39812','24839',
                          '61580','27869','49441','49355','20280',
                          '46600','12844','54319','83242','24022',
                          '91464','38537','22311','72770','16279',
                          '29116','24757','48920','78938','69665',
                          '87469','19649','31392','64518','81322',
                          '47283','18656','82008','43130','12880',
                          '92730','77604','76174','26756','60625',
                          '74426','39737','68170','42843','20159',
                          '69149','50573','31258','17773','37228',
                          '44937','78890','13455','30803','51774',
                          '15402','10668','28925','22204','19929',
                          '32716','13854','14922','11815','41798',
                          '44318','84643','16536','20262','37418',
                          '39022','26398','23857','23078','99571',
                          '90254','97133','29179','80961','60776',
                          '11391','79274','85404','35007','82325',
                          '14724','30354','14830','45947','74385',
                          '79107','18668','42240','56551','18123',
                          '56483','21057','31660','44677','69959',
                          '20458','62979','41496','47837','71651',
                          '28096','74271','10494','86146','97722',
                          '36911','23778','76673','86014','49150',
                          '75857','10338','42963','50919','22140',
                          '40614','73790','96796','24067','13233',
                          '19398','33714','12706','88349','96192',
                          '12860','42148','27587','39690','49522',
                          '56748','24263','24335','30042','41498',
                          '34061','79011','16156','41134','16379',
                          '72101','31916','42953','15525','65794',
                          '29594','80150','27528','50916','73563',
                          '57810','16711','57691','22033','40430',
                          '12228','17216','21698','53955','61656',
                          '11067','46002','82938','70451','65047',
                          '92068','57420','35470','88237','64221',
                          '28561','62665','42483','58648','85622',
                          '92783','17522','48228','73861','55832',
                          '81870','21262','42876','94804','58713',
                          '25484','44550','67556','95672','73947',
                          '55070','48342','28969','44814','52715',
                          '47329','31182','84728','21241','34683',
                          '30962','19670','23839','70073','42265',
                          '51568','42323','54892','57466')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
