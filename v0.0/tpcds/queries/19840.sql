
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '56161','75207','15342','54611','55136','61882',
                          '36855','11284','30127','61174','47267',
                          '10191','50942','54850','41942','13799',
                          '89368','14742','83847','33834','78076',
                          '15657','59770','99194','68737','21139',
                          '10455','79376','52495','47283','83613',
                          '55960','91620','59383','10388','11066',
                          '13632','63723','34335','70995','78762',
                          '34216','82214','22648','70258','87841',
                          '16005','54922','37982','62176','86160',
                          '41812','23253','71461','75040','29668',
                          '30724','65247','38630','93797','74067',
                          '48905','71758','29766','97886','92521',
                          '91675','46538','47527','40340','27698',
                          '21908','26575','33798','41025','25106',
                          '29855','41837','16737','87741','91743',
                          '45434','57798','21342','24997','34947',
                          '40886','10780','42303','92822','17683',
                          '53059','46461','24463','46735','49763',
                          '52246','29109','12847','76751','16552',
                          '50355','59084','53175','17340','15838',
                          '85189','31221','46849','63395','14732',
                          '20727','74560','55998','76295','19324',
                          '21917','93077','33202','80408','53523',
                          '82350','64663','46476','40555','56482',
                          '55016','48041','14112','37558','45989',
                          '18280','65894','19266','14087','56518',
                          '31819','22102','55385','31188','55726',
                          '60187','99544','26466','49039','42305',
                          '85613','17678','74074','71027','61963',
                          '17263','13567','23833','97332','12865',
                          '22869','13725','16293','74330','93352',
                          '37024','27766','15282','39309','13326',
                          '51621','18917','99313','33683','59636',
                          '35725','22952','60735','46599','10168',
                          '97637','57405','16427','93182','32106',
                          '32912','12554','55135','23888','38337',
                          '95254','64565','68759','37062','29473',
                          '90670','64291','46422','76945','82843',
                          '31845','60361','15795','73541','34936',
                          '35616','19985','42703','34865','93204',
                          '58904','27522','83652','25461','30540',
                          '48169','55828','43628','65486','16947',
                          '80751','97238','32579','60542','87701',
                          '93591','73247','42758','26732','80796',
                          '71694','40700','42168','65193','43206',
                          '13714','13010','57428','49617','81530',
                          '60242','58967','17386','10915','54948',
                          '39608','10347','55618','19254','47183',
                          '41298','20462','43928','19242','11687',
                          '80026','72467','76719','11598','19841',
                          '89708','87349','21151','78092','90337',
                          '28086','15134','47594','55503','85670',
                          '68934','40876','17652','65096','37496',
                          '25976','18122','96863','90006','79466',
                          '14145','84247','71573','94976','30322',
                          '99012','65527','82193','48939','86310',
                          '30524','64953','88983','35748','25821',
                          '13648','20283','76431','26078','99795',
                          '11875','64298','37092','12252','86421',
                          '57172','95597','17360','94963','11333',
                          '79941','60576','67773','89548','48450',
                          '35333','28948','18401','36085','77304',
                          '45055','33155','20411','11165','13510',
                          '39047','57855','46405','32118','45038',
                          '81307','53939','75435','41920','25613',
                          '19854','85475','31668','11172','35161',
                          '53984','53749','36825','68188','18372',
                          '17869','45647','56406','19973','16238',
                          '43520','92872','74456','83914','54324',
                          '96512','95918','41323','15894','27001',
                          '72050','70299','82778','35595','19345',
                          '49603','11678','43849','89072','85015',
                          '87323','95552','70602','51884','13348',
                          '40601','87369','23171','71053','82939',
                          '40971','90531','33226','78431','59271',
                          '16720','54021','48883','17597','80104',
                          '30768','92051','99076','39216','96893',
                          '23588','20302','75236','59349','59449',
                          '13885','37347','35233','74548')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
