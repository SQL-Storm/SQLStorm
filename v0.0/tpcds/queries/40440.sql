
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '78686','57540','35826','16185','84733','77742',
                          '50682','70674','52150','97920','42342',
                          '27058','22328','12827','62178','33913',
                          '25579','40239','25652','46848','72043',
                          '85328','61210','47919','78977','21107',
                          '33141','56163','52427','42820','13724',
                          '39058','28381','23856','64822','38019',
                          '69248','71040','95541','68766','80895',
                          '69327','40433','37250','32454','42054',
                          '13020','57976','77059','13112','49900',
                          '49743','28000','11054','82201','44074',
                          '76001','72389','30912','27431','92837',
                          '67868','30910','81820','27307','39207',
                          '13628','34951','58572','19862','71411',
                          '19188','23160','75655','49732','43474',
                          '57924','30981','43473','63000','44656',
                          '97766','25340','28332','48187','61856',
                          '74953','13600','37643','51149','42268',
                          '73068','90828','91652','88809','26372',
                          '22321','10909','81696','23412','80918',
                          '78687','61255','84806','49917','43306',
                          '77953','12712','62445','83768','28662',
                          '53247','81894','85014','97018','63261',
                          '32705','82698','10190','38738','45035',
                          '53363','78542','63678','37331','65434',
                          '28719','75621','86059','43490','39859',
                          '40170','43491','40234','38246','34673',
                          '30026','50466','69180','21132','97369',
                          '51881','85530','40224','47491','13509',
                          '94230','33445','28514','94428','48352',
                          '40407','92424','26159','63916','16321',
                          '38961','69510','95853','15091','50974',
                          '16819','42290','35242','15299','72772',
                          '21282','52944','84788','47914','35157',
                          '35500','73935','64330','78367','68139',
                          '74211','98496','21597','85015','20017',
                          '28056','16361','28268','22090','17936',
                          '95036','76382','68284','74551','25580',
                          '63099','26587','35082','35360','22080',
                          '50764','38578','59597','83771','31395',
                          '40355','62881','45132','22947','41242',
                          '82007','21496','21983','35276','76799',
                          '25165','43084','65251','74914','71132',
                          '25736','54551','87045','27919','12505',
                          '68145','45341','36881','11997','19205',
                          '39008','74556','62516','10982','35105',
                          '33270','57141','12661','20614','83757',
                          '38998','22481','11089','45800','63232',
                          '47796','85110','98811','39717','21170',
                          '55148','55354','52795','58176','24403',
                          '13479','41880','83642','77074','57032',
                          '55230','83463','94464','76115','56200',
                          '70026','26526','65461','42927','12573',
                          '17724','30192','60102','71621','62413',
                          '45894','77939','43337','98659','55360',
                          '33231','69482','17637','89910','56459',
                          '23181','26908','27774','16940','80971',
                          '89130','82257','14845','46745','46082',
                          '60620','30463','19998','82374','82410',
                          '13147','43500','33260','86199','31680',
                          '24889','53970','67877','99056','15735',
                          '58986','40295','40816','98999','44459',
                          '19955','57274','77174','17013','96318',
                          '13176','95162','82053','99569','85482',
                          '48457','78456','75069','25523','88127',
                          '96379','41408','19927','36889','59343',
                          '32492','21727','28456','82791','57627',
                          '12611','97919','90149','94854','12720',
                          '93344','49905','92539','35648','50260',
                          '68620','95096','92019','14062','22966',
                          '74415','77788','59254','59884','13339',
                          '67140','27134','31284','49512','76437',
                          '61262','20578','17038','58817','14036',
                          '21030','56958','66775','40920','41613',
                          '83072','48275','77353','12120','69680',
                          '29555','76320','18566','16343','14652',
                          '29745','72932','10513','33871','23039',
                          '59610','30877','82887','32212','66254',
                          '43279','82663','86458','65538','65807',
                          '33616','52965','55019','81019')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
