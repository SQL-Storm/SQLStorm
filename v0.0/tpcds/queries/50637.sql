
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '63435','19732','74997','50740','29068','42441',
                          '45910','94393','14311','21150','47908',
                          '26807','92086','98859','47568','52104',
                          '65479','95937','57684','39813','61347',
                          '79265','16316','80443','91748','97094',
                          '57774','71391','85182','36998','66192',
                          '15688','71153','30690','31587','59114',
                          '54267','74536','71487','78793','21240',
                          '21494','96029','42791','77993','35389',
                          '32109','52708','51050','20105','48813',
                          '11125','77440','30722','27726','20802',
                          '47621','25982','26183','18267','59987',
                          '11855','74028','90178','64004','88546',
                          '32525','47406','44589','11131','19419',
                          '70289','98040','79120','22798','28228',
                          '98977','41051','44553','44615','24529',
                          '49071','11543','26176','23320','85374',
                          '79429','51952','28506','93232','12156',
                          '97570','94612','63129','41132','62574',
                          '17917','52407','28928','89111','44570',
                          '81125','71098','97879','20941','38120',
                          '56634','10753','45827','83214','70707',
                          '55316','57050','24340','30886','71895',
                          '27382','10060','96269','35383','26137',
                          '12586','56165','91320','50341','35526',
                          '41238','61466','22000','47117','28438',
                          '67221','46231','12158','41508','27093',
                          '36744','78417','29319','92417','58432',
                          '69152','37497','51270','64856','43887',
                          '10761','77359','79192','16986','79262',
                          '31936','37536','39918','13950','31682',
                          '15772','88683','36769','44040','21294',
                          '39713','48282','22871','19955','74167',
                          '80325','13227','53955','43868','62456',
                          '41765','87252','14960','79456','17128',
                          '97038','76060','58229','42394','48017',
                          '62810','69603','80640','91276','28992',
                          '73805','28188','73351','95471','37991',
                          '50029','40686','58179','47996','49722',
                          '39483','36471','17670','70584','34857',
                          '25285','69710','21640','42882','37533',
                          '26808','93102','72818','92527','24828',
                          '19267','45496','16311','96342','80921',
                          '76614','95028','40482','33286','33783',
                          '18918','20207','79969','53991','51295',
                          '32329','43893','58723','52126','24941',
                          '72197','79905','22808','83513','51361',
                          '59737','46512','29665','73295','23126',
                          '63869','95830','13898','77517','68090',
                          '57089','56668','72155','28792','17862',
                          '26867','68766','36682','45295','17837',
                          '65555','12358','28552','24027','36426',
                          '15651','94152','77017','48432','44537',
                          '97497','39935','95793','74020','67465',
                          '13902','26068','70841','29299','55838',
                          '99894','78337','65249','19789','87489',
                          '13086','61194','42276','11039','93963',
                          '27348','74150','29033','66186','64846',
                          '21250','39040','17765','89613','88575',
                          '67616','82025','60360','23660','91068',
                          '57458','55441','13304','67101','23833',
                          '68482','63230','85367','16535','28267',
                          '41755','20825','96955','24239','47535',
                          '49877','10931','33971','31259','47589',
                          '63535','73061','82443','15822','19018',
                          '24835','60505','98759','34403','44503',
                          '42782','40499','44322','29562','49194',
                          '33546','40046','32050','79813','11790',
                          '87852','11518','17556','49390','20922',
                          '36652','44618','82232','18898','20447',
                          '34793','23312','57112','26680','29056',
                          '67467','48291','30756','97915','57682',
                          '36951','27504','80246','23462','17240',
                          '68366','54690','62503','94980','24238',
                          '43349','86982','53708','25618','48243',
                          '70385','10398','62436','57286','41413',
                          '38858','49042','62993','24773','21919',
                          '54311','51123','50401','75408','66765',
                          '23611','42319','13129','23446','48628',
                          '67681','89687','19854','14047')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
