
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '99219','25613','35795','36636','66386','17494',
                          '84576','33356','35420','22091','41319',
                          '22652','38736','36823','62668','50655',
                          '67007','24486','46998','33405','14149',
                          '11679','55460','82506','50897','66241',
                          '31919','82278','43963','75493','45463',
                          '12610','13342','51619','27498','45917',
                          '59487','33843','53045','18000','47632',
                          '54512','79378','56379','63164','43291',
                          '15350','35802','49139','55820','33799',
                          '66034','49287','71853','26581','95539',
                          '34950','80383','36015','30475','31702',
                          '93097','60748','25302','51129','86171',
                          '69266','31011','39569','22324','25248',
                          '15608','42717','46669','74987','75208',
                          '33159','34184','37167','59460','51776',
                          '36872','35184','29788','60992','30679',
                          '20075','84983','29086','36311','16610',
                          '34214','10945','18429','61521','56067',
                          '63429','69487','91639','63435','78021',
                          '91210','61744','92798','75630','74551',
                          '88858','71511','85330','47189','18057',
                          '35835','94391','67613','41533','90600',
                          '77398','48177','56116','39503','38079',
                          '21438','12260','33245','51832','27711',
                          '43046','27840','99177','21725','89025',
                          '22384','96343','76736','49910','85737',
                          '48597','30306','98233','91753','89835',
                          '25299','54903','29417','84175','59445',
                          '91601','95149','39173','51188','59103',
                          '34454','92381','22427','50960','56532',
                          '94915','99000','40819','41863','21500',
                          '55777','64796','59939','83597','34290',
                          '21765','24330','96656','12439','91123',
                          '37115','24184','74708','43907','26084',
                          '61582','62190','61698','11343','17299',
                          '98732','26906','68632','15411','61885',
                          '32336','14591','18584','39573','23267',
                          '42727','43835','49611','80956','27097',
                          '63591','11142','22394','75118','47016',
                          '13857','57544','71110','55742','19802',
                          '66238','69319','40309','71802','26776',
                          '25446','83961','20970','35472','59329',
                          '32979','96912','78589','36547','10617',
                          '42382','84433','82833','40283','64658',
                          '34487','83032','34580','32068','11549',
                          '53827','48758','87004','82139','33806',
                          '73664','26647','91208','30860','53181',
                          '23260','17699','46947','16543','94482',
                          '32855','10905','72084','49155','67112',
                          '11379','23570','89054','45480','55789',
                          '78762','54747','76421','90849','33620',
                          '57517','20937','12104','18756','82670',
                          '86511','21010','37220','49014','94592',
                          '15552','80317','71851','21981','56497',
                          '41521','80484','49218','26522','32383',
                          '15302','47613','39596','28458','18413',
                          '32433','38731','56908','87223','86843',
                          '54250','51970','80330','13468','14825',
                          '85364','88007','13653','42906','59118',
                          '18441','40853','27720','14307','14270',
                          '57040','35284','71754','62156','28878',
                          '84920','64302','61587','10198','29736',
                          '90788','45404','75561','30906','53405',
                          '39694','26412','94117','47018','40209',
                          '12585','29190','47849','36466','83639',
                          '38544','66819','45602','66437','21456',
                          '78233','12209','41631','23844','31875',
                          '69007','94808','81491','31349','60871',
                          '64905','71542','75747','16950','94492',
                          '33727','73623','76037','82585','44555',
                          '72355','35114','92643','70976','45587',
                          '73362','64550','10386','17677','31619',
                          '81699','39022','63569','66930','33954',
                          '92767','58894','29974','12706','49431',
                          '78341','94204','75315','46400','83045',
                          '46644','75613','27748','70149','38178',
                          '47567','20242','82648','46832','19984',
                          '54278','53800','53936','17408','29481',
                          '26701','40433','35864','13008')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
