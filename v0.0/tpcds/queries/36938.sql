
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '81119','55615','32401','69254','87674','32881',
                          '33002','17249','32632','12603','96996',
                          '21292','13166','89974','81276','99179',
                          '65931','31111','92455','57409','57213',
                          '20893','37097','18872','20671','99884',
                          '22180','38046','78660','14845','78100',
                          '70060','22484','27343','64898','54193',
                          '44135','20425','29644','54990','45752',
                          '18824','77430','29717','92726','95064',
                          '38766','30278','74659','96064','54423',
                          '70797','99579','64254','25707','78297',
                          '14964','30564','16596','55086','16676',
                          '88489','68741','36629','28530','19241',
                          '50165','92107','17697','53930','66426',
                          '99045','73840','43746','54213','70418',
                          '77965','54351','45714','49319','58283',
                          '25615','48798','11117','35933','52245',
                          '18033','76278','54552','58498','57862',
                          '47407','15236','17083','79995','11011',
                          '27836','81379','48453','72646','93300',
                          '27650','26861','89989','92796','14248',
                          '15316','65107','33851','82462','79255',
                          '34837','14001','66058','13522','96810',
                          '11262','23093','26048','99150','68798',
                          '41626','76616','61265','22014','57629',
                          '17213','86827','78765','18608','39468',
                          '11395','28096','58599','81154','30233',
                          '28086','66065','29119','73333','51203',
                          '73516','22156','99676','39863','39159',
                          '72844','23891','50810','11123','35899',
                          '60949','18743','46735','50018','71669',
                          '36087','96315','84686','17951','83032',
                          '81854','26204','29153','20970','36786',
                          '61930','90101','80920','92759','13833',
                          '96950','17017','24154','71441','39385',
                          '79578','10518','38430','27746','87111',
                          '45826','75509','29065','67597','50003',
                          '62413','19893','43114','96700','49316',
                          '81436','93584','18171','46400','41983',
                          '50202','51186','38269','77452','10901',
                          '26122','61551','25970','32908','87838',
                          '97502','57997','96618','63978','27254',
                          '89892','60255','23572','56603','55348',
                          '10497','51109','21879','20356','47930',
                          '92720','67339','90954','15082','65123',
                          '15147','23005','96931','66618','58238',
                          '34556','42989','50277','71430','14611',
                          '77066','27697','60782','45882','66758',
                          '82334','27632','52689','49067','52126',
                          '59526','64045','33197','13207','25890',
                          '80612','12602','42270','86570','18392',
                          '78625','93059','51775','72037','88548',
                          '68630','37011','22531','89991','54742',
                          '39380','19596','71484','29757','45761',
                          '86154','41272','11185','61385','13655',
                          '24905','55462','80816','80142','67458',
                          '55803','72490','94680','17084','13276',
                          '76780','10758','61386','96930','84718',
                          '98855','92548','68903','21053','22417',
                          '20740','67659','32419','61454','24692',
                          '71763','11040','17546','79877','25097',
                          '67404','49421','79058','60685','11973',
                          '49574','34208','12380','26956','75187',
                          '11078','68102','76421','86278','61441',
                          '94396','43071','20269','78983','37305',
                          '17658','83156','26735','62921','60645',
                          '90744','76882','56410','10072','10451',
                          '29745','16129','38221','14826','99094',
                          '11194','97781','49317','95201','92123',
                          '60039','26541','14917','12235','36228',
                          '95261','32602','37475','62725','34055',
                          '23409','33932','45308','73801','15756',
                          '76252','37670','24556','60487','25141',
                          '30187','13872','97055','94120','65437',
                          '10575','40992','45131','98297','33596',
                          '99249','21759','53620','93820','65122',
                          '77782','46252','97498','77472','65994',
                          '39051','92015','22160','46706','25310',
                          '91105','27180','99251','94514','16484',
                          '75867','69794','78239','43561')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
