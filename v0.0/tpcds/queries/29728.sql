
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '77847','89301','20622','38703','63980','71984',
                          '94604','26348','68973','18438','59072',
                          '42387','55452','48016','34021','32716',
                          '87233','90241','53016','37525','38937',
                          '34047','14818','46576','25161','77330',
                          '35764','47935','28249','60868','28190',
                          '35792','26877','19331','17274','33420',
                          '23322','49234','14691','67549','77524',
                          '26381','60435','21783','65783','52774',
                          '36241','36417','62028','42193','57649',
                          '16190','38290','27464','37470','49073',
                          '24730','23843','37647','24861','81806',
                          '24500','64068','34768','59678','43937',
                          '76974','21605','22023','22673','20232',
                          '13756','31697','30224','99349','75870',
                          '67050','70907','73261','24348','83552',
                          '44899','34540','13875','95364','98008',
                          '47948','10884','40491','59220','96320',
                          '98621','46996','81601','29742','14260',
                          '44395','43129','58889','10511','58646',
                          '81513','38699','94431','53706','61432',
                          '25361','67925','61589','21207','79630',
                          '60108','16317','81329','59420','66897',
                          '83211','89408','38811','36341','67957',
                          '58134','75453','33688','21695','56458',
                          '35833','22761','24285','41498','16634',
                          '62526','27159','21408','37753','66193',
                          '49439','81492','25990','51830','70244',
                          '25234','35223','77241','13306','40136',
                          '96500','50907','28694','58976','87939',
                          '11934','10807','47126','84906','59124',
                          '39249','79304','60053','76220','48306',
                          '54045','11343','74857','61059','59941',
                          '44132','69808','34830','78012','33115',
                          '24145','41253','66036','45898','49806',
                          '32076','15086','35173','53644','20678',
                          '27751','65220','18865','49591','63831',
                          '82712','55382','45703','25745','29497',
                          '54862','10828','30787','78289','12883',
                          '95072','98484','83862','25436','35853',
                          '91881','83841','93298','41328','50793',
                          '15552','35338','80241','95858','98816',
                          '25603','33248','73999','59762','75511',
                          '73676','65199','59000','99185','46905',
                          '77982','89813','70523','33365','49985',
                          '22777','44589','27273','49789','57822',
                          '52617','93927','70320','88343','22016',
                          '66659','20295','43449','69032','91004',
                          '12369','57165','18429','93276','63575',
                          '75999','97761','11227','77806','10749',
                          '19140','38881','13725','40247','15621',
                          '24657','48019','78969','63598','95043',
                          '86026','48022','85260','62380','50030',
                          '63740','85147','63797','32280','29601',
                          '73433','42141','61069','16815','72889',
                          '96707','74731','13187','51548','43624',
                          '25830','70173','27301','36524','87224',
                          '37472','16620','63869','55173','77692',
                          '61415','72731','64264','15423','17620',
                          '32563','64336','18415','65724','58784',
                          '20181','51975','72295','43048','33659',
                          '43240','28895','24862','13598','60475',
                          '85848','46064','67756','19506','24077',
                          '77519','17075','63194','29408','92947',
                          '79561','50379','99594','34912','99035',
                          '83853','19771','86287','34740','90509',
                          '14012','68206','68233','15671','20289',
                          '52392','99579','61266','60586','84027',
                          '52001','85826','48316','49746','45120',
                          '18553','89721','10125','79276','23051',
                          '11357','77406','73562','76149','31677',
                          '83438','19711','22480','94323','28160',
                          '24015','50071','86806','32370','44275',
                          '30940','28224','89351','59399','33112',
                          '38745','82932','41013','19443','30770',
                          '69389','13911','24743','67115','22462',
                          '69220','79909','37624','52073','11897',
                          '75781','18214','48054','14095','77446',
                          '78892','23240','25979','75491','49929',
                          '88159','33937','15399','33163')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
