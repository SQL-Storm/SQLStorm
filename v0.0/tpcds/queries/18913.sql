
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '62297','58756','75374','82113','88576','26427',
                          '46230','39360','26210','60295','33958',
                          '72126','47635','40172','51522','53287',
                          '22627','33961','31820','91877','87370',
                          '24919','21553','44480','51284','87477',
                          '99962','59215','89315','40980','67120',
                          '97707','33653','79720','37252','20551',
                          '69372','50624','66331','36213','22476',
                          '94647','27795','97356','74272','93362',
                          '27251','48461','50120','36487','68412',
                          '46631','82059','86307','35792','80442',
                          '12010','82761','36191','27340','17963',
                          '47014','80832','70511','32113','28550',
                          '91067','63524','71631','57069','46566',
                          '71192','12514','27402','69528','65468',
                          '21178','79953','44715','22900','50236',
                          '75850','96748','72352','86259','92785',
                          '50900','42151','32569','21656','66875',
                          '63181','79969','44236','44080','58331',
                          '10893','13511','73154','29168','18387',
                          '89201','14351','23678','94794','31101',
                          '68151','51002','32639','45626','86067',
                          '43052','25955','16637','25801','10038',
                          '45872','28830','46080','74531','69872',
                          '20673','65285','46852','83737','59658',
                          '89562','44780','34653','73711','60771',
                          '37875','88810','95437','33094','37026',
                          '47526','74468','56767','66318','33969',
                          '50260','36378','88247','18008','93093',
                          '67540','45789','62120','21423','95889',
                          '26146','31978','80584','20508','58176',
                          '88850','24827','52058','91938','77467',
                          '19899','16582','85779','43486','64084',
                          '66387','39023','28994','63622','10685',
                          '11235','85359','39087','82918','30150',
                          '50823','53123','14473','69760','10577',
                          '11344','89020','13852','59291','28545',
                          '23512','51959','61383','35789','49931',
                          '28558','83841','98356','72331','98922',
                          '10815','29038','41453','76924','64887',
                          '48093','37819','83796','37586','88838',
                          '16958','31840','53256','91029','18691',
                          '18628','44631','18561','11341','44365',
                          '48382','28941','73939','23683','11845',
                          '56672','55551','87476','10145','89705',
                          '96523','30033','19700','13518','38728',
                          '68564','29801','96902','27237','19842',
                          '71774','33561','25559','90461','10334',
                          '90598','99292','27788','66413','81326',
                          '41410','28717','97815','20998','71118',
                          '19510','60739','35786','63939','84902',
                          '43377','20307','23407','88525','86488',
                          '29119','70283','16853','53548','19900',
                          '80340','73881','27579','32626','81046',
                          '15879','55897','54810','24621','54365',
                          '69386','94055','65312','15059','19619',
                          '52821','50420','58056','31213','52610',
                          '98182','15635','42325','34076','14969',
                          '27048','64204','50117','74974','69395',
                          '76424','39015','74473','73501','10538',
                          '26279','68890','88482','29496','10519',
                          '22520','82026','73843','97733','44462',
                          '46991','50000','70543','72873','11310',
                          '14048','47947','69993','17426','85333',
                          '76084','11581','11244','85297','17139',
                          '28504','46534','98707','34690','54309',
                          '76300','11916','39086','14036','52213',
                          '95691','34263','56405','44976','36543',
                          '24123','71297','76713','71725','99255',
                          '56369','79535','94931','31168','83561',
                          '18516','76901','37685','73484','59411',
                          '56249','88678','14300','10443','29467',
                          '56118','84704','16467','51069','13001',
                          '41114','20559','20029','72858','24631',
                          '61167','11272','40443','98370','39478',
                          '47497','22181','25016','23282','70856',
                          '18089','27155','81625','43268','39055',
                          '85363','31743','77216','51819','25550',
                          '56737','45080','61496','38587','33290',
                          '33251','85264','25516','77519')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
