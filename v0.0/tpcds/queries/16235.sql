
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '82732','71337','83391','52383','78488','68468',
                          '83924','41647','88356','21519','73305',
                          '41680','51423','72518','23190','58567',
                          '76368','16127','72924','44266','75252',
                          '13829','97643','52676','51994','59176',
                          '32487','36144','26737','44889','13979',
                          '31894','68861','17872','45390','99799',
                          '62393','70158','71763','47341','57577',
                          '11501','79361','36340','21445','11779',
                          '14801','16020','77007','80175','84942',
                          '84164','10779','13788','45521','79166',
                          '37062','44661','61060','55985','29319',
                          '58610','26659','69029','83992','48932',
                          '60040','38541','24392','16060','55064',
                          '30171','46615','47991','30240','26750',
                          '27378','13554','77435','33577','93268',
                          '68062','24928','70388','20187','83378',
                          '60154','31802','44040','58321','19665',
                          '33470','15856','38929','16501','36636',
                          '74254','14051','15020','10821','73597',
                          '42683','55196','69496','68283','31966',
                          '88475','96147','20833','11110','77793',
                          '24697','62952','20510','50062','10104',
                          '56007','64147','25873','45827','56279',
                          '29343','86283','83743','57192','83186',
                          '38313','46416','25661','18743','15944',
                          '74105','75302','46182','40545','74498',
                          '53521','41589','29552','52928','53704',
                          '46673','73621','29776','11640','98385',
                          '63481','61403','37227','26804','25767',
                          '34820','43534','89738','18441','44258',
                          '47087','82361','46078','17599','68323',
                          '43095','54330','98561','34759','17868',
                          '42598','78145','37320','27343','67034',
                          '17235','46495','60149','92525','65550',
                          '42866','93177','15072','44395','66563',
                          '72881','26064','66755','33649','89316',
                          '61480','93424','92735','45314','43263',
                          '10339','24028','65465','49485','55965',
                          '60680','54723','57920','67932','56015',
                          '27166','66183','73601','34895','55796',
                          '15579','99373','18128','44175','38307',
                          '99002','77922','16994','34712','42467',
                          '45106','47948','49748','23668','18478',
                          '54370','16039','39837','11166','64277',
                          '43072','62267','69994','71136','20818',
                          '68345','75661','81982','33984','80178',
                          '36320','69342','24653','62062','63608',
                          '57653','16036','58102','69099','20327',
                          '73584','46872','42176','15850','12534',
                          '93710','36938','55372','81614','54427',
                          '71094','73625','37700','72323','84848',
                          '50182','57973','64189','23354','44912',
                          '49753','44288','78365','48108','42789',
                          '93720','48774','20500','30455','17078',
                          '93534','13299','59650','69288','13717',
                          '31498','86751','41765','76188','80841',
                          '23630','62517','37188','16750','91862',
                          '74542','11937','17960','29137','60876',
                          '56125','72525','29639','17633','69253',
                          '43602','88531','85601','94968','41069',
                          '83509','75002','60632','66317','61142',
                          '52400','84274','18939','18182','40130',
                          '32861','68170','99630','76350','51682',
                          '81499','58591','67755','52338','31180',
                          '27581','73850','62231','65945','42862',
                          '69940','99465','47707','97251','82936',
                          '94332','75764','15995','75759','50400',
                          '54220','10848','97785','97772','55707',
                          '22777','79462','71375','28511','14494',
                          '82439','66790','88595','59672','41883',
                          '84550','83960','83754','18544','73042',
                          '78972','67622','82685','48542','66855',
                          '72495','10324','95814','37953','21344',
                          '28394','56512','12120','71815','58914',
                          '84099','63607','52621','36825','42610',
                          '62077','81898','44169','24781','12768',
                          '30652','17587','11194','39557','53418',
                          '99917','75343','25210','39095','34708',
                          '32416','85574','19830','71608')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
