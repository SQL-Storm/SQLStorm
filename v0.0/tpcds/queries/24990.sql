
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '21231','53055','33731','87449','13113','86609',
                          '14953','81214','12481','63083','51364',
                          '85637','69465','48690','86766','26036',
                          '62736','19409','60795','25249','59553',
                          '62291','15539','75019','62450','43928',
                          '49782','60634','41258','33695','91043',
                          '37532','11016','29339','96685','60867',
                          '22872','32577','95061','14675','42267',
                          '63845','10869','41075','80964','80636',
                          '35253','73305','11658','33702','54595',
                          '26369','55233','18634','35787','29598',
                          '52573','50653','75860','14274','24039',
                          '10234','16276','30573','66506','50739',
                          '42272','58475','71200','21969','79997',
                          '67281','26388','81480','22290','83570',
                          '76562','21796','76953','65174','17867',
                          '62343','42178','12942','79476','26736',
                          '45645','22048','57114','70625','83823',
                          '14327','29519','89292','87528','10709',
                          '27293','28279','57832','25577','71523',
                          '27140','48753','76136','38767','63348',
                          '81833','72186','94045','21900','29563',
                          '89383','29418','88980','63690','63794',
                          '12071','38816','23777','95927','10101',
                          '58316','56737','20864','11937','26298',
                          '41716','20616','87824','92540','43878',
                          '42309','67429','28835','46648','16160',
                          '10692','17870','56122','17106','12919',
                          '40762','90006','76481','85929','44117',
                          '44540','54976','11634','15155','22174',
                          '73926','58361','43244','23032','22711',
                          '61687','30987','11454','64834','97955',
                          '18794','21820','94965','33828','31583',
                          '78977','29154','54361','16413','69483',
                          '82257','12382','51684','73725','96950',
                          '44262','31549','44837','13698','31831',
                          '27021','51841','62041','49721','39065',
                          '64156','15101','77876','43467','54054',
                          '81395','87137','34118','98919','13625',
                          '64694','48468','20458','44587','10142',
                          '57752','28482','32428','99354','53750',
                          '17566','21692','97241','33312','44946',
                          '80215','41068','74227','22843','28527',
                          '36978','14240','10439','46135','72777',
                          '42226','64450','27066','72097','72751',
                          '54879','91048','24755','78674','50317',
                          '17700','27709','43627','27995','39012',
                          '72684','82298','81764','19481','95411',
                          '16308','51454','16694','34173','34527',
                          '89954','31016','69589','28927','75114',
                          '32880','19424','21683','69424','81518',
                          '25889','13581','27441','95618','59892',
                          '25140','12164','90544','10527','46484',
                          '89567','75004','22073','10785','68605',
                          '69335','13250','52944','36180','13239',
                          '19169','14571','85146','21452','78823',
                          '62201','66243','13699','40264','12125',
                          '78336','27642','84015','44250','20880',
                          '55386','23007','87602','72268','28982',
                          '51800','67958','71979','72451','32902',
                          '19323','82079','90795','29492','14872',
                          '24841','86629','98373','82226','76687',
                          '28312','77031','17600','16759','68834',
                          '56192','74613','28704','62085','26277',
                          '63196','16417','87154','12948','54139',
                          '86361','32962','13231','26798','15842',
                          '70076','90853','19053','15166','80067',
                          '26821','86901','72165','43554','48079',
                          '16187','50594','16709','78109','53376',
                          '14563','99172','82952','50311','49661',
                          '14554','46492','22880','54652','63797',
                          '97259','52950','51003','19717','33931',
                          '18095','56143','63968','25946','16825',
                          '90816','25772','26841','14948','17946',
                          '79733','78222','26312','77225','78036',
                          '36868','70098','32622','68488','22807',
                          '32633','12879','74390','66784','57037',
                          '78570','96081','52864','12820','51301',
                          '44953','53711','62364','56855','98203',
                          '30962','31062','51169','81410')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
