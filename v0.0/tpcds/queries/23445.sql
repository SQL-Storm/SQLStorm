
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '43452','90531','57516','10288','57579','53488',
                          '44876','19390','35778','30664','21229',
                          '24368','50461','69557','91766','24026',
                          '42109','16102','62298','55044','49754',
                          '24558','59316','29963','46974','31244',
                          '81078','32608','38814','43237','53779',
                          '18008','41210','79727','75211','23388',
                          '63932','34212','71580','97303','26816',
                          '63284','37261','80634','67396','59264',
                          '15901','57300','44547','97119','71676',
                          '57213','86201','49741','59834','41810',
                          '63861','14135','65116','88881','33940',
                          '47255','87536','72413','51944','29120',
                          '40848','47895','57004','75897','15900',
                          '41791','60354','88807','96734','12141',
                          '80705','63767','32372','27049','90218',
                          '91042','12208','30661','24024','61183',
                          '38961','89596','37199','47461','64155',
                          '66990','76499','25221','20298','48112',
                          '30238','16953','38399','22728','63308',
                          '39845','98693','31804','35434','36472',
                          '47525','62648','17203','64272','49152',
                          '10419','50690','49183','13078','23864',
                          '10137','13685','51971','70373','50767',
                          '14049','25656','41255','39326','10276',
                          '88752','97954','25891','10859','79461',
                          '97465','68155','71696','10076','16218',
                          '28930','25999','15957','13652','93907',
                          '92855','62661','48508','74314','82769',
                          '61872','18124','14639','52180','60769',
                          '42783','24461','24060','28798','97625',
                          '18554','99770','66423','48372','77254',
                          '84058','37441','54375','57332','82257',
                          '31393','12130','51112','36162','49933',
                          '58337','45387','66909','49393','82877',
                          '15680','85626','76701','29242','93454',
                          '38773','73389','43515','67441','77358',
                          '49758','54802','68949','28140','60184',
                          '11512','52435','15203','19515','94742',
                          '60822','59646','30736','11035','94706',
                          '23483','25668','26803','73306','18180',
                          '16550','58485','53047','73155','74083',
                          '49880','10957','70369','75076','80319',
                          '30053','36259','48022','23846','22007',
                          '28243','44883','13908','21302','42711',
                          '61899','37010','73073','31657','23086',
                          '15929','42220','20143','61564','76529',
                          '63397','52694','62075','12681','20592',
                          '29903','77718','66576','12381','72817',
                          '47547','41588','58508','78378','35617',
                          '59566','84609','43801','16343','20291',
                          '19145','84549','32032','66338','38913',
                          '15058','78180','91645','85435','42781',
                          '31283','49681','62880','54077','71107',
                          '32691','78626','61567','55654','32687',
                          '86157','70747','43869','28304','46927',
                          '82879','21258','15300','20107','96893',
                          '28233','42543','52858','22427','12691',
                          '21982','31324','59106','40309','14202',
                          '18495','35272','85108','73325','97745',
                          '10719','48401','70645','14597','87421',
                          '97145','75587','30025','90962','57938',
                          '11783','80021','78069','88565','17910',
                          '25448','90337','20195','57066','62277',
                          '41178','57119','51040','61111','54237',
                          '14091','55376','39676','82596','28556',
                          '28807','15702','50439','39066','88171',
                          '50583','71503','70563','74424','95820',
                          '61909','73922','85116','78137','99223',
                          '34862','37059','77537','33875','94154',
                          '46536','85195','50356','12656','94447',
                          '46227','18277','57568','37323','49813',
                          '63468','42434','40839','27453','42073',
                          '71595','84526','73895','95623','37557',
                          '26014','23669','72913','15065','61911',
                          '46025','85976','23291','98577','16893',
                          '91713','24065','12454','95122','19329',
                          '33426','76872','12222','37847','52583',
                          '15777','27749','10787','22257','32276',
                          '84989','10985','24704','71485')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
