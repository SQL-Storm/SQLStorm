
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '16554','31742','48399','43474','68590','22832',
                          '82082','12938','68751','44739','98539',
                          '78973','37213','19357','72707','68549',
                          '65506','44395','70823','38214','56511',
                          '99395','70786','20926','58670','60559',
                          '10574','33435','74487','88734','42824',
                          '54182','42787','56897','15683','19655',
                          '36525','51255','41502','10897','49165',
                          '61114','50851','72588','20070','93162',
                          '32103','65971','11022','44581','89892',
                          '66831','34422','53689','61725','13465',
                          '43168','43424','39373','81331','21263',
                          '35567','19075','41946','42689','79332',
                          '37112','25771','49728','14663','56201',
                          '72603','26792','12580','12684','27441',
                          '52168','21248','56688','56227','76163',
                          '20216','67726','12268','58923','44999',
                          '60656','98367','92638','99822','96404',
                          '34924','20647','26552','34488','76572',
                          '79153','37001','74712','65461','12346',
                          '79615','93907','89954','54172','68306',
                          '79969','25430','32415','99733','10339',
                          '50289','67114','68605','50574','70258',
                          '12290','44799','49907','88329','77870',
                          '89871','91355','56993','70073','48023',
                          '68081','53156','46709','94521','84555',
                          '12400','33028','15260','94990','23683',
                          '55225','68266','70138','62490','19093',
                          '52355','11321','26261','64062','39860',
                          '19627','63624','41279','14337','14328',
                          '55483','45460','62795','32570','63166',
                          '16979','64649','96391','18690','48154',
                          '59313','30237','74114','69178','30403',
                          '34573','72505','36418','82343','54089',
                          '14545','57715','48822','87117','15838',
                          '13704','98523','34452','28075','89827',
                          '10591','11264','71895','23747','17031',
                          '14998','44861','31866','30946','19107',
                          '54473','43334','18139','57050','14085',
                          '41899','30390','26581','69971','57855',
                          '50818','32513','84065','70403','50090',
                          '11776','37988','28743','89492','36535',
                          '21997','16364','11050','75082','45619',
                          '33634','56456','39962','34211','71506',
                          '63013','14895','31747','60945','71710',
                          '38087','45241','53824','93748','86603',
                          '26969','14511','50435','38406','14155',
                          '85189','51084','85230','27680','97331',
                          '41937','65592','45061','23647','89093',
                          '44399','71699','80115','57071','59706',
                          '38261','86747','94784','31631','98839',
                          '37677','50292','81291','96246','57707',
                          '80954','45087','35471','17289','52331',
                          '51685','10805','52767','22012','44101',
                          '74845','35563','46047','35394','64515',
                          '10157','50274','54718','63373','26253',
                          '62234','32533','72147','43181','45035',
                          '61894','35693','79257','94758','44296',
                          '58604','25581','50961','51476','29217',
                          '14952','38842','43117','79732','48619',
                          '12995','67903','64600','49600','59609',
                          '78213','79071','89252','33237','36898',
                          '41265','44563','12334','42922','87444',
                          '73347','51337','68139','47785','18483',
                          '51822','44536','55006','85482','23623',
                          '32507','54021','72042','43337','86272',
                          '53364','21405','85089','12033','81411',
                          '42821','59295','27257','26688','45052',
                          '43451','27925','30456','18445','61783',
                          '60851','43121','75456','33221','46386',
                          '66872','13569','27018','42074','86397',
                          '56546','42440','85357','26033','48157',
                          '33524','74573','64938','23595','44432',
                          '31239','80324','94693','65542','18220',
                          '76654','20169','93546','74597','36775',
                          '26726','32768','84649','22573','38754',
                          '56092','54664','11129','86856','82504',
                          '73603','31314','52778','17380','12335',
                          '83422','18271','19554','82153','90961',
                          '31847','74113','17486','31810')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
