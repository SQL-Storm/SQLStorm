
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '33899','10414','32643','29395','83250','40650',
                          '32922','24897','25515','73887','49987',
                          '86375','37323','14269','16116','67435',
                          '98300','62643','14519','32558','48747',
                          '92041','81255','32930','31935','58483',
                          '80466','28238','85337','32969','16071',
                          '32590','23464','12550','82620','57512',
                          '47343','23904','23272','24146','22025',
                          '27832','92680','40468','10076','27070',
                          '82307','11860','69470','60984','96653',
                          '53546','22868','39438','23723','32795',
                          '46189','11665','26154','16366','41217',
                          '69078','65124','20217','44436','39750',
                          '18491','48393','19102','30301','32738',
                          '77322','34765','36391','16727','90787',
                          '45140','61355','17430','50449','33732',
                          '30473','41230','18634','35725','86728',
                          '27290','38922','59529','21383','42966',
                          '94265','78793','62177','58173','27135',
                          '82474','35883','33067','68189','18386',
                          '29254','19137','26815','44843','19347',
                          '31093','38101','50044','16282','10224',
                          '37137','55987','29463','83917','27067',
                          '67744','90871','63715','70902','58678',
                          '92738','27103','90832','46140','94997',
                          '94310','65660','70023','91012','17809',
                          '16613','10476','74813','48720','44988',
                          '32382','69191','94945','22493','43307',
                          '24422','73566','71930','60342','98617',
                          '23642','73165','88331','45302','73458',
                          '49042','45222','50043','48927','39475',
                          '30292','29990','29580','44582','10793',
                          '91655','80316','40345','63069','39235',
                          '28200','35658','94174','86149','98256',
                          '70137','34694','80002','48469','24675',
                          '98216','67672','21010','14840','90236',
                          '57209','33210','26930','21482','36937',
                          '15088','35155','65785','57436','78494',
                          '93482','87476','78792','89581','67430',
                          '37864','27179','33778','64665','76196',
                          '23496','84177','11847','31496','92353',
                          '21732','11789','23851','24213','81902',
                          '57156','74461','68819','93455','65639',
                          '31909','47330','81730','33546','62075',
                          '62406','50545','17884','29674','47074',
                          '95057','21242','61834','61547','40731',
                          '68907','43623','77859','58948','40702',
                          '78330','62225','37282','78909','47294',
                          '78282','33401','78983','23715','50561',
                          '29455','11971','40000','64356','52841',
                          '86879','82325','69024','76468','34792',
                          '45488','87918','50031','26004','44168',
                          '40446','32544','16822','99389','69080',
                          '96106','97495','63774','83297','21663',
                          '10176','30041','14799','35234','22041',
                          '48626','60994','14572','46524','96803',
                          '22982','20821','82551','41572','63680',
                          '70874','32294','10668','25182','18280',
                          '64986','61096','69788','41962','40777',
                          '10657','58666','51033','21464','45119',
                          '23269','25553','17366','37044','55444',
                          '22730','36562','76104','68206','22901',
                          '44961','88488','33819','27383','17419',
                          '38121','17742','70605','13287','50448',
                          '90715','19688','90925','83684','88902',
                          '90328','64217','19006','85835','41055',
                          '79574','65492','15711','60061','53537',
                          '28597','12928','69260','35107','72686',
                          '46987','95403','74675','57089','74165',
                          '49736','16299','67349','14496','15191',
                          '15220','93376','34897','32623','94392',
                          '33963','74741','13927','39725','22741',
                          '29396','92623','16050','44601','28759',
                          '54914','88926','38759','12939','23451',
                          '21595','56404','12977','61970','52327',
                          '41390','47978','78068','13563','58674',
                          '17021','51252','28702','46587','27242',
                          '80778','43941','10844','84639','26324',
                          '56620','34579','47024','59226','64388',
                          '18051','51170','36452','63975')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
