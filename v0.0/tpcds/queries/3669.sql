
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '13956','63595','35782','63056','64213','97115',
                          '96442','90732','89937','28570','87619',
                          '45130','77634','50850','73004','31249',
                          '65662','30981','45839','39531','54508',
                          '51857','48271','67812','13556','20086',
                          '89267','78473','34535','13393','32517',
                          '90527','70025','18266','52514','22792',
                          '27354','54836','75975','95945','26380',
                          '67504','16838','38088','36514','18242',
                          '94973','52948','43515','86172','50357',
                          '35692','73039','13145','29810','95767',
                          '36632','70787','50802','40400','18608',
                          '29180','74286','95171','39078','87947',
                          '57711','93436','68607','64096','80030',
                          '62945','50403','65410','35900','42233',
                          '13753','92608','85656','65057','92382',
                          '40362','15142','29770','57980','26943',
                          '44811','19714','35537','26218','25016',
                          '98236','37157','26336','67082','39400',
                          '84420','20556','55779','57355','44164',
                          '42543','67361','53118','32316','15316',
                          '23024','98785','25070','21587','49144',
                          '23358','82407','70041','83267','29186',
                          '28492','64081','75829','61912','35436',
                          '24507','61835','16530','75744','24395',
                          '90425','26827','87295','52229','22857',
                          '68592','88789','79845','90133','36474',
                          '97010','36053','66662','77801','34747',
                          '38166','82397','21819','19877','12269',
                          '13510','10018','63563','57704','36604',
                          '33751','22138','17953','60003','24629',
                          '56487','80709','20987','50945','73541',
                          '31802','63520','48240','84903','86851',
                          '88102','90799','30771','24290','83439',
                          '24784','81403','21539','62301','50369',
                          '83681','86818','21257','39882','49251',
                          '49095','23832','80410','68772','30110',
                          '25671','54198','97233','35951','26578',
                          '68970','99095','89691','99398','23600',
                          '15546','18988','17943','63992','72783',
                          '97069','33484','11679','98851','84133',
                          '97357','92104','93945','87906','21178',
                          '59794','34293','13912','23068','23881',
                          '87185','76116','78252','65178','19362',
                          '39002','75059','63908','27474','27849',
                          '65277','89442','99873','74592','76711',
                          '26638','28286','78122','50622','11673',
                          '40994','41146','15830','61582','28419',
                          '22837','55524','46909','35033','25022',
                          '70274','81535','60723','48620','83978',
                          '81479','31397','24530','70641','73923',
                          '26599','12723','71918','15962','35108',
                          '92377','84317','24157','76103','94700',
                          '26622','16624','37019','83044','70722',
                          '26265','72779','87269','22344','59814',
                          '89968','67228','20268','14037','64593',
                          '14765','35101','87490','64955','86949',
                          '68412','65523','37999','45595','48288',
                          '30949','36143','46004','44448','47954',
                          '67934','15176','34124','13938','45080',
                          '92586','16015','65663','27706','14349',
                          '29737','25573','36124','69799','76623',
                          '39196','35743','89795','79638','32406',
                          '38069','50828','63163','23333','68292',
                          '45741','80373','26180','28724','13813',
                          '65667','43014','86248','70435','77533',
                          '75929','64881','36826','19034','69355',
                          '67410','14610','51969','19560','13799',
                          '16511','56509','14746','35072','48744',
                          '31328','67502','30807','98365','73053',
                          '81310','42883','82659','24263','11108',
                          '33595','13547','10412','74878','68058',
                          '36455','59082','93509','72013','69979',
                          '19780','27554','48911','29338','44881',
                          '11076','31352','21799','24313','53595',
                          '12115','48797','45313','70352','89564',
                          '85881','67342','81452','16204','10741',
                          '18436','36832','49814','38390','53580',
                          '57334','54459','64961','27039','78110',
                          '35243','67396','57225','44933')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
