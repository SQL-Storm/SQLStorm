
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '30362','76669','62150','58161','15194','50341',
                          '29978','52995','62523','47612','69620',
                          '65889','10624','24264','73580','82598',
                          '26927','45279','36767','49533','56686',
                          '30740','43154','51659','57203','92692',
                          '54005','49017','81421','85544','24228',
                          '71694','81329','96437','16492','32384',
                          '48357','52647','53620','20161','67657',
                          '93322','56476','18421','99984','99333',
                          '27675','27185','48210','26181','92960',
                          '28210','54444','81144','20855','23486',
                          '57282','48425','94064','16115','11190',
                          '59374','81471','97727','49179','57584',
                          '12744','95628','67390','20873','39364',
                          '76053','39720','60632','47693','10758',
                          '69552','43189','38868','57583','44389',
                          '17621','19670','83159','44601','25424',
                          '22781','75269','89034','35349','85881',
                          '15374','50742','24452','54404','58098',
                          '31892','55107','82617','77270','45501',
                          '26798','52126','66588','18737','19447',
                          '91798','66784','52901','14151','11877',
                          '61452','23838','43405','75297','74804',
                          '66051','63557','12238','85209','17808',
                          '24627','10159','78319','15550','38732',
                          '52356','17626','79260','74273','78816',
                          '44773','37395','23755','29349','72646',
                          '13455','63763','15002','18998','19891',
                          '44664','44391','61706','83829','54092',
                          '13619','18109','55221','77520','49306',
                          '38900','13541','73349','18589','30741',
                          '27153','11017','77664','54683','63432',
                          '70639','95938','34815','47305','10397',
                          '22465','22695','91027','78053','40380',
                          '75126','52054','31912','93870','40441',
                          '26638','34498','88481','85252','42238',
                          '96251','14673','77852','87858','13459',
                          '93029','84734','17836','56276','14207',
                          '19223','68734','18200','47372','65842',
                          '16022','23968','86071','19839','87780',
                          '33921','55318','83636','89179','26574',
                          '25335','97566','17476','91258','41327',
                          '16020','67717','31422','42335','28479',
                          '96582','68621','46292','73334','63137',
                          '26295','47388','14602','44910','13478',
                          '19288','18033','50062','52253','31565',
                          '83610','13183','92293','57953','39093',
                          '84731','47998','21995','90557','81742',
                          '50577','28647','60219','71913','47094',
                          '80790','24946','43809','36063','37266',
                          '94306','74871','30656','24570','14483',
                          '20840','73954','10984','21589','30629',
                          '57141','87581','43169','55028','54383',
                          '38432','57427','51763','95675','25001',
                          '61440','43145','62062','35806','46287',
                          '79456','45855','72802','15866','26511',
                          '91051','52958','81605','48297','36394',
                          '21602','20614','68788','13892','27333',
                          '65015','30831','28973','16956','92703',
                          '57211','58896','95979','47921','23307',
                          '12175','58148','11071','18835','13115',
                          '32907','71660','62956','36496','66997',
                          '70804','58493','86575','84604','36219',
                          '15649','76717','20917','55702','47951',
                          '75798','29207','21823','37924','59843',
                          '73433','11801','95587','43797','20770',
                          '22960','58994','14155','32698','51414',
                          '11036','81894','37250','68736','76107',
                          '67642','53116','13331','19555','58578',
                          '38621','13072','89077','86562','58818',
                          '35801','14755','75659','62316','75284',
                          '95043','63798','62340','36665','36056',
                          '44258','60664','78327','62326','20432',
                          '67126','11409','31106','56689','17247',
                          '31584','10429','85277','56082','63035',
                          '83014','97866','71487','99035','42787',
                          '53540','63224','71749','52753','42598',
                          '63247','48882','33382','22558','51767',
                          '54895','80797','85904','96228','81896',
                          '61088','75995','23372','40360')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
