
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '20284','53543','25854','68500','65767','54104',
                          '91008','88742','21195','72863','80471',
                          '39622','97170','47561','13171','59163',
                          '36096','57537','12657','15354','14670',
                          '15491','53674','16522','32188','71107',
                          '57103','66844','21482','12794','46059',
                          '16150','11848','81310','25926','62118',
                          '44392','35947','28625','45886','28730',
                          '82582','12888','36651','41378','88719',
                          '26404','99305','37544','91870','23737',
                          '89677','25893','87347','57364','11430',
                          '72765','58272','89589','74427','12334',
                          '74483','24320','92615','91972','19785',
                          '18857','20535','76536','15104','11276',
                          '95400','79904','82486','61797','49591',
                          '60148','57163','20162','50896','87407',
                          '11297','75613','55880','49347','41953',
                          '78077','86077','25618','12084','64451',
                          '85045','23021','84806','38031','27275',
                          '10710','51590','17877','42506','62948',
                          '18565','32260','28761','30050','22026',
                          '31416','28237','36901','59751','97468',
                          '79984','43518','30016','84178','33715',
                          '74683','93905','95326','35863','16563',
                          '96123','25038','92041','35770','17819',
                          '24507','69672','40530','69650','22920',
                          '65047','25430','42355','41167','98146',
                          '30012','84564','66894','78216','62739',
                          '91510','85999','78238','43356','28017',
                          '53615','44471','37165','29080','27554',
                          '87996','57166','66197','24847','78998',
                          '62600','15822','24119','40840','13235',
                          '82303','17659','98914','85632','57332',
                          '24619','17953','68334','53090','98147',
                          '28311','88731','92691','31125','67672',
                          '28884','68473','75379','12630','46978',
                          '20441','83524','79429','25167','45014',
                          '67611','87222','49595','22916','58934',
                          '94156','37411','92883','11389','98564',
                          '20094','33811','49785','94205','76541',
                          '50135','13354','14562','86664','71818',
                          '19877','59386','74273','15283','40468',
                          '50312','10214','24530','76035','34315',
                          '95787','67330','23488','23347','44719',
                          '53207','10766','63359','14035','23357',
                          '92707','62869','49701','40024','60494',
                          '13824','63691','62023','16901','96300',
                          '43321','32555','87118','62910','32383',
                          '62234','15069','32069','27626','13898',
                          '43528','51305','93824','25822','16500',
                          '63997','21784','73662','15615','51389',
                          '85548','88730','88532','43892','98094',
                          '36947','60788','27650','20151','62329',
                          '59049','22667','50562','16180','22200',
                          '26948','26026','72564','48098','58351',
                          '17526','32058','74614','82401','68411',
                          '63512','23274','99666','26992','92255',
                          '14783','51521','39074','57411','92201',
                          '80113','62990','31729','41681','96780',
                          '17494','87843','44348','45797','39777',
                          '65660','13040','40092','44570','63217',
                          '12813','76359','29469','21907','26329',
                          '87166','14208','35739','32550','42057',
                          '84742','41311','10862','25226','35556',
                          '33987','29372','32898','44925','30064',
                          '58964','81484','73158','25792','47917',
                          '46416','32659','72852','57712','29557',
                          '12889','67188','20191','24891','90309',
                          '75368','47634','61090','87252','53376',
                          '68544','12656','48285','50298','17121',
                          '88130','47156','56931','35532','54482',
                          '73302','70732','10494','82895','29705',
                          '72823','11818','14549','10326','44383',
                          '32253','23089','11893','51220','12357',
                          '78871','19425','17657','12781','32597',
                          '48825','68861','41304','22704','42659',
                          '51082','13776','20820','72548','27124',
                          '77928','86071','70487','67424','98567',
                          '63006','82871','44054','27481','29860',
                          '27632','49948','81386','47269')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
