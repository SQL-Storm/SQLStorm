
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '81780','36487','32205','74321','36451','44343',
                          '16607','44517','77527','66245','51511',
                          '39270','45935','75033','58080','76821',
                          '11130','28231','74423','68944','37443',
                          '81516','19121','32421','95838','49201',
                          '50236','65152','14069','19201','61724',
                          '11929','27194','36637','30721','99856',
                          '30425','71641','91153','14147','18979',
                          '75150','73039','38084','59596','16000',
                          '23273','22334','18459','80880','47107',
                          '84040','75200','11100','36358','78605',
                          '73296','62342','82884','66548','37359',
                          '72805','60746','27645','27569','46991',
                          '57993','69618','85003','79206','57051',
                          '94506','18679','37893','57739','47355',
                          '72854','15280','28943','46977','24404',
                          '23129','83034','51892','60464','95188',
                          '82883','98586','89096','13059','19873',
                          '20774','39750','29806','14628','45744',
                          '82502','51258','63619','69094','32961',
                          '67685','83537','35297','93442','64035',
                          '45945','35952','54161','81647','58108',
                          '68292','93977','12329','94628','68819',
                          '53629','94745','79503','41691','36345',
                          '87629','27752','17487','24746','26000',
                          '41787','95127','16760','11429','91833',
                          '40886','27925','44767','37108','69030',
                          '75745','16333','13958','45486','21616',
                          '42052','18347','53953','35258','18751',
                          '78970','84783','17459','61431','89005',
                          '81125','45059','85237','16875','14692',
                          '98720','12768','43095','15060','97659',
                          '45926','11321','61789','99030','75446',
                          '65304','21922','23110','23544','76164',
                          '24334','53409','52230','35392','14898',
                          '58269','39587','35030','57070','36459',
                          '32885','28526','33148','59755','85661',
                          '26576','57633','67419','79216','27482',
                          '78417','86014','74910','55262','34122',
                          '10828','27232','46347','47197','10152',
                          '95797','52107','44261','14891','93709',
                          '81289','95492','87245','33963','62429',
                          '75363','83585','29427','16625','21426',
                          '83608','78333','43067','73197','52234',
                          '46239','32456','42977','90027','32301',
                          '51013','26959','56922','41012','64747',
                          '35158','33178','58478','43795','80938',
                          '55176','37498','58783','13401','17769',
                          '91804','51464','47340','29950','26098',
                          '31251','36945','20064','30683','30528',
                          '25679','11796','49846','76537','10371',
                          '13352','34603','38591','17429','51227',
                          '51942','81010','86152','18594','31256',
                          '65125','23168','46240','73079','72537',
                          '11323','53339','55941','29546','82704',
                          '48313','91409','68346','24242','84315',
                          '15228','71458','86988','72652','64392',
                          '23875','13131','86290','76557','70128',
                          '83586','86257','25236','34299','12955',
                          '94497','47056','39964','57490','57309',
                          '41541','25939','27033','33677','53980',
                          '93685','52662','21813','18903','43383',
                          '53644','44942','23399','24093','30738',
                          '49583','86888','59624','83302','19546',
                          '87651','66414','85637','60026','50402',
                          '79733','44225','17835','57571','40150',
                          '17050','34071','43259','18074','80884',
                          '33892','65029','77829','66360','33176',
                          '78438','18034','44637','44145','19725',
                          '72711','24782','34353','63745','93984',
                          '72835','94991','94206','60541','25619',
                          '51045','10022','29942','27743','17570',
                          '51565','37372','99141','60565','42283',
                          '71975','77125','68133','36135','26991',
                          '51209','39703','34208','35930','32332',
                          '35319','49980','45859','40024','94831',
                          '91467','65554','20462','56265','78493',
                          '65830','94484','63847','91752','69991',
                          '29218','27682','98922','30285','60306',
                          '80174','20806','29189','28714')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
