
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '55311','71001','32518','84173','37554','11640',
                          '41668','54110','47499','10784','10967',
                          '22425','41217','45323','24868','22023',
                          '67000','32454','88872','19350','43045',
                          '18448','31391','16641','95802','28570',
                          '52285','81121','68353','45737','62937',
                          '26158','28654','14763','15389','35694',
                          '57157','73698','87834','42705','92376',
                          '19087','56026','70206','77841','20096',
                          '44160','75724','22684','47889','29751',
                          '75896','75825','47322','20695','82023',
                          '46994','60846','57407','69281','99409',
                          '30370','53815','48050','53749','90140',
                          '28154','23691','27980','55685','87428',
                          '21355','65007','14043','49014','45722',
                          '32166','70465','75221','14898','27391',
                          '35810','50959','26864','96676','13766',
                          '63597','85166','27455','98586','91370',
                          '46102','75143','38177','99217','86081',
                          '51386','69993','20523','18776','65816',
                          '94252','67143','28694','35879','15618',
                          '39551','72760','54184','10263','76519',
                          '71313','20768','80408','20210','15258',
                          '48751','43586','47702','18751','30239',
                          '26033','81857','43849','68067','12237',
                          '18580','77771','36524','67623','26258',
                          '25532','25891','99487','57810','56809',
                          '14531','85803','67836','97242','33778',
                          '11307','72622','14116','36724','32525',
                          '83895','62561','13833','16518','69305',
                          '75820','73947','51312','49505','51307',
                          '95750','47380','96146','13806','86047',
                          '33185','53386','13582','23441','75593',
                          '42903','33102','36447','89499','15515',
                          '35397','70954','18354','63236','22597',
                          '54036','62805','70534','17739','32925',
                          '31616','37466','71000','60773','92527',
                          '11148','65375','91101','10086','21994',
                          '99906','64786','48661','51484','37345',
                          '44726','16037','93075','52821','55828',
                          '62710','62253','29042','51547','31494',
                          '97561','57875','36848','12966','15049',
                          '63477','78670','21927','78828','66489',
                          '90017','82841','96170','54293','29922',
                          '32974','57953','18688','27277','12264',
                          '21470','37719','76363','74742','39532',
                          '46118','36628','99042','27164','78730',
                          '22544','24994','89813','10879','88786',
                          '55917','40416','97787','81640','14146',
                          '92067','57752','37704','38837','89380',
                          '77798','57049','86888','89995','27036',
                          '94478','33968','38021','82439','38349',
                          '33227','18405','34472','34999','59763',
                          '87358','81809','10508','32059','16284',
                          '16805','43286','17932','47198','71099',
                          '28037','55752','54259','25840','46290',
                          '10586','43158','37665','38986','80129',
                          '71402','63296','58422','87102','81918',
                          '52981','60932','72611','43153','25858',
                          '61840','23683','10441','85532','18022',
                          '12853','13621','14125','49015','61018',
                          '31814','19376','40794','41844','43086',
                          '18581','58600','81304','47435','46395',
                          '76681','81937','33291','39603','13751',
                          '27806','33075','96081','89811','63302',
                          '20608','44427','47595','54744','42734',
                          '63522','92971','34646','30031','82538',
                          '71725','22671','57244','94836','46478',
                          '22925','30872','66834','88792','64217',
                          '69757','63943','40367','87953','87248',
                          '60661','34540','24060','76312','92255',
                          '23403','42898','19409','79307','28271',
                          '75904','66194','28102','47524','14506',
                          '45862','40431','80583','20469','55320',
                          '63094','71850','13113','32691','11254',
                          '39601','82663','13133','63770','20673',
                          '63804','12427','24611','41011','31267',
                          '95533','70847','64488','16756','17500',
                          '65173','17063','14008','66889','65796',
                          '80582','84453','37660','14493')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
