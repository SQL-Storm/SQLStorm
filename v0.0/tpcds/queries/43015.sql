
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '72231','19843','81053','83004','28225','63193',
                          '17072','31260','76206','29199','32826',
                          '91236','55785','19527','10771','32900',
                          '73039','18838','56824','50197','58759',
                          '54448','26414','19791','19556','58565',
                          '38404','52506','47487','16697','28143',
                          '32492','53103','28902','45869','47005',
                          '31777','54699','27805','83481','22240',
                          '74510','77279','57088','41141','13698',
                          '66116','99063','87612','51945','17751',
                          '39639','72753','92934','12819','75779',
                          '73308','63671','66888','16443','31952',
                          '51709','35325','87149','43597','37803',
                          '45488','16141','22232','18792','61478',
                          '23034','77588','53714','17071','25249',
                          '89761','26855','70763','30851','16595',
                          '90988','75106','60760','64651','18385',
                          '72934','74367','19132','68437','11016',
                          '29775','71914','55022','80956','50521',
                          '41939','40257','84584','34289','88960',
                          '28337','95422','97091','49860','54280',
                          '27271','16996','19415','78149','18651',
                          '12620','90403','27309','27801','14318',
                          '37116','21523','60387','29863','43974',
                          '51985','22643','72249','28681','21553',
                          '40769','10529','61059','35315','96153',
                          '84587','40365','43508','20305','47922',
                          '53096','90134','13318','13063','34204',
                          '52205','13845','76460','68967','64524',
                          '87587','96060','63504','33699','77311',
                          '42926','99548','22125','92522','86595',
                          '17550','46034','16377','85642','39691',
                          '67838','90101','38049','45655','82021',
                          '66257','63335','71109','81757','64449',
                          '13766','98346','18440','82603','44937',
                          '92449','88041','20895','13077','53391',
                          '58338','77600','33103','79254','72430',
                          '53065','32421','23803','96460','77585',
                          '40188','76137','81917','72494','42612',
                          '18225','88925','69328','81426','21359',
                          '28499','97665','73918','82119','55874',
                          '25184','79455','31344','22077','11720',
                          '75818','29089','66831','25632','81943',
                          '71605','31080','50869','42432','39027',
                          '92960','92281','70269','27803','63927',
                          '30995','41985','11986','84034','36433',
                          '42755','67559','22157','19988','41969',
                          '57947','22426','75650','10679','70259',
                          '98044','25423','57877','16827','10445',
                          '91521','55926','87255','93305','54846',
                          '49656','40550','72746','28476','40168',
                          '30294','29828','67412','64720','86477',
                          '12964','65290','34074','45693','82980',
                          '94018','77887','35466','54229','59911',
                          '47278','41051','16782','34499','78160',
                          '62160','14251','12081','54292','28149',
                          '12846','70418','50723','26797','10064',
                          '75544','17197','14819','90425','93967',
                          '44461','58467','79685','71753','36031',
                          '61517','86490','18169','30375','34317',
                          '47244','20401','24042','79873','49227',
                          '24920','22531','95961','20205','37391',
                          '13268','14263','23263','58583','82380',
                          '18237','18943','27768','71581','94283',
                          '51100','12737','21589','16981','54265',
                          '97697','83396','54108','52703','18976',
                          '45991','57345','22073','76719','20803',
                          '26883','66176','48149','36199','91589',
                          '40603','29782','41653','96213','85658',
                          '19465','38080','22914','43404','88461',
                          '19710','65699','12877','43893','85328',
                          '84248','68771','46309','48124','65872',
                          '11343','43742','28700','74559','17561',
                          '34474','32864','22018','36210','32913',
                          '53811','63986','14196','14444','64052',
                          '29822','64840','85719','36173','32295',
                          '85271','23713','93097','54828','37732',
                          '59625','56948','50698','94474','65850',
                          '35832','31640','12778','38919','75639',
                          '10470','25128','28089','21732')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
