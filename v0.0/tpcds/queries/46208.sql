
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15406','70085','37680','25068','19758','74742',
                          '49978','12147','77481','91284','56477',
                          '80316','47158','60273','59202','57012',
                          '11141','27402','50955','21762','24682',
                          '75882','46529','21099','61270','14043',
                          '85301','32460','13781','25670','12751',
                          '67976','64526','12238','99080','44975',
                          '12572','46763','90804','99886','13978',
                          '32889','23039','81422','82532','85866',
                          '87521','13512','64277','13143','21819',
                          '48195','78820','60920','95943','73111',
                          '92445','16954','63466','51338','38635',
                          '72705','28986','49872','13244','31063',
                          '61020','29680','18404','34285','54272',
                          '10238','64871','85192','12637','71241',
                          '46245','69516','55372','61172','33093',
                          '26674','77533','79723','45008','17306',
                          '32867','23400','77913','25205','78211',
                          '67181','84781','36938','94123','34569',
                          '91520','85482','69393','36293','53237',
                          '63427','79442','11391','56836','16162',
                          '19774','16707','62210','85806','60118',
                          '90979','60493','18005','47203','98440',
                          '39555','53229','59017','56770','59896',
                          '58840','21479','41466','21061','99790',
                          '83871','82705','23871','65787','40129',
                          '10828','28939','99291','17837','88671',
                          '55940','23298','31213','31355','32615',
                          '35280','66132','74808','61266','13449',
                          '28371','61835','62421','15561','34826',
                          '27711','56612','61013','28025','55272',
                          '83843','50328','78635','80941','72174',
                          '44967','50157','16503','17205','91551',
                          '41712','23515','29905','93011','98252',
                          '24213','13142','13752','33086','93730',
                          '14862','83031','23618','36720','11348',
                          '92805','36221','43663','66872','14410',
                          '62941','42394','51743','17132','59122',
                          '25182','52672','14538','14918','22518',
                          '69904','97787','20649','12548','21902',
                          '61170','25957','79073','74259','92857',
                          '30672','40229','26478','42708','80163',
                          '31321','90375','74843','65405','83746',
                          '20406','22466','38134','29251','27549',
                          '36963','26083','29110','37143','38107',
                          '38337','56663','29463','63444','69582',
                          '79325','36927','78956','91411','34176',
                          '10711','52420','72934','31290','42846',
                          '25415','37019','25448','79490','73007',
                          '55951','96378','26759','30097','45010',
                          '14667','24358','43122','25876','39256',
                          '88882','20535','33948','41454','89249',
                          '52645','14481','38058','35371','77898',
                          '54349','54668','22329','41186','15443',
                          '52981','29246','30326','69158','64174',
                          '41453','60767','32724','45304','38819',
                          '57580','80972','21579','29323','16140',
                          '14735','65541','68328','45759','97619',
                          '40935','29172','14457','54041','67801',
                          '72610','96517','66163','31810','85279',
                          '56402','25564','55133','91841','46156',
                          '16307','10008','89182','66286','45906',
                          '54275','91391','54228','64765','16578',
                          '90263','18207','18962','99168','75062',
                          '21046','54196','97520','54887','29584',
                          '56945','35882','27337','55886','32334',
                          '62681','82960','65434','17922','93973',
                          '26547','59119','35648','99606','70224',
                          '34075','33098','24156','34034','76281',
                          '56353','74899','31870','39841','28444',
                          '60668','55178','68131','84437','57367',
                          '72418','27681','17552','33482','36042',
                          '30059','60582','68280','86870','30004',
                          '21325','63963','38760','38194','56422',
                          '81565','40608','20301','17217','90154',
                          '37052','51091','22693','70334','90626',
                          '24887','59010','22213','77885','77672',
                          '24218','29673','17579','11928','10115',
                          '56911','34364','14304','93906','68477',
                          '65720','35380','20813','29963')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
