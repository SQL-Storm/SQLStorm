
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '34619','36480','24686','10741','92379','94597',
                          '36309','18302','26512','18594','19175',
                          '25874','25974','53696','14576','67110',
                          '47724','74641','16051','68922','52792',
                          '94942','53620','86036','73702','12458',
                          '63419','21533','21237','10727','71107',
                          '30228','59216','14058','38772','83084',
                          '20993','56668','27094','81857','93412',
                          '89262','44383','66081','44220','49192',
                          '41583','15980','75549','92785','46512',
                          '74557','84342','48811','16416','59310',
                          '11942','19433','39019','42522','30056',
                          '98343','34907','63913','74440','34020',
                          '47757','28211','27953','23841','46191',
                          '35212','98967','96983','14227','39509',
                          '21930','16483','84492','14026','80852',
                          '40540','55281','94027','17487','41335',
                          '50696','41743','81057','34905','33481',
                          '66595','90933','16120','29058','75031',
                          '25597','21102','11829','75001','11934',
                          '58016','32086','96103','12858','60431',
                          '53611','98988','91538','28821','41940',
                          '93645','81993','20673','76653','60991',
                          '96552','80504','95071','50823','11378',
                          '78618','48142','90449','11471','20269',
                          '44110','75371','75120','72323','87163',
                          '76877','32838','16805','90493','57473',
                          '51442','44435','65355','33265','54600',
                          '35309','81928','22870','74819','65079',
                          '54806','43589','41919','51121','54839',
                          '31686','71546','38626','39279','72789',
                          '70327','92798','18900','15770','21878',
                          '31866','43342','39985','25138','27232',
                          '15282','46566','29906','73762','74055',
                          '62789','30408','73229','55673','96161',
                          '10941','38566','18577','84923','86258',
                          '45987','42958','45904','64630','47533',
                          '79562','52347','56068','80437','27873',
                          '34553','42983','68377','18783','43171',
                          '63195','86060','19212','62885','48591',
                          '64858','43523','39967','14229','22271',
                          '18227','51263','20642','98880','72591',
                          '17642','49826','22402','17408','59865',
                          '79793','63337','45456','94394','25377',
                          '95307','23105','45451','35383','50568',
                          '41060','66309','42688','98758','88456',
                          '31318','28408','37698','79054','18707',
                          '85985','56657','29729','10349','34437',
                          '11094','57627','67387','50415','13188',
                          '56483','93571','89441','89622','72514',
                          '90785','41821','97964','30926','85261',
                          '22746','69228','22667','81130','12397',
                          '56417','80994','69721','67362','52631',
                          '53286','25397','37383','31604','13198',
                          '13399','42751','43206','35313','32737',
                          '17513','37074','86266','42881','23908',
                          '99613','96300','17290','83289','92063',
                          '66142','82333','13862','66748','83053',
                          '60508','37843','80873','35727','60284',
                          '78741','58640','51935','69184','21280',
                          '61333','92098','49922','54025','53319',
                          '31785','66864','18084','11764','24809',
                          '35839','16258','28467','73886','20474',
                          '87472','65338','57776','64939','64753',
                          '10464','80650','33702','14710','49786',
                          '11376','46863','49028','39699','10668',
                          '70351','32133','55635','71986','73280',
                          '47944','66046','11802','25398','22037',
                          '31804','22744','83559','39861','14397',
                          '42982','43933','60893','94365','17473',
                          '11110','62793','79295','76944','92811',
                          '96914','26337','88549','16666','30548',
                          '37942','21970','75540','27138','44862',
                          '78928','13222','93465','69957','77994',
                          '92645','63629','98560','69682','18597',
                          '16888','92688','33258','39532','11935',
                          '16824','32531','60719','86328','18177',
                          '92738','71638','69016','13693','51241',
                          '43243','76352','52137','50966','63139',
                          '48115','33472','59663','81822')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
