
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '69014','39921','80986','72219','54413','36567',
                          '27667','66158','26232','58689','56816',
                          '67273','64045','97918','55825','27142',
                          '20381','49966','60153','22703','56862',
                          '11319','17691','37823','79704','85772',
                          '33416','66073','48677','47031','11674',
                          '19078','16604','59184','46006','14776',
                          '27660','55278','41580','21230','21384',
                          '53626','65648','28193','39780','47108',
                          '78287','99948','97672','13719','85049',
                          '17285','11207','54855','85059','13496',
                          '18430','99249','85309','93141','13369',
                          '21295','47209','17869','28280','31258',
                          '20005','86622','75240','73606','28421',
                          '35948','22815','30542','76871','24639',
                          '40911','49972','39643','10850','33207',
                          '41296','25236','56587','58820','35068',
                          '52707','34077','31633','44828','16569',
                          '12035','72873','79767','90169','90294',
                          '34741','82393','27342','47067','15403',
                          '16426','86790','74011','91249','10272',
                          '45718','51624','96290','51883','16892',
                          '86132','26618','63878','44864','31225',
                          '59113','15552','90453','16688','29073',
                          '20560','20819','21874','50089','37881',
                          '22533','31458','98765','25148','94955',
                          '30040','20469','65467','98048','32791',
                          '76336','70835','28225','96377','27379',
                          '96457','49097','51494','65288','39860',
                          '79675','30517','47142','27518','21872',
                          '16670','53430','90802','90765','69307',
                          '71714','11332','87658','53689','36061',
                          '70941','22658','87067','87705','43394',
                          '84416','59981','45639','23975','96485',
                          '11425','28746','41543','45193','79052',
                          '26527','56364','37499','13969','44233',
                          '97154','87609','75184','77805','18746',
                          '55661','89760','99802','85579','56431',
                          '47933','16205','22800','26735','34006',
                          '30426','23950','25629','26814','31649',
                          '28154','24186','43626','69672','35813',
                          '15574','20602','38033','69684','29575',
                          '52816','11754','56446','52691','54513',
                          '85921','10349','26492','64055','23738',
                          '32970','18937','65627','23709','73557',
                          '62870','80865','44203','65974','32098',
                          '86725','88299','30858','48959','24329',
                          '89999','68937','76974','28796','81760',
                          '22865','80829','19135','85856','96530',
                          '28743','59621','16066','26104','13394',
                          '36924','57080','36304','97234','33105',
                          '54607','45261','85259','92334','11707',
                          '86244','36135','90627','71312','63788',
                          '98643','10014','33473','48245','82438',
                          '27945','44243','53409','97348','64596',
                          '33725','23326','91916','66472','17718',
                          '88921','89351','44324','84303','11603',
                          '64137','13339','42743','87336','63747',
                          '41490','36155','18252','97474','14491',
                          '48242','13231','73352','15198','12799',
                          '17599','12917','22573','36980','99296',
                          '70670','72131','97570','98201','59570',
                          '27185','46596','48675','71044','73003',
                          '29720','36176','66440','86583','71186',
                          '52508','19656','32052','31392','81564',
                          '88907','48295','22226','12879','23159',
                          '23700','16186','10923','76476','37976',
                          '75286','51565','42574','94895','40913',
                          '84115','47453','12858','16676','64890',
                          '91808','96021','18265','24419','10092',
                          '13112','50346','86726','42144','20444',
                          '24206','48393','31868','69530','84252',
                          '88458','32332','59692','47632','95165',
                          '11902','79399','47546','21520','26764',
                          '19937','40769','86213','91479','78914',
                          '26634','52377','21611','79424','24756',
                          '14838','99294','72507','38106','28924',
                          '62980','32454','71102','68746','61861',
                          '57932','44043','96600','83231','87864',
                          '12443','18344','26102','67268')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
