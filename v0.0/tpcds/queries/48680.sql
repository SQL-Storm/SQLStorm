
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '37467','13507','78871','98582','21463','49171',
                          '84903','32260','68534','28129','84282',
                          '13903','56589','61741','80335','33212',
                          '32415','64626','52727','28562','24335',
                          '58069','71854','25524','97849','29891',
                          '74899','54640','19057','33069','64008',
                          '43977','95615','28918','85325','85620',
                          '25626','48723','54150','38649','47846',
                          '48642','40450','23210','30111','32872',
                          '37350','27241','35485','19617','11043',
                          '27850','66416','35206','69614','81724',
                          '75996','56141','50608','39492','31197',
                          '11200','12973','85772','64011','78579',
                          '35482','98074','14595','13485','77770',
                          '93762','43187','27896','55756','92729',
                          '11225','28936','52371','24870','24927',
                          '40811','53078','58411','21709','32836',
                          '56452','80714','95711','77228','80481',
                          '61801','68921','73596','14699','89536',
                          '58853','44331','74738','18916','13318',
                          '15600','46290','28108','51482','30866',
                          '66394','89931','36668','89376','85971',
                          '26515','69765','20003','82270','87856',
                          '27337','19344','26593','37589','71030',
                          '20140','87195','45809','37076','70005',
                          '22720','26653','83353','17330','79829',
                          '28113','69706','74382','28026','92678',
                          '12682','17722','52169','49140','22901',
                          '50117','94635','90391','30026','86438',
                          '32068','46358','14806','28205','29569',
                          '90862','66818','30909','95413','37622',
                          '11471','54642','25223','40313','79317',
                          '21303','49001','23226','37395','44027',
                          '97665','20104','91899','70340','32350',
                          '35410','47862','19513','97490','31620',
                          '65289','30316','15226','41621','63340',
                          '21565','17203','45822','80035','86858',
                          '62574','81415','49735','33137','19418',
                          '86461','36712','49006','53373','70843',
                          '52684','44444','69004','99824','89421',
                          '27797','47983','45335','85244','78719',
                          '31027','60766','58948','58797','66583',
                          '56623','22230','16477','15080','38955',
                          '70878','19238','98008','59077','66676',
                          '16294','85821','65816','79520','19586',
                          '27086','70974','38467','25075','86173',
                          '20836','84605','40204','11242','66087',
                          '25535','47952','70189','45473','43022',
                          '99319','11972','34660','58717','30843',
                          '21141','11913','13773','33424','18951',
                          '92319','40969','22808','48937','31107',
                          '27776','31183','41380','79136','73658',
                          '49918','41520','49613','15913','74680',
                          '50432','19522','35686','57891','76838',
                          '21907','82392','46002','81633','49425',
                          '62698','40835','42022','63316','73162',
                          '47242','74047','75356','17343','56722',
                          '95843','99385','35769','48874','41063',
                          '24096','46684','15187','66705','39456',
                          '33474','72108','15532','98670','80118',
                          '38964','55005','11219','77949','35218',
                          '89901','74016','12491','67212','31413',
                          '66592','29414','67877','55425','63440',
                          '22666','69629','71840','19808','24090',
                          '55644','16951','20735','73247','55664',
                          '15661','34141','84993','33915','61644',
                          '35869','94378','19427','30266','83230',
                          '54435','50203','17670','30533','60880',
                          '85644','47133','94580','20264','58257',
                          '48523','10209','46541','15880','46277',
                          '27181','26152','14216','45594','88105',
                          '65891','80909','38269','68234','48982',
                          '84206','44276','43104','54484','14644',
                          '17907','21838','39002','21744','47742',
                          '45978','63944','76587','97341','42867',
                          '20242','32416','52226','37000','40391',
                          '50010','67547','27494','33209','88471',
                          '65989','16034','68906','27963','27697',
                          '39709','53272','76287','47433','85551',
                          '80800','97824','10929','45587')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
