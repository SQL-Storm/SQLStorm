
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '81748','87707','17379','45149','38661','31718',
                          '94158','93836','27059','63876','16178',
                          '41506','40360','78433','30413','37216',
                          '84642','26879','21288','56435','13940',
                          '52939','62203','36664','12422','45721',
                          '58893','50896','92862','62737','44008',
                          '49138','11169','32505','20279','64748',
                          '21995','60599','40638','36655','32448',
                          '12516','17483','27511','15676','16654',
                          '89261','93236','68796','97421','63813',
                          '77468','96817','31262','99986','63125',
                          '35337','63715','10533','56051','73836',
                          '55346','61713','60911','61706','55490',
                          '48273','64852','26789','90812','95404',
                          '59162','38497','51605','55279','74398',
                          '25025','73711','16374','67252','86541',
                          '89368','93027','98590','63433','45447',
                          '24709','15998','88320','70540','31265',
                          '37661','64183','34815','30362','60752',
                          '90096','12742','76256','25231','38095',
                          '51479','48580','79626','75805','72905',
                          '45366','61446','70414','27544','16054',
                          '71967','60022','97261','24187','67053',
                          '19555','51991','19169','24576','77645',
                          '74586','74357','14712','81728','13540',
                          '33213','48776','64216','11473','23106',
                          '74895','47756','61337','91101','51729',
                          '24411','29236','40124','29921','10764',
                          '43832','88448','30136','46470','19382',
                          '86915','49123','41730','18060','10051',
                          '25086','61287','19047','81494','35775',
                          '13766','63384','37067','33323','65112',
                          '53307','60115','20564','12631','24115',
                          '47508','35965','56269','23873','19072',
                          '53983','92238','27051','77255','45715',
                          '36853','71721','41302','88939','92604',
                          '72924','37561','96063','51325','77282',
                          '41067','20010','65833','16095','53094',
                          '21638','63336','98392','90860','68925',
                          '16393','46342','68742','59545','38797',
                          '63562','83018','17016','40159','91678',
                          '82965','49395','23968','94144','20117',
                          '30272','37853','60734','37844','54768',
                          '48568','76096','78378','82582','14016',
                          '63529','30010','31952','36721','22121',
                          '65069','99792','38363','93988','72139',
                          '92329','54157','91087','11720','27711',
                          '76001','66522','80482','67870','98822',
                          '17162','58433','21051','86928','58519',
                          '95441','37635','63211','14006','78780',
                          '19274','70066','52413','23942','62843',
                          '68926','90308','31184','71487','86272',
                          '96504','57287','57036','82069','27753',
                          '73349','37977','32849','18029','50691',
                          '43135','80329','22808','59196','47853',
                          '33929','54508','66304','23630','96047',
                          '54728','70409','21521','57576','51781',
                          '50075','37282','64963','31406','25645',
                          '37511','80562','74987','77635','92927',
                          '21422','79812','36790','88740','35756',
                          '54089','35100','84147','39309','56464',
                          '45548','57004','65897','11330','78770',
                          '13301','54078','43870','51072','94141',
                          '12037','65234','53638','47625','17059',
                          '91311','65694','89354','58540','55069',
                          '33985','88015','15535','73936','14151',
                          '42689','22538','95102','85232','35522',
                          '23988','17178','45427','57740','59488',
                          '19992','33744','31877','49619','40650',
                          '31268','47252','64724','55106','75595',
                          '81339','19456','30730','75448','37238',
                          '71634','65254','90298','34477','88095',
                          '44519','34485','61036','52217','31012',
                          '68705','40855','46332','22624','88795',
                          '17975','72439','64274','11149','12392',
                          '23625','81932','42772','32787','82225',
                          '74579','63198','13538','87473','22228',
                          '24713','30832','48453','42538','17684',
                          '25128','84045','16574','47777','47216',
                          '87807','58092','51931','77072')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
