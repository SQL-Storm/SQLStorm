
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '21358','73341','86525','32309','51886','89684',
                          '34825','17393','63498','15800','78488',
                          '44234','26722','52157','28847','72160',
                          '69628','50927','75648','43633','88356',
                          '24121','83555','70987','75614','33723',
                          '95049','39888','53854','97221','33420',
                          '91574','59598','13276','31200','23473',
                          '93770','46419','95618','10171','34313',
                          '94919','11940','32399','96908','58471',
                          '54013','73225','41853','61621','36165',
                          '11568','54084','23858','12089','58780',
                          '89959','48521','66978','51781','51994',
                          '89700','27875','10525','28046','40169',
                          '41922','81351','51006','79632','80835',
                          '12383','22309','88902','80112','43006',
                          '11093','17897','25495','14100','38772',
                          '50932','60292','92275','56707','75540',
                          '58405','50133','12187','73601','36812',
                          '98701','98266','37321','21189','16294',
                          '77457','32832','54823','50247','53818',
                          '43054','47239','71915','29088','29201',
                          '79072','45366','99489','51613','44481',
                          '54851','92897','46638','20951','33268',
                          '84253','27716','15844','15919','80696',
                          '39840','20730','80076','98988','11420',
                          '46950','93006','88749','60836','56226',
                          '93044','13128','59215','79109','85932',
                          '93556','46533','88928','36989','37062',
                          '23256','94552','74270','79779','95961',
                          '17003','37937','20725','38606','78366',
                          '92742','94811','99426','94193','75559',
                          '71366','60543','21284','70445','25294',
                          '99089','60376','51401','49831','41270',
                          '56384','14993','84751','23401','37422',
                          '47181','52520','56779','65288','24260',
                          '32182','38831','90377','96406','55791',
                          '91273','91982','82131','36305','70112',
                          '78083','48088','61988','53612','41228',
                          '10763','13983','51960','52150','49606',
                          '90953','34717','16696','65561','80036',
                          '64087','60511','34001','87572','27172',
                          '26920','53431','73359','67813','29785',
                          '64475','54333','50177','24511','18640',
                          '98751','33577','54072','29345','63474',
                          '40453','70542','54555','43177','54031',
                          '44502','44717','49936','60730','66427',
                          '20647','19568','15671','17815','40153',
                          '49276','51615','71058','65366','80924',
                          '70589','72944','81298','80452','48522',
                          '16009','73087','10427','26005','60231',
                          '41686','43019','72821','31369','75385',
                          '65051','88456','23692','28500','24401',
                          '34854','50968','27294','50048','71942',
                          '20108','53895','52149','39413','19611',
                          '87233','93736','92213','55905','69796',
                          '62646','20769','53653','26395','63201',
                          '60567','32103','82169','88645','69202',
                          '59202','28727','47380','65910','54484',
                          '31374','28690','37494','25547','69767',
                          '63670','24877','26802','39062','92114',
                          '89420','82744','41323','53777','38603',
                          '83039','92033','25619','45331','57192',
                          '29500','53630','36607','33687','48063',
                          '16613','10958','45635','14072','92992',
                          '33972','75043','37172','86240','50180',
                          '95696','31179','62244','23833','68584',
                          '50804','75418','67316','28556','99162',
                          '27085','46906','64327','30738','13174',
                          '33725','21807','14193','82340','79266',
                          '93294','28251','41142','11192','17719',
                          '23910','17961','22449','26525','91177',
                          '48941','60254','69500','62016','42133',
                          '65203','38343','74792','21362','65705',
                          '33055','43525','99063','20914','33986',
                          '37059','33102','47099','42746','97669',
                          '46493','75054','81582','70199','72175',
                          '90065','42611','42303','33885','25352',
                          '43748','21259','26799','13555','31765',
                          '54791','17810','25339','39258','38555',
                          '34227','82594','33624','32195')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
