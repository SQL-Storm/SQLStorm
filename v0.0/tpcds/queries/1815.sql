
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '60795','36798','64715','96442','37107','53558',
                          '75929','53036','94969','95020','86591',
                          '48271','17596','72249','40001','29987',
                          '33672','76746','27354','57210','45594',
                          '62553','63854','16723','24199','56867',
                          '73039','49569','80302','22607','88278',
                          '49238','40013','52453','15637','74519',
                          '16850','67998','19867','85656','13877',
                          '94288','28949','49989','23284','57079',
                          '68325','34758','82722','78188','85814',
                          '61329','32316','18256','94813','97884',
                          '41076','65166','30094','31436','69099',
                          '97430','34568','48344','21363','75732',
                          '88789','48542','96495','15974','35936',
                          '30298','82979','34529','34005','13631',
                          '47426','25843','72451','28422','59407',
                          '32142','99395','91707','40414','13666',
                          '72406','65349','31496','23313','63310',
                          '23832','68772','59992','85791','24678',
                          '65933','27551','15546','76820','68906',
                          '42996','83681','93041','33295','31235',
                          '75619','15357','22973','58489','75544',
                          '40045','87374','28972','46634','16417',
                          '51083','50622','22764','10209','60950',
                          '64599','13922','22734','60723','39958',
                          '95213','37386','77878','22509','67511',
                          '31514','72306','80536','50067','24478',
                          '50329','22344','87682','49563','22374',
                          '86850','91199','45079','37999','38686',
                          '53579','24369','87499','28069','35687',
                          '43188','34961','33341','10847','62315',
                          '22367','25552','94137','32980','41771',
                          '91702','70192','32225','92452','13708',
                          '17545','79451','86962','51969','70912',
                          '62300','35072','92233','76083','46439',
                          '46841','18144','15629','77199','83069',
                          '10236','78648','97571','47576','42569',
                          '83544','35213','28628','41879','89564',
                          '47066','16204','17505','96523','33771',
                          '31832','17315','97022','78820','41392',
                          '81400','91087','59625','16761','74015',
                          '36616','91365','96973','81578','57413',
                          '95386','59541','62356','87162','42888',
                          '37547','91951','66726','91725','24468',
                          '83839','45393','50264','71098','84288',
                          '37639','91545','21043','17598','14913',
                          '54910','68721','64584','61006','43535',
                          '19956','32900','38623','32615','61957',
                          '14076','27022','23934','36505','49112',
                          '20035','64891','83379','65715','28897',
                          '45740','35451','59089','85321','13471',
                          '85657','54019','82783','98696','16605',
                          '95417','29400','62079','64761','25324',
                          '14693','38154','23510','28068','22627',
                          '36220','81233','71085','72301','66628',
                          '23884','65659','11958','64251','47399',
                          '93495','77069','92669','34558','48737',
                          '38551','49278','60307','11870','95911',
                          '51202','68072','27608','21579','85963',
                          '18655','63735','21315','98793','85958',
                          '16807','85144','37832','44582','58565',
                          '66696','80185','11087','60961','23822',
                          '11899','22872','94898','17806','30782',
                          '31073','72238','35504','43693','69886',
                          '43657','67888','47987','60308','58262',
                          '69971','93470','40271','12183','30898',
                          '69863','57997','24727','95826','89661',
                          '92064','60011','60841','16610','56900',
                          '58370','16046','33883','86497','86158',
                          '36202','57695','75465','25137','41527',
                          '54083','15858','99402','62132','52378',
                          '49986','13230','45936','20939','26648',
                          '72674','27998','96755','45013','16362',
                          '30954','55564','56005','86838','70991',
                          '91046','73336','76268','23174','58507',
                          '35201','22217','72657','33454','81011',
                          '92941','35071','42550','65310','10535',
                          '16206','65240','99694','98299','49003',
                          '75491','65582','37481','83604','82645',
                          '60957','34385','33613','70406')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
