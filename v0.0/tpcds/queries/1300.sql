
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '32853','45472','72399','83503','16754','52860',
                          '15482','40168','19881','40502','18276',
                          '72470','44299','24252','41813','15256',
                          '40083','92729','86979','34743','88016',
                          '67458','25286','48426','54464','28953',
                          '26832','19388','35684','94870','96720',
                          '49360','42441','16506','97668','38767',
                          '93124','35374','11085','40832','43595',
                          '36077','30142','54265','84610','22590',
                          '44311','23115','36352','22689','98147',
                          '74682','87415','23474','76671','83485',
                          '43150','35527','19430','26109','53738',
                          '66386','27214','17349','11237','88327',
                          '83183','26838','31763','34968','68020',
                          '58920','27430','16129','78824','30413',
                          '70384','28185','55250','13147','42780',
                          '31352','36535','32263','70977','41102',
                          '40483','33876','32488','38561','20438',
                          '68211','64969','44570','79829','58300',
                          '11310','37676','23251','83451','21095',
                          '58339','53979','61526','63395','39623',
                          '44110','36391','72066','98856','16901',
                          '89495','10944','33527','27517','16366',
                          '85927','81017','47454','54810','58621',
                          '87813','32632','30001','94244','81884',
                          '96543','25132','80548','45892','12876',
                          '56505','12611','21901','84055','97641',
                          '27715','34313','33135','20750','26746',
                          '31407','17378','85848','12600','23511',
                          '75052','89565','73530','78756','37085',
                          '27274','15929','91112','20969','18648',
                          '46575','37049','96550','26164','32946',
                          '43403','45237','11400','51600','66370',
                          '51459','12186','45231','10109','25736',
                          '81226','81285','15128','33704','13928',
                          '48288','76301','52088','38123','94074',
                          '32393','58098','85801','13054','36052',
                          '52705','94920','65167','48412','35288',
                          '83515','56115','30383','21602','80273',
                          '47239','99994','73574','27920','69510',
                          '16214','21038','22592','23782','48565',
                          '10458','44360','56944','83174','11847',
                          '11027','21042','10636','61316','94597',
                          '27482','45798','62982','91926','10059',
                          '49799','31077','79781','40764','69150',
                          '55206','73392','46703','55211','94826',
                          '45495','36605','89775','84249','73367',
                          '19987','79267','99692','43451','33799',
                          '93771','91941','29857','77585','62934',
                          '69670','38232','57827','50542','21163',
                          '69750','89630','63608','42987','60231',
                          '51108','41595','16304','19718','34164',
                          '70614','50838','23949','28844','26548',
                          '45055','12591','79165','78193','52708',
                          '61319','46377','20582','11241','74989',
                          '87557','70850','13885','24710','35304',
                          '62486','58439','82157','40775','87977',
                          '47888','45899','41681','76913','39481',
                          '88830','36647','38350','47591','64618',
                          '33237','59462','62769','68578','55563',
                          '53704','54837','77135','71035','39480',
                          '67454','57398','37703','74724','37336',
                          '75741','67532','13139','25551','29871',
                          '77385','37932','39888','56205','90314',
                          '28613','83573','65012','25309','70915',
                          '43353','86343','81875','12942','76975',
                          '92950','19055','48034','85898','72262',
                          '97504','61884','17554','49173','94555',
                          '35402','20960','80969','54516','15044',
                          '57245','81839','64814','23909','73693',
                          '96404','32228','96268','57357','67710',
                          '31374','53085','10385','54947','88527',
                          '78495','16940','65217','31774','28599',
                          '59242','46265','25039','26411','22426',
                          '16567','10906','20951','52428','36425',
                          '63201','71387','61295','19633','96579',
                          '15780','87890','68405','61291','28614',
                          '20600','77888','96544','18618','11435',
                          '75671','18188','14166','77278','82082',
                          '44776','18948','62760','20880')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
