
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '59850','13710','67034','86473','11419','72800',
                          '41978','83719','24746','17988','54525',
                          '49784','80270','38701','71727','62273',
                          '27789','39165','40298','65764','58496',
                          '28108','69033','47386','25800','13584',
                          '51576','35357','43422','10342','46498',
                          '39785','82143','58189','36271','40067',
                          '98364','79847','80814','40541','38762',
                          '44745','83313','86388','91481','28299',
                          '35331','97617','56692','14099','52152',
                          '66916','84007','16735','34919','13888',
                          '20313','95703','78714','75834','68399',
                          '21300','55294','87570','54400','20300',
                          '56048','16880','51942','14421','30372',
                          '56993','25476','73776','10149','11441',
                          '71744','67312','62058','32534','48072',
                          '98507','30227','54879','32694','16355',
                          '20631','69601','10882','25945','43098',
                          '67685','13935','47788','34113','64822',
                          '73647','20171','48469','86364','32219',
                          '26525','30329','70782','13128','92188',
                          '59889','40604','90330','92567','74293',
                          '44742','95418','28027','40057','83672',
                          '21044','11072','22136','41695','98740',
                          '22375','85596','39230','64956','66931',
                          '12691','49011','37412','34355','56990',
                          '52831','98812','71759','41963','55836',
                          '98409','89138','11268','75764','41004',
                          '14522','98843','38414','66092','98551',
                          '22256','90710','39662','10952','31798',
                          '16421','83846','66865','54199','13959',
                          '85472','50100','86802','30387','75406',
                          '88877','36354','94361','80167','13774',
                          '21069','13068','84356','22893','54120',
                          '21225','84889','76008','80988','10880',
                          '66489','43286','83932','33254','86546',
                          '18120','20222','81505','27775','85951',
                          '23349','27240','55526','18719','55180',
                          '24763','17080','27948','92733','70727',
                          '16666','65601','65983','39531','97254',
                          '45165','49974','84233','96343','35704',
                          '85538','84782','56750','95892','27210',
                          '99507','31067','20316','62582','33865',
                          '27676','27232','33692','56605','41860',
                          '12545','10726','56102','16764','35867',
                          '11770','67601','14104','17902','83845',
                          '15571','25345','16999','16966','99429',
                          '47421','40211','87155','62760','19751',
                          '25487','20492','71799','62623','76552',
                          '59052','37298','67182','51749','60214',
                          '21618','55614','23336','48614','74037',
                          '17378','10735','49043','75411','31341',
                          '25940','23421','12453','49286','90738',
                          '82658','23188','23013','90071','86215',
                          '57547','15423','26403','52154','55447',
                          '43275','94854','90743','79585','36554',
                          '77127','80667','35881','98160','28383',
                          '46105','89232','51662','73372','20400',
                          '19756','37056','44460','92639','72648',
                          '15294','34476','11041','97637','31592',
                          '98085','50832','62772','14834','67772',
                          '95577','90891','69544','38827','48175',
                          '77528','59921','45595','33086','32531',
                          '86450','95711','92120','42005','87550',
                          '65168','88125','13610','95919','57839',
                          '44375','62282','95055','89067','61387',
                          '59759','30288','51321','66263','56576',
                          '10677','34266','93954','99840','21267',
                          '73250','96082','32824','38859','41710',
                          '67331','59990','39631','12696','14662',
                          '95843','68452','88874','41953','46129',
                          '69604','13441','82638','12409','29727',
                          '26119','90064','56404','95656','80483',
                          '84122','27617','81915','10040','70603',
                          '61200','71363','79060','96399','98369',
                          '64402','86773','35789','77275','42810',
                          '72453','71077','19532','22486','38789',
                          '66676','41600','15260','65023','18673',
                          '14442','87360','95819','44249','71748',
                          '40324','49567','35112','48189')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
