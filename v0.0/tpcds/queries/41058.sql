
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '10918','98590','24064','58204','45086','49386',
                          '52747','24229','96871','48363','74650',
                          '69736','64659','72806','64330','88452',
                          '55767','34763','63443','31856','21795',
                          '14963','63388','63183','26455','43550',
                          '45974','33013','10697','93304','27837',
                          '20803','19087','90198','14795','24092',
                          '14065','74062','27531','74895','84186',
                          '65115','85622','22697','68186','10976',
                          '27178','77291','12734','33549','37408',
                          '39327','47206','43646','54707','39855',
                          '57231','11578','49110','13041','95306',
                          '24401','54431','29222','75316','90542',
                          '19867','25017','51502','28233','58716',
                          '29712','79437','98671','55934','37815',
                          '30809','10451','83876','87176','57484',
                          '47264','49454','24712','22657','48247',
                          '24959','98669','66995','30556','17947',
                          '66320','33196','74049','56111','82340',
                          '46902','67076','17874','75685','63411',
                          '94584','52712','52486','45402','89124',
                          '22367','19281','54021','73918','82928',
                          '56574','75983','48180','60725','63282',
                          '43393','71052','57412','97377','75401',
                          '53590','16885','44394','69261','24579',
                          '96573','34399','26059','95528','92994',
                          '31051','57023','17150','36018','39029',
                          '77704','72381','37260','36194','17093',
                          '27634','44230','82153','75739','71960',
                          '63167','16484','82533','49352','64922',
                          '14080','84517','93386','28337','70040',
                          '65336','61348','61245','81915','92721',
                          '41315','79402','32529','23377','85726',
                          '88820','97426','23792','27850','30517',
                          '10429','58776','37082','16508','34390',
                          '95680','66975','10411','68006','84146',
                          '10220','75930','26162','47181','84464',
                          '79091','50318','57058','41648','12425',
                          '34457','39895','44517','92083','51966',
                          '11871','50931','34989','41932','65600',
                          '80150','31921','27839','99873','27146',
                          '23050','53526','26043','30447','33486',
                          '15201','61293','27942','39218','19465',
                          '78245','81629','76978','45177','69984',
                          '19458','22255','59837','88005','38663',
                          '12690','15579','81730','49963','63341',
                          '68155','54242','54513','23020','36425',
                          '52487','98612','26174','33563','42228',
                          '21459','68947','39919','90952','17047',
                          '55322','28847','15896','84299','13653',
                          '47143','11558','70531','97421','86264',
                          '55409','44376','74807','41771','44450',
                          '49238','87200','32691','40515','89866',
                          '84899','66174','78451','35855','98310',
                          '22494','88577','56286','42573','25300',
                          '87544','51983','17250','69003','17660',
                          '76608','55617','71236','44751','30115',
                          '30849','55653','86589','98026','34700',
                          '30666','18929','56547','62052','76912',
                          '19689','64662','11203','35989','89815',
                          '16003','80862','23995','81135','90418',
                          '38014','12386','50937','18690','10234',
                          '22904','20344','35001','77900','11570',
                          '76500','66942','23909','69035','96386',
                          '72285','65528','57731','84165','56512',
                          '70667','69231','23605','12223','12716',
                          '28274','57374','33605','48387','10660',
                          '93653','65733','47104','82506','19051',
                          '10840','47070','28284','65898','18876',
                          '26325','48976','22042','83810','94706',
                          '44078','24987','10788','62807','60699',
                          '45453','82123','72188','74900','57172',
                          '14762','93440','31578','29424','88627',
                          '46250','42041','83829','50709','41590',
                          '56440','15272','16878','73521','86517',
                          '67955','10361','58935','41499','80316',
                          '99152','49019','19799','52408','46703',
                          '68487','60226','24155','17830','68889',
                          '70857','12869','50276','72139','47394',
                          '20321','53667','38110','66305')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
