
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '11294','57084','70627','40068','66708','55461',
                          '12670','54104','25842','89656','43413',
                          '99883','51328','61171','94511','46470',
                          '57001','37213','12321','24903','14018',
                          '67370','46325','37840','28442','95566',
                          '75266','55429','42318','23293','19997',
                          '63354','44128','14820','45886','60462',
                          '78945','20462','88545','35888','65754',
                          '69810','15368','15507','25389','26852',
                          '81086','21794','93920','16107','28146',
                          '20381','21630','80363','43990','93209',
                          '90888','33652','14125','18460','56079',
                          '29122','26258','26109','28453','12556',
                          '99814','33170','41266','97038','59867',
                          '11099','33459','59184','41404','40090',
                          '89013','15325','16923','81929','32846',
                          '85284','11781','49136','66692','68962',
                          '85603','40568','85072','83177','99798',
                          '46239','46524','43479','49641','91445',
                          '70225','25751','96822','23187','50797',
                          '56669','82809','94856','65606','41934',
                          '11016','15863','36278','26068','40562',
                          '59390','76834','72641','85934','51505',
                          '33668','67250','37618','20201','90245',
                          '59402','60962','74969','42603','23098',
                          '61134','15843','31152','37852','87643',
                          '36429','28556','21088','62135','69014',
                          '52524','41695','23953','84348','30269',
                          '88179','56871','49307','97590','70074',
                          '55448','39063','14988','72879','11650',
                          '52831','95364','75354','95137','39263',
                          '59426','94459','42812','36477','20390',
                          '99227','34955','21736','41372','83499',
                          '61929','68824','33326','15390','32904',
                          '50515','16537','39258','29233','27488',
                          '46407','75299','27978','10820','17029',
                          '24272','47389','16452','75034','36019',
                          '76763','45730','22465','88118','20765',
                          '62113','16604','59696','19389','72522',
                          '74972','45856','18724','83135','97386',
                          '23294','60110','39925','92394','42716',
                          '63414','45665','77009','90906','48605',
                          '36613','46185','44867','95203','38405',
                          '10834','17446','57678','30351','90379',
                          '75713','20965','26255','48292','18596',
                          '13184','67131','43338','75107','66019',
                          '95530','79216','91625','81670','45410',
                          '12426','10849','71616','24150','81703',
                          '94605','45907','85277','83171','29579',
                          '61277','23502','65388','29310','49887',
                          '87536','28920','61022','11134','33872',
                          '56096','34496','48563','88437','28261',
                          '84488','38597','20674','41055','51750',
                          '78671','94927','86645','74217','35482',
                          '20742','47415','82490','81025','40148',
                          '69231','93421','13228','28177','64032',
                          '36919','22253','51529','23587','74210',
                          '28369','23898','10931','13731','39816',
                          '69767','11375','80910','24999','47099',
                          '80922','25333','18158','44710','77090',
                          '91802','80744','50379','26356','83165',
                          '22017','14521','73775','10836','52958',
                          '45212','60737','84512','22720','53623',
                          '39375','75896','75470','77824','31723',
                          '16538','43041','28584','36049','41672',
                          '64309','39496','13129','24193','58984',
                          '33753','75392','93434','22557','81077',
                          '51123','15335','11995','53096','21995',
                          '22300','85760','57435','76581','17978',
                          '63862','72628','92311','25099','32131',
                          '14091','62807','14210','51743','79334',
                          '52942','22900','26422','15805','88154',
                          '52090','62916','26874','58352','45044',
                          '31922','62691','17261','12278','52598',
                          '52581','62722','60327','14468','47113',
                          '34090','39519','30959','83018','69587',
                          '77148','31125','23291','89778','24025',
                          '15561','81501','60756','66898','17111',
                          '14257','46678','66333','12349','67495',
                          '46317','80444','40768','18056')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
