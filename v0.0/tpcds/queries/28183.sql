
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12983','31676','67929','24369','56144','76918',
                          '50140','69911','10537','90857','35290',
                          '79841','72881','77672','32668','39121',
                          '28947','38298','13193','94958','85335',
                          '33136','41764','45052','72522','20230',
                          '28613','31898','20917','41623','15373',
                          '41215','14380','53745','25584','44622',
                          '34141','85769','32483','60594','49923',
                          '82096','63233','59061','33305','30298',
                          '78151','44041','35876','27645','75260',
                          '49006','93792','50965','28911','34324',
                          '31972','16680','15075','28783','42030',
                          '46865','10133','39364','26721','42490',
                          '40700','23265','70614','62872','44681',
                          '74905','14564','12078','17650','17440',
                          '43264','33144','39887','61568','59684',
                          '71629','18069','20757','39912','34849',
                          '54885','99317','20074','31766','38635',
                          '34918','55327','54787','18708','85466',
                          '91646','77773','14435','87230','66549',
                          '79906','19095','85231','61817','36595',
                          '96466','25014','72272','15534','60687',
                          '89520','83150','15063','18446','10579',
                          '14071','18610','87353','49050','24259',
                          '40465','84477','52056','54635','33999',
                          '59080','45803','63141','35734','38530',
                          '41374','15975','58487','20663','32107',
                          '52354','95680','67143','81305','26937',
                          '79427','45172','88169','77353','66149',
                          '65897','28095','10197','24684','32764',
                          '10828','58654','28102','10513','46392',
                          '15912','41576','56217','92149','12394',
                          '91505','93762','46881','70618','85523',
                          '30092','84495','37456','33938','95104',
                          '31280','82369','72513','72387','54844',
                          '61376','29147','55319','86723','28785',
                          '31860','37474','67531','70787','10699',
                          '50366','94372','15816','60818','35106',
                          '10933','52578','64935','86706','40070',
                          '84047','82303','52349','39109','54548',
                          '57794','73770','11008','57181','38286',
                          '16701','15952','89076','67829','62901',
                          '41802','92351','22096','14002','66410',
                          '27430','72380','58522','51547','73761',
                          '64525','44337','57365','73116','78700',
                          '67419','20813','77086','58084','76856',
                          '41373','37223','94386','18459','16459',
                          '14657','17618','57163','20405','49499',
                          '25957','94048','23203','88002','11865',
                          '97949','77620','18577','40073','19756',
                          '64028','42027','24455','41864','70644',
                          '29271','20203','41363','45389','23546',
                          '28488','88623','99778','14136','34812',
                          '44810','39167','83756','32057','42031',
                          '51625','12611','15754','30843','25201',
                          '13661','29353','59129','48704','77026',
                          '10142','17783','15018','45201','78309',
                          '38692','37793','43972','15024','47619',
                          '40669','65976','72162','10109','41397',
                          '67677','28207','10483','57568','75254',
                          '61884','59679','47115','41460','21853',
                          '20287','92005','28993','27253','91657',
                          '36142','27533','53526','27781','90798',
                          '24011','17044','26039','41187','50580',
                          '90733','47983','48962','84785','40641',
                          '10826','72059','24274','55618','10538',
                          '70563','11614','35523','66686','62715',
                          '33141','25862','24660','39756','42026',
                          '26908','94325','56794','53914','31229',
                          '53715','96831','90766','15314','17719',
                          '21389','10158','56833','70492','52015',
                          '67166','80660','59747','31588','75827',
                          '16169','43278','29921','83805','36228',
                          '37735','17376','78775','26102','26689',
                          '23774','60333','10852','93461','49500',
                          '99837','66521','70774','16751','73976',
                          '32892','33902','19182','71578','11637',
                          '84200','35373','63667','17556','18083',
                          '17964','25542','67839','73169','35834',
                          '51356','42363','19950','16243')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
