
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15919','30621','11848','21430','88121','18807',
                          '11306','41530','29822','80137','75867',
                          '74058','87485','16847','14844','82887',
                          '22362','44250','55503','39158','23680',
                          '57326','81338','30516','28922','31997',
                          '29823','98841','36787','80904','31820',
                          '42861','90301','93421','66836','28659',
                          '42197','49171','29490','11394','49948',
                          '51053','26900','39419','45426','16014',
                          '31132','26212','56868','15313','64360',
                          '93775','44634','94759','36403','20408',
                          '91223','99284','47068','53769','89906',
                          '98068','87987','27320','51909','50540',
                          '69267','77885','58018','50407','94825',
                          '67049','84401','90160','83453','92480',
                          '13059','18098','92273','87003','66987',
                          '10318','95794','77483','67722','68824',
                          '55051','89125','68759','52841','32178',
                          '23657','18963','91992','16668','85702',
                          '67649','72384','52629','50297','13436',
                          '32275','58370','15264','26012','28682',
                          '34280','21399','84275','75326','74349',
                          '68176','29708','73386','30669','17197',
                          '78850','19693','42055','74430','62957',
                          '52570','23191','41451','40244','31079',
                          '18277','43565','82182','42724','28106',
                          '70873','83288','61936','66742','21059',
                          '79242','88484','86752','64136','84498',
                          '28069','94020','91793','12976','50184',
                          '29057','80853','72081','89422','61290',
                          '83546','19866','70199','15936','42500',
                          '59444','66372','24182','79450','78652',
                          '97343','43220','63213','39824','56857',
                          '82430','62997','98197','35453','81028',
                          '28131','78802','22675','35005','50394',
                          '26145','41133','41998','30073','61300',
                          '92894','16783','24004','50368','65752',
                          '89966','11343','65290','25017','26341',
                          '24619','31427','72762','51431','76947',
                          '38828','76218','99857','31700','33398',
                          '76288','94510','62960','58455','69441',
                          '94619','25474','88165','98884','51719',
                          '72798','42968','76672','46165','32581',
                          '41945','42233','76746','79284','60815',
                          '49090','76246','20500','60438','58677',
                          '14516','23076','22004','17446','83006',
                          '16144','28565','13966','24304','40229',
                          '21656','33883','51084','32591','28241',
                          '84734','58505','41859','38500','86507',
                          '15827','77517','35829','57099','33810',
                          '42644','72212','48060','11506','35865',
                          '94567','51161','14805','62032','62146',
                          '96971','23022','70448','27402','19992',
                          '31978','42494','55119','17992','22767',
                          '65532','41914','20532','34637','99961',
                          '49274','34035','86594','23409','28978',
                          '43156','10628','23471','14561','44668',
                          '74818','31891','46659','47212','27115',
                          '21137','20303','95792','46325','17462',
                          '96781','40904','71528','52882','66272',
                          '52716','17871','87126','77957','80300',
                          '19191','22443','89202','24284','15889',
                          '81880','32937','11131','63803','35229',
                          '46580','32807','11757','15352','88123',
                          '12400','70603','43204','91810','11277',
                          '22342','28560','24939','89216','80254',
                          '21301','45120','64042','78876','88902',
                          '93878','39643','75470','23405','82601',
                          '31932','29307','63961','70024','36216',
                          '52747','94437','89215','26033','53010',
                          '52780','16372','78696','29459','23814',
                          '62282','88282','22508','87135','52684',
                          '78867','68766','74157','10771','92986',
                          '54195','80084','43566','11825','49414',
                          '80575','92641','70405','11170','36178',
                          '21010','44944','91583','61583','73966',
                          '89599','56401','86117','17319','92975',
                          '27527','51216','57888','73213','48558',
                          '98174','60288','58909','38818','36659',
                          '88827','41504','80447','87822')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
