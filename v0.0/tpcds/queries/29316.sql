
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '52989','85185','42307','23910','91348','79331',
                          '13912','29627','34975','38310','69036',
                          '37089','10335','58536','83591','16424',
                          '53733','63906','32010','97197','53851',
                          '65101','80349','31962','30858','48902',
                          '97259','83843','95523','39426','52152',
                          '24049','85024','55335','49719','70587',
                          '56503','21827','44261','29732','30323',
                          '78975','90863','26976','28410','42334',
                          '27465','32351','11360','11611','80054',
                          '67075','72625','36466','41295','49470',
                          '73552','46064','59273','63601','80160',
                          '70588','14393','57799','69117','40618',
                          '21672','48293','50462','51236','41887',
                          '44347','60656','44185','62220','40171',
                          '75881','57885','29820','82115','12378',
                          '67578','24026','72991','19618','45188',
                          '45492','68047','78411','11826','83977',
                          '49004','66322','43593','88007','58949',
                          '27884','27733','93675','66145','33437',
                          '48594','53366','37871','86716','29044',
                          '13483','24598','31148','71109','14118',
                          '13717','22297','12465','55083','19140',
                          '15927','33358','17320','68078','86635',
                          '63220','63599','51344','22600','63632',
                          '30544','39303','91513','33381','17727',
                          '29331','12384','66208','67850','66584',
                          '10759','49663','51395','22070','11347',
                          '37814','35519','59723','90988','67875',
                          '98928','30406','35122','31360','28461',
                          '93308','21263','15609','60762','92365',
                          '61640','41344','70163','92005','46691',
                          '35063','29883','19046','36565','47006',
                          '79541','97301','31943','63575','14916',
                          '74000','79910','62976','14241','75220',
                          '24027','36932','32272','47217','16890',
                          '14965','44236','35581','44378','88457',
                          '90017','43547','91594','15211','76163',
                          '37604','56211','16923','80802','21786',
                          '37051','99322','53281','13059','66202',
                          '61015','67427','34756','20044','53262',
                          '22952','41618','34411','20975','41711',
                          '23346','20796','22816','10605','33575',
                          '25100','18140','21509','74466','58796',
                          '26621','74773','16473','29743','12476',
                          '63603','72872','50194','12831','81655',
                          '74834','13896','77644','29951','93161',
                          '77332','68132','44247','58351','83350',
                          '98655','34266','65677','78377','11996',
                          '78858','96975','91184','12550','28474',
                          '28019','77906','89993','86692','74609',
                          '45158','22605','27854','96072','53047',
                          '60461','14198','49977','64564','28476',
                          '17280','72343','93835','15611','32875',
                          '35577','59144','71091','29297','24582',
                          '28636','52408','74783','15620','14061',
                          '63639','55441','73518','35730','28616',
                          '62630','71060','61984','59012','15364',
                          '97242','65639','17334','12680','83337',
                          '20873','49842','69328','61786','47004',
                          '22204','67171','18306','60828','80466',
                          '17229','66307','46313','13873','37322',
                          '60405','81792','46568','47059','84609',
                          '93039','40375','70917','73597','92881',
                          '20286','72075','42674','37261','14075',
                          '43799','61535','48558','48610','31960',
                          '46199','36307','94367','24647','38112',
                          '92744','85214','76473','44257','20508',
                          '74886','37415','19933','50835','21595',
                          '64858','11429','30528','61189','25815',
                          '49656','91664','83240','86291','21938',
                          '93640','91584','79227','98249','22112',
                          '55311','10660','83426','62950','27591',
                          '82839','74974','48045','52705','23948',
                          '54302','41256','43641','78091','79950',
                          '26590','84058','97290','75721','35914',
                          '14900','77826','77655','11779','44536',
                          '16163','94151','90778','33085','24110',
                          '90249','47845','97807','12503','21068',
                          '15643','25607','48654','10140')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
