
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '61856','67703','80599','37589','50069','49206',
                          '24259','68051','98613','28631','34532',
                          '13377','10848','82576','85366','29689',
                          '16544','60346','31416','58698','63070',
                          '51692','72126','13985','47635','20737',
                          '98586','19183','94965','34676','46186',
                          '31567','85177','65792','93562','72665',
                          '35320','97600','15643','57643','41304',
                          '64144','19185','51160','21553','47558',
                          '87287','87603','70886','68593','55460',
                          '31153','64117','19196','61583','21229',
                          '81356','68274','68734','25398','10458',
                          '90380','12965','41021','84409','66579',
                          '25426','59010','88559','12738','53171',
                          '16100','80764','26442','62276','94111',
                          '66331','57879','67728','95149','90471',
                          '22972','29727','44703','97156','43269',
                          '69323','82363','28043','50957','69162',
                          '87131','46037','87805','10419','97583',
                          '57221','16826','25364','53046','68412',
                          '10097','22074','53206','89200','26803',
                          '19598','48907','19883','23666','67822',
                          '40713','57916','19443','52825','17291',
                          '71129','82216','82335','77840','46096',
                          '46735','36922','52166','80832','19315',
                          '68825','24987','32113','99079','46834',
                          '60558','77211','90873','56187','33602',
                          '23051','54898','12317','75883','46566',
                          '91788','62755','72488','40765','92538',
                          '27402','17456','41123','72820','16188',
                          '17827','95942','60109','31015','85112',
                          '68732','53682','23256','34540','61286',
                          '95588','83879','46008','10057','25753',
                          '18720','58880','49780','33596','80289',
                          '57234','70198','84180','33987','76496',
                          '32569','53514','62677','43346','29836',
                          '38467','78039','80682','79969','17559',
                          '15927','10270','29118','70793','56103',
                          '47758','74034','96711','38394','19924',
                          '46842','40416','67681','65412','18387',
                          '58992','89201','11671','53775','70854',
                          '23915','32562','21672','41166','31101',
                          '80177','68151','26771','13007','36929',
                          '94405','13014','66993','77562','87087',
                          '13343','43052','31476','91194','75105',
                          '93045','85086','29335','64867','46268',
                          '51165','82195','66159','63611','62878',
                          '37995','48036','57128','85159','36621',
                          '74035','53633','69959','92581','99099',
                          '89300','99284','47124','10800','64665',
                          '43541','20456','21814','34893','56694',
                          '32593','53623','85696','40531','60771',
                          '26314','21035','30646','29179','32432',
                          '18157','54114','87009','79108','78180',
                          '21374','29158','99619','21402','20761',
                          '94302','95155','27942','91890','37891',
                          '59210','50260','26507','21753','38997',
                          '12716','88514','47892','79957','27996',
                          '65027','67540','72434','56300','38789',
                          '13493','74382','81163','36412','95889',
                          '64808','95275','28285','39327','50926',
                          '57910','70404','87014','17678','58176',
                          '20289','88850','41085','14735','85670',
                          '24448','49517','21019','31204','78436',
                          '52167','54175','87577','16582','13259',
                          '77860','92000','40856','15345','31615',
                          '70009','17761','46821','42412','60822',
                          '28994','51503','12809','86304','29649',
                          '32907','29020','24525','43449','27228',
                          '85857','63412','89861','28807','45435',
                          '17173','38599','81316','46967','53454',
                          '83655','47719','74915','79270','16384',
                          '57361','82058','50979','83103','86363',
                          '78580','31117','13376','13584','39261',
                          '16701','29349','32923','79949','42750',
                          '90028','70316','35789','26083','99071',
                          '94688','25990','92053','13176','29027',
                          '91529','60534','54431','81830','45572',
                          '49683','29276','52872','18248','45908',
                          '41453','64630','76924','38431')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
