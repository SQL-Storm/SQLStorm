
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '35724','67196','95307','29550','79989','87424',
                          '81756','62242','67661','93835','71545',
                          '21587','81050','28081','29095','83322',
                          '56345','11860','14507','24596','77839',
                          '24310','10545','97669','82585','86388',
                          '12111','61894','10747','51611','46847',
                          '69340','18551','35664','70558','18135',
                          '22008','69114','93609','49863','60264',
                          '34585','88864','83666','42958','22608',
                          '65247','42636','52131','91440','22347',
                          '30969','86712','86966','42632','67474',
                          '45081','44581','15918','48152','99366',
                          '93250','12590','55255','89293','63870',
                          '34372','22224','40304','42083','69553',
                          '31612','42723','96888','30849','50753',
                          '85562','39981','31932','37754','56911',
                          '87003','25193','26795','42591','45485',
                          '11279','74537','50778','34451','63475',
                          '34884','47895','87667','38214','24157',
                          '21384','90326','27346','32083','55141',
                          '52554','11372','42174','20172','83847',
                          '27697','70978','99252','94539','57265',
                          '28704','40693','20582','87881','97977',
                          '39113','32444','67465','42373','60239',
                          '35883','31528','51628','28250','28916',
                          '40228','40488','85942','96092','73410',
                          '22288','38428','61300','48749','85246',
                          '38353','18869','41559','20235','46409',
                          '48743','42238','77441','77725','80236',
                          '61267','24961','59344','93819','71963',
                          '68348','50285','91839','85980','41843',
                          '23010','33408','42420','98320','36029',
                          '79281','64869','86974','97610','52998',
                          '83738','81552','13196','58736','23658',
                          '30057','48290','26343','32973','41992',
                          '46455','80664','10185','22907','28678',
                          '83068','30242','44698','25427','71730',
                          '23674','61728','99526','94863','14069',
                          '48396','93478','60286','56820','25243',
                          '31239','79876','31333','16396','16193',
                          '24827','86029','43825','87416','31116',
                          '12845','56209','85789','17610','20538',
                          '42737','42250','81935','98066','42333',
                          '47597','25741','39406','87868','22750',
                          '29984','58255','44985','96246','47492',
                          '57980','28463','97708','12664','20790',
                          '99729','81225','14451','10036','81285',
                          '11188','60279','97757','80774','22779',
                          '41875','53004','13861','91206','99796',
                          '63498','22902','55779','28355','22993',
                          '99853','54980','53508','95300','68279',
                          '59950','19267','13559','26767','24871',
                          '44815','80632','28141','24858','56047',
                          '50273','22299','38559','63648','95397',
                          '16622','78907','42269','79719','71074',
                          '79459','16043','32462','66746','20005',
                          '40067','92349','91235','98225','43244',
                          '25854','74878','17460','92629','80788',
                          '43870','93030','99135','58237','60790',
                          '87054','18454','43535','11520','59450',
                          '58495','12053','79060','97484','18490',
                          '70736','50418','25654','52980','79024',
                          '17755','60671','52525','89015','47043',
                          '56191','58375','20812','10437','96187',
                          '82223','83587','41217','95809','42051',
                          '16464','81131','93078','82070','38180',
                          '98118','13975','97900','61187','34804',
                          '58537','41857','72195','15762','33626',
                          '66392','25860','65988','54517','19230',
                          '13335','20243','46635','63368','74493',
                          '18215','81551','69217','40103','98341',
                          '47235','27121','42205','41303','38228',
                          '34658','89717','20383','84324','68712',
                          '22084','69497','68297','84829','59137',
                          '76034','18412','22512','61584','69485',
                          '38986','60892','28103','19908','41152',
                          '20781','35912','33918','85801','32790',
                          '37575','61751','28845','62068','20173',
                          '16963','71337','50170','34805','90610',
                          '60538','30021','42916','40984')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
