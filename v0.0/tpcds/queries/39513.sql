
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '65442','38627','53469','21455','51181','14800',
                          '87729','44248','59600','15387','50868',
                          '46688','52008','59959','47178','94857',
                          '97100','96141','57998','50837','21436',
                          '14052','60513','45150','17777','51721',
                          '72693','72464','88874','51635','63644',
                          '36325','58375','30146','30141','13155',
                          '23789','68447','31671','68042','19596',
                          '40272','56459','37010','54441','51105',
                          '72759','61299','92481','33149','20675',
                          '53754','54012','77591','10612','93309',
                          '82487','15954','84101','16963','47310',
                          '72330','90024','77645','18038','60185',
                          '34448','57504','38406','33603','65748',
                          '10510','76477','56795','85413','64119',
                          '53905','48672','51985','71736','12026',
                          '12830','82376','13357','73854','32619',
                          '31896','89787','18416','31626','81926',
                          '76837','14425','54136','56798','32061',
                          '37848','37107','65241','31826','70317',
                          '15456','74333','43286','66339','57690',
                          '54404','59764','71561','98543','33080',
                          '41457','60510','32781','49623','19793',
                          '63415','39847','90632','42220','67737',
                          '10309','27228','34887','95502','68610',
                          '52249','64450','67876','73668','54282',
                          '44572','12896','14379','63213','61407',
                          '99862','18059','13291','52461','67841',
                          '24742','41248','54180','22522','98496',
                          '60839','76840','29589','20076','28962',
                          '31300','38055','95381','66358','86409',
                          '56462','34968','58821','91117','89526',
                          '57957','73315','85489','22250','64604',
                          '30608','38908','43131','23664','59801',
                          '14579','42800','86339','30220','35870',
                          '34980','50339','62968','46634','20536',
                          '18590','97478','99374','32337','68377',
                          '20442','78635','22773','50110','16334',
                          '15236','85749','94681','31757','75877',
                          '10842','66140','39279','94619','49449',
                          '64592','78016','42393','34012','67331',
                          '22034','95930','33671','81529','25811',
                          '86589','51340','16294','77105','39191',
                          '41979','13934','91583','36607','24175',
                          '47794','46090','43180','31563','80018',
                          '48318','10977','13446','55554','62294',
                          '41589','63615','33733','47699','68602',
                          '57799','61267','59189','10009','80318',
                          '24784','74582','49376','93558','84366',
                          '25330','18433','97708','60815','47361',
                          '82433','27729','40431','65029','33925',
                          '15850','30325','54920','11019','28825',
                          '32861','16646','67887','71553','16041',
                          '98284','59945','21295','14607','81953',
                          '73171','24634','83674','39375','73693',
                          '95140','78261','15128','48892','58316',
                          '13773','48866','63233','90236','72924',
                          '43681','93486','55432','53679','83625',
                          '62613','44261','93426','11476','93683',
                          '85692','33652','48955','34631','13236',
                          '37849','43523','69227','43965','60535',
                          '82409','21378','19054','36623','79342',
                          '49886','72112','22546','30172','39599',
                          '24422','77051','32003','46824','25353',
                          '37998','46336','94723','42892','26325',
                          '89736','41497','45446','26748','47024',
                          '18645','33656','69743','49450','33127',
                          '58261','84058','45062','56042','71337',
                          '96625','96614','21133','34269','52059',
                          '15272','11711','40759','27495','52203',
                          '43473','71705','96432','22487','89927',
                          '15417','28286','32908','60473','63511',
                          '26168','76090','12659','11043','44745',
                          '71158','56480','33971','85448','35997',
                          '26436','42543','54509','11466','26219',
                          '25694','36479','80056','37210','88677',
                          '10800','15972','60263','60242','46882',
                          '88022','38955','34864','21984','61712',
                          '39106','78727','15786','14027','27622',
                          '16010','28015','39131','63716')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
