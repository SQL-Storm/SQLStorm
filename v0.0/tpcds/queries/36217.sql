
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '53778','12620','51925','70589','25721','98371',
                          '33411','35692','38794','40938','46933',
                          '15608','70478','30681','13052','99449',
                          '16430','18198','12577','94558','31689',
                          '63760','93131','72278','11973','57098',
                          '22185','67965','80713','14989','40959',
                          '24134','60785','22375','50026','84109',
                          '82879','30400','33291','21433','71238',
                          '26230','78264','49872','77885','29352',
                          '22636','13435','53490','55304','30909',
                          '12516','14630','17622','83371','24249',
                          '27363','67566','16131','12444','46848',
                          '14621','46048','27149','60780','69137',
                          '53333','28596','93356','16475','57536',
                          '39415','23607','19669','37831','95013',
                          '50266','41425','56722','65056','99618',
                          '35569','45982','36473','30557','71510',
                          '89542','26958','91261','11029','44344',
                          '89469','12988','74661','60927','73105',
                          '76724','55283','65571','63066','69088',
                          '66143','61090','42072','34887','17816',
                          '74792','34983','43931','20488','30113',
                          '38615','50524','42063','15121','45725',
                          '45039','25289','93001','94775','43398',
                          '17892','40263','48872','38769','54215',
                          '70088','32791','31219','78590','60773',
                          '48597','17279','27989','97818','51829',
                          '48003','69685','57712','58198','35450',
                          '98876','74226','14411','49059','55858',
                          '76383','24493','93954','96273','90423',
                          '66756','65873','18725','18086','19249',
                          '49215','24858','12151','11278','33046',
                          '14343','19685','92571','42316','21294',
                          '90479','25660','14133','39746','86687',
                          '39252','66824','36604','43566','13848',
                          '77369','32571','42389','32805','61567',
                          '27242','63444','85389','87211','63453',
                          '45318','53624','95407','59885','51933',
                          '13483','62319','13918','64929','31696',
                          '89910','20907','25679','54266','73753',
                          '26588','62201','43485','64992','94583',
                          '47479','83270','50400','60740','58817',
                          '18154','60248','24845','19013','47877',
                          '73748','59919','26508','62333','93876',
                          '79121','85891','24411','60825','54319',
                          '47772','40405','43932','85552','64865',
                          '43812','46148','63873','14672','22146',
                          '99985','51170','74368','23997','15896',
                          '46885','29915','42769','24041','59311',
                          '10733','19717','49414','19118','21198',
                          '29325','31324','81173','90098','81848',
                          '17629','68894','82625','23505','23021',
                          '43552','88848','37092','80393','74522',
                          '39416','41522','94954','98352','35145',
                          '32510','21453','67521','34209','78003',
                          '27430','39116','35919','35624','72025',
                          '57759','47789','10942','17329','68212',
                          '65145','74111','26373','51976','63387',
                          '67875','22132','91945','46410','14134',
                          '35924','76191','75979','15301','70433',
                          '18455','60053','32230','11225','96043',
                          '89666','23077','70330','12488','96593',
                          '99174','36729','95621','52930','52740',
                          '89614','36989','65198','25981','19416',
                          '60244','84262','43701','79698','37692',
                          '75101','40990','46228','91084','59608',
                          '15807','83573','13094','55278','60294',
                          '79142','94563','41325','59232','13511',
                          '30657','96330','77225','88072','49747',
                          '78440','56542','69908','73887','45439',
                          '33417','72573','18389','80274','42590',
                          '21757','39553','36180','55312','36760',
                          '72560','32964','27523','24106','30443',
                          '50979','49790','16341','94200','72930',
                          '50293','48027','41184','76754','36226',
                          '84449','19182','25392','11942','53082',
                          '83858','15925','96751','61967','39001',
                          '24178','11410','83752','91505','56363',
                          '29473','32448','63463','68514','79183',
                          '37400','53642','87291','74892')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
