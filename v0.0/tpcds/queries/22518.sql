
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '39026','56679','81184','65602','13752','28533',
                          '64583','81073','21785','83592','99186',
                          '41088','43719','42227','76766','37626',
                          '89057','35342','29360','22154','69108',
                          '94031','74213','48237','39793','40155',
                          '80585','11591','67838','11077','36156',
                          '76956','79206','40027','63605','20461',
                          '69470','36383','16843','22198','51717',
                          '44465','61178','99287','27769','35725',
                          '83554','48873','49397','62786','95158',
                          '46839','85563','17698','68469','90303',
                          '47672','61004','95052','34693','78413',
                          '56965','27076','85163','79239','11568',
                          '32663','79328','40340','10460','70391',
                          '23729','51074','44363','92195','71079',
                          '67369','70380','17161','62837','72400',
                          '83148','19413','72686','18226','30255',
                          '65704','39286','51470','66295','49257',
                          '39139','62227','75300','41060','18992',
                          '47272','94879','10166','10476','40784',
                          '71029','33821','13027','20969','87687',
                          '73407','25575','76171','33058','29840',
                          '88609','13265','88921','39723','10164',
                          '23850','86448','37586','63532','73469',
                          '16070','19925','33938','60200','35080',
                          '13187','96318','25648','68718','41083',
                          '66254','85662','62913','89056','12153',
                          '73600','96217','16508','99475','66437',
                          '47750','14263','35536','49345','46819',
                          '63625','26803','99015','23667','47926',
                          '96473','66799','36099','41974','28773',
                          '23189','93993','45597','38136','79222',
                          '51918','51744','75819','19130','48770',
                          '54792','52223','48603','22090','30434',
                          '10284','71032','17918','15859','29808',
                          '78927','62839','22534','94448','48054',
                          '99676','21670','90164','56307','73919',
                          '16573','63164','51839','53971','15474',
                          '67847','66519','20813','69686','23160',
                          '74310','11601','15203','81734','60575',
                          '10918','40709','72357','30330','22211',
                          '17211','56342','83269','88160','95377',
                          '36459','71033','16839','69274','75015',
                          '36552','40391','13224','23004','48386',
                          '62161','54870','47313','42871','31123',
                          '69348','34885','61123','27357','77085',
                          '71313','42232','30056','81638','28262',
                          '84562','13270','62624','20887','84873',
                          '32404','84111','64914','47485','44749',
                          '84345','84706','71650','66138','67095',
                          '91627','82053','62325','83924','30301',
                          '58895','99332','99810','12367','45110',
                          '34220','39627','39205','93376','20018',
                          '49042','79754','76337','36356','36476',
                          '58843','95050','21766','86245','24457',
                          '40558','32168','35639','22659','19345',
                          '36688','60466','19464','33883','71172',
                          '95891','21233','87116','95609','69413',
                          '23975','66061','53253','20973','57661',
                          '10493','53332','75573','16304','67403',
                          '37774','16842','53553','52546','48199',
                          '41909','18794','97500','72384','55991',
                          '36595','64412','83797','27744','67249',
                          '13454','17066','36403','59137','94416',
                          '84023','24999','72160','62776','61482',
                          '70577','60287','64567','86965','90601',
                          '60403','50031','18617','24893','15336',
                          '81425','96716','88245','92946','69194',
                          '46874','72464','22202','91879','28789',
                          '66449','25197','32959','65087','33391',
                          '85540','41340','40210','68791','26706',
                          '51644','39957','34875','71955','36887',
                          '28150','75259','32273','75675','54543',
                          '18772','23114','62780','48330','57458',
                          '36931','39334','48203','11469','52140',
                          '35131','81542','36963','91286','63449',
                          '47987','66856','79438','24666','23944',
                          '30632','52281','21972','62803','52887',
                          '73297','50011','87047','26373','26726',
                          '74478','39111','56100','81769')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
