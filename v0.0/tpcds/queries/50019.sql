
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '59935','96109','59617','41185','51052','41367',
                          '16889','68780','14961','32518','92727',
                          '77626','38929','51969','37093','28009',
                          '25471','35408','27942','98577','53184',
                          '48803','61092','80320','17658','61910',
                          '38069','41750','69459','26166','42991',
                          '29652','17734','33933','19409','62892',
                          '51984','68758','39687','17516','53513',
                          '61982','17066','35419','68280','18906',
                          '14828','74418','54905','79542','17581',
                          '95056','10465','18305','61573','55548',
                          '26893','50019','26792','76270','45272',
                          '10467','90636','74357','39364','66905',
                          '60596','24363','38269','56281','59993',
                          '30544','57173','34846','55459','85133',
                          '98771','77694','98627','45434','67451',
                          '36740','63845','27564','65074','21062',
                          '87642','26255','90881','15788','45215',
                          '25651','35855','78583','46262','11417',
                          '16519','62326','68416','76981','15448',
                          '62233','66735','40199','14876','33048',
                          '17410','75645','55139','66077','74804',
                          '21159','55188','16365','10240','42492',
                          '75860','58391','14274','98206','24039',
                          '76579','68737','42126','62093','16667',
                          '79784','54204','82000','95682','89057',
                          '80970','31860','43823','26369','25287',
                          '55917','32092','63777','10881','22190',
                          '74487','85118','11685','86662','73027',
                          '79079','25357','25265','28155','83570',
                          '52052','17437','64692','51181','14244',
                          '19707','58326','90343','67216','12262',
                          '62903','41769','96282','71806','55177',
                          '59297','16094','93126','12844','26736',
                          '54741','48142','58500','87935','96346',
                          '81713','87980','32781','99052','66245',
                          '99947','64934','14627','57921','14649',
                          '28311','21410','26071','81099','70683',
                          '69142','48992','45240','44834','41368',
                          '44334','62491','37268','33207','87551',
                          '43495','46963','21740','31605','36779',
                          '49813','66559','24918','10906','86244',
                          '89979','81833','17001','25612','46456',
                          '49790','97881','73213','15352','10071',
                          '56346','89383','39639','26636','31745',
                          '41919','54337','12357','15697','87351',
                          '64557','26774','43837','37667','27594',
                          '23777','23599','31644','11982','49525',
                          '14224','36002','15044','37734','29204',
                          '14148','52031','23884','18269','28915',
                          '41935','35200','14998','24406','24301',
                          '38435','17161','56610','70369','21781',
                          '29583','59650','13137','73317','82967',
                          '12057','77000','84627','39361','35374',
                          '38669','72515','70587','48628','16477',
                          '50254','17972','17106','58417','88590',
                          '67279','21039','67632','90006','79262',
                          '86703','54967','33216','27730','29388',
                          '31555','22775','99048','23909','94073',
                          '63144','85560','29662','80699','55803',
                          '22134','65943','67251','54634','19743',
                          '87410','56627','70510','64451','11289',
                          '52976','35636','90338','26807','41907',
                          '60684','36926','97580','46967','31289',
                          '58840','56401','11742','75546','26578',
                          '72721','77194','73220','22213','31583',
                          '67758','88058','76424','30050','32467',
                          '58513','83180','44329','34303','69483',
                          '34750','33164','74025','56217','19390',
                          '95767','14696','65882','96974','89321',
                          '68967','44262','32120','99303','47160',
                          '23571','55230','92005','34269','76947',
                          '43930','37140','26509','17508','51975',
                          '91829','29201','62753','31844','39065',
                          '85886','71202','56082','15101','12813',
                          '44070','52457','31493','38483','87115',
                          '16574','23376','38590','39920','54659',
                          '20120','31019','98919','15639','50694',
                          '74419','35572','57373','30095','56531',
                          '48474','57943','42937','62819')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
