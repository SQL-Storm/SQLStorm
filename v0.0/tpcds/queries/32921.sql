
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '35499','38200','71989','37013','68413','53825',
                          '91700','75579','83720','55254','42998',
                          '54930','13178','10180','79361','24940',
                          '90697','55359','58546','57609','51329',
                          '14263','24212','15105','74345','48451',
                          '38855','66732','72552','60713','62214',
                          '70616','15394','27763','92013','33111',
                          '82985','88706','61403','18927','47777',
                          '10908','93716','95560','74496','13801',
                          '80182','32458','20852','20685','26866',
                          '75403','52630','86609','74593','17328',
                          '83379','16413','21626','58685','22160',
                          '96030','27336','79216','91640','22402',
                          '13305','70308','57320','97914','26641',
                          '85438','54777','18996','70309','84390',
                          '99327','86168','57870','75388','91261',
                          '71266','77849','91549','62153','22015',
                          '57188','37269','28837','47432','13115',
                          '64675','73958','22602','18872','30502',
                          '23026','15062','65815','76365','69790',
                          '12010','55868','50717','16261','64206',
                          '95180','54824','16301','45415','40392',
                          '98024','57985','10431','68784','56332',
                          '98741','64124','15260','79464','83879',
                          '12895','29116','47141','66611','62514',
                          '60263','77762','42518','30890','30843',
                          '18516','54486','25097','41462','21073',
                          '10944','83845','16439','56149','88201',
                          '63452','19874','30758','19452','43658',
                          '32263','42411','76805','59017','11974',
                          '25964','58374','79638','98342','86969',
                          '38781','14748','21870','82570','60213',
                          '60729','21759','26245','92032','63102',
                          '38657','35149','54427','98191','50275',
                          '86224','68364','43616','17305','19339',
                          '29758','97389','84586','32239','15729',
                          '80680','26075','39443','45732','86630',
                          '17643','29360','54338','65114','13446',
                          '27935','11508','66112','12304','24746',
                          '69623','11140','97032','38846','87593',
                          '68801','52739','65188','17240','88017',
                          '91901','30702','16288','47954','61327',
                          '74108','34515','70368','50921','99650',
                          '59983','55102','37182','82639','62485',
                          '57504','39568','36277','90087','39813',
                          '40873','47636','81099','99152','48896',
                          '17062','11593','69245','49197','88160',
                          '71168','21580','18848','52126','79011',
                          '39790','66126','58552','12832','92627',
                          '71729','17690','47898','97346','26783',
                          '55361','25305','62442','46558','81726',
                          '21686','23486','14257','51868','23570',
                          '21379','34655','89244','94812','53502',
                          '69629','37790','92747','36841','20701',
                          '50811','96936','54681','12851','21813',
                          '25163','46757','44076','29662','59621',
                          '65642','60993','12321','32577','36642',
                          '22366','60785','61251','87260','66002',
                          '25962','16026','93463','30972','96524',
                          '44376','13740','70428','32173','33169',
                          '76090','62758','97716','11482','71158',
                          '39782','77579','24001','17470','42543',
                          '36855','32819','24693','85910','21992',
                          '49791','26180','42342','67188','77870',
                          '26043','92263','93253','28680','24554',
                          '41768','34130','15661','10558','59312',
                          '49793','59185','39446','60402','61016',
                          '48311','41091','90380','32260','78232',
                          '75554','49002','28472','13905','47763',
                          '10549','81027','36355','21104','11439',
                          '66373','11984','35968','74135','16260',
                          '72383','35571','64100','13749','48101',
                          '22089','13691','85236','71572','93140',
                          '45328','62133','78909','40228','24488',
                          '16213','13577','32524','13653','23516',
                          '16943','47066','91180','31278','62682',
                          '89107','13916','55635','17056','20579',
                          '65471','13626','16779','62874','15007',
                          '26504','52170','54406','85026','22252',
                          '26372','93968','40493','29214')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
