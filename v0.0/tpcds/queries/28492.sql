
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '37713','14975','62048','15500','10471','50060',
                          '18169','37525','23682','59937','44560',
                          '40185','90870','92282','67369','73840',
                          '27030','97934','85475','15752','54040',
                          '74906','38916','50220','64959','55306',
                          '78071','17321','50120','58153','79367',
                          '47040','16183','62938','61775','69454',
                          '93472','21030','77311','33334','87351',
                          '93873','27226','66228','75082','77752',
                          '27925','24219','90024','43207','28977',
                          '80237','17736','44231','15067','81367',
                          '79035','77195','69058','44728','34833',
                          '30448','66630','37221','35330','26532',
                          '86496','93933','84460','62144','15429',
                          '72054','17470','30699','17809','97927',
                          '52293','28822','49579','40507','88987',
                          '20345','13538','42947','62450','50348',
                          '24040','53338','14596','90685','23298',
                          '56628','89692','52896','51129','69874',
                          '94532','15066','84208','20454','25104',
                          '54594','28610','69071','56383','57408',
                          '72861','66834','57096','34554','40801',
                          '71342','81631','97711','29165','22972',
                          '47882','22879','19704','14308','73569',
                          '99548','52152','59531','21328','49395',
                          '63348','36426','11194','29309','14003',
                          '37295','73943','96446','19337','67366',
                          '14313','32789','96183','29383','54665',
                          '42869','95901','43957','55184','32065',
                          '63207','79337','41328','35394','13306',
                          '17418','47814','26542','96121','14131',
                          '99769','44264','31424','24598','17477',
                          '65087','89098','74256','29569','43100',
                          '95732','82207','65264','44153','62165',
                          '91992','33557','25506','79279','48754',
                          '25417','48274','71257','41566','20684',
                          '44711','24053','63552','50368','25258',
                          '13271','12883','55203','45492','32083',
                          '67738','98530','25421','39214','61243',
                          '28388','27912','31249','95141','88721',
                          '77238','48131','37956','50587','58200',
                          '25541','16868','54345','78762','38048',
                          '40587','22284','21899','41154','17528',
                          '30058','17396','93091','18675','32454',
                          '44425','81704','94726','64715','88429',
                          '67775','84779','84018','17154','17481',
                          '24190','42657','20030','92517','54492',
                          '26328','15445','19743','20153','32993',
                          '31548','20053','46213','49870','22056',
                          '13759','95403','25577','93484','86858',
                          '36808','61749','68882','63788','26873',
                          '64229','17454','21977','21864','28543',
                          '50662','42297','48575','48815','49654',
                          '87771','31009','22159','96654','47420',
                          '15703','54297','16831','16107','84167',
                          '65998','12306','64509','17653','20741',
                          '12627','34588','17149','32446','21293',
                          '84288','24423','41712','81552','91636',
                          '10828','75605','24713','60674','81058',
                          '26056','62743','15767','83764','21463',
                          '26888','22890','73819','17582','98356',
                          '53474','36904','91098','14349','61268',
                          '93166','42885','83707','66017','43672',
                          '38927','54422','36357','87295','89790',
                          '82062','72818','27760','16954','36861',
                          '73873','20877','20164','49047','41034',
                          '94947','88527','19631','87500','50063',
                          '83448','61601','39072','33582','46666',
                          '30656','86281','43530','26370','91158',
                          '67468','23409','54364','94413','14358',
                          '49302','54686','75682','82273','43019',
                          '25859','22236','55635','65379','94514',
                          '27984','35138','76999','17720','93766',
                          '62128','84827','22204','15950','49268',
                          '54429','87602','26661','56650','25869',
                          '29037','85031','66398','62460','79132',
                          '62297','62719','40898','46979','10058',
                          '41781','45245','48055','36346','54475',
                          '37838','25436','27069','74053','43289',
                          '84646','13999','43227','96299')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
