
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '43647','33734','15205','74826','15319','70183',
                          '86411','14350','41640','29101','51947',
                          '22374','28689','40018','79665','36164',
                          '33001','87532','83499','19483','73201',
                          '47177','69958','90812','24510','79723',
                          '58166','89336','33386','30232','30376',
                          '20929','97609','43267','22175','65542',
                          '56980','86867','15978','16768','76489',
                          '68070','23765','73092','70747','18430',
                          '36421','34504','21505','12444','69866',
                          '49596','66822','31280','31177','27709',
                          '40649','67893','77255','38105','57044',
                          '56868','66585','32265','63336','69105',
                          '71361','22977','58035','56652','36351',
                          '21991','22333','23869','80679','38263',
                          '90582','47758','11720','26967','98822',
                          '29663','29956','14006','93218','44473',
                          '41981','74541','14831','27021','50691',
                          '28906','39830','43009','66382','42263',
                          '64963','52526','17293','45302','22350',
                          '49501','79592','43305','76471','89795',
                          '82231','82914','65001','43731','73157',
                          '86421','92284','16057','55370','15149',
                          '71068','41838','29953','44738','55515',
                          '74010','25945','39257','21553','99063',
                          '42772','12080','82295','26708','27936',
                          '19224','17873','10741','16657','79675',
                          '76305','63134','64329','61147','60204',
                          '90692','72902','48692','77922','95430',
                          '17291','45165','59251','22568','60502',
                          '77793','17439','14371','32544','74357',
                          '76889','21031','81486','67526','53175',
                          '17172','54588','18749','95610','68698',
                          '77794','30441','98528','27575','70907',
                          '10464','45774','16527','12728','15526',
                          '48687','90737','55566','14855','44234',
                          '12779','24067','52627','18032','64798',
                          '55983','67129','26494','52708','66415',
                          '59715','90909','28774','66954','10269',
                          '95896','87905','22934','23599','47482',
                          '25699','15076','23126','12381','53394',
                          '24648','25106','68824','99491','86101',
                          '21919','38279','95120','48814','20002',
                          '51497','59915','45283','24621','30405',
                          '17282','27982','33238','22722','15140',
                          '56793','33753','15056','23669','58596',
                          '65326','95394','12292','62236','35928',
                          '60701','17837','97727','52382','30140',
                          '19358','29398','69367','51196','18437',
                          '96032','51492','92809','67173','53622',
                          '34996','75386','82397','70081','87615',
                          '43526','47397','22038','14848','99146',
                          '82400','55763','13955','68443','29854',
                          '45378','15091','20506','61865','17798',
                          '96381','24419','81353','22736','44639',
                          '77977','84432','26651','40920','30883',
                          '17012','28216','20423','29228','16028',
                          '54207','76977','66871','90427','73098',
                          '32987','34914','96619','63356','52100',
                          '52404','47392','55051','15391','81208',
                          '35680','13009','16951','38177','84846',
                          '97335','29931','18747','29768','95074',
                          '68168','46609','42026','77987','47563',
                          '28119','37667','52359','59083','53153',
                          '52669','84330','96452','28131','36026',
                          '65489','81957','37066','77780','37149',
                          '55932','98441','87042','57814','37867',
                          '28127','47521','19408','35023','56849',
                          '79825','73680','54790','16385','12265',
                          '76598','66035','69612','35589','16055',
                          '31665','53538','67535','74816','44101',
                          '20744','93138','38268','74324','91797',
                          '84415','31868','15657','18371','40968',
                          '94285','70088','83413','42091','44749',
                          '33825','28010','60908','80898','48559',
                          '10042','14833','25492','29439','85285',
                          '52507','95331','76866','39644','58729',
                          '30575','19843','72964','22140','24618',
                          '61604','73193','36088','52593','22406',
                          '44700','94910','42243','68986')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
