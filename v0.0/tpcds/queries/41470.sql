
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '44711','33839','20458','70005','44639','51312',
                          '87509','30356','62936','43886','22839',
                          '68188','31927','21358','46143','14744',
                          '22439','29655','91565','19585','33166',
                          '17059','44795','33358','50223','27364',
                          '19789','37668','64999','39513','31407',
                          '35596','40458','49748','45679','50252',
                          '53040','30342','69074','49619','31771',
                          '35626','81947','99163','71388','90026',
                          '15038','62747','24624','70799','67355',
                          '88406','67621','36364','94260','20004',
                          '64678','43764','82964','59922','96952',
                          '39764','21073','23101','26443','80789',
                          '95574','33207','45528','37873','95490',
                          '27117','38279','68287','10378','13386',
                          '23783','12476','86271','15411','92967',
                          '31439','62508','81729','72056','38754',
                          '69107','25174','32667','77950','38525',
                          '33445','80245','17394','66165','87878',
                          '11051','70632','25784','44152','34130',
                          '40098','43645','26704','10700','20962',
                          '74777','28371','80720','89732','21778',
                          '97584','47476','52289','19350','99649',
                          '54414','77656','76745','18115','78924',
                          '61493','81562','81659','39534','88964',
                          '84688','60827','28068','48442','92430',
                          '35927','48801','10432','14621','38638',
                          '27451','64607','69627','78515','97019',
                          '27712','18315','56737','18337','25747',
                          '38079','15212','45824','89407','22134',
                          '76080','62805','32114','52481','30166',
                          '48984','25905','94007','92229','31596',
                          '61816','98553','25528','51811','13559',
                          '86459','90455','10704','45635','96322',
                          '82077','16490','21660','63805','66216',
                          '31749','22314','55932','32577','16148',
                          '29448','43595','13395','44952','79762',
                          '22977','71411','58311','88368','23980',
                          '51715','46380','19714','42016','28843',
                          '85741','75130','40315','21376','60495',
                          '38454','65801','12287','18318','61079',
                          '33585','73266','30662','66749','22731',
                          '78867','43512','89749','43303','49675',
                          '24445','39681','36895','81079','90776',
                          '49751','32479','50712','36039','32739',
                          '94949','10668','31212','89625','15812',
                          '11728','68138','60563','27808','61149',
                          '99333','40535','76110','36834','84916',
                          '29354','57474','21571','18711','49983',
                          '82171','29633','12579','43832','25959',
                          '49973','46635','70810','54215','53037',
                          '71427','97832','76927','78875','64499',
                          '24589','91202','22843','13975','63177',
                          '15618','21994','13016','28804','70030',
                          '17919','78844','79629','22888','69977',
                          '21562','57231','41665','85863','26674',
                          '85861','70521','13259','90857','40670',
                          '10425','36680','64273','92948','48907',
                          '29218','86634','15089','29500','44178',
                          '44469','56928','17246','49250','47455',
                          '94112','76723','24048','32583','65960',
                          '14022','22520','94517','56348','12078',
                          '86739','77065','54339','36934','18260',
                          '16425','57293','13008','64477','31924',
                          '91948','91413','64726','79365','27394',
                          '26500','55662','63273','48232','75503',
                          '43008','49507','31906','46621','65396',
                          '10669','98964','36016','10848','34018',
                          '15187','29690','79329','63603','44020',
                          '90684','32858','19297','88687','20499',
                          '51861','94450','68368','67265','22087',
                          '81717','29235','74876','69009','91988',
                          '24139','28440','38739','99103','29229',
                          '85119','18932','24162','45487','69750',
                          '18755','75116','49823','33430','31142',
                          '11564','36130','76388','30950','94891',
                          '38289','58038','32053','26381','68197',
                          '88881','13683','73751','33435','67496',
                          '84517','49007','48542','36597','59351',
                          '37338','33690','36558','87840')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
