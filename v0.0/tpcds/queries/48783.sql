
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '54547','14009','57808','53500','31332','50532',
                          '51770','70662','76955','39596','14295',
                          '26267','78488','11350','81252','82008',
                          '29390','26297','76366','12213','56488',
                          '75692','24394','20012','88356','37119',
                          '63141','43526','72915','65761','18815',
                          '76376','34788','18258','93046','62788',
                          '41065','18667','96012','64205','57444',
                          '20854','40051','17608','35034','68727',
                          '25459','34411','59154','78298','40627',
                          '31152','44680','26710','89059','77772',
                          '10193','21888','27128','71627','58933',
                          '23601','72357','37184','17240','29949',
                          '57765','95621','40393','43370','55190',
                          '87509','44780','95141','25946','59176',
                          '17948','93575','22003','40213','86155',
                          '67052','72637','13923','33860','30836',
                          '73921','61654','10431','47253','41445',
                          '26441','13766','95047','24812','63735',
                          '22760','34857','66155','17872','98226',
                          '24400','64746','15825','51803','99799',
                          '39003','88439','80116','68004','33377',
                          '70158','50809','70382','97456','21192',
                          '46953','98231','83506','40185','88343',
                          '61465','46420','14688','16252','55909',
                          '82976','27728','47831','71003','15919',
                          '23628','46258','77254','64585','82295',
                          '56914','97721','23964','70271','71374',
                          '48474','90921','28456','14918','11244',
                          '25749','16589','91058','72499','84942',
                          '88749','96223','39925','78360','69368',
                          '33828','65711','16875','78927','22253',
                          '76721','71738','25685','59582','10076',
                          '10390','40786','99701','98081','37251',
                          '41264','53924','16680','45120','82950',
                          '39180','25948','53508','47736','13931',
                          '17447','49144','12969','37754','15568',
                          '23384','11788','41487','30146','92149',
                          '79110','16611','10508','43208','32524',
                          '39943','60520','76464','15592','24986',
                          '74293','27418','28828','37422','58692',
                          '98807','98117','34382','91606','46683',
                          '38697','27672','66331','17077','23752',
                          '38022','53751','37579','73152','64740',
                          '59461','18673','35133','47271','69801',
                          '20558','47275','13787','28361','44476',
                          '49408','98940','26570','77435','32805',
                          '10804','47801','73157','54801','52564',
                          '61698','78809','78762','79400','53685',
                          '27427','43320','34951','21719','88277',
                          '81128','20187','19745','51193','16790',
                          '19633','72689','98658','12399','25445',
                          '96172','97902','88918','44040','27251',
                          '23400','29215','19711','14736','36109',
                          '26484','28861','47851','85627','25508',
                          '87718','28651','81654','10740','58223',
                          '65293','22171','31216','28562','36636',
                          '53155','90255','95417','67250','81937',
                          '66068','40687','21923','27246','49951',
                          '47877','57571','81621','32897','14110',
                          '14747','78297','21514','55929','99947',
                          '86438','31357','68534','43234','14994',
                          '79985','52820','63740','31477','10388',
                          '91297','18932','84052','27800','50703',
                          '32708','25788','54818','41589','68273',
                          '61488','71657','89463','51687','21151',
                          '44512','67647','40019','26027','41891',
                          '89347','74873','32447','26663','48538',
                          '88908','14936','93557','63102','57119',
                          '51532','38384','32925','63284','60186',
                          '64147','25071','65783','64549','57224',
                          '75891','14015','50020','86977','31830',
                          '23724','99949','60759','94145','60306',
                          '58835','21248','19052','90788','35660',
                          '52304','57192','26226','81004','88123',
                          '27014','31893','21943','11466','80177',
                          '78206','62603','68420','11037','44980',
                          '86106','31688','23410','32557','14284',
                          '99749','65280','74105','57138','20999',
                          '22286','14762','21028','14822')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
