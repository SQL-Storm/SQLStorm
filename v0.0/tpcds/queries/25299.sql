
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '18886','48781','21375','45910','22770','35382',
                          '64100','16420','28760','19490','15038',
                          '23329','60312','99430','29550','66192',
                          '37740','27220','79945','30148','23271',
                          '66381','29522','51427','47698','73092',
                          '10556','78529','89415','68636','65037',
                          '14552','85577','96639','44137','55230',
                          '77134','16793','29870','50079','89599',
                          '13788','53015','36975','43997','22695',
                          '55721','43404','43335','78243','44570',
                          '39704','45666','18717','67336','67463',
                          '21744','14672','19669','35835','38127',
                          '13892','70049','46913','75697','69406',
                          '19187','21821','36744','36312','60286',
                          '68848','78199','23335','22860','66057',
                          '82581','63247','40487','22913','89585',
                          '29536','19955','10068','11777','21460',
                          '24987','79456','48990','62923','12538',
                          '59452','21173','81565','71948','75581',
                          '12479','76204','16288','89547','38566',
                          '78698','42882','53940','72818','71796',
                          '16261','29439','72914','28887','85354',
                          '10215','53991','72804','11043','16361',
                          '79905','83513','61589','25197','18069',
                          '26489','30765','57089','72155','29779',
                          '52471','45295','12824','11789','92749',
                          '12936','82090','18503','20643','12774',
                          '98059','29299','74502','14917','76040',
                          '12408','16653','80805','24277','98718',
                          '21803','58362','86420','21844','10275',
                          '87038','67101','72374','29426','17665',
                          '24136','24239','49877','33971','42113',
                          '58871','70965','24835','38313','11134',
                          '58880','92716','18684','32050','36208',
                          '30595','58496','36652','31828','52814',
                          '46187','78230','12561','58541','18699',
                          '19673','22022','63102','12878','84236',
                          '86604','20055','10065','34757','33897',
                          '29466','91516','77615','24190','71685',
                          '87450','61766','55659','17865','49284',
                          '18787','94089','12644','27731','44136',
                          '42863','49741','68854','50680','38163',
                          '48909','74163','73757','11027','19548',
                          '27183','86328','24378','58598','73351',
                          '30962','73518','16097','28508','57736',
                          '25250','60226','73344','44097','82320',
                          '60096','74834','90319','49297','76710',
                          '63675','79259','64833','41648','58387',
                          '12791','94739','64045','88759','80869',
                          '11111','16878','49836','30459','73511',
                          '40481','55629','18390','53675','13919',
                          '26584','38223','25335','29142','89691',
                          '53682','24921','14098','39176','24714',
                          '43447','80832','76389','72005','83733',
                          '25793','65021','88269','86665','55188',
                          '58206','53026','91806','45314','54809',
                          '85261','77421','57896','93164','27959',
                          '22766','81853','66249','95447','38701',
                          '17996','41328','12969','39823','11099',
                          '14963','45277','53430','48543','19237',
                          '67958','43657','26767','21600','13328',
                          '53252','51319','18904','18843','25181',
                          '52159','43127','86399','16783','18726',
                          '12608','88872','27655','75978','31942',
                          '59048','16755','95379','18956','20509',
                          '21356','12509','39138','67202','14257',
                          '19444','52544','18906','93012','71421',
                          '74941','98350','37756','13413','52719',
                          '39905','42284','44281','26623','20411',
                          '69216','38735','35201','85752','46754',
                          '22397','24192','75380','85095','77064',
                          '23168','40691','14125','24196','75665',
                          '23476','66784','97367','82044','60322',
                          '87241','29124','36252','41874','77427',
                          '26675','11303','55533','37019','54931',
                          '21651','44199','53242','52119','38912',
                          '34731','21036','10485','17482','52705',
                          '19865','48464','38311','48458','83383',
                          '87620','68780','92380','11648','21283',
                          '62163','53288','47522','91821')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
