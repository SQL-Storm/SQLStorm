
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '98545','32205','72884','48150','25373','13067',
                          '84413','46576','34356','38123','37443',
                          '21459','76102','22801','67660','61724',
                          '42009','23780','23878','10721','42400',
                          '42121','17280','39332','29590','29601',
                          '75200','99214','20333','52425','78232',
                          '19816','25683','73784','23233','51752',
                          '46510','44421','64981','34229','13328',
                          '44758','54267','61268','75611','46875',
                          '60283','89716','59230','19578','83188',
                          '27748','17006','45945','51833','58108',
                          '38472','62324','32019','43550','14591',
                          '47358','24746','73044','91666','84859',
                          '53748','27285','17540','53400','21616',
                          '18347','58187','40945','22826','78131',
                          '40473','99703','98720','11690','28061',
                          '11321','25219','45602','54103','49418',
                          '91442','35392','46372','73731','21043',
                          '20896','48331','26576','81646','44793',
                          '86014','83046','48138','81371','10583',
                          '44811','45642','66930','48545','16657',
                          '58292','23234','16616','90824','50268',
                          '13630','15165','11165','64844','17824',
                          '33178','43795','55176','69115','52462',
                          '20274','72276','49265','11616','33893',
                          '42138','19311','73056','10715','11596',
                          '72118','57189','13244','43911','81339',
                          '43599','11949','96828','91287','73169',
                          '57009','22642','25781','64453','80227',
                          '41309','23923','11750','73638','92132',
                          '27579','83847','47619','94919','54170',
                          '26370','24093','44511','37672','53830',
                          '55783','53827','26597','41263','58565',
                          '47274','37775','33892','68336','84906',
                          '13991','86697','51594','81269','59741',
                          '94991','56269','19339','38683','82326',
                          '93517','29872','29375','68133','65788',
                          '99774','77246','38710','14208','94831',
                          '58662','81898','90295','54938','63540',
                          '87051','74108','53255','43151','44887',
                          '52845','83792','20633','24407','25794',
                          '20108','85410','32229','17834','37743',
                          '42682','97629','14342','92341','30730',
                          '35702','51129','20517','10760','72941',
                          '49317','42285','63082','38076','66151',
                          '79434','14405','55608','44926','62183',
                          '52512','15998','10598','60439','35173',
                          '72703','78741','72503','21647','32503',
                          '12111','27556','70494','45236','41576',
                          '65838','84074','70854','21691','42255',
                          '62840','56096','17964','43269','94018',
                          '14787','14577','28413','78639','27206',
                          '57443','87329','89900','32086','22117',
                          '82427','99190','69022','64154','51539',
                          '60882','76935','18353','94994','28321',
                          '88022','18378','34776','29419','78939',
                          '99438','28322','17463','47778','53172',
                          '27213','30363','57278','65434','26518',
                          '40213','97378','33763','67150','60233',
                          '60762','73830','12858','16230','59704',
                          '91805','55949','20403','59051','75787',
                          '72500','40738','47509','12610','21963',
                          '89684','79094','66736','18921','57406',
                          '74792','26068','76636','53472','73168',
                          '50489','82136','47819','31837','72025',
                          '35785','88433','66450','48661','97533',
                          '64340','56412','90115','15398','67125',
                          '26261','55422','39589','11025','63412',
                          '36553','51344','79096','49041','66121',
                          '39138','88202','25514','57153','93816',
                          '65272','96767','83734','89607','21285',
                          '75523','87582','79203','82708','21454',
                          '18952','12775','72525','80283','52527',
                          '14255','28269','98941','62535','65701',
                          '21311','24852','39745','85267','77311',
                          '58731','43112','79188','60754','48660',
                          '62067','59262','64912','90367','19775',
                          '18714','42314','17604','13245','18773',
                          '67276','15665','51285','14312','22030',
                          '23260','93076','77002','15906')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
