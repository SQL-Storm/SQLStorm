
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '41780','97804','43190','33502','35786','92368',
                          '20025','63492','16303','75015','23900',
                          '95518','47072','78243','10903','49529',
                          '62331','54907','95417','28699','33068',
                          '95278','12917','29634','41217','13991',
                          '21646','72963','19282','27669','80567',
                          '47793','28804','10214','11503','35091',
                          '57008','27484','82020','36341','43664',
                          '28173','56732','23280','62034','11058',
                          '43033','31869','81971','49754','61798',
                          '54293','59853','35343','16361','45112',
                          '27407','25736','71278','35899','62937',
                          '34372','83981','92452','81008','23456',
                          '38316','69505','90618','11369','74855',
                          '39062','30661','23389','88027','60835',
                          '63508','29470','23698','34940','44781',
                          '61619','41079','55370','11485','23259',
                          '33546','10717','56530','31618','74169',
                          '11082','91198','72706','14786','72161',
                          '22684','97301','87373','44017','37984',
                          '48039','75896','13511','86878','13451',
                          '67735','45519','62459','26152','19043',
                          '69386','13435','65287','39437','52805',
                          '29054','54231','69281','21136','59255',
                          '51461','21372','43391','28508','95137',
                          '63520','61894','83648','44822','16682',
                          '91074','37033','77056','34099','44995',
                          '95557','13363','45799','96459','48542',
                          '69219','46309','42857','13437','22139',
                          '14043','25121','48854','23048','45722',
                          '61263','93063','34756','70465','57143',
                          '97852','84759','92291','93155','22115',
                          '92104','42808','93584','33713','73910',
                          '82158','31399','42496','78997','53747',
                          '14860','23746','14343','44207','57632',
                          '91239','31962','66638','34560','91370',
                          '15670','32507','53568','27898','69545',
                          '80777','70328','88554','80841','47687',
                          '93312','45061','20615','95743','62801',
                          '96900','83329','30073','11994','11655',
                          '13151','44373','48406','13109','89071',
                          '29526','10635','12350','12855','37252',
                          '19596','31742','25214','57655','39330',
                          '66862','59482','15838','99387','42188',
                          '55566','66467','92939','13382','92687',
                          '69789','84612','52725','33027','96501',
                          '82235','29673','14202','43586','14680',
                          '71989','42307','99920','74586','62920',
                          '72494','77184','33050','25089','24644',
                          '73403','21856','68067','74026','55891',
                          '32587','12407','10901','79989','21297',
                          '46494','81966','30500','65107','73050',
                          '45415','16572','82423','36288','19585',
                          '99487','63617','57810','41871','46112',
                          '29962','32724','42705','65573','10814',
                          '70185','10848','14457','76786','11189',
                          '79471','53023','24260','72622','12325',
                          '59627','82542','46303','25286','25566',
                          '90936','28216','23510','82658','43300',
                          '28206','54521','84864','72708','40085',
                          '25275','77596','37529','77203','22035',
                          '82100','29201','32553','73687','51307',
                          '27161','17199','20052','24817','82073',
                          '59714','22058','18149','61496','22286',
                          '24314','51422','57561','53386','32956',
                          '31170','39380','99717','19489','81820',
                          '29660','87158','33871','88063','64039',
                          '99184','49912','31909','96024','15515',
                          '62089','51743','35851','26329','23625',
                          '45866','17594','71190','75905','35334',
                          '16135','15718','75101','44958','90862',
                          '48533','58734','12012','43095','31627',
                          '35983','22370','79187','95409','87166',
                          '23045','23692','15479','90744','16992',
                          '93897','33921','96538','64662','66906',
                          '75554','71678','16760','74823','12351',
                          '24099','57415','45574','27863','95716',
                          '63143','83028','51484','23511','24999',
                          '61772','44726','86608','62141','31591',
                          '83426','38579','59770','20467')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
