
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '61704','81231','62919','72686','62450','35467',
                          '99717','21260','24342','34771','55210',
                          '79767','41760','72670','70682','84909',
                          '66162','12328','60724','26888','89478',
                          '56807','45418','56422','58403','67963',
                          '54484','52340','47754','32572','84349',
                          '56729','54367','54045','67163','86641',
                          '97692','36759','69254','32332','18072',
                          '73068','93106','44130','36903','57753',
                          '90258','38450','82047','24522','50644',
                          '33583','78220','58542','95722','88188',
                          '83098','40294','43114','11844','82629',
                          '39731','96440','79516','47393','99084',
                          '88064','91140','88352','68978','27699',
                          '41955','67369','81262','56822','61304',
                          '48624','33074','42837','40644','11350',
                          '17076','74146','71074','85712','54910',
                          '94176','30656','86037','89270','50196',
                          '33497','67344','47773','40672','20381',
                          '63421','32466','74898','28418','97632',
                          '42068','47926','81540','82201','31193',
                          '31300','39593','21886','45806','82326',
                          '27145','68077','69747','60823','11395',
                          '77196','90236','38964','77070','78876',
                          '67450','69156','12993','93655','20252',
                          '50769','25291','51471','83570','12862',
                          '21995','11160','44008','30370','24174',
                          '73971','36480','45350','68822','20149',
                          '20433','49249','48895','38996','20776',
                          '24711','83078','89049','55066','67023',
                          '33841','71394','74818','43018','19803',
                          '24125','46152','17503','11959','13382',
                          '71493','57325','53300','40550','22470',
                          '37347','25755','12401','26150','15567',
                          '38695','65199','58447','68386','54559',
                          '48287','39552','22088','55657','69877',
                          '23130','20158','90999','52393','66510',
                          '95031','22537','52656','23266','19507',
                          '18491','14350','10389','76163','87643',
                          '50605','10859','93997','63978','44548',
                          '61112','44994','85778','96970','48197',
                          '18276','71071','29483','96346','32536',
                          '11059','32347','14853','34293','51280',
                          '34608','35638','59726','12184','89136',
                          '37598','33801','97548','22602','47999',
                          '10698','43913','39338','74346','29873',
                          '60307','79724','67956','25504','35339',
                          '21145','74026','30044','21933','62086',
                          '38068','68005','90916','97549','68705',
                          '17525','53154','87751','79582','45381',
                          '20958','65933','20591','55218','48049',
                          '15033','22079','48812','91897','63446',
                          '38498','49553','58853','12793','99416',
                          '93323','19170','10237','86726','76651',
                          '15369','31881','11244','16067','51774',
                          '96090','58094','53546','58247','19106',
                          '16649','77797','85327','59141','45536',
                          '75568','26337','22988','56823','71990',
                          '92738','34318','95829','28552','33994',
                          '21521','19461','22650','61838','24633',
                          '50122','96215','87583','14414','71164',
                          '53571','63937','43123','10428','10965',
                          '74794','45519','98952','89724','89972',
                          '16801','15402','20826','79714','14211',
                          '13162','89253','68050','95903','56880',
                          '71097','89358','82521','38606','64674',
                          '73234','90441','57157','42018','16269',
                          '50878','16614','82849','34770','18387',
                          '77989','11744','10397','44216','59662',
                          '24002','44252','76993','82365','40810',
                          '36714','62268','18232','39473','41626',
                          '40609','63262','92704','62721','63001',
                          '49009','83638','31995','23384','72441',
                          '27685','49849','73459','67126','37771',
                          '97464','30615','95730','43116','46138',
                          '11453','27014','22255','58813','51664',
                          '77834','46096','58368','61020','18321',
                          '12198','42591','33450','86501','70629',
                          '90404','20845','16967','87249','15585',
                          '10832','26158','36061','46938')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
