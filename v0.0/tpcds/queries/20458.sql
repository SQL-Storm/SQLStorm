
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '53154','63582','60652','45263','23462','65901',
                          '44764','55997','69794','93271','21332',
                          '19220','93273','77717','27524','51037',
                          '84428','63620','49223','63718','40972',
                          '44907','51634','71486','43471','54543',
                          '10991','94683','81464','19457','49803',
                          '31328','11624','93068','58302','26040',
                          '28368','22896','16927','64931','61547',
                          '66547','41530','22731','39130','20347',
                          '31906','22226','85695','54905','35784',
                          '55770','12572','14840','53170','46515',
                          '55599','83571','88039','35687','76536',
                          '30863','15617','28525','53028','97356',
                          '74197','60756','18476','44644','32386',
                          '31767','31215','17124','48518','42056',
                          '39859','16036','17194','68015','61532',
                          '17841','22679','30757','12973','82860',
                          '55073','73389','49929','80266','30177',
                          '90668','13335','38455','48465','42869',
                          '70890','77934','31347','75763','37486',
                          '57309','90751','32878','71441','15157',
                          '91636','52711','23564','54501','89293',
                          '24012','83666','19456','95117','65160',
                          '76078','10265','58134','22595','33971',
                          '54242','11301','34584','35265','88600',
                          '44806','19391','20052','16307','83143',
                          '66947','74141','14714','23600','14108',
                          '73144','30398','13991','77327','42441',
                          '61652','20750','86121','29235','12785',
                          '88957','73516','91580','20566','14576',
                          '67965','62151','37968','76779','86085',
                          '76106','41174','89160','51154','11870',
                          '10974','65394','22200','66778','18072',
                          '20029','57560','68260','48664','38696',
                          '13483','12284','96493','35104','94975',
                          '20243','59205','82253','17067','98985',
                          '68527','15194','47971','46555','52291',
                          '19636','49308','71965','72320','30395',
                          '15120','79140','65664','36240','40006',
                          '47541','97751','92749','56985','57525',
                          '82240','87810','25200','73622','77757',
                          '26255','31100','36033','15168','16604',
                          '99662','78301','17723','36143','49840',
                          '44336','25382','43603','38218','94738',
                          '61259','35154','10634','43795','34534',
                          '57437','61457','25646','59086','19318',
                          '48401','14609','67848','95640','17355',
                          '17889','79948','16674','91604','77253',
                          '69288','57650','72750','16279','33554',
                          '68702','93311','88844','94826','23110',
                          '11615','75391','83778','10941','15418',
                          '40322','84720','21451','43748','93631',
                          '35510','43512','88517','14813','78173',
                          '54977','25877','23358','33590','30867',
                          '28892','70671','60162','87386','71764',
                          '58400','79103','31862','22211','10775',
                          '69806','82197','94873','73098','87894',
                          '31308','17372','10021','95741','10275',
                          '59264','38239','78544','37889','51600',
                          '54514','16918','97936','52705','81096',
                          '35542','47145','20287','46490','87654',
                          '14581','24748','50818','81833','61214',
                          '56109','50986','36416','20682','24844',
                          '25743','23080','19422','22445','38317',
                          '73858','57677','64252','54903','31272',
                          '41297','47514','72820','75822','94530',
                          '47885','50248','15671','95235','31055',
                          '40077','15776','58007','14106','17084',
                          '12175','18743','54171','91909','65379',
                          '71767','36028','97159','65600','39068',
                          '24505','96942','66315','68750','81676',
                          '63100','34841','65785','13253','10797',
                          '60221','33594','11747','26525','28968',
                          '94917','83217','56248','35691','75456',
                          '26881','58646','21620','49756','21913',
                          '50778','59571','43580','25410','76865',
                          '81667','27489','87437','39976','49309',
                          '88601','68393','82224','92632','83446',
                          '66566','42114','84396','19343','46709',
                          '33092','16523','77339','68127')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
