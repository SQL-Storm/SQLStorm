
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '73109','59756','46234','35104','95438','32546',
                          '34343','32249','56383','70722','65700',
                          '40818','36202','45838','73531','28430',
                          '60812','41350','23125','61134','60586',
                          '27902','44489','41095','13786','80573',
                          '99311','30707','29943','77869','48311',
                          '73488','54760','53091','49452','98194',
                          '71787','15521','29807','25574','34412',
                          '83596','38680','90681','49182','77874',
                          '31166','18433','71797','64053','14699',
                          '58429','99655','98878','91076','55546',
                          '72861','78383','13100','27495','54356',
                          '23865','56793','82487','39676','62700',
                          '84909','53010','81648','33265','34593',
                          '10622','12481','44909','82554','36785',
                          '93143','10651','65975','10649','33985',
                          '38898','60051','92254','18630','44150',
                          '90035','34001','92111','13461','28829',
                          '35129','78340','89551','75095','53510',
                          '65899','17752','38396','96363','98075',
                          '21040','29145','54726','82803','21899',
                          '75175','42468','32717','26096','70509',
                          '19876','53692','28367','33664','81221',
                          '66430','53483','58085','91229','19551',
                          '12565','10852','88341','47410','30142',
                          '77676','81712','41197','66737','70273',
                          '80261','30620','37828','41812','63068',
                          '12227','52461','42417','88005','33606',
                          '26099','81459','23321','12043','26313',
                          '33851','93985','73569','59151','12684',
                          '39096','64072','77954','82731','69418',
                          '13299','55452','87383','14206','72478',
                          '27025','64688','77084','19049','57613',
                          '98356','62639','23184','33234','26941',
                          '20150','63395','26793','95000','41878',
                          '13220','58526','99544','53044','73625',
                          '79953','85667','34354','53284','13921',
                          '20953','87795','41216','92802','21742',
                          '33367','24541','54819','20178','96782',
                          '22615','37025','59342','64537','88183',
                          '50888','67488','42638','15260','78549',
                          '88006','41548','97212','88452','14949',
                          '58269','14330','27754','12279','15229',
                          '61621','44205','64479','48478','94436',
                          '48096','75183','60263','59977','16208',
                          '53839','32104','29204','86298','25933',
                          '42351','77395','26024','17755','20698',
                          '47329','22794','47065','31841','11841',
                          '46061','15266','30952','46323','73829',
                          '46375','33939','36035','12505','17606',
                          '32421','86753','18543','39016','92898',
                          '77368','93085','96979','24432','60710',
                          '27938','79097','24425','21482','49095',
                          '12040','81139','17867','25386','50405',
                          '37586','19439','35839','66732','76032',
                          '63308','86352','76645','12001','73223',
                          '26992','49025','77987','44075','95784',
                          '32248','61146','84405','21261','20742',
                          '52403','15719','91810','25366','78967',
                          '66409','16525','14033','18839','96178',
                          '89034','70254','50319','28887','17725',
                          '94270','73359','47189','42038','46868',
                          '18394','69030','99294','21366','24508',
                          '18582','29808','41839','17536','71979',
                          '22056','29172','65078','33396','94413',
                          '66458','15401','56710','41479','19600',
                          '29030','22422','39386','86662','24538',
                          '64867','13771','59103','14592','22754',
                          '52259','42323','29811','29434','12910',
                          '57246','48516','79673','14321','54885',
                          '22327','82703','35932','32134','58254',
                          '61247','87981','63644','78749','83038',
                          '33566','80871','91980','78616','86317',
                          '32916','20384','78568','19152','62494',
                          '96846','90527','11116','29815','78241',
                          '15508','16141','47275','13726','22938',
                          '90444','78683','11884','25500','56999',
                          '55157','74764','51298','33945','79702',
                          '17880','41155','64933','74545','43457',
                          '55611','82427','39067','14866')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
