
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '16084','59839','75613','98613','38580','58064',
                          '48511','54866','31594','49865','25245',
                          '13597','98664','22251','90918','34903',
                          '13398','12445','72879','72566','10801',
                          '19701','20746','61576','36045','45283',
                          '56724','64890','98264','54439','90834',
                          '88629','42898','24285','96360','71032',
                          '33956','50328','31421','47189','13702',
                          '21977','53589','94481','78230','52639',
                          '97886','63718','49288','34312','77536',
                          '93399','23948','29009','27546','67246',
                          '30954','32317','65045','32208','53353',
                          '96716','29553','78565','47859','71134',
                          '40622','39385','37430','99417','37961',
                          '56470','24163','78147','72725','81207',
                          '67037','89759','15792','43210','58482',
                          '80522','66300','21608','86960','87184',
                          '54676','97885','21209','27562','62079',
                          '48312','81865','12729','75030','64956',
                          '58791','44507','77250','78868','43363',
                          '78892','95755','23621','95808','67977',
                          '39850','35468','69512','19805','29053',
                          '50129','32427','36574','67772','19429',
                          '29258','70450','41208','85404','15468',
                          '32281','11999','42654','86683','13664',
                          '34800','52854','86493','48038','14052',
                          '19165','87513','59055','53851','17595',
                          '13743','79200','10251','83292','17850',
                          '83574','34453','69578','27165','31250',
                          '55091','25266','94420','95139','13610',
                          '34080','63852','64385','47833','73746',
                          '73910','49280','27501','21090','60198',
                          '13209','19857','32644','22699','11212',
                          '82434','66982','41553','81198','26760',
                          '16805','44400','69203','81972','22288',
                          '20991','15974','26638','84425','89083',
                          '38659','15251','13055','46992','92907',
                          '84288','85645','89791','75773','39510',
                          '22560','77144','32800','97723','82006',
                          '52257','19027','81298','27522','21240',
                          '11820','20089','60803','31261','58566',
                          '18480','75765','16265','72299','19783',
                          '12797','80607','45991','13350','26950',
                          '94443','93337','94959','59237','22713',
                          '81257','97841','60347','89374','73442',
                          '28501','71161','20217','27830','83326',
                          '37042','39331','47714','78032','13706',
                          '12323','58132','27645','59779','29093',
                          '80621','13144','32618','25134','50393',
                          '14879','87478','88370','33335','60900',
                          '10924','37737','35219','50911','29819',
                          '30809','53546','43631','44009','11329',
                          '78977','18222','11278','54458','83216',
                          '27457','63812','41827','29382','66278',
                          '11751','68048','33339','88942','24131',
                          '51970','52979','98189','18627','60625',
                          '37540','79472','71428','10723','57831',
                          '76623','67209','16349','98398','61331',
                          '41491','65840','89555','16865','67116',
                          '12810','32417','23002','11772','21107',
                          '87124','56897','35602','67913','10391',
                          '28942','35527','95776','18237','72051',
                          '35927','65150','65975','12233','32956',
                          '24555','40158','11081','42083','15038',
                          '89698','79914','26376','86647','32535',
                          '28390','41675','14888','28342','45321',
                          '25427','14018','13797','68634','25505',
                          '46990','91349','25285','20726','25822',
                          '78889','18578','74248','34937','61420',
                          '70078','61422','55222','71953','22375',
                          '94682','28644','14342','72070','32773',
                          '31742','69518','68475','90052','99679',
                          '71436','44126','53927','77444','75615',
                          '31415','75698','34329','50876','51110',
                          '59962','85506','66773','29597','47237',
                          '14035','81940','40184','26559','51973',
                          '21947','23305','42006','81130','54913',
                          '78967','56459','40492','36407','42956',
                          '52058','91574','45498','72395','62037',
                          '42711','87267','57412','45189')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
