
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '33061','56925','81898','31939','55697','77555',
                          '62005','51540','61226','86380','31427',
                          '87055','68984','98871','30735','55413',
                          '28410','87500','71883','51677','20204',
                          '26472','29473','37244','36134','35186',
                          '67217','96108','59971','98929','21044',
                          '93825','75586','29065','69496','41641',
                          '86297','71262','59625','28965','32304',
                          '67297','29671','16555','46053','44154',
                          '73126','25885','80191','65229','36474',
                          '22680','31601','97968','47892','77436',
                          '25097','35249','33778','80043','35456',
                          '59013','26028','65815','14893','33803',
                          '81063','27246','51932','92029','13094',
                          '46656','42992','16359','16565','39796',
                          '22975','89804','42210','79803','34266',
                          '77486','30036','46497','22511','88243',
                          '57416','69068','90867','54357','50942',
                          '70404','37430','19244','46921','72298',
                          '99840','59054','41323','75322','75992',
                          '47962','87595','16681','28807','93986',
                          '47242','65342','26201','95030','78189',
                          '24217','95236','48757','46552','41712',
                          '91270','42689','29169','75313','81735',
                          '73285','17730','30215','11856','93828',
                          '29919','32915','46471','20683','68613',
                          '29727','55103','25755','35857','88180',
                          '46085','18706','27014','58073','20860',
                          '54372','71624','98477','26598','68422',
                          '34213','18777','78266','39405','88472',
                          '52118','48436','66910','34657','78525',
                          '15589','82611','98866','94330','39678',
                          '30390','86634','44372','65447','83609',
                          '81784','57002','28814','33344','23303',
                          '27379','13811','10211','76366','44167',
                          '44938','54619','17540','13397','11444',
                          '78640','71646','66394','10090','22260',
                          '40126','33741','68332','72874','84220',
                          '78079','31690','57614','57395','18797',
                          '36238','81465','16036','65108','29469',
                          '70642','95720','91532','93654','97818',
                          '17819','88305','28580','11435','14110',
                          '61823','15664','35223','25797','98674',
                          '75092','30099','44904','96659','61870',
                          '11452','37477','55789','12843','61672',
                          '14094','21155','55660','83723','27190',
                          '70927','18954','94356','35432','61865',
                          '85983','12459','28053','32439','62735',
                          '33689','36191','15950','14622','15772',
                          '82825','75702','97573','81779','84397',
                          '34025','93108','27315','47704','17915',
                          '55226','36101','13844','30564','36359',
                          '16619','15046','42870','36092','40125',
                          '35655','81910','17727','90582','43442',
                          '37538','76540','42009','43249','76786',
                          '39992','12273','28032','54955','18496',
                          '83731','46428','89212','19368','41907',
                          '84708','43501','62881','85111','42510',
                          '80406','14298','26641','46177','35062',
                          '15095','76758','69108','78455','42536',
                          '83682','17014','56424','55329','55591',
                          '83612','18287','54541','49807','29598',
                          '43738','81347','12185','24929','39531',
                          '21075','29453','14070','13796','52208',
                          '91364','15681','80802','53670','47184',
                          '63074','90347','88174','15289','62204',
                          '41125','30310','37606','10204','70699',
                          '71446','48378','99550','91524','20847',
                          '94023','86156','16561','98263','82888',
                          '46064','30633','29679','45318','38848',
                          '75732','11671','64730','49959','11860',
                          '63623','20178','15139','95521','45492',
                          '10023','63014','20104','25604','73450',
                          '49020','12212','94423','92471','78269',
                          '51933','76839','61645','33245','42426',
                          '64888','47715','26512','82725','14702',
                          '96846','55911','59850','32670','63422',
                          '11189','87255','36907','44515','55448',
                          '34635','59626','40997','26291','18662',
                          '61642','79125','98793','57107')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
