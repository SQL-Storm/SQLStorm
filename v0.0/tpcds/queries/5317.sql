
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '64706','68195','21411','76636','31083','27740',
                          '24613','95825','16170','88415','11062',
                          '92583','68399','37133','20903','39754',
                          '97678','61522','95447','18746','13984',
                          '88458','12939','11173','15430','81726',
                          '64454','13451','91305','76444','10591',
                          '83790','68820','86052','12095','84844',
                          '40502','27267','70238','62920','56427',
                          '28992','34939','25226','14729','73063',
                          '22419','69212','33328','94868','55079',
                          '57519','81580','29356','74190','60609',
                          '41813','76259','54070','49137','65779',
                          '15669','48088','58452','56354','72364',
                          '19727','32064','33979','19048','49180',
                          '55145','66187','53394','50313','77169',
                          '42641','40789','42630','30057','25158',
                          '33258','19674','17425','17163','83702',
                          '11559','35741','63390','99680','43807',
                          '39048','26780','29949','81358','32328',
                          '83700','30701','32942','31457','62877',
                          '36531','13712','34253','26832','59090',
                          '36297','70256','81047','23918','32902',
                          '55765','61058','11909','80065','34978',
                          '56411','70535','82519','66249','16757',
                          '89804','12532','63643','64769','46592',
                          '86169','70525','22291','12103','27854',
                          '89369','19494','32366','24884','27242',
                          '39006','64168','95868','59350','39409',
                          '83621','64573','20905','16384','68302',
                          '79718','61494','54916','11288','79375',
                          '12160','12910','34325','86394','28723',
                          '34447','16220','86590','27443','11781',
                          '66097','67298','83370','18971','40891',
                          '16343','67666','79980','14514','57531',
                          '35372','54263','41934','18974','37638',
                          '24031','14937','20495','13311','83204',
                          '47176','24527','94123','34919','74812',
                          '95459','56230','24803','96570','11552',
                          '61070','34497','62582','46779','29198',
                          '23881','28032','13551','38360','41035',
                          '17062','36240','37366','87634','40874',
                          '11829','54540','63799','39046','49675',
                          '26811','79282','96432','33069','33037',
                          '87990','73199','28839','17365','67291',
                          '98252','13744','38180','15459','81099',
                          '26903','99351','34164','49991','85654',
                          '95444','39123','11321','31192','38656',
                          '62651','72671','15118','60154','87246',
                          '69538','19775','77017','33181','31262',
                          '96095','32925','33342','89635','76646',
                          '43247','56671','30979','64651','30921',
                          '13488','50266','31525','23294','62051',
                          '13015','84404','33765','37980','93055',
                          '13986','69187','75733','20839','97182',
                          '47979','56700','29189','74920','12659',
                          '17105','87266','25537','31016','16837',
                          '59000','23903','35459','13208','85864',
                          '50735','63593','40859','26526','37921',
                          '19293','56255','39376','62048','44581',
                          '12453','40551','26474','17158','57114',
                          '38385','51423','30354','56020','87533',
                          '54136','21834','14041','10925','17587',
                          '62631','37970','35259','16691','15130',
                          '99340','30559','48500','56153','61253',
                          '48496','34289','12543','40762','83997',
                          '38511','28382','46556','34471','62606',
                          '55731','29978','65373','19669','22087',
                          '12719','56592','45429','21023','20277',
                          '92968','17640','51504','63813','64040',
                          '53449','44903','16394','20404','51782',
                          '39313','98909','97775','13124','13707',
                          '72212','35147','44945','55835','19978',
                          '25316','50463','44859','61372','90746',
                          '39671','41180','87982','81857','98312',
                          '54131','26327','24069','46321','30878',
                          '59822','23502','18772','53315','99019',
                          '22429','62890','51160','20339','90364',
                          '71456','57363','86173','19025','53433',
                          '64964','14518','27270','28427','36332',
                          '29231','30477','44021','25916')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
