
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '26835','10456','32698','84624','17367','21314',
                          '27383','75546','32902','83547','62266',
                          '72952','47045','51665','16578','32576',
                          '74018','47779','68574','41709','48429',
                          '68825','88102','99276','52865','43571',
                          '12738','49208','20846','16654','48182',
                          '49715','11793','54611','17946','22066',
                          '14257','32623','28702','75990','23110',
                          '83117','27209','27913','32267','11880',
                          '13871','95354','90278','42916','95510',
                          '36669','11542','73710','57468','75071',
                          '45769','76231','29316','18885','75713',
                          '60151','21285','51975','92602','11376',
                          '58358','56576','52387','74874','74733',
                          '70693','53823','57329','67000','72694',
                          '58087','98192','38706','15628','72334',
                          '64675','70823','16888','15502','55507',
                          '57226','90554','42083','63301','19343',
                          '78549','82987','76606','18443','89515',
                          '66793','83030','76769','81592','58684',
                          '94216','74777','39416','54818','74086',
                          '26322','25253','33021','28946','96557',
                          '71392','69629','74066','48929','65729',
                          '22721','63250','33654','32775','75366',
                          '66108','70195','18895','90096','77475',
                          '30391','32565','43643','58930','74332',
                          '78607','66970','17002','74207','61817',
                          '17342','35211','86254','24652','63526',
                          '20891','95021','26589','56491','45447',
                          '14115','28437','15429','48735','50179',
                          '74979','52057','60875','69528','38137',
                          '90478','66615','10988','96632','22867',
                          '53301','82641','25073','27646','54394',
                          '10185','14911','22443','63929','32773',
                          '20897','40504','36486','74938','54094',
                          '66539','67358','87773','57399','35067',
                          '75844','75498','68709','72657','46336',
                          '65398','28050','16009','78302','29124',
                          '17928','58934','19523','26878','24285',
                          '21174','53170','57202','73213','78911',
                          '54306','86329','89360','75349','31007',
                          '17415','50634','50217','61591','15906',
                          '38881','77392','16113','32643','38961',
                          '67716','46356','36996','53046','51068',
                          '12823','41622','83979','88477','91039',
                          '24406','93227','51564','14855','39906',
                          '14746','19058','31531','89434','96629',
                          '26365','98075','51838','58903','99118',
                          '66019','68757','96616','81338','95479',
                          '43365','55963','12497','88480','25206',
                          '90085','89967','12360','13278','21881',
                          '33474','62790','10061','44656','31238',
                          '16033','38989','16260','45277','63265',
                          '31747','91854','18855','18768','14388',
                          '51935','23831','36222','65193','61361',
                          '42884','22805','52214','16359','47339',
                          '47158','83444','90097','19708','88299',
                          '41251','36370','14161','19329','41783',
                          '43501','79618','36460','52419','32975',
                          '54537','94829','26370','94251','97020',
                          '95601','28850','11023','90530','75442',
                          '10722','30544','43143','33776','22454',
                          '24791','25340','80034','79188','48087',
                          '20209','45596','63339','46367','28763',
                          '28442','21114','16393','75594','72642',
                          '82516','32876','86934','89427','90257',
                          '90707','76655','38806','14252','38339',
                          '15692','86515','14169','30063','11873',
                          '69881','40916','31316','17678','91473',
                          '32699','24976','68555','13580','66673',
                          '91661','46527','90102','46042','21915',
                          '69389','26944','13738','61656','74763',
                          '12175','11145','22005','77374','93751',
                          '10084','61592','23960','90822','70797',
                          '28165','93665','73233','72660','29873',
                          '25049','52821','42098','40100','71668',
                          '17999','38454','57728','68146','20670',
                          '41441','58894','73759','69941','15259',
                          '74518','89917','11189','36569','41461',
                          '58404','55931','45846','33304')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
