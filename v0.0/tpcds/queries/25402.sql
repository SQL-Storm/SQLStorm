
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '14489','97920','91658','11750','15485','16949',
                          '33287','48469','10711','64959','35047',
                          '90442','62141','74300','68651','89507',
                          '37877','42682','27030','55546','73769',
                          '89308','86455','95725','21230','28898',
                          '46496','40057','20875','99819','88486',
                          '27823','47932','98614','34784','28203',
                          '59338','32911','19938','11515','63143',
                          '32961','25701','30245','64677','13119',
                          '66677','33700','37720','86737','51011',
                          '32687','48584','25022','20920','31742',
                          '10716','62869','66329','11830','77229',
                          '10923','17409','77614','50523','50435',
                          '13948','92105','56068','32630','51598',
                          '10433','37652','64946','53268','10513',
                          '79097','72259','57601','47679','30941',
                          '69972','68686','61435','55722','47435',
                          '84446','64858','85525','71788','30364',
                          '30445','25621','82334','61044','67845',
                          '46395','92179','16113','37621','94413',
                          '29187','16466','95728','72605','61344',
                          '22067','27947','97582','61794','27623',
                          '37586','87531','50357','46942','82415',
                          '88831','48693','86294','87385','32723',
                          '66430','37931','29175','77143','50132',
                          '40652','46549','65650','34247','96391',
                          '16554','78815','11067','42326','17595',
                          '63451','20871','66736','93452','99198',
                          '56715','50571','23799','19144','45655',
                          '29141','42070','66633','69856','77882',
                          '54224','22036','27266','43688','37689',
                          '29813','32097','52822','52099','78044',
                          '20992','19007','37283','12248','42160',
                          '43302','16990','46159','74069','96143',
                          '67429','91130','64617','65706','19003',
                          '27535','91153','85524','17724','15414',
                          '12307','35789','23589','60597','14091',
                          '20504','56554','40392','70634','90848',
                          '98653','74344','92326','79217','22472',
                          '23772','74989','70198','43476','83901',
                          '82519','62004','19402','67515','67188',
                          '17314','20673','87274','21194','95482',
                          '28455','48812','73970','16805','43138',
                          '25962','32529','27014','93753','59305',
                          '51458','12129','74763','64297','26103',
                          '19609','94884','87732','28336','46147',
                          '82485','73647','27540','74188','29628',
                          '53546','19751','13170','59447','16794',
                          '85746','92418','11344','35673','77065',
                          '74830','70842','54650','46516','35634',
                          '42726','73919','11525','30821','60493',
                          '36982','54505','72203','84858','42451',
                          '42862','76891','42668','46136','35895',
                          '66544','43370','25162','55336','55905',
                          '10537','17426','61094','98131','86879',
                          '62541','30121','12858','14301','18216',
                          '42982','89315','83638','86370','44134',
                          '60861','92639','85900','80289','13075',
                          '60677','42965','13643','63217','18062',
                          '52879','90502','25403','90072','44682',
                          '61362','23653','24951','86776','54255',
                          '24848','92727','17576','42246','83628',
                          '81400','75136','55859','19032','46966',
                          '38698','73758','46489','16602','42010',
                          '30905','64222','28254','28642','71086',
                          '87570','55661','37255','52116','10522',
                          '87772','35539','31088','73911','23619',
                          '32441','30132','22051','61764','46418',
                          '64117','11849','54405','75814','91043',
                          '19827','31276','60665','41211','65255',
                          '33819','70774','95485','70595','23920',
                          '27024','56266','44308','31987','58513',
                          '83152','77368','11459','53443','53589',
                          '22660','94782','97396','67475','25184',
                          '16585','13432','20874','72118','67352',
                          '10684','53219','50075','46753','17976',
                          '71946','51954','11223','93039','78049',
                          '55736','55207','18885','21935','67885',
                          '45949','42243','67676','48653','26859',
                          '38063','59999','48950','91936')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
