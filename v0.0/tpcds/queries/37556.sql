
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '69014','17423','73000','14920','38827','45123',
                          '31020','18279','32493','36139','37050',
                          '63802','15010','10454','85354','96809',
                          '74337','78980','11944','11146','98300',
                          '90051','33374','98087','40595','87969',
                          '32956','53353','83267','14988','52927',
                          '87676','99578','56599','40865','34541',
                          '76002','71352','23522','17200','55257',
                          '79343','16499','15164','43345','44431',
                          '14340','23524','17192','97976','45814',
                          '19102','99102','66500','45267','88073',
                          '36801','84702','12338','20774','69470',
                          '14014','38877','45271','99633','45756',
                          '99755','40763','16261','27724','61446',
                          '41830','53806','25167','17893','79680',
                          '80717','86202','60225','38061','82052',
                          '40722','73658','71766','92643','52951',
                          '27747','15641','37175','45942','78472',
                          '56953','75329','86385','84024','84986',
                          '52673','93582','26197','52472','79149',
                          '77479','32495','68840','29878','74144',
                          '17373','48320','62402','61264','44382',
                          '23132','90292','63254','29216','16085',
                          '39158','55428','51637','66312','85781',
                          '75894','59139','93694','55679','54609',
                          '39356','68073','12412','47875','68106',
                          '61901','50338','11973','96627','82586',
                          '72981','35812','87199','26407','58053',
                          '84090','79904','18324','22574','85033',
                          '32185','89620','14737','85720','51292',
                          '33195','93510','47159','35407','89107',
                          '23081','55239','22831','91128','23181',
                          '63230','50293','98075','76336','10476',
                          '86063','19193','91659','68578','44308',
                          '14353','53837','37026','35586','76233',
                          '56642','82629','47738','33785','28221',
                          '71577','43161','79886','30728','61777',
                          '57505','36068','79731','91531','68360',
                          '82000','18433','45063','47960','35314',
                          '22706','31883','18671','23916','53152',
                          '19109','82064','89325','57312','66197',
                          '26253','25227','72488','50266','79293',
                          '25533','28074','39799','99116','66700',
                          '12973','49343','73255','25538','78270',
                          '18489','19081','35063','97941','20346',
                          '69766','31581','56390','36763','59690',
                          '85857','48852','52419','37915','51571',
                          '26324','68653','74059','32152','16135',
                          '37515','95600','13877','20713','51925',
                          '88982','54460','43619','77798','43104',
                          '57885','48040','62868','12981','14741',
                          '91491','45865','31657','58741','23189',
                          '13810','38800','90792','80527','86696',
                          '77187','66256','55266','33306','70726',
                          '76745','95016','28822','48684','18394',
                          '44668','46946','54830','55832','32790',
                          '26597','96227','16536','53690','56188',
                          '14457','35074','22390','10568','43300',
                          '22175','34878','19575','18081','41974',
                          '10821','40226','59665','53393','57075',
                          '60890','10323','62578','13110','61882',
                          '12288','90274','71718','24404','72349',
                          '61066','68173','40282','46363','53971',
                          '72251','18089','52955','34012','72771',
                          '32071','26125','52777','41245','16772',
                          '67648','27332','56754','53742','63739',
                          '11732','65343','22780','83261','16986',
                          '80070','71067','14733','31797','18656',
                          '22800','98163','60336','13846','26963',
                          '67117','50725','12805','24214','81102',
                          '52421','94800','62467','72676','72078',
                          '48739','50502','43273','35647','18741',
                          '67061','90882','10009','22405','21253',
                          '44474','91856','20272','94409','29096',
                          '39139','18464','99819','28374','29127',
                          '20821','45626','29173','98280','98191',
                          '87865','46877','89141','68678','33962',
                          '96884','76479','35750','10148','79360',
                          '25317','58883','75235','48409','87354',
                          '95074','90537','10920','10332')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
