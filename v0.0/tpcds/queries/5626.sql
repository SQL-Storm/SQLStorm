
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '54050','58998','85669','49469','34691','78089',
                          '12625','99120','35125','10913','20744',
                          '25099','86388','64958','55903','82869',
                          '84699','54495','81268','76452','10028',
                          '38440','61199','91070','50373','48663',
                          '62464','19875','13363','63341','23067',
                          '61096','92371','67029','19544','27838',
                          '25458','31527','22177','95328','62128',
                          '23798','26881','95392','62478','23027',
                          '31073','30438','72518','31188','17506',
                          '81185','67877','27907','26353','17330',
                          '25836','17057','69522','84941','60076',
                          '37523','41474','16623','14552','73471',
                          '44535','72379','42567','27043','14222',
                          '20377','57138','16417','75166','47832',
                          '49749','36921','81609','82419','25692',
                          '98007','72256','63841','69230','12265',
                          '96363','40387','34027','31230','28470',
                          '35674','93101','14093','13663','75558',
                          '14058','78626','13908','72685','45753',
                          '67660','11614','29274','73897','47513',
                          '57971','88882','28385','29938','82314',
                          '66868','48213','92948','64271','27422',
                          '90222','46535','43503','85519','93855',
                          '46613','84311','78162','37104','17651',
                          '85371','61148','32295','91286','26074',
                          '36228','12483','78357','75470','28300',
                          '72402','11294','54283','35477','24484',
                          '38602','57480','14098','19203','31915',
                          '55862','17752','20167','80676','91643',
                          '57805','91856','43589','68540','96967',
                          '55667','85679','58317','70481','17076',
                          '13331','46271','37484','24464','83146',
                          '29822','72279','31748','68802','52708',
                          '11844','43164','86455','21431','64232',
                          '86856','46007','13395','64652','32625',
                          '63228','74066','46004','94429','12221',
                          '28206','65072','11301','15350','26527',
                          '44774','29239','20939','58137','38466',
                          '84197','10644','81565','28399','61918',
                          '28905','50319','62817','14414','87188',
                          '99491','89546','22688','77190','96304',
                          '87808','31319','38134','36718','29858',
                          '25218','11863','12772','74141','31529',
                          '37685','14132','75541','62882','74975',
                          '87274','62546','38086','40397','41308',
                          '96301','87093','15606','49487','81860',
                          '57892','29371','47821','37625','74522',
                          '29547','99539','73828','52862','36860',
                          '22990','14191','20166','66109','78148',
                          '57262','73454','66887','37342','25614',
                          '52449','95003','40779','68310','71528',
                          '71031','37779','13163','69111','87814',
                          '40102','63398','76432','38523','26404',
                          '94437','10231','33057','50403','31106',
                          '94186','30232','44085','83064','19487',
                          '83149','21139','41387','33282','41067',
                          '69324','29850','17598','33186','76896',
                          '48645','28499','77039','50086','41884',
                          '11241','43789','60552','17603','46085',
                          '58849','19840','78921','15379','73988',
                          '53206','61511','47616','25174','45667',
                          '62795','92055','72414','93685','33550',
                          '29986','31758','77821','10510','64034',
                          '52545','80876','23198','13504','37165',
                          '82478','71875','40907','51762','25370',
                          '82842','81669','37149','29521','47010',
                          '49813','34927','10059','40458','47218',
                          '76244','74313','95401','83176','33514',
                          '69219','85805','21711','68978','53747',
                          '12488','44842','26624','71548','97547',
                          '89385','14126','41209','29559','76758',
                          '62780','51810','29847','77882','29798',
                          '91514','36100','35510','69793','91250',
                          '85815','96744','42169','97896','59243',
                          '56834','11556','13634','28498','11344',
                          '84759','10773','58927','48767','14985',
                          '20986','55362','51737','56024','36466',
                          '39029','56469','39692','15675','95557',
                          '22124','93518','84309','53526')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
