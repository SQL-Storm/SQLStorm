
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '23868','58182','97316','81242','40527','68588',
                          '57873','52017','44366','33736','48622',
                          '94261','73369','66467','24472','13931',
                          '46540','30350','20356','18376','12021',
                          '38118','92739','10527','27736','98371',
                          '87436','45246','56431','99596','32440',
                          '79893','11970','28201','62062','38439',
                          '22670','14182','47675','50284','70534',
                          '95553','70763','71445','80010','76563',
                          '48287','26947','24675','39551','27529',
                          '26928','26986','92584','75335','12450',
                          '87218','28373','17982','40025','40625',
                          '10765','73993','55842','73979','18653',
                          '81661','65087','32988','99750','51807',
                          '72131','89771','11922','75504','29658',
                          '11328','59396','41128','14742','69833',
                          '19392','94994','86797','48939','18479',
                          '35141','16294','53749','47165','76217',
                          '30090','59013','84821','11635','52443',
                          '26829','90052','73244','51417','39021',
                          '37543','43623','97093','69219','77414',
                          '82491','90736','66240','94731','13108',
                          '34608','46805','55920','19771','80914',
                          '67347','89964','20502','64361','14252',
                          '22570','71442','18295','15666','19805',
                          '31311','76895','30118','53939','32610',
                          '61101','77259','84861','27738','91796',
                          '13537','25259','87844','28633','47617',
                          '96145','46720','98376','93418','75055',
                          '39493','29199','92043','54072','34781',
                          '11043','41498','64306','81603','78845',
                          '19793','67369','25018','23811','35503',
                          '31192','54896','22679','12898','88620',
                          '68795','65562','37519','12916','57008',
                          '67892','50904','91653','20572','43758',
                          '55156','55562','75497','21840','22553',
                          '90147','82257','21098','39995','94104',
                          '27255','26102','56885','66941','86587',
                          '43091','36814','16968','52523','28727',
                          '33137','50448','67584','63060','60984',
                          '19812','89000','50585','26023','93241',
                          '26433','35778','99180','17983','53203',
                          '49675','55735','23983','72094','50056',
                          '55376','36802','91958','32182','97939',
                          '77734','46938','62859','85220','93152',
                          '39706','50775','21675','70949','88635',
                          '70945','53459','55210','82464','66487',
                          '83081','24742','10581','46087','37220',
                          '40100','57522','20455','10479','16155',
                          '58249','14731','59968','62157','84337',
                          '74489','11867','65180','21421','28560',
                          '38994','19479','72269','63971','43305',
                          '31614','41126','32109','55846','84980',
                          '96127','54813','23621','41463','19096',
                          '39492','15647','28034','20866','16073',
                          '49980','88157','23153','58242','46714',
                          '69554','43687','54864','37653','52255',
                          '52745','51745','81921','70715','99571',
                          '99544','26267','33449','81467','12636',
                          '67645','13052','52282','40289','58721',
                          '52856','90962','83952','93956','48435',
                          '94923','96659','18242','68514','74406',
                          '61048','20763','82842','17517','66604',
                          '87638','22678','95200','48795','36183',
                          '20707','54904','24705','92442','16017',
                          '77609','22391','24885','63512','40341',
                          '49448','58246','64093','29095','10666',
                          '68579','23577','58497','93900','35402',
                          '23828','73254','99194','22520','65442',
                          '46974','39992','12209','34930','20716',
                          '83949','44910','87065','15287','92999',
                          '17779','17890','76993','57073','56662',
                          '67566','19480','95643','43471','98701',
                          '30063','71923','71371','19511','94949',
                          '54628','15475','64154','13712','15910',
                          '33969','64404','39624','82514','67818',
                          '30805','86491','15923','32682','97766',
                          '93750','41653','37740','33472','76799',
                          '71247','42523','39867','28298','17637',
                          '31209','39863','64111','26616')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
