
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '79308','51307','40327','48674','70226','23670',
                          '49385','16431','13119','36637','19054',
                          '92352','92925','98276','38570','69570',
                          '95339','67935','66584','54867','12735',
                          '27502','80952','17516','91639','54663',
                          '71142','32623','16886','15232','17143',
                          '35289','54098','93895','16298','53174',
                          '27264','84429','71343','17094','12572',
                          '17716','15184','24353','15730','67693',
                          '24377','66446','23636','25908','27977',
                          '33974','83319','61306','20870','47019',
                          '31218','17735','44563','22523','80983',
                          '86067','92831','34031','81966','50399',
                          '64327','10012','40277','84641','17279',
                          '73709','46872','12675','96921','76702',
                          '68913','19256','45988','71067','15565',
                          '54856','32163','98912','20192','50461',
                          '91720','48943','90468','35523','15443',
                          '66635','58509','83136','18812','34727',
                          '61555','70626','76947','55687','29331',
                          '78763','21833','59295','30075','96903',
                          '19422','51914','17759','80255','52186',
                          '26559','20310','27464','33596','59360',
                          '96350','94933','77302','92444','11463',
                          '44829','17108','51592','33382','35193',
                          '36365','63701','21500','24152','11060',
                          '17671','68406','88808','10890','38600',
                          '76421','87399','34456','14181','86587',
                          '10833','15146','60481','19096','82583',
                          '81982','52481','52064','26387','64967',
                          '67267','47584','23314','95795','36060',
                          '81271','44778','88149','39248','91968',
                          '30276','55361','96440','44813','94637',
                          '79375','66394','34867','38784','44083',
                          '67384','55013','20995','64407','90128',
                          '22218','62778','32266','51631','56472',
                          '45663','40047','28011','53765','97203',
                          '24720','68955','97634','99229','98697',
                          '91233','44334','88438','12477','56201',
                          '11569','48539','16151','36823','35944',
                          '72750','28905','16261','65131','48851',
                          '17158','90227','17756','57912','73548',
                          '49154','35635','67485','51050','25226',
                          '49388','62507','64543','19187','11027',
                          '20905','12778','70619','31143','26980',
                          '72544','27460','84481','23156','62550',
                          '16611','92100','47212','17062','54765',
                          '30996','15939','56854','36756','37014',
                          '53972','63862','26437','89096','21907',
                          '32649','35185','34026','79140','42593',
                          '46663','53457','55686','71235','22721',
                          '76731','80312','95235','42668','48780',
                          '98317','33942','48569','63472','15756',
                          '13888','46855','61689','69316','84229',
                          '13425','24813','43243','29399','27402',
                          '28121','58079','16499','84930','55754',
                          '39922','55466','23349','13783','78945',
                          '17050','33495','25159','78177','75788',
                          '16359','33911','36528','58559','45784',
                          '45790','29623','69349','85435','68756',
                          '86593','57762','14682','13446','10791',
                          '11019','95517','47262','48136','21715',
                          '83366','11188','45419','89163','51239',
                          '49255','18748','67831','11725','40893',
                          '14569','58908','93576','19249','42064',
                          '35072','25321','84415','26658','14091',
                          '42535','22685','47654','96944','19540',
                          '34394','34910','46191','73002','20670',
                          '16010','36033','64904','46511','38827',
                          '83529','78669','68724','77948','60254',
                          '23990','23797','26661','92289','81503',
                          '84872','54485','80571','17343','47962',
                          '81247','30189','51779','20110','87113',
                          '34578','17852','80333','44066','22100',
                          '90311','35592','60675','10153','93542',
                          '69390','90808','36484','34368','76907',
                          '73685','99367','75997','41118','40894',
                          '59146','28051','15872','88705','87498',
                          '73733','90400','59238','23299','21284',
                          '19030','81515','65599','10068')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
