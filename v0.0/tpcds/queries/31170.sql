
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '26213','90849','30788','92059','13520','55625',
                          '41324','71804','63135','77512','99923',
                          '69132','59685','61089','79472','44738',
                          '59138','20083','78174','64407','89444',
                          '79862','20939','87685','66406','75560',
                          '97834','79416','48374','39811','79158',
                          '44932','27524','43753','95614','13177',
                          '69635','29285','59253','65413','21424',
                          '72196','52458','75545','43623','18415',
                          '52679','57001','54220','86727','52717',
                          '79284','56702','32050','89082','65933',
                          '72803','22387','98883','11769','27044',
                          '74479','59912','23759','61371','21704',
                          '42218','94300','50690','10620','14012',
                          '67222','39631','19681','35499','23762',
                          '77757','85482','48481','47654','67804',
                          '48047','14141','51671','59537','83463',
                          '17897','14967','31168','65841','31170',
                          '40038','28491','62870','28958','31825',
                          '15668','84735','24184','68993','51065',
                          '23548','98788','16900','83242','50677',
                          '29529','38656','94038','97652','79037',
                          '34671','12007','71259','55245','37710',
                          '30138','14570','32302','31788','47584',
                          '85021','32548','89572','49757','84488',
                          '32109','66688','15118','72920','54644',
                          '54341','71474','95961','47777','23001',
                          '79327','26783','47402','36677','92633',
                          '61939','10781','92020','16027','41185',
                          '48734','41439','90304','42454','54147',
                          '99950','10135','17680','39111','74617',
                          '50901','51212','31324','42890','28974',
                          '14707','79733','22961','45055','82322',
                          '13024','20514','28218','38414','42274',
                          '85366','33596','46816','77119','17192',
                          '58939','36500','63162','67735','92393',
                          '94894','24754','26476','11239','10481',
                          '20586','20162','23851','38667','51238',
                          '11824','10758','42383','73526','56897',
                          '58394','38267','14755','16879','97593',
                          '42414','76163','27462','64469','16701',
                          '25257','75269','37736','69839','12045',
                          '55988','92899','23291','68496','46585',
                          '65283','42474','29584','98878','34857',
                          '58941','47767','12420','18962','33608',
                          '32101','34986','21295','18196','41561',
                          '52386','20116','42227','47836','66096',
                          '56906','40518','21334','88791','10343',
                          '29416','41376','63132','57052','39555',
                          '75433','61865','38559','90919','11564',
                          '14784','27144','57505','48250','15640',
                          '11445','41453','16989','76687','52643',
                          '60763','66556','76807','79069','16883',
                          '16145','12930','19448','42261','54662',
                          '27554','75426','65197','99047','40496',
                          '65299','10420','66561','57529','49419',
                          '84157','31784','34042','28566','64691',
                          '93450','85488','28643','18786','60596',
                          '72602','43412','63665','34884','65556',
                          '74361','78018','41339','57608','43875',
                          '75371','49497','72750','97468','16680',
                          '12851','52844','65529','72205','99913',
                          '37573','11397','96336','85054','23723',
                          '99840','60095','33097','75808','91181',
                          '42754','27219','56642','62686','56867',
                          '42752','61357','72631','28948','70513',
                          '43954','12908','92317','28003','49916',
                          '91160','57235','72220','30735','38135',
                          '20080','11855','22458','38191','43237',
                          '78309','77085','88677','10963','77908',
                          '24180','66501','74569','79423','41233',
                          '43023','72711','62618','30771','34175',
                          '68538','28304','59831','34025','69646',
                          '52519','83246','94049','17920','12170',
                          '31494','95765','62122','46999','91423',
                          '10993','85019','69946','15075','84994',
                          '74020','72636','12684','49147','96259',
                          '28964','30233','71375','19686','34881',
                          '44064','29432','35287','53325','15724',
                          '44484','64446','12474','66343')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
