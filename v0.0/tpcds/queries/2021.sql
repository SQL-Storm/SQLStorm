
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '50079','90697','37213','49476','45886','42385',
                          '19880','32629','73704','92134','28012',
                          '92261','86869','98594','25407','13318',
                          '35201','86974','80138','43428','77870',
                          '15563','16056','48820','95677','63258',
                          '27306','56789','12788','16974','61804',
                          '57927','71230','68434','14644','11157',
                          '77611','65148','53824','11423','91226',
                          '45065','75917','45138','14973','10330',
                          '36877','30331','81826','11529','45356',
                          '60743','44563','13047','85482','57355',
                          '89470','80339','10661','92654','23639',
                          '77189','57370','23056','86856','71127',
                          '54131','15134','88929','18239','42893',
                          '79380','15985','99372','50154','36474',
                          '53742','21335','14024','14073','80827',
                          '75308','71967','89387','77584','52579',
                          '53484','49368','64787','34515','63520',
                          '21693','52540','63253','48360','14922',
                          '70030','59501','43023','25391','21033',
                          '22091','19750','81174','60358','61542',
                          '50091','63808','23922','33952','40067',
                          '74598','97403','70199','86469','21936',
                          '10584','76516','84927','85763','96611',
                          '61540','37879','52814','39633','44355',
                          '94681','59017','85645','93461','12958',
                          '81382','40959','68170','50416','55384',
                          '39530','18653','11903','22547','62337',
                          '65160','52833','27406','23370','29713',
                          '91346','85394','73126','47949','18541',
                          '46864','24794','76389','47074','32279',
                          '43032','25538','89956','79223','67344',
                          '99995','51724','46025','76672','39747',
                          '23275','46183','53670','43704','18729',
                          '96802','28564','77931','36249','39958',
                          '56699','26023','28372','38205','49070',
                          '51014','18640','53882','37534','69055',
                          '18196','13779','79875','60889','29264',
                          '30921','87380','27950','73172','83564',
                          '58249','47824','32310','49996','60395',
                          '36289','50397','72016','20068','19317',
                          '23557','23052','43813','80059','82681',
                          '43862','57507','99117','49429','84194',
                          '52763','24355','19594','49949','34193',
                          '19731','90969','22561','91374','75368',
                          '56897','11406','28577','28311','39865',
                          '47832','53706','58457','50655','14555',
                          '42273','41554','49598','86993','10175',
                          '93267','61539','31412','71790','23183',
                          '22577','54608','31701','46642','84288',
                          '78773','64321','94621','13263','20572',
                          '87496','29501','66517','47291','32952',
                          '43915','75350','65055','57316','56522',
                          '65735','89668','75011','97051','33174',
                          '26074','97030','19637','39491','88353',
                          '11546','45958','83339','17318','77327',
                          '32265','84521','81481','20886','17927',
                          '32591','62097','25117','98945','47602',
                          '26000','20289','94557','66132','41086',
                          '40858','82452','71285','90903','30714',
                          '37222','84905','93042','62615','33269',
                          '14171','64392','65033','83928','88425',
                          '76768','16733','54331','45122','94607',
                          '81359','70565','92573','48888','11377',
                          '24213','13539','16443','57592','55742',
                          '49796','44862','72100','51604','86107',
                          '21322','31317','11131','67279','74277',
                          '11508','58026','35784','82488','72044',
                          '75576','21131','12777','82173','41121',
                          '48476','56758','10854','59798','31321',
                          '20323','34368','13577','93689','92909',
                          '19211','41180','48341','14272','85993',
                          '34028','68518','72507','55251','67693',
                          '50259','96217','88293','43460','96930',
                          '20051','61491','63631','80641','40228',
                          '78001','25619','61906','57100','16953',
                          '28452','20885','99696','78828','25924',
                          '69719','80183','23880','70172','33571',
                          '81164','15873','96299','10940','58398',
                          '27494','76406','34955','17290')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
