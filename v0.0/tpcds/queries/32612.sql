
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '74251','48634','90302','55140','88327','96265',
                          '17403','56726','14426','15200','47973',
                          '37411','94492','26258','34923','56760',
                          '50756','42536','45749','53152','44018',
                          '29324','56076','24446','19294','35381',
                          '99068','13221','13684','23727','21080',
                          '96389','97392','47558','68850','16466',
                          '49146','70813','53439','34704','64834',
                          '40925','69058','41588','27816','94627',
                          '87399','24686','39043','66144','11803',
                          '10295','89203','47935','10626','52644',
                          '55775','81220','81345','80889','26704',
                          '78773','48948','52670','28746','65137',
                          '67004','45281','84909','29457','91439',
                          '63296','82469','54628','20821','36704',
                          '16275','36844','40079','18300','69230',
                          '84034','30760','29786','31792','27696',
                          '20674','16276','16389','62743','52574',
                          '51954','49288','97399','34527','19489',
                          '92379','40429','56070','41818','95048',
                          '68904','58206','71063','15342','36003',
                          '57070','90801','36007','67724','96953',
                          '93205','96782','28547','91785','78524',
                          '22735','16481','54569','60194','87032',
                          '89714','32742','36713','39902','26834',
                          '70288','50811','55118','68352','26270',
                          '87359','29874','26814','75549','10219',
                          '32105','21323','12616','96673','25080',
                          '67268','14741','24131','12148','68366',
                          '48339','20992','38822','62154','85506',
                          '25375','42598','12369','86620','17606',
                          '15087','62084','51539','98077','32558',
                          '78677','44150','21347','63220','70187',
                          '40518','57357','82740','27912','76861',
                          '88398','90022','81597','23925','50215',
                          '27591','14232','52651','96652','40933',
                          '70981','63329','53004','76222','28275',
                          '66411','27729','45162','12617','76434',
                          '48917','79641','21979','60824','88174',
                          '63123','34039','98161','12547','11829',
                          '11476','34049','79777','93963','18649',
                          '19190','65279','44675','69962','15274',
                          '61062','83983','24963','55051','67499',
                          '39584','41563','69809','14924','27500',
                          '60544','82353','34319','50057','46901',
                          '47640','35553','31575','66480','26508',
                          '16205','18676','47705','22939','44987',
                          '84893','34919','35779','39333','65368',
                          '94355','66155','17835','25808','84571',
                          '27386','25969','80813','52672','34970',
                          '88070','78998','35011','20235','98023',
                          '61150','84035','27203','91624','74445',
                          '25820','96495','67682','98974','65782',
                          '73431','34606','13064','71244','72065',
                          '34358','25064','50762','45350','78485',
                          '77555','96015','37723','15435','61773',
                          '73892','62077','88982','44578','95112',
                          '46673','74139','19558','76593','88054',
                          '50778','20954','12335','70123','59581',
                          '38876','91700','85006','13185','70303',
                          '11806','41471','72346','34183','52046',
                          '22201','70961','25017','72203','16420',
                          '13008','47861','48149','20034','53367',
                          '68332','49502','26844','21763','84837',
                          '95649','62750','45441','39012','21436',
                          '46064','68395','41048','23156','96468',
                          '53797','28819','66212','20240','18069',
                          '33575','43086','83174','44475','48788',
                          '71806','45517','22509','26122','19563',
                          '40889','42366','34334','12871','54915',
                          '98144','61075','78344','14087','10602',
                          '22060','86918','43222','85714','35284',
                          '40745','80010','75867','18685','45597',
                          '49730','32528','75477','56363','15708',
                          '74529','92260','94929','58703','99029',
                          '87743','57875','40862','44120','90825',
                          '17118','30717','32609','51459','35403',
                          '46102','66469','26536','40924','27055',
                          '19729','73682','15235','14647','27538',
                          '25065','89834','18907','18803')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
