
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '17642','62504','64158','39920','10701','80716',
                          '52264','31769','29965','51151','65649',
                          '19154','35466','86232','78982','42639',
                          '30331','39925','35209','35562','72704',
                          '57158','48850','67868','73169','47070',
                          '85794','62435','65513','31004','85186',
                          '53848','35993','29727','14304','17985',
                          '88624','97424','18102','61229','19893',
                          '11584','77715','29992','16247','19405',
                          '35454','11794','19461','33452','73480',
                          '57476','83128','15379','79921','99547',
                          '14806','30709','97116','64744','58702',
                          '90231','44515','99874','85888','45705',
                          '13425','80577','43275','39134','57768',
                          '43046','91769','52456','40200','52358',
                          '12758','65466','60381','14142','34475',
                          '41602','13525','81046','71825','24718',
                          '57744','26568','26997','92128','20202',
                          '66794','73345','74222','83454','20740',
                          '60925','35004','38266','78389','28754',
                          '42326','51330','41872','53240','49620',
                          '43323','47789','36356','98435','50555',
                          '58167','13931','40188','14858','74783',
                          '73063','72614','15623','45508','43547',
                          '20185','56114','16971','14184','30242',
                          '12778','48351','98353','19707','27671',
                          '83269','18634','72344','18321','25056',
                          '82832','30933','93253','65585','26809',
                          '18320','18745','94133','59178','61425',
                          '40058','10237','95135','39126','66639',
                          '32073','59801','30564','21020','50749',
                          '35964','63551','77501','16391','52842',
                          '13601','44041','69115','72627','21333',
                          '82149','15346','50878','29106','23246',
                          '13721','82133','45936','55304','72628',
                          '43173','34548','29622','18990','47882',
                          '29210','87923','11323','65191','20526',
                          '41182','28962','73551','23003','13832',
                          '38336','33122','18707','59036','54088',
                          '79486','81200','28623','70117','17377',
                          '42748','45169','13766','12253','51620',
                          '30011','36864','74250','38527','79786',
                          '66674','58507','27717','78031','10774',
                          '15006','85487','96585','87657','71488',
                          '35239','77584','51193','62894','64154',
                          '67717','10968','39520','43360','98397',
                          '29036','67122','19424','40773','38373',
                          '19185','12630','77550','45756','61237',
                          '53766','38265','15638','56758','44410',
                          '89422','79632','84635','99940','52769',
                          '22833','47303','92781','27072','43690',
                          '39497','83275','20175','13657','67093',
                          '37990','17526','19097','23782','97625',
                          '82148','23384','84153','81676','51440',
                          '41503','21614','63796','55308','44123',
                          '14974','66561','75208','14429','34264',
                          '97792','25438','34418','36535','15394',
                          '96903','88100','54834','35522','13482',
                          '70579','31836','77567','79532','14554',
                          '23419','31800','12690','49443','50637',
                          '76706','86562','45544','13252','13429',
                          '98267','23502','16497','46035','90405',
                          '29463','22085','19125','41939','93907',
                          '10971','85353','29527','54965','70571',
                          '48350','97569','54182','69282','93623',
                          '26760','63118','26637','54210','81040',
                          '27993','44864','76900','66725','64970',
                          '70755','91019','22421','35499','96850',
                          '95441','53182','33506','78205','67223',
                          '33179','39968','32001','15867','12611',
                          '83357','37157','28386','62077','59775',
                          '38559','36219','73189','63019','18355',
                          '93487','61071','19409','41226','39866',
                          '47751','27603','86430','88959','86917',
                          '80264','71859','33188','32643','47212',
                          '73050','65402','39021','55800','41364',
                          '32439','56415','41617','21799','32181',
                          '59518','54116','18444','34595','29343',
                          '37763','64409','70391','45111','59799',
                          '71884','33560','62283','11815')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
