
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '14983','47795','93639','89867','90113','13041',
                          '91147','90591','25902','12320','78076',
                          '41284','70034','45965','59282','85602',
                          '24669','49203','20394','73789','94409',
                          '41866','20070','19351','42938','35280',
                          '52111','92134','87244','82021','95020',
                          '35848','13830','17644','57609','10268',
                          '45537','85442','64193','41749','45045',
                          '58136','47441','46889','56307','19937',
                          '44903','77344','79153','75942','91770',
                          '65821','11470','24940','32415','10339',
                          '30661','25947','47809','49907','77870',
                          '67784','61891','21354','28044','26085',
                          '90567','91177','73138','42277','27663',
                          '47557','31654','98114','30903','49155',
                          '78372','57652','72063','96391','55185',
                          '20308','64649','66540','36418','42473',
                          '93671','18470','48143','34452','95026',
                          '64286','60324','20209','14405','35644',
                          '22794','98119','41195','49330','57855',
                          '44808','51954','39741','23722','43703',
                          '53700','11554','86695','39272','85385',
                          '30145','98560','15953','53824','12674',
                          '24456','64237','28849','51424','30907',
                          '45948','17267','39235','43535','11988',
                          '17091','73402','82782','80381','85656',
                          '84921','16642','47133','49319','17986',
                          '43525','30271','46623','47639','26253',
                          '67215','77605','25540','62814','81843',
                          '17967','13573','14978','85995','79634',
                          '18049','69554','41871','12963','94381',
                          '44563','23629','98486','65412','25901',
                          '36314','86402','45586','42720','99585',
                          '22287','94789','90882','33816','32045',
                          '96757','33858','29552','11990','46386',
                          '25511','99262','12950','95739','49914',
                          '74573','41600','31239','62857','13516',
                          '10077','74597','39623','15897','72303',
                          '54664','86856','24577','44382','38822',
                          '24682','94348','71315','22968','88873',
                          '69449','21257','47033','78164','33187',
                          '86638','32949','93327','66962','32044',
                          '60999','20788','36211','25747','46318',
                          '43566','98753','14823','46761','97572',
                          '22694','49339','49927','13341','49823',
                          '46363','26638','22910','77637','92027',
                          '77902','16912','35321','55725','40722',
                          '31656','96263','51498','26713','14933',
                          '92055','59905','57434','23085','90497',
                          '71967','72159','17096','91959','31677',
                          '20521','25798','94216','27984','54420',
                          '47994','10814','34635','97502','59233',
                          '24087','88111','68244','61870','60682',
                          '85196','70301','31384','58663','61200',
                          '79390','44378','16119','41903','37258',
                          '24160','40253','73345','71499','26017',
                          '29000','96697','68604','71591','98180',
                          '51840','52822','83936','96833','70942',
                          '76126','11090','55176','34524','44332',
                          '25699','99964','26559','45171','38466',
                          '85525','61066','79124','65414','14552',
                          '89107','47113','91450','48304','65273',
                          '23282','85022','52991','39056','41913',
                          '25016','13893','97637','55512','63569',
                          '13803','75280','16360','64064','20336',
                          '66254','55758','94592','16489','58319',
                          '29881','11735','50109','17230','35066',
                          '22015','33054','28709','70199','82684',
                          '10282','39793','70430','13386','39523',
                          '10326','63687','26628','43365','89323',
                          '40967','40252','15333','84927','19359',
                          '51597','15854','50321','68821','74645',
                          '54091','46344','14348','14311','37785',
                          '45213','86986','77583','14562','39654',
                          '31719','39633','66619','12325','59856',
                          '21062','35226','28437','89265','54886',
                          '73881','53055','40455','32985','60632',
                          '99155','56481','33610','56098','87893',
                          '67360','15794','81382','21129','70030',
                          '22071','37791','26590','90532')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
