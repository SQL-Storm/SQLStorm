
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '59241','16208','63366','19856','17781','67490',
                          '10276','47723','23717','50242','41572',
                          '40617','22387','23555','70902','38576',
                          '25827','38619','27304','54765','47770',
                          '80777','34253','41261','91712','10389',
                          '61247','90112','19469','30060','74342',
                          '70983','46997','44857','49647','18696',
                          '69050','41278','78979','75906','88218',
                          '55431','87175','98900','21528','37076',
                          '26254','87509','22632','73055','20105',
                          '21517','33528','18721','69002','83180',
                          '57519','62840','25017','59181','41217',
                          '16861','27657','29833','74069','21334',
                          '22317','46824','23498','64774','96618',
                          '92183','15031','13534','31419','98439',
                          '77848','16676','15881','27134','96951',
                          '55191','11021','17022','76071','47885',
                          '33393','38532','13008','86015','54491',
                          '30143','21938','86293','18787','65774',
                          '55985','40172','32346','17735','38135',
                          '96668','98652','22281','67813','36549',
                          '70689','66502','16632','28871','70232',
                          '54758','52261','64569','38659','47564',
                          '57754','30525','71270','16035','94489',
                          '56680','28483','90448','46140','20290',
                          '19849','32817','92717','77111','66634',
                          '30771','50699','46763','47225','17578',
                          '91017','85283','85126','15265','24827',
                          '16531','94175','42071','19419','12186',
                          '38530','92801','50546','17069','46244',
                          '57096','37656','58837','15075','33617',
                          '97805','11581','80726','41732','28654',
                          '46623','62548','74742','45184','48095',
                          '97217','29331','73294','58767','21376',
                          '53131','47275','71097','56869','24381',
                          '15938','27458','26123','19783','66272',
                          '28076','53205','70408','23651','26538',
                          '48951','35930','74560','23881','26457',
                          '38320','76327','23301','32273','52001',
                          '62167','53415','17678','56807','50560',
                          '28958','53133','38205','45736','53330',
                          '54174','52652','57402','87910','13440',
                          '97381','41272','18346','90489','47853',
                          '50081','79558','53542','73933','14290',
                          '82090','73872','14450','13565','97952',
                          '54541','53295','71811','43761','60529',
                          '10586','22968','30033','31228','54167',
                          '22594','62653','97336','89121','21986',
                          '21927','55451','69042','20945','21799',
                          '48463','48374','74705','89593','69525',
                          '92560','67369','38546','30462','65886',
                          '28023','48688','39733','93909','87153',
                          '13777','65437','45208','18032','49752',
                          '24699','25196','18889','96029','19808',
                          '38924','63706','51523','16715','13493',
                          '27087','48963','48700','65595','36858',
                          '29180','13527','71027','58288','98834',
                          '22338','39422','91165','91179','21477',
                          '41088','20068','14659','49553','52484',
                          '45433','34324','12201','55982','29269',
                          '55230','86809','90033','86115','91439',
                          '59898','16085','64787','91922','67358',
                          '52901','85702','79400','76625','11242',
                          '98813','37724','38091','48165','99734',
                          '66578','92176','34562','12739','31918',
                          '79669','48626','31721','64688','30521',
                          '83609','63771','17620','97456','77938',
                          '94782','45631','71124','19752','37261',
                          '87775','40774','25118','11544','56386',
                          '51487','56438','17567','34122','13237',
                          '74740','25350','25909','96968','63903',
                          '62290','90010','95853','73126','70419',
                          '15040','70633','36931','11227','14117',
                          '55317','14197','71729','68694','92890',
                          '97256','88829','36765','98477','45722',
                          '30097','99840','15204','48746','20322',
                          '21722','95279','86906','81404','52087',
                          '84014','30807','85866','43776','46219',
                          '15861','13019','99078','43225','18976',
                          '21965','70475','37637','51395')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
