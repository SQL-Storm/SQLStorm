
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '27916','97360','75742','10667','39456','16947',
                          '53551','15702','76664','86754','69985',
                          '72070','53542','27547','54962','64897',
                          '49727','86520','21240','40120','67369',
                          '26759','33729','22551','28212','36927',
                          '41258','18148','15832','54512','27040',
                          '25522','51604','62909','24143','93842',
                          '10600','21378','19619','51470','51757',
                          '60438','77656','41512','50465','18497',
                          '69222','75378','13753','91260','33234',
                          '23109','32366','39208','18700','29167',
                          '37776','74148','96892','70038','59536',
                          '94035','30952','12294','53062','33009',
                          '63135','12195','67474','67153','62202',
                          '41632','34801','64417','23759','85913',
                          '86826','33671','31225','17384','34706',
                          '43199','16857','63713','89764','20358',
                          '54405','93510','42657','53046','86378',
                          '65817','36350','74832','78691','93513',
                          '61317','56353','30521','73416','70881',
                          '35518','21598','98125','99535','84305',
                          '24903','64060','82830','40298','89194',
                          '70367','52374','24029','57709','61133',
                          '57863','28673','14067','26453','75591',
                          '27391','74340','53253','28834','45728',
                          '16870','39410','96229','14329','99460',
                          '33093','91914','58854','20124','52511',
                          '33813','58948','94496','97856','97111',
                          '26958','70549','36528','67842','68168',
                          '39012','84282','20715','80832','20223',
                          '81943','74835','13934','36115','74642',
                          '86274','88740','83719','77034','50992',
                          '82546','23257','87906','74274','94457',
                          '27436','37207','90901','78580','17410',
                          '61381','48153','73548','28649','41873',
                          '80123','11065','24783','29217','30852',
                          '10654','85591','83536','16867','57700',
                          '37063','90949','66281','95784','47505',
                          '39464','88542','48557','10994','61485',
                          '23419','71742','56743','83542','56321',
                          '25246','76154','97349','17407','86745',
                          '22091','36919','88307','80309','60213',
                          '10605','94514','12696','19285','99632',
                          '43690','69992','24353','41637','75390',
                          '20208','33413','80671','29803','33597',
                          '13079','37903','68018','19948','84623',
                          '57926','33774','52144','16834','23528',
                          '16996','30643','44102','11586','74787',
                          '62129','91574','10731','63483','79759',
                          '29336','36400','23139','13561','76914',
                          '92374','49762','79569','26937','14738',
                          '80628','26774','93520','38659','30668',
                          '24983','27051','74984','41826','59204',
                          '22056','73208','64071','36749','20467',
                          '30051','40908','72604','30962','40680',
                          '11558','61422','37793','46630','19692',
                          '35836','20593','25275','42303','32769',
                          '87627','11446','30977','90972','33241',
                          '20366','50212','35915','21111','93999',
                          '50638','61112','16307','26780','70075',
                          '42780','22092','76993','51487','67698',
                          '11697','13989','76958','16776','33578',
                          '17353','69669','58656','46167','59860',
                          '61245','71926','48100','84617','68835',
                          '14432','66437','48236','28692','88236',
                          '42263','72999','24246','41061','18438',
                          '39363','27546','37583','57451','49207',
                          '28364','60357','66652','24014','22566',
                          '12198','75969','83309','40373','99828',
                          '56022','29570','12714','92968','32386',
                          '65838','77921','43098','78560','22912',
                          '24203','68211','16521','62344','61763',
                          '94595','12052','69896','75613','26740',
                          '57408','56028','19236','63533','49414',
                          '95453','38697','24822','39309','57043',
                          '26072','74791','50503','79139','38885',
                          '85598','20676','84718','65479','80052',
                          '77367','42046','20417','27321','26256',
                          '54174','19501','32243','61107','43565',
                          '52000','31548','65868','18088')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
