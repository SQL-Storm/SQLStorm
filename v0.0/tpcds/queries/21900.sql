
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '48983','96843','83843','31425','18460','66360',
                          '82784','40919','48750','87131','36266',
                          '45894','32938','66838','67562','31997',
                          '43403','97511','93766','53591','85126',
                          '83070','22422','22310','46255','79465',
                          '79317','36164','67428','79360','64339',
                          '49967','79520','35952','62102','32299',
                          '14823','92946','21882','94074','37928',
                          '79432','64483','72622','37670','18985',
                          '94011','23900','16889','16708','55534',
                          '10044','51322','32127','10987','65244',
                          '47509','31124','70501','92803','75944',
                          '50055','82476','88127','76432','44604',
                          '41173','55070','78088','67057','19813',
                          '28459','78754','20748','24275','65707',
                          '62024','66318','38423','32308','78922',
                          '10759','42140','20547','64139','46712',
                          '59519','26766','45590','88137','38134',
                          '45483','49113','18190','54947','69388',
                          '58953','19487','85766','66868','29039',
                          '23106','20210','82595','30799','27860',
                          '30503','85028','80268','64797','42607',
                          '68404','71962','73872','39374','18581',
                          '52581','71521','32881','64370','13848',
                          '58831','84575','53270','54314','53379',
                          '19932','97057','34177','20115','38964',
                          '62621','45684','68463','53973','44657',
                          '74900','83440','25598','42143','59384',
                          '38172','76163','20535','62699','13470',
                          '79204','77150','11645','36571','72312',
                          '39045','88479','28554','63850','56756',
                          '87502','78553','23480','14463','86939',
                          '75108','49556','65040','78083','54179',
                          '10479','14645','85981','38162','93408',
                          '19464','11743','47683','18336','47101',
                          '14139','88007','89276','73503','53698',
                          '85125','94937','15535','69676','97391',
                          '37289','59465','52088','29732','41432',
                          '86960','36731','61095','96610','66406',
                          '60756','49818','39322','23536','23310',
                          '49099','16501','20726','62945','79076',
                          '89733','36839','33817','11872','19573',
                          '71967','99240','14563','14970','28386',
                          '25039','58564','10989','46922','21893',
                          '51369','49414','13428','45897','16030',
                          '60785','17441','68781','89856','10679',
                          '58518','55355','45274','48558','92437',
                          '88224','94941','12839','11665','92945',
                          '21083','92475','33696','11288','45028',
                          '32971','29688','31271','40015','15489',
                          '99736','40678','54582','95335','36765',
                          '41470','44575','33606','86162','23288',
                          '24945','29264','37823','19171','25784',
                          '56646','97685','33446','49525','26692',
                          '42049','79266','94667','42685','40512',
                          '37042','12087','36632','10422','49945',
                          '96038','17323','31713','20853','12937',
                          '12211','88719','21701','43543','15860',
                          '25241','41265','42200','25001','51566',
                          '87382','30600','22662','44589','51035',
                          '69912','14723','74276','44787','69970',
                          '85320','42865','56251','12287','10652',
                          '85254','27454','66140','71016','48552',
                          '98776','97045','32860','97871','61328',
                          '78326','97821','38965','40851','71171',
                          '49449','95221','38746','71865','42193',
                          '75507','25805','53899','42042','87294',
                          '21786','27198','65388','38381','53561',
                          '36816','39082','42377','22855','96312',
                          '81995','25766','81662','99453','55000',
                          '15084','43916','80039','10614','81242',
                          '54805','55699','30497','36714','56152',
                          '86050','15558','63355','62118','57754',
                          '89731','66945','28958','92651','80283',
                          '35543','53255','63433','56571','41004',
                          '80378','48586','13960','45019','21921',
                          '16506','98586','18400','94336','36703',
                          '53105','48009','54192','86134','24012',
                          '81957','37458','89607','31141','11292',
                          '17948','62360','38749','97038')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
