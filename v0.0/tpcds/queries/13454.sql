
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '25033','21612','87260','97920','38334','32210',
                          '64751','69453','72497','38800','79415',
                          '13569','27798','13338','83158','12338',
                          '98754','34600','90368','25103','63686',
                          '95110','66340','53452','53232','39405',
                          '86207','15439','84132','82358','19699',
                          '69672','22321','62714','26157','43306',
                          '83500','60740','67522','70035','21570',
                          '55541','28719','63089','87832','13127',
                          '36772','84271','20778','15630','22786',
                          '26159','69627','61082','14096','42025',
                          '13923','45971','12736','26149','17654',
                          '34080','21454','90879','98732','53776',
                          '36219','44431','73719','43288','76799',
                          '28106','25736','44687','45341','21742',
                          '95713','20687','19847','79062','10205',
                          '99256','55148','66068','57411','91063',
                          '22406','93541','42927','38382','48639',
                          '56788','55267','89413','62035','55128',
                          '69311','59467','25788','40236','28957',
                          '35246','12002','34936','59549','77826',
                          '19903','46143','42161','28216','28555',
                          '28456','13013','42980','42650','14660',
                          '20233','69100','54641','73405','21679',
                          '21003','15536','23658','73559','86361',
                          '48621','76039','57976','21164','55099',
                          '85761','94469','31417','19416','16286',
                          '76676','49254','25492','20954','80749',
                          '31558','60942','69484','20380','33178',
                          '38513','40846','99642','35954','62963',
                          '55855','60325','21830','27515','79396',
                          '63930','84504','64383','69580','79689',
                          '10469','50764','14988','42515','81032',
                          '97903','26739','23987','28196','63901',
                          '38274','27077','96963','32049','76164',
                          '80232','87681','43245','87323','92362',
                          '10701','12121','79198','42721','40492',
                          '38346','94651','27311','87609','82780',
                          '54524','21217','77849','88343','13727',
                          '68576','91857','98712','31237','29792',
                          '54039','49032','16221','52394','46261',
                          '25273','19777','16289','99479','38173',
                          '18904','88844','41561','89521','68677',
                          '32218','66087','28780','95815','49894',
                          '62803','30047','53615','72559','73069',
                          '85262','20604','99082','59949','18369',
                          '35969','27391','25950','19867','58265',
                          '80550','57797','63450','35153','50082',
                          '96933','73924','95369','12315','64753',
                          '53286','54537','82148','81824','50527',
                          '31600','37979','23372','27317','35459',
                          '14235','98128','47869','33829','53283',
                          '74219','10875','31072','28635','66623',
                          '63509','24304','21440','84914','11990',
                          '57925','95571','77880','98289','66971',
                          '24199','84716','13461','66768','30306',
                          '66572','58717','44392','20507','36749',
                          '62142','13614','18529','28819','37585',
                          '86874','21024','41375','97960','21238',
                          '25728','44244','58135','75403','38215',
                          '38819','62640','24265','39797','93039',
                          '78240','40613','10503','72070','88824',
                          '90642','14317','62392','10082','65222',
                          '73510','26419','89783','69857','64080',
                          '50702','73930','87455','56681','54494',
                          '36160','28704','57682','62443','82213',
                          '16732','58821','40376','70147','37354',
                          '18573','49465','45724','68094','48062',
                          '97782','29306','45470','91674','24332',
                          '89424','20260','36447','67885','73779',
                          '16713','44600','47072','19693','27652',
                          '65901','71270','59386','74175','27911',
                          '56126','96655','87554','64450','16262',
                          '54163','63061','76602','75868','14461',
                          '94358','18066','17599','32228','43785',
                          '90126','54990','76527','58628','73500',
                          '50666','24347','99532','21243','11290',
                          '11114','33745','35344','71342','91249',
                          '78976','43373','86502','74115','42982',
                          '77369','66831','62491','47929')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
