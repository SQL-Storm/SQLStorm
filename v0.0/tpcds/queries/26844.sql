
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12421','79852','89178','98008','49391','15021',
                          '74273','26746','36286','52466','91378',
                          '40778','32971','63421','25410','92319',
                          '85338','36371','52502','23135','34276',
                          '38770','92576','64907','54659','47776',
                          '44415','79380','42814','34770','20024',
                          '51685','58727','11762','40945','55774',
                          '41018','22152','71616','14959','86421',
                          '57234','89681','30343','97397','36162',
                          '46718','14211','14993','11889','70761',
                          '50634','74309','22646','30599','76240',
                          '33429','21978','34432','13335','81125',
                          '28822','56400','97658','35593','22737',
                          '69192','62653','74047','27752','16098',
                          '99695','93791','95128','97150','18683',
                          '50860','22003','43342','30311','10220',
                          '17061','32450','28470','10730','80002',
                          '37584','56376','60613','62050','42360',
                          '50328','90359','55636','11328','77538',
                          '17147','45829','54490','37053','46800',
                          '86443','68773','63140','27334','40682',
                          '78998','44856','88281','22480','82227',
                          '19123','24542','88203','23415','27240',
                          '28145','25934','96227','36560','63715',
                          '46300','61846','80469','13674','17292',
                          '36928','80370','59667','19653','60521',
                          '16043','92948','28368','66929','62577',
                          '87277','56693','37656','95003','48444',
                          '59363','48329','78261','53685','74855',
                          '72044','24615','62410','39576','15439',
                          '50742','67840','14123','33943','67230',
                          '35045','79096','32089','95985','46078',
                          '31742','48461','70293','43423','65546',
                          '59559','82259','41701','63567','63232',
                          '67207','49826','56326','22219','20575',
                          '75610','61360','72019','25462','38382',
                          '16652','14605','19348','39743','22340',
                          '11662','92024','37845','71584','58488',
                          '47850','86815','40986','42159','19122',
                          '72835','87296','32866','74056','50112',
                          '41220','82047','11332','21140','47229',
                          '11723','44662','94213','49341','45202',
                          '32750','23795','23938','24078','27650',
                          '15089','59366','36787','14945','46495',
                          '61968','18913','48039','83786','66150',
                          '55832','53603','76044','36614','82031',
                          '21209','67902','33052','88956','11428',
                          '30271','79186','51119','38510','12067',
                          '84368','32395','21382','91689','62168',
                          '73249','47493','28399','90636','68080',
                          '75040','41070','20307','47617','94112',
                          '62532','80171','16576','59801','21516',
                          '92183','45121','12838','92107','85657',
                          '60402','88676','18568','30767','20798',
                          '51246','79406','46948','83763','41322',
                          '53125','81615','51185','35948','71205',
                          '18580','52559','49267','15663','30615',
                          '88936','16578','50674','94003','16828',
                          '24514','87502','26381','14068','74190',
                          '83211','40815','76893','20747','47265',
                          '57360','77370','21563','12122','28998',
                          '58175','88493','89222','84408','45796',
                          '68688','24619','11117','10563','46710',
                          '52553','73887','42288','33761','29508',
                          '63175','80657','21780','19176','69727',
                          '66511','30349','39225','23220','60523',
                          '43436','44004','56512','17578','40966',
                          '44117','53264','33005','96510','17408',
                          '21158','68970','59069','38936','54455',
                          '66335','24993','45168','55958','56861',
                          '78315','62372','66728','36489','20336',
                          '82034','51964','63099','33073','44526',
                          '26053','20069','89343','57500','39763',
                          '52943','44510','72471','39060','61634',
                          '12685','33197','98932','53348','43460',
                          '46637','19806','11631','59774','51879',
                          '35749','32559','36073','34049','11925',
                          '70729','67673','16172','46901','43405',
                          '58548','50684','61167','94239','42155',
                          '41723','71277','50081','82714')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
