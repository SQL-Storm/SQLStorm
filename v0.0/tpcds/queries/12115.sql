
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '77293','69788','33734','36899','26990','79128',
                          '78120','23729','40852','75912','95651',
                          '34747','34917','91944','58123','98889',
                          '57136','62843','28345','92265','12627',
                          '10744','40567','31449','56062','31150',
                          '40018','75220','79665','56658','16001',
                          '20927','30374','34450','41770','33541',
                          '20312','73733','13558','26593','52977',
                          '25020','60911','77439','47846','42748',
                          '90812','75624','24510','14887','41139',
                          '24979','58166','48841','99991','46361',
                          '34998','42138','63971','50404','94115',
                          '20088','33169','52096','88674','34289',
                          '49074','42306','60194','21136','27253',
                          '21477','94637','20311','72304','51415',
                          '70064','48239','22103','11183','28910',
                          '88677','49911','41712','22282','78945',
                          '31583','51042','30096','48084','14511',
                          '30252','15745','21878','60711','34237',
                          '31490','95051','21297','75919','26134',
                          '15243','61485','11826','25677','16246',
                          '60619','72180','37582','24143','22831',
                          '79194','31369','93093','10739','29624',
                          '37291','23638','10358','47600','37186',
                          '26838','95638','53975','81760','98125',
                          '38930','31778','65814','36012','27377',
                          '24060','65171','33560','61950','65702',
                          '52609','24942','92358','80857','26760',
                          '86907','92299','34876','62196','38356',
                          '47444','75516','80679','11815','67878',
                          '19164','36205','76742','91720','37369',
                          '25238','38929','69324','82686','13965',
                          '64975','41504','62347','97572','24663',
                          '14006','46227','53347','20265','48166',
                          '17280','41981','88573','33676','21051',
                          '14831','23347','17484','48667','34894',
                          '51598','73246','16338','33315','20913',
                          '73967','68051','59169','56526','29755',
                          '17759','64963','53900','33907','16335',
                          '29676','75809','56490','15148','23810',
                          '41473','49501','12560','45548','62107',
                          '56676','46564','39662','11229','91197',
                          '13450','76982','12409','40216','77731',
                          '40433','23888','25923','60506','16331',
                          '53030','88839','62828','35443','60910',
                          '76719','61935','20111','60669','17191',
                          '44684','90787','72108','35619','96793',
                          '24001','44235','44738','31140','17870',
                          '51734','74010','61872','24391','83963',
                          '12389','26306','85617','41283','17407',
                          '62922','60965','87918','74579','75229',
                          '89751','63539','11716','76451','89506',
                          '71152','19224','73477','56748','31213',
                          '77072','26534','57451','47655','31948',
                          '55148','79084','30729','41824','52387',
                          '83176','43192','49654','77611','58118',
                          '26338','25081','88581','37250','31751',
                          '77635','53953','30138','12823','48438',
                          '28341','54924','19396','55764','91139',
                          '47615','17719','30159','90435','16041',
                          '12488','46161','99390','17439','53670',
                          '14371','33413','23290','55888','63898',
                          '13423','18327','48081','94844','38212',
                          '15273','30107','20240','92966','36440',
                          '72698','75012','20263','63882','53151',
                          '73726','87775','51935','53549','75644',
                          '18216','49062','15121','68238','16548',
                          '90353','67284','35168','90804','60156',
                          '61687','72209','45992','45774','30817',
                          '20126','32069','74574','78168','67355',
                          '45043','13428','50805','55984','48879',
                          '32394','14271','80870','48647','43447',
                          '22810','12779','75663','37927','10245',
                          '55095','23020','73647','70661','58295',
                          '57649','45501','19852','59373','87117',
                          '46966','91627','65560','48877','70569',
                          '11366','73837','41607','17311','27309',
                          '21747','31901','25712','27457','15123',
                          '57364','57246','44383','33377','34811',
                          '90782','79125','23599','44324')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
