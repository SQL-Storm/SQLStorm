
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '97970','66448','46736','18004','12009','52673',
                          '18401','62405','38708','89355','83307',
                          '55017','93991','78300','72629','86317',
                          '30931','44355','36745','84008','55925',
                          '73149','54585','16658','36156','67413',
                          '95542','14672','22504','94050','39137',
                          '48579','64260','73402','62744','65773',
                          '98895','33594','47788','25982','58730',
                          '26421','58714','59615','56948','51399',
                          '61186','40550','69468','15180','61969',
                          '62937','49056','86990','56173','99545',
                          '88875','46862','10628','15969','49187',
                          '91591','35159','81370','33272','26475',
                          '25623','52006','94253','72244','15349',
                          '95327','30022','70929','48325','37786',
                          '49352','29170','14790','60205','26680',
                          '12310','21342','14058','51437','76599',
                          '29464','18791','96120','95527','38682',
                          '94932','14318','62095','44038','24134',
                          '66776','86607','92085','88187','57539',
                          '25193','11642','16531','74816','97962',
                          '35101','41260','55544','67655','66512',
                          '37601','50980','99607','42444','36476',
                          '97802','77339','27308','33924','34275',
                          '27995','40787','12514','75104','21550',
                          '25621','17765','43079','93893','18564',
                          '62759','51862','66732','52672','51806',
                          '84372','37807','79307','57813','30177',
                          '15295','14960','87242','72418','39401',
                          '45145','90378','41124','23999','34024',
                          '62515','46959','39095','29997','67454',
                          '40836','37640','88740','16897','41179',
                          '44482','31544','23285','28923','24004',
                          '96821','25430','36408','67262','18553',
                          '16721','18537','50529','28956','60593',
                          '81678','35237','36554','31215','24245',
                          '31899','89885','36209','67604','79904',
                          '39328','60685','13240','21227','95081',
                          '89838','22589','10721','56764','27482',
                          '64187','70596','19931','32253','98908',
                          '42821','17615','41661','52625','61339',
                          '27624','25884','74910','32680','14844',
                          '98298','98846','27721','27863','33182',
                          '81589','67725','92290','42739','56835',
                          '57395','43024','85989','20195','84878',
                          '76522','44444','62676','80217','17006',
                          '53764','51370','80970','60723','81775',
                          '22183','84038','53080','78751','76810',
                          '12051','87675','82960','26476','35715',
                          '20834','33361','79833','32127','28753',
                          '68171','32655','91128','65809','10672',
                          '53871','56820','21436','25319','51776',
                          '23214','58828','48906','67879','22686',
                          '92349','10774','63721','22414','88431',
                          '29940','53252','87831','14302','15849',
                          '93375','62004','95956','62723','77939',
                          '75249','52584','83979','12415','94984',
                          '95731','52768','66723','44323','50954',
                          '50034','17522','68135','10979','45376',
                          '65215','60302','16848','36285','84842',
                          '67259','86726','90300','40859','14060',
                          '43801','48079','28915','46669','39625',
                          '84758','60831','28060','17954','86929',
                          '55506','48112','39316','17364','43710',
                          '27939','20463','17518','75151','26134',
                          '18795','90800','75433','13493','28566',
                          '49534','13877','13839','34967','54356',
                          '88213','57507','37195','21949','22806',
                          '51322','17286','28728','52454','85612',
                          '13196','47355','20667','27171','46526',
                          '51278','21710','48519','61229','21610',
                          '17249','24006','30548','87501','93544',
                          '83815','69288','11162','14001','65463',
                          '13519','47661','22408','25742','70647',
                          '58541','64062','14258','51971','42221',
                          '27184','58450','11271','33266','69067',
                          '66485','65632','77138','82458','10014',
                          '31696','50835','61742','99813','10264',
                          '27022','16813','87880','93293','61754',
                          '81743','88939','90430','34772')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
