
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '17011','10133','27582','60741','75040','43206',
                          '13424','11379','14305','77800','44839',
                          '46498','15023','26356','23531','78658',
                          '54442','33474','50447','27460','15429',
                          '21949','85153','85618','26159','13307',
                          '72889','61631','98458','95257','61133',
                          '24515','34752','46963','74230','28941',
                          '55640','94441','92593','58069','63827',
                          '74534','67811','31879','18862','42882',
                          '88298','56814','52734','13873','37692',
                          '71576','86731','91968','48989','25716',
                          '65506','57035','27043','47362','99004',
                          '95968','32731','89472','47115','35600',
                          '10261','37372','57223','60342','11735',
                          '16964','71946','18761','48972','17914',
                          '23655','47944','13631','67775','94407',
                          '51212','92921','52127','59127','89070',
                          '44572','48841','47565','48796','13210',
                          '51190','15986','24106','76507','23285',
                          '11954','30013','88870','21190','88805',
                          '92709','33672','58070','27702','75892',
                          '14695','91713','28768','88809','30571',
                          '68101','53515','16495','32889','47401',
                          '27539','28827','15074','25483','38023',
                          '23395','30483','75234','89475','62259',
                          '22146','29220','41059','67682','64687',
                          '25796','10912','42967','50817','73739',
                          '13224','33042','48335','75968','44641',
                          '74593','77102','40724','38751','32659',
                          '68604','79254','17899','17260','60165',
                          '66717','98637','47190','34352','86073',
                          '23811','78745','54457','45799','97342',
                          '36321','44989','48476','97152','94114',
                          '94786','36262','79345','16787','23426',
                          '96352','57613','22356','68106','38578',
                          '18660','23887','80810','19021','89683',
                          '34804','30304','37855','39893','34606',
                          '27246','10987','35120','26206','21527',
                          '99385','24831','12507','32612','75853',
                          '97957','37008','85552','87887','38401',
                          '21717','11499','25204','47761','53960',
                          '25743','14966','76573','85380','41554',
                          '13340','14281','41474','55635','49901',
                          '63252','10580','39500','57968','99798',
                          '11594','39580','15539','81800','76937',
                          '19947','68225','93841','68609','76155',
                          '32570','16800','59252','66422','52695',
                          '96998','73321','41646','71667','48614',
                          '73887','27746','20150','61338','75017',
                          '73976','58650','53763','43906','29132',
                          '63911','27255','28945','48462','19876',
                          '29670','93888','33190','95214','48325',
                          '12980','24919','16331','44323','21497',
                          '33601','29653','72371','16932','84466',
                          '37267','94787','71886','72374','39859',
                          '35184','73530','63077','78744','22908',
                          '20341','43863','51857','20589','94616',
                          '59803','28033','19662','37085','94630',
                          '38709','25959','44241','51621','40947',
                          '68005','76223','55573','23815','48315',
                          '87403','20162','69274','67957','67688',
                          '75533','93234','78262','97096','62317',
                          '29166','53297','85868','82653','17434',
                          '10995','26553','47711','16062','54237',
                          '36615','59906','20059','19412','83268',
                          '19051','57989','54763','88000','19992',
                          '84573','32170','27110','31641','31881',
                          '18047','39434','70225','89051','81488',
                          '49782','66900','43966','97261','68177',
                          '97976','99980','17029','54960','69940',
                          '65822','32754','79090','53125','17549',
                          '79147','28523','57709','41457','27286',
                          '47154','37901','46917','14520','73727',
                          '95028','16640','45781','85231','74057',
                          '38190','52028','26387','32622','13710',
                          '73660','54215','54315','43155','96192',
                          '55838','46334','43129','78419','29035',
                          '58072','95073','75443','45357','70621',
                          '70958','35902','40260','55958','19246',
                          '49520','22099','74242','39886')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
