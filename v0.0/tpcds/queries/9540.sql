
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '53776','46541','76580','87082','11137','32387',
                          '42601','22289','97473','85387','45426',
                          '79809','20249','78557','17109','18996',
                          '12151','18803','60330','60755','32072',
                          '67108','11429','27261','11673','79637',
                          '38454','88769','52910','29217','84278',
                          '55311','58389','76866','26932','36387',
                          '22623','45069','18582','17761','23537',
                          '26653','16281','32812','42493','34414',
                          '10675','25223','60120','86534','65643',
                          '33338','57198','44186','73020','46972',
                          '38616','59065','65912','15120','64682',
                          '61755','76163','12520','65641','92896',
                          '80735','66365','95697','31189','39766',
                          '49273','94701','14435','18665','48267',
                          '98929','86726','68882','28025','65848',
                          '54595','80261','53795','84015','24221',
                          '31368','99925','22900','72677','77464',
                          '46231','66566','24544','78865','47919',
                          '38481','61502','21055','97056','15547',
                          '71946','70392','55394','47884','25204',
                          '33105','25833','50212','56385','44402',
                          '38683','10180','91075','83372','64327',
                          '17318','11443','89708','30704','57767',
                          '61863','74560','78449','24504','91979',
                          '11668','15036','89589','52651','37410',
                          '20738','51571','99452','93525','55757',
                          '29539','75274','34128','68507','29970',
                          '30219','41918','32467','17428','28507',
                          '50566','14118','90399','26639','46017',
                          '64723','74097','22076','19570','61643',
                          '35233','69740','80230','65268','52054',
                          '56085','41838','64688','36666','82089',
                          '76549','79671','18339','11951','22033',
                          '90380','38297','37061','89243','72331',
                          '80341','34811','60432','49076','22087',
                          '78788','15403','87404','19239','90361',
                          '89811','50415','29044','60047','82451',
                          '58107','25605','63705','58957','62617',
                          '73486','23076','94438','53566','33835',
                          '77378','44752','34630','45209','18181',
                          '13759','78676','36058','85566','11879',
                          '51142','91539','13514','61164','44075',
                          '20746','54565','49545','42619','86734',
                          '15783','24813','17251','66718','16188',
                          '23985','55959','15961','31878','55894',
                          '33349','98105','65778','87332','48463',
                          '23946','39743','81039','17252','76728',
                          '74820','36884','37100','51868','25547',
                          '85774','79364','34511','32143','38138',
                          '11335','27054','59799','19841','95572',
                          '44805','72260','29178','75904','59229',
                          '22413','39345','64412','32270','80395',
                          '14962','75338','74327','48166','63674',
                          '35611','31889','76078','82919','60488',
                          '27024','87785','48354','67792','20359',
                          '13661','20160','31743','66289','31902',
                          '24335','60756','42445','61493','27722',
                          '85875','64550','91245','14074','58493',
                          '43280','33729','78234','95701','23929',
                          '81375','86240','19677','39552','41532',
                          '12366','83882','60647','18552','17345',
                          '36669','53913','16812','10504','57925',
                          '88863','13442','65355','83787','34252',
                          '43171','50731','22826','40028','73879',
                          '14741','27814','55663','61656','92279',
                          '24121','76574','86939','77112','14186',
                          '87758','71092','62498','93952','65039',
                          '56350','11508','88380','83701','26978',
                          '31145','52206','69942','14590','70003',
                          '84363','42358','59314','12181','58302',
                          '70864','27393','38225','39177','15940',
                          '79057','24950','35936','46934','34885',
                          '24662','61729','51752','30757','61469',
                          '38324','26575','29616','32255','29782',
                          '90613','23223','29312','92907','61448',
                          '78348','13186','45127','69950','53648',
                          '30856','15669','28675','70035','49984',
                          '43303','21053','93067','32527','66093',
                          '85886','32258','63180','65862')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
