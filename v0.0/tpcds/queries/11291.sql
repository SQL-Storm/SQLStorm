
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '54050','69962','85541','95290','44292','80212',
                          '97721','23702','48025','24432','25579',
                          '37213','71349','31938','56597','65737',
                          '14269','14276','83931','52903','78304',
                          '11260','27024','45066','48404','51029',
                          '85345','10041','17672','93260','42428',
                          '79799','57988','38282','56722','27981',
                          '76120','57190','34353','35707','54285',
                          '84367','18975','28441','73366','84241',
                          '28366','50875','66606','58125','93323',
                          '36663','61308','52166','20885','95652',
                          '55497','34983','63341','32619','23067',
                          '98780','58015','54989','23605','63654',
                          '13874','43059','23684','58409','61700',
                          '18892','20628','54718','34431','19910',
                          '73337','31632','46078','13816','62128',
                          '30312','55945','38398','26881','21816',
                          '63586','22617','51389','64984','42575',
                          '90408','59345','40796','11858','29440',
                          '64908','46034','42132','57334','56788',
                          '34108','40856','32809','14229','78495',
                          '74057','40511','51809','62712','48939',
                          '61562','25632','88339','36958','50542',
                          '80443','52184','19994','58325','49432',
                          '59423','80080','68612','32088','30978',
                          '32995','10800','38670','83141','23310',
                          '25349','19329','37472','18769','66484',
                          '28713','83606','27043','77094','40555',
                          '54653','34845','53277','22119','53829',
                          '18076','44208','75166','33608','81251',
                          '95634','53751','16193','37079','25846',
                          '15777','77710','82419','70251','28473',
                          '74027','88894','84890','35225','72644',
                          '40460','16287','69230','19676','36696',
                          '71294','29654','79262','17581','84585',
                          '92414','84705','62865','18010','67116',
                          '26455','57747','68170','95210','71184',
                          '63043','56192','34308','36175','75558',
                          '63719','14058','17002','44041','64030',
                          '35785','83838','58783','95044','91054',
                          '50266','84807','14525','39512','60692',
                          '97101','15461','47732','11679','47513',
                          '75615','62821','34019','73104','22592',
                          '92715','20078','46347','57579','13394',
                          '65351','11632','31025','25756','17970',
                          '33216','36561','22461','93761','27422',
                          '61492','54246','28312','29593','77795',
                          '59406','78799','76373','35482','49043',
                          '61263','13526','45799','36013','82502',
                          '75808','20464','53712','75805','21858',
                          '81270','53260','46638','22290','51730',
                          '40753','50759','95839','87339','49408',
                          '60393','36353','43599','73822','81980',
                          '31391','26795','31625','33959','57086',
                          '52243','99543','51494','68488','11400',
                          '88371','56816','54769','41787','70919',
                          '11944','78920','72773','12290','16602',
                          '50599','46818','19203','90186','60144',
                          '11815','18463','60430','50061','44899',
                          '51281','85482','29582','30782','82481',
                          '17697','46972','38230','12506','47975',
                          '33679','12717','16736','66129','87686',
                          '67849','15963','74280','93722','49334',
                          '61494','43700','69902','20298','27482',
                          '12736','45128','51785','43575','39753',
                          '71308','59238','78166','71131','74937',
                          '23643','69690','70650','55795','75703',
                          '44909','66206','93749','77268','39312',
                          '35599','10663','75479','27359','30077',
                          '38437','77861','59982','55708','81686',
                          '11507','86856','43247','90697','47913',
                          '82035','48757','21001','81668','14338',
                          '35085','91936','26364','44270','55948',
                          '86951','29626','61019','91153','84908',
                          '17996','51639','51944','17583','18485',
                          '55766','78756','24213','60016','10226',
                          '43092','81348','17853','69118','92210',
                          '29548','85607','92356','76807','88730',
                          '14896','16356','60052','20676','91113',
                          '81565','81176','48331','15875')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
