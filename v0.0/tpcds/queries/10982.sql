
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '16236','50459','41396','15215','24687','12688',
                          '72178','44661','25853','20719','54770',
                          '16504','79754','60728','23577','31018',
                          '70359','27623','64781','21220','44111',
                          '35923','43911','13545','37808','27606',
                          '65509','58056','99329','83471','18815',
                          '64077','93994','81296','39912','36925',
                          '43369','95761','82414','89504','73649',
                          '28923','18121','58742','17635','92442',
                          '66655','59182','88921','44276','10961',
                          '67165','36640','18237','54132','27241',
                          '79355','77006','23591','25362','64090',
                          '19326','33887','19006','10189','35785',
                          '65136','18459','24513','23019','15045',
                          '19364','48320','95630','33861','36493',
                          '60965','55910','35970','46728','74359',
                          '11879','11688','96219','97229','41985',
                          '59397','63099','13863','71262','68629',
                          '69501','40760','57385','49748','41670',
                          '38074','99326','81034','14650','26281',
                          '30733','43576','67863','51012','65486',
                          '15190','48535','16687','67637','34136',
                          '25786','54326','16959','33058','40729',
                          '46632','68822','74576','83290','22478',
                          '94083','68724','35655','36080','60595',
                          '13856','38025','39589','69719','43927',
                          '55896','23050','65137','53470','54565',
                          '72317','37601','11937','90959','67434',
                          '30949','42678','85346','67443','38135',
                          '14852','50966','36743','89996','84818',
                          '44952','88198','82630','26550','98767',
                          '43130','21570','74481','72284','84555',
                          '81455','97988','47631','10010','37845',
                          '36164','70269','11727','63677','50580',
                          '64410','35113','34741','25291','40904',
                          '79212','75915','46927','63167','24938',
                          '20877','24786','83082','35700','34376',
                          '33294','62256','84921','84501','58161',
                          '27533','64016','29958','12503','10166',
                          '74008','54424','76079','41789','99883',
                          '31488','39886','80995','86583','13120',
                          '40196','76856','76119','36420','26118',
                          '82233','69917','32985','33047','16916',
                          '10762','96539','20429','77764','44240',
                          '11865','64387','59270','97002','33968',
                          '20650','90088','15244','89361','33462',
                          '55987','44709','71055','20848','19266',
                          '15884','49084','49568','67479','86067',
                          '24397','73652','67516','34866','36160',
                          '19699','43468','83584','60979','96586',
                          '49273','36477','11508','73972','38991',
                          '41853','13925','36591','19798','36896',
                          '60667','99897','55977','20789','47265',
                          '32610','96558','74834','38192','29938',
                          '48768','94092','41915','39906','66315',
                          '88934','41973','42458','57461','92031',
                          '36264','38098','66845','92660','71425',
                          '33015','40677','48673','74975','29461',
                          '93093','70495','67782','79904','86532',
                          '16028','73455','30200','81232','71929',
                          '51325','31139','33441','78566','86074',
                          '11825','75559','91440','90087','36133',
                          '55006','12512','55636','75566','76899',
                          '24592','55374','79426','60556','78510',
                          '42489','28896','29922','14254','43533',
                          '29615','28023','59855','21996','11427',
                          '27153','17999','36761','50138','42240',
                          '19584','32828','79805','51439','74617',
                          '58829','19389','79743','55135','60408',
                          '70064','31958','33855','38505','42179',
                          '39298','38647','24969','28637','93175',
                          '41510','89403','89507','49845','21324',
                          '96589','69015','26763','50991','87487',
                          '56626','74414','54472','27594','23141',
                          '39945','29423','39637','60649','22175',
                          '30213','98481','80868','79907','13193',
                          '42151','75174','35053','33880','14582',
                          '60355','55913','26876','41913','82265',
                          '29412','89434','18192','36941','45955',
                          '66467','63654','86773','68268')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
