
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '68849','45893','25379','30626','93171','16666',
                          '27282','73556','49955','30648','39329',
                          '34429','58300','97611','47629','65703',
                          '47171','28182','49030','24243','68724',
                          '93695','44349','11924','44411','19614',
                          '83455','40672','24569','63033','13345',
                          '12560','25971','22750','94929','37602',
                          '11399','87316','77714','15559','57001',
                          '82047','59538','83278','68057','42507',
                          '93176','53567','30082','31619','38658',
                          '94034','37968','40918','38625','77529',
                          '12541','64415','31106','35254','89033',
                          '31768','10660','56624','25977','11478',
                          '24470','31939','79398','66329','41038',
                          '28711','12033','46135','31145','59681',
                          '40173','68311','36316','63149','70290',
                          '24448','38547','15482','71258','15256',
                          '13399','44595','58589','45128','49000',
                          '84020','67770','75463','31807','17531',
                          '87030','35715','11583','27221','58290',
                          '63261','63374','90315','54379','71042',
                          '60336','53009','40223','22943','66263',
                          '17580','44000','44307','17929','14168',
                          '98015','51475','78103','80501','81964',
                          '26885','59172','18781','88277','36200',
                          '89657','47827','29706','24016','63838',
                          '17101','65918','10063','16750','24923',
                          '91030','68121','89881','49072','42461',
                          '85449','51150','33863','34081','41882',
                          '72339','43055','15822','70531','70023',
                          '37113','91281','33953','25406','83487',
                          '67635','79620','45052','28362','61555',
                          '60433','83414','94727','91306','99814',
                          '17527','22340','71490','20916','72705',
                          '26793','94008','58380','42429','56081',
                          '99231','75796','25347','94175','27571',
                          '44872','48886','32141','28240','48998',
                          '48259','55640','19353','26040','85660',
                          '52115','44327','47630','77743','33663',
                          '34252','19504','79985','73583','14615',
                          '65488','72437','40005','43013','11318',
                          '23964','42895','44064','86793','43945',
                          '76531','37395','29334','43006','28031',
                          '21613','88623','50867','90455','73349',
                          '45634','50117','41277','78413','77981',
                          '69036','16582','28129','89119','50635',
                          '86160','38157','36854','93611','79510',
                          '44366','32636','31909','89807','47140',
                          '47864','67324','77651','54163','73044',
                          '27787','36100','54933','51756','10206',
                          '52150','21828','25543','41214','96724',
                          '20030','25813','69819','62637','49143',
                          '55372','84029','58034','12779','80278',
                          '25148','97268','34317','20373','70527',
                          '34964','76572','22213','71856','86601',
                          '96463','18827','74794','46900','51902',
                          '72027','81973','91713','29440','35128',
                          '31036','92920','57018','60536','99001',
                          '82122','57118','90148','13340','35590',
                          '85186','99684','72923','61303','82502',
                          '65867','61388','75163','14085','21328',
                          '91394','96011','11904','12700','44229',
                          '62558','59547','43483','19620','18010',
                          '68889','68495','28159','47735','77012',
                          '16756','28208','29917','10398','80703',
                          '20769','22276','47259','24458','42195',
                          '69890','52439','40070','74522','16043',
                          '21767','56382','12234','42841','97692',
                          '39899','73711','48620','18184','64964',
                          '64183','26767','57689','82469','54737',
                          '26579','38074','17650','80225','20276',
                          '24571','84644','96013','66613','14769',
                          '50122','21243','43906','23879','58798',
                          '12132','37756','14394','92797','82039',
                          '70497','31044','15907','64996','73976',
                          '90708','55228','78651','33653','36672',
                          '60366','89577','94579','25969','45061',
                          '12391','25484','22365','87174','55797',
                          '80294','51649','94972','56732','25545',
                          '81510','15638','89132','52658')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
