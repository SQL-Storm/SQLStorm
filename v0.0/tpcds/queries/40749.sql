
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '39765','33065','77378','85371','72686','29079',
                          '35755','37895','87083','10590','60366',
                          '48397','46670','97696','73967','21113',
                          '42047','43594','35951','36131','58226',
                          '46969','27484','14945','49146','13906',
                          '12278','28533','67052','94321','25795',
                          '90168','78383','24750','47196','27879',
                          '82327','44994','53833','91139','79624',
                          '88669','83564','33131','56869','61012',
                          '12757','32418','24386','76468','61156',
                          '56234','88732','16172','68454','59780',
                          '45189','14172','19655','17535','23622',
                          '65374','73337','33472','56456','54734',
                          '81857','72528','29770','83160','28787',
                          '65014','71407','79500','67351','94553',
                          '12635','11956','98661','66116','41764',
                          '47247','23837','84782','98945','64641',
                          '46264','24501','71578','65411','12924',
                          '69694','11520','66863','15204','69743',
                          '67025','48807','82618','29861','46684',
                          '78867','77409','97971','44483','24876',
                          '44498','93882','46584','36595','72533',
                          '66928','92820','25394','44045','19481',
                          '23359','41227','13376','11826','11703',
                          '96475','64909','58563','78298','73619',
                          '40582','52527','65589','24509','10998',
                          '51906','59451','63077','93292','26795',
                          '98865','15319','31510','76718','43972',
                          '88048','32987','71476','63099','23001',
                          '99424','72278','27221','84557','79564',
                          '32821','72171','29755','24886','11874',
                          '51973','40159','92758','17403','27059',
                          '32544','10700','98263','42982','70763',
                          '93963','55255','42228','53859','39674',
                          '24379','63269','17325','32407','34127',
                          '29540','40912','62679','23163','41968',
                          '26624','16044','26148','84024','51200',
                          '67344','93140','17671','43449','31165',
                          '85837','60931','84370','53556','49693',
                          '50094','12829','73944','49994','69585',
                          '24309','36867','66577','91755','59924',
                          '22598','53098','21120','20382','79888',
                          '17693','75636','46406','10398','18058',
                          '74437','68090','37470','76948','27055',
                          '65261','34868','74242','10928','28934',
                          '44277','36791','19855','84540','39717',
                          '27128','18220','27118','61050','78111',
                          '16336','84375','32828','77221','77070',
                          '79534','30816','61067','34412','89734',
                          '79785','48580','31231','23061','86810',
                          '18583','77666','75365','14218','90028',
                          '90983','94633','15559','33456','85222',
                          '90533','33959','36718','29325','21171',
                          '76723','88607','94376','18450','34423',
                          '82295','30317','50426','75072','27759',
                          '95839','94888','51997','33369','11565',
                          '87817','44439','56997','10308','19978',
                          '32323','12794','44651','52108','85057',
                          '57838','68295','54206','38957','11572',
                          '21914','11746','77612','90412','54929',
                          '79049','90647','12134','29842','83975',
                          '86547','27233','44196','55024','99225',
                          '37449','45734','19500','55111','63272',
                          '74161','74106','68127','75127','90721',
                          '68553','39607','35153','76222','58583',
                          '28762','31079','70101','80798','32853',
                          '36498','30618','85260','77749','20630',
                          '46487','78762','49751','88680','42402',
                          '15759','10924','83775','43862','16664',
                          '53855','47501','51387','33404','56343',
                          '20795','59207','71350','82247','12914',
                          '49650','57815','71546','50520','63074',
                          '52449','27214','92119','33204','62165',
                          '12285','68668','78544','83385','25845',
                          '19447','63762','28020','13505','84167',
                          '16302','12391','95610','56568','25654',
                          '98211','82174','75669','16754','49906',
                          '33511','12484','66777','32307','66923',
                          '70331','20412','93620','18784','10316',
                          '30369','26006','19050','91430')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
