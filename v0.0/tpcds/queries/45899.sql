
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '70080','94560','73009','45654','70804','70659',
                          '33241','48565','61202','58229','76390',
                          '86753','93864','52016','28982','25405',
                          '66800','65038','50308','75344','21093',
                          '59906','63834','43864','17511','85124',
                          '87309','31821','56520','84536','68479',
                          '52937','15985','96542','67369','35892',
                          '44061','14712','23993','73843','43682',
                          '92682','22194','29135','60588','61457',
                          '27886','74963','63281','98237','45098',
                          '43038','30827','14822','26043','36723',
                          '26207','52792','59462','84611','84226',
                          '91757','25658','19915','25837','11197',
                          '17438','95080','63884','35649','73983',
                          '58448','73331','36104','45133','33951',
                          '45943','56382','26436','55790','47201',
                          '21492','77333','10839','73406','16953',
                          '50376','89552','19806','24024','75197',
                          '24018','22054','82040','75631','69825',
                          '15655','37557','64861','50678','83091',
                          '24043','80854','73548','82548','27307',
                          '37975','96831','18471','24674','26014',
                          '51597','26822','88948','29259','62035',
                          '61852','10949','83913','99979','99581',
                          '11725','62512','38853','11576','38731',
                          '90424','13341','44706','98159','79622',
                          '74991','78710','70799','51924','10288',
                          '46228','14788','10455','56064','91165',
                          '66001','88359','70484','45119','25224',
                          '99533','49337','16553','48244','52853',
                          '64189','13161','79784','73997','15873',
                          '86042','84956','30539','99605','25309',
                          '56562','13379','68514','64182','93599',
                          '17499','85512','16572','22732','39472',
                          '70911','28067','41499','88227','84881',
                          '35888','26355','86039','67135','29038',
                          '62182','34159','89739','20697','42885',
                          '33841','59522','52957','96407','82042',
                          '76562','93424','41295','28403','84433',
                          '36691','10151','23644','67128','20483',
                          '14773','99459','91710','66009','57352',
                          '26091','18394','14920','83801','38112',
                          '57874','68691','30947','64737','78070',
                          '51637','77387','90350','48171','39628',
                          '13926','91586','36601','89071','28378',
                          '84631','77305','75611','14374','31819',
                          '78468','68676','21047','41271','36986',
                          '33323','37787','67980','30680','23594',
                          '83677','11626','53157','47468','95363',
                          '92176','31465','68462','47059','29738',
                          '14469','49309','53375','73339','42061',
                          '39058','59216','43395','72996','27172',
                          '87530','14690','16496','92030','25264',
                          '13709','35927','58991','28899','12375',
                          '96523','61913','77787','31356','27201',
                          '82308','40614','35038','19337','59227',
                          '44684','54911','42394','65820','82265',
                          '27116','23451','83367','49833','24876',
                          '75354','46401','24896','97458','44673',
                          '18504','55395','89484','58350','19554',
                          '59667','94349','47945','78294','38176',
                          '48987','91476','21316','90244','52354',
                          '57445','50567','54051','10374','91494',
                          '85262','11744','13356','29177','26242',
                          '73839','47538','81578','10267','21617',
                          '35219','97472','22266','87446','49471',
                          '13085','82139','74103','49081','51026',
                          '56486','30550','33165','15780','29925',
                          '15895','20019','28769','79167','74565',
                          '18817','63656','64176','22545','94322',
                          '76884','88314','84330','99221','60010',
                          '38246','48605','65125','22411','64240',
                          '33346','59104','81573','81555','29321',
                          '20118','32727','19797','63499','46257',
                          '56234','60191','54324','13703','62481',
                          '63677','38391','32096','65683','24056',
                          '28049','29875','40573','85488','40936',
                          '21911','59119','19009','64338','87201',
                          '79405','90893','52071','26524','67078',
                          '42545','20780','89760','35535')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
