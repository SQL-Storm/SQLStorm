
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15954','35258','45848','75371','13267','50407',
                          '23350','40020','26073','35747','18017',
                          '56800','61012','60702','75279','49045',
                          '47613','87821','30719','25301','23223',
                          '82188','58158','23199','51592','18842',
                          '95945','64876','56357','69477','11593',
                          '70454','50017','70839','51875','50646',
                          '58307','34181','81866','25639','86022',
                          '88357','14559','41102','41725','47007',
                          '70118','36777','74275','16238','59438',
                          '54162','85656','17468','72140','51037',
                          '10288','83716','82793','54491','97171',
                          '26155','12757','66001','87268','39292',
                          '57355','91389','58985','78182','13254',
                          '12540','39117','74863','27267','31489',
                          '45249','88599','97000','98840','62804',
                          '65287','11066','37877','68836','54966',
                          '70061','43430','16366','43424','36474',
                          '19264','25613','34694','76573','52742',
                          '84577','64328','62299','36501','34894',
                          '56112','78241','27851','34611','75662',
                          '95869','70558','12038','43794','49223',
                          '67531','26154','11387','88845','56956',
                          '78335','54555','11580','42396','56888',
                          '16888','44077','15984','43601','27384',
                          '41913','93676','32156','38153','45667',
                          '24669','63880','17554','90443','97655',
                          '16700','21654','51090','52603','58616',
                          '86660','28265','13030','36767','70926',
                          '14458','54849','45709','98327','74249',
                          '12220','26644','58749','71218','40669',
                          '50622','39537','94300','97297','52361',
                          '85606','15395','94850','45308','26999',
                          '27833','53064','86851','19527','26162',
                          '16345','33732','26875','40228','89399',
                          '89121','37647','47505','27804','21804',
                          '15822','31681','96117','60462','44461',
                          '71983','73617','43029','18194','42620',
                          '17196','69397','22124','21670','25006',
                          '66255','16489','15256','75995','19738',
                          '13082','27169','39002','34999','12333',
                          '31678','15447','33846','38800','66832',
                          '31504','64467','62897','44108','27731',
                          '28724','17775','24319','69691','22302',
                          '46334','81059','38889','70044','52139',
                          '37487','30844','67798','74326','15870',
                          '16857','48008','40888','19208','36007',
                          '44560','60179','33993','80517','43930',
                          '56701','90578','11639','86689','69872',
                          '46356','21070','31352','40396','89731',
                          '87653','54265','79687','78310','70150',
                          '50054','45561','42821','34929','39311',
                          '17466','33619','15203','55132','95751',
                          '50526','14965','68317','38174','81716',
                          '20246','44977','50889','24759','51564',
                          '32112','11681','73268','92052','80231',
                          '45712','99425','31549','64905','36239',
                          '99198','83552','16217','46568','70860',
                          '22162','22859','31812','22665','18752',
                          '49739','26293','56583','28107','84288',
                          '56552','20198','17109','86109','29170',
                          '11497','71774','23310','81984','82298',
                          '25682','52927','10486','84308','65538',
                          '97833','19865','16044','39893','11969',
                          '61710','63446','99657','98118','64973',
                          '29961','52493','73868','38071','82464',
                          '35324','14035','41503','16826','33766',
                          '44726','33300','82023','68264','98701',
                          '45547','22383','19301','74250','30896',
                          '30966','52625','76980','64675','66745',
                          '52571','11555','14360','58295','52627',
                          '20947','49957','26129','84585','16588',
                          '27637','93997','39258','75676','41646',
                          '51171','95053','69222','88233','79536',
                          '24088','16374','26052','46470','29544',
                          '79954','45472','95660','68051','47841',
                          '15458','22186','56136','35094','42612',
                          '80392','17367','67474','43665','51976',
                          '45524','78976','19679','47175','43739',
                          '63735','58455','23626','67964')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
