
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '73116','75663','82856','98252','51392','80616',
                          '39572','61269','97471','20658','54803',
                          '41541','51156','46425','93469','61063',
                          '94123','90437','99927','60485','17536',
                          '22901','36840','80716','34081','16744',
                          '31964','45286','13003','41709','84854',
                          '73019','42075','25780','52351','36120',
                          '66290','10141','41897','16986','86840',
                          '11054','60686','44928','68273','60507',
                          '99652','52748','41472','84349','61051',
                          '35514','87104','71492','86219','54216',
                          '13670','44819','68719','83418','52074',
                          '31186','38360','69374','65296','65258',
                          '33600','22177','98041','78013','20152',
                          '17653','22548','36273','45565','86695',
                          '77946','28496','19372','85353','22430',
                          '29512','33703','16598','19768','84364',
                          '98362','64720','18760','48664','29508',
                          '87789','73672','78571','36184','17111',
                          '14064','27498','13472','12733','21609',
                          '53965','16676','90931','20077','56835',
                          '19737','10245','99191','80245','13877',
                          '12226','99015','14450','88906','26763',
                          '11206','60455','57386','78636','13614',
                          '80575','14193','64857','24980','31163',
                          '31654','37648','81059','64010','62825',
                          '30757','76067','28685','77265','64632',
                          '12735','12246','99114','43227','93655',
                          '34140','28169','27946','14814','36234',
                          '44197','32557','77646','74515','94457',
                          '42519','25208','87625','23030','12330',
                          '31922','71285','89066','14256','62359',
                          '88580','74553','25188','26006','58866',
                          '89674','71123','29833','40874','37700',
                          '46515','13339','20877','42642','85525',
                          '65765','14708','35253','36940','81037',
                          '75519','46356','54416','37030','69653',
                          '63665','47502','87545','68095','51491',
                          '46962','24805','32486','60835','67095',
                          '38831','98461','26098','82840','87840',
                          '11252','12365','48921','74976','17592',
                          '83739','21760','90770','68714','76452',
                          '21477','11440','25920','45197','51132',
                          '47317','38350','65583','33249','42458',
                          '98715','32421','61786','82046','27441',
                          '55217','11229','10877','19203','16990',
                          '63545','52326','34366','30934','26663',
                          '21221','32281','89055','70284','78843',
                          '17984','22473','46578','12554','74405',
                          '10518','43603','12928','42756','12547',
                          '95969','10743','53126','93554','68867',
                          '82368','97732','41997','36051','28276',
                          '92519','25049','45464','52860','85098',
                          '20334','48975','69386','94006','99922',
                          '96732','14860','51784','18749','19253',
                          '15127','51325','80457','16925','91477',
                          '93839','79678','40018','73122','59761',
                          '31458','28328','76865','13418','93953',
                          '84115','50614','20921','71681','65746',
                          '55029','38972','27462','95140','44305',
                          '66905','95084','44742','24006','27832',
                          '99434','57442','29985','51954','19089',
                          '44445','12726','63830','17830','69319',
                          '61872','10453','67052','33152','89504',
                          '71938','84457','80430','28871','94661',
                          '73884','30229','51500','51173','25312',
                          '78358','24229','34742','96714','22891',
                          '45935','67200','73206','77520','73581',
                          '79444','30420','84850','99556','39979',
                          '54281','15847','15643','54508','99661',
                          '26487','26677','47823','14205','40911',
                          '89349','43984','14875','29177','16529',
                          '23033','35417','50630','32509','32314',
                          '65150','81058','64852','20538','28254',
                          '34806','76021','83831','49620','24394',
                          '33108','72329','86234','42214','26254',
                          '16667','30540','74950','33328','67376',
                          '27883','38872','98713','67120','90493',
                          '17060','15457','23123','21880','72414',
                          '30157','69025','70808','15072')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
