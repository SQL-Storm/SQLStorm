
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '37421','75495','88724','33434','15284','57862',
                          '65403','54115','70015','17638','47429',
                          '42099','87935','35917','11315','42768',
                          '65713','76585','42470','46745','92583',
                          '37829','62396','73891','20307','20998',
                          '94951','35297','38791','34134','59617',
                          '23348','59079','29398','40732','36287',
                          '58608','95796','67986','72734','15485',
                          '14058','72876','28691','15264','25141',
                          '32326','59054','38061','40363','18679',
                          '73977','34753','23133','97446','41153',
                          '17588','36572','34435','17979','75121',
                          '59674','58275','32640','25601','18034',
                          '36161','22033','16573','53640','13443',
                          '88400','30684','99931','34510','87571',
                          '75345','67951','13926','57637','23686',
                          '90484','63545','63601','46967','52949',
                          '13291','28345','41074','55154','52594',
                          '78015','70605','24644','60974','60174',
                          '18178','57079','29687','79327','24499',
                          '83541','79871','30412','12586','65800',
                          '13103','32540','94940','40333','52062',
                          '34538','24065','16440','89539','65193',
                          '21521','22184','57744','71961','50958',
                          '41713','46331','62224','83607','70469',
                          '74958','19773','54177','85004','41970',
                          '11102','39820','91376','48193','20426',
                          '53127','31963','35421','12285','68099',
                          '92237','68175','19770','30551','12869',
                          '94362','44654','25787','21363','52812',
                          '71654','89841','62342','67204','16708',
                          '44558','37481','24804','94802','49801',
                          '32060','41143','41833','57479','96751',
                          '84864','69098','75860','59835','58932',
                          '46293','91004','76830','80664','74733',
                          '22436','68514','74268','17201','42232',
                          '30087','81148','67730','44700','45215',
                          '14580','52997','46359','23722','36445',
                          '33331','18838','70965','66010','50685',
                          '86238','33952','69216','25768','25150',
                          '23368','26305','29602','56702','30922',
                          '46007','25239','29903','26055','84305',
                          '13450','33449','23035','47246','26923',
                          '21484','42302','67132','15039','48343',
                          '15474','24992','70078','61564','10364',
                          '47980','30055','86685','25025','69437',
                          '43192','40114','91953','53627','81711',
                          '25015','22228','93487','85735','25510',
                          '70056','15525','58742','56247','51804',
                          '24593','28013','43126','81520','81488',
                          '35129','52523','19497','16083','48309',
                          '99897','64448','10286','30861','56844',
                          '95129','39098','97471','20263','41196',
                          '46681','16313','23231','44395','41498',
                          '41077','63469','90969','56622','11196',
                          '72976','48346','69505','92446','26090',
                          '26916','30658','27761','86506','96815',
                          '57274','41118','62582','24378','41656',
                          '89276','64487','48171','44221','76948',
                          '97328','18511','71437','86135','25441',
                          '47645','14962','49021','62434','65234',
                          '13736','13655','17368','27831','55539',
                          '44379','21183','66065','15397','93397',
                          '35099','24087','72777','23919','40674',
                          '57889','32095','88484','85539','17074',
                          '51277','89359','73278','81682','22949',
                          '21236','70659','35971','89091','29196',
                          '23800','13759','11860','79410','27847',
                          '21560','48582','27401','96469','66246',
                          '24642','48879','62077','63177','11178',
                          '13803','94662','32652','54151','10816',
                          '45200','86480','46085','20774','46824',
                          '70798','79378','50804','16135','98386',
                          '13230','62422','91317','25974','61031',
                          '46170','22577','47878','83375','77392',
                          '45419','92785','39887','92725','18563',
                          '85851','65512','38198','27515','70956',
                          '58591','63643','34932','19464','55106',
                          '39690','19750','35587','96134','50898',
                          '33656','68498','58845','19771')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
