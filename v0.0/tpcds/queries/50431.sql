
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '25425','31358','42615','82302','10510','47369',
                          '17171','74609','11835','58472','80559',
                          '82431','66360','59119','19100','44301',
                          '82143','88947','82149','21307','89880',
                          '29092','76603','80402','54684','40436',
                          '22171','49837','63407','72586','30572',
                          '69497','36218','93052','23876','60362',
                          '83506','36410','90275','46748','89362',
                          '39813','48160','38690','88357','78089',
                          '67205','47142','14771','67322','11958',
                          '99441','52743','31688','70801','60164',
                          '95580','19874','50525','18214','97305',
                          '47778','43593','37695','12873','46942',
                          '75139','94456','85731','90527','31594',
                          '42206','14349','23538','95339','30832',
                          '39241','17337','41090','57316','72950',
                          '95905','74175','27155','32680','43307',
                          '13215','12534','31507','20887','57784',
                          '84719','77031','10398','96915','88213',
                          '25615','20457','83269','20980','26939',
                          '89376','28253','24598','16034','73681',
                          '22935','54437','21732','84173','33504',
                          '80100','73939','10464','55939','63954',
                          '54012','57254','34145','15115','80476',
                          '96392','13963','75340','45501','28797',
                          '78720','37810','99265','29771','61018',
                          '65658','41061','86650','90314','28281',
                          '53467','71850','39469','41607','94144',
                          '35625','20680','36888','41183','80005',
                          '84447','26755','86981','95029','68361',
                          '61778','25790','21273','34232','13632',
                          '43056','25857','67782','94184','21700',
                          '28588','92300','79692','82736','18182',
                          '83067','20814','10034','78667','76562',
                          '34089','53680','70474','99842','10216',
                          '60548','62637','58267','22790','24674',
                          '52879','50221','99628','16670','41003',
                          '43449','61120','24620','59584','38448',
                          '86400','24881','32819','34944','62192',
                          '99734','57153','52085','61943','40638',
                          '64767','28925','40135','27529','33318',
                          '10523','63970','17231','53420','16425',
                          '14659','36732','44248','35854','24512',
                          '75034','62675','13620','62786','25393',
                          '29508','13451','98181','77640','14717',
                          '37389','77929','33340','21552','39822',
                          '39508','39222','85637','11778','32649',
                          '63569','73468','43070','36547','45691',
                          '20460','75260','70018','10508','62960',
                          '30320','52817','32609','39851','55339',
                          '42896','11302','29816','50428','77874',
                          '77922','46038','95996','95475','41830',
                          '14405','44523','62386','49777','87899',
                          '18234','64926','78542','56066','26768',
                          '94493','92295','15589','11470','94192',
                          '34045','40177','60678','32462','48614',
                          '30637','53742','26294','11250','69183',
                          '12875','33509','69914','36692','66745',
                          '18127','58706','81678','46914','16380',
                          '16278','89695','27977','64834','21982',
                          '55576','77969','26240','50903','77616',
                          '31053','78684','28060','62507','73154',
                          '82844','89908','15843','27368','95417',
                          '98038','66420','47503','86778','43692',
                          '82982','57293','15458','54157','44989',
                          '73930','69978','72041','49583','22716',
                          '11237','32744','46567','54912','43331',
                          '11586','23385','63628','13962','96579',
                          '43338','97445','82259','53922','34284',
                          '14605','51110','60383','18204','21515',
                          '18302','67171','30814','36047','63892',
                          '47789','42770','94693','59756','56301',
                          '11335','14504','12109','70283','59204',
                          '85834','34980','23862','18106','19835',
                          '79215','47209','34069','96663','17018',
                          '32309','76584','84396','35952','13826',
                          '88958','50210','85013','95181','34603',
                          '97151','30448','18273','13487','91408',
                          '69355','48314','24622','66794','21943',
                          '35514','44627','21845','48818')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
