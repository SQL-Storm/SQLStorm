
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '66212','78919','87664','42087','60074','32048',
                          '30316','23992','16731','89035','53151',
                          '93849','45416','14584','76699','61642',
                          '41976','24761','89469','92009','90757',
                          '42851','41732','40885','67572','67944',
                          '41712','93876','47528','44110','37471',
                          '88955','19066','45950','15701','87023',
                          '26684','45730','46124','54661','97483',
                          '63608','66222','61933','55567','58987',
                          '98560','91959','58409','84591','29235',
                          '68313','29876','69158','96388','72367',
                          '61543','47446','39265','58003','44610',
                          '31237','54659','38547','53266','71958',
                          '46143','13450','27610','18839','22619',
                          '48559','27859','28866','54783','15589',
                          '88954','76484','27581','96403','44289',
                          '20086','32636','24936','11795','27130',
                          '37795','11664','63160','52220','93809',
                          '26756','44664','13259','61276','78742',
                          '11300','25373','36126','15212','31367',
                          '37259','24141','69675','84084','79843',
                          '30190','10955','28411','47993','42919',
                          '68261','14891','48492','65640','77169',
                          '43899','24335','36560','28420','45029',
                          '80191','88702','14502','15397','83550',
                          '27873','78921','86067','89627','49442',
                          '68606','55241','30380','66093','21067',
                          '67784','88228','58159','10685','59189',
                          '88754','49929','51004','72989','13865',
                          '22043','27593','35950','91252','11046',
                          '26605','74746','82813','40520','86915',
                          '15495','90685','10305','29908','56296',
                          '39331','30510','33342','48653','89653',
                          '21929','13296','60323','73027','28733',
                          '85829','69975','44535','38600','26758',
                          '42606','28548','29053','47416','35480',
                          '95538','18470','14153','43910','38735',
                          '65623','86874','16028','13020','29984',
                          '90556','59185','52891','77938','44327',
                          '26954','32102','24789','59746','51427',
                          '67117','43021','42923','49550','78051',
                          '22238','93518','42016','12122','12662',
                          '14100','17589','64840','98190','61024',
                          '34920','40566','73350','37307','10558',
                          '55867','56973','96582','14688','79796',
                          '24525','58954','37107','88299','54782',
                          '35582','67242','51949','52619','30700',
                          '14653','61190','27000','49110','29734',
                          '20977','78601','38851','58024','72407',
                          '60633','73194','46140','18807','53417',
                          '74729','12060','97569','34888','51955',
                          '60094','48502','70115','92386','37673',
                          '21506','20167','55873','62227','51226',
                          '80989','78398','78798','43537','64983',
                          '79660','27831','69466','11835','81487',
                          '25439','28622','38418','11426','14557',
                          '28935','85049','54864','54113','23690',
                          '59939','61210','81434','85636','33693',
                          '12426','69962','82260','84330','44287',
                          '47374','25409','22504','97825','70740',
                          '46228','49271','12005','84555','16006',
                          '32448','72774','56422','14360','21847',
                          '11439','43856','72786','79299','75747',
                          '38962','23775','51122','67002','35545',
                          '11975','88567','54737','18304','27172',
                          '13238','34084','18711','24829','66717',
                          '96238','36147','28186','59400','57686',
                          '68262','12132','87980','77150','14016',
                          '46915','21615','73600','65406','30550',
                          '66744','43119','93011','47412','16637',
                          '12794','93111','13620','29075','48097',
                          '92605','65258','32470','55183','60954',
                          '52952','42158','23878','71037','17435',
                          '17956','97984','17627','27241','40909',
                          '47733','44991','53121','88722','40449',
                          '28449','97758','25916','38511','70278',
                          '72370','21862','77681','51277','14913',
                          '69219','34096','16193','28414','36897',
                          '13118','65123','54725','54568','80515',
                          '37294','79140','91100','53831')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
