
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '16583','97042','49391','54395','61982','47719',
                          '32429','78179','90958','19043','14266',
                          '44808','30122','34829','29378','32174',
                          '88768','13152','70242','10218','19295',
                          '59148','17781','50190','17880','61008',
                          '26385','16494','89542','68100','31627',
                          '99518','82812','79415','99407','26961',
                          '59965','41986','86263','79714','54203',
                          '92572','40804','56654','13646','28144',
                          '26336','63060','73587','10177','85587',
                          '69844','48545','77108','33483','76115',
                          '27250','72439','20957','52278','41053',
                          '19704','62109','60873','54666','12650',
                          '14757','35704','80610','57135','58656',
                          '12002','91794','45716','45358','34110',
                          '38270','58831','61257','22020','79661',
                          '15102','89886','51793','19739','63775',
                          '89516','60510','94687','54143','81049',
                          '55154','25270','43135','58686','96260',
                          '48614','19858','47895','23807','36927',
                          '15858','10163','33664','45684','27216',
                          '14799','56242','25009','62666','78070',
                          '12850','21918','20537','72717','24882',
                          '94623','10085','97087','83302','35559',
                          '78599','93306','33062','30846','96316',
                          '29834','27089','35542','43019','49896',
                          '23763','46453','70679','90281','61344',
                          '54402','32134','88093','17225','84646',
                          '37536','34101','23506','24477','21592',
                          '92793','60401','50602','64986','83867',
                          '83700','42986','16831','38795','85116',
                          '49276','18806','93518','19417','72120',
                          '54092','32009','29866','81238','31315',
                          '43837','98942','89982','35025','51656',
                          '53155','93907','43297','60650','20403',
                          '84909','14171','52876','59509','33080',
                          '97198','50387','49475','92661','18345',
                          '50742','82503','93659','89875','26435',
                          '60043','19330','95857','39129','61001',
                          '13399','64032','99109','67846','19773',
                          '55553','91518','13606','85335','45392',
                          '24030','31920','14840','29709','23067',
                          '43628','40747','31178','59768','71568',
                          '38507','48447','63963','10510','12462',
                          '81521','49468','25134','39804','53261',
                          '88299','60290','15368','47302','39480',
                          '74101','82765','49236','28842','57696',
                          '94560','83167','30009','97867','30707',
                          '87108','32179','85216','69800','41931',
                          '98876','64743','83594','14798','66327',
                          '77595','91740','28822','97766','58466',
                          '59008','71368','40434','58178','69741',
                          '15463','17034','62161','40904','55756',
                          '64899','41349','68507','19920','47528',
                          '92818','98398','67229','50588','27024',
                          '63638','93383','51154','19560','96303',
                          '52112','87100','27675','29334','85581',
                          '35999','40691','16217','65538','15677',
                          '13120','78996','46983','24945','33976',
                          '43936','76794','34807','44105','34528',
                          '77219','89528','55806','28651','20616',
                          '88826','35983','84037','26449','15075',
                          '52716','63180','59442','23209','43635',
                          '22910','24949','43367','64351','15182',
                          '35456','56404','58765','12952','42155',
                          '71427','43222','53738','18015','63630',
                          '76241','24385','39096','38380','43522',
                          '54885','42601','14933','44560','77119',
                          '78007','67065','59439','74971','43295',
                          '12065','77270','22065','29897','28298',
                          '86596','78009','62053','42187','59046',
                          '98122','37285','92331','24762','49606',
                          '56086','20304','61489','24003','21350',
                          '66769','31753','14917','28134','43940',
                          '97052','12614','49131','66940','82030',
                          '58692','83539','13732','47184','64631',
                          '29066','40880','97166','61638','16474',
                          '56623','42091','89494','76646','18979',
                          '48856','36535','23275','58892','23925',
                          '12945','80032','39128','25374')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
