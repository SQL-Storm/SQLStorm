
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '60795','24725','37585','11246','25004','94393',
                          '10844','21908','78782','74304','47601',
                          '15851','29817','42746','80903','13483',
                          '74007','99009','64281','97899','35171',
                          '91773','10194','54785','29148','26084',
                          '59854','80420','95764','79577','10090',
                          '47130','85084','16809','94923','44980',
                          '53857','38845','75898','27555','43780',
                          '54151','92517','23814','16901','40491',
                          '41031','86725','37351','96635','89125',
                          '79533','59705','51750','20111','29684',
                          '61860','56862','20495','59770','22830',
                          '39906','53309','72173','44992','36727',
                          '92147','20695','14176','25202','35433',
                          '17014','98187','85922','95520','40466',
                          '46583','61254','22426','59116','14570',
                          '56263','87327','20436','90798','39820',
                          '88583','29032','64156','48210','47495',
                          '46586','34035','53163','53929','82828',
                          '30884','13151','43048','19018','45380',
                          '73894','51149','38398','63159','53256',
                          '84697','36567','18334','28854','91581',
                          '52263','69855','94529','37079','90585',
                          '39898','32323','34020','24514','69081',
                          '57618','51957','80733','81332','52944',
                          '90957','15146','50033','89940','29807',
                          '79862','98363','46907','50740','22153',
                          '43338','19749','43709','19788','15355',
                          '78366','73375','46279','90591','65005',
                          '37900','53686','11178','93306','80719',
                          '99864','16920','46943','46369','48547',
                          '56447','71434','63239','11287','70011',
                          '39532','21172','79292','94330','74758',
                          '45721','27704','86666','65329','52541',
                          '57513','54395','32102','44307','51805',
                          '67470','96794','74851','86696','54623',
                          '72629','34500','31234','56918','44514',
                          '12589','59722','70975','57893','50421',
                          '13574','89431','87490','76744','87630',
                          '20454','35172','10475','92816','67123',
                          '15039','29650','97321','43209','48639',
                          '96798','29495','57105','80182','39678',
                          '46241','73915','22952','21959','15140',
                          '91874','43685','20553','49642','34398',
                          '84150','80382','77661','96241','52550',
                          '26037','55537','65586','25498','98260',
                          '74452','34163','94514','74523','89637',
                          '46345','26333','57568','31187','50984',
                          '59110','74582','40515','52234','74222',
                          '64570','96901','51996','22222','63872',
                          '37752','45973','17664','25417','43960',
                          '63919','45491','83818','42679','67653',
                          '59780','81812','61913','18350','14036',
                          '24357','16687','25708','22986','51413',
                          '68511','25582','71809','29333','47489',
                          '79666','51241','43058','98887','72266',
                          '56618','70216','25769','86902','83395',
                          '18897','37887','65784','46747','35667',
                          '27018','67562','32615','82551','84022',
                          '46944','47623','60894','49131','11076',
                          '64340','76879','16806','61979','79835',
                          '63863','31981','30780','99848','66998',
                          '68502','53607','81827','18488','92597',
                          '64392','27680','16644','76295','27263',
                          '42101','60049','40223','40188','73334',
                          '52273','45012','75456','54616','89369',
                          '30275','94623','34441','16711','93675',
                          '14640','96582','53091','83676','98588',
                          '37302','18486','29442','77317','90635',
                          '17505','45559','95709','47750','74318',
                          '64819','57313','53208','50011','64569',
                          '17616','23723','32849','52837','12362',
                          '56394','25055','48105','13937','65906',
                          '30378','88567','69721','99446','37322',
                          '63086','17706','78629','77812','20679',
                          '23954','26552','92157','28058','41897',
                          '23580','68080','30659','36838','28270',
                          '49428','42812','53319','87779','27589',
                          '91081','72843','19314','29925','67638',
                          '31100','18676','41564','16302')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
