
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '63677','46384','53196','14977','77557','29502',
                          '53236','47338','20648','96620','92484',
                          '59222','10115','67559','34884','75538',
                          '71346','18833','69900','91493','72152',
                          '11470','22136','42713','61265','11096',
                          '18251','69373','29516','74160','71551',
                          '83478','47810','68646','79937','83881',
                          '17331','26160','59964','30343','33629',
                          '23780','47593','96358','64913','16569',
                          '67430','75880','96472','48299','47881',
                          '79919','20498','33977','18002','16004',
                          '10465','53847','10060','27524','10937',
                          '11147','67342','40575','60968','79603',
                          '48482','75327','55032','17887','28385',
                          '75851','84656','36701','51701','15959',
                          '79430','35917','77151','65289','74859',
                          '63185','89314','66394','11289','23826',
                          '28713','85024','30623','35882','83827',
                          '66514','39866','58824','75735','57689',
                          '23656','32494','76027','58415','29981',
                          '41595','94665','43428','25664','51807',
                          '33011','20819','10883','96554','30151',
                          '85538','79212','38835','11328','16245',
                          '49307','23721','67576','52894','64554',
                          '95890','37931','52106','54297','26967',
                          '86966','80966','38121','30095','79665',
                          '72908','51629','38644','15677','45870',
                          '25201','39100','15639','69377','15838',
                          '48811','23256','97692','80356','33988',
                          '91006','83798','94417','72070','12029',
                          '76953','60423','37493','49556','70773',
                          '24689','57406','78587','52401','52566',
                          '89964','74167','20678','19737','13108',
                          '35903','55473','58155','29817','56926',
                          '38605','28881','77235','15362','14238',
                          '68480','37307','69339','32043','34059',
                          '89950','79738','68470','58375','87979',
                          '33534','31241','86680','81364','18934',
                          '23327','49538','34035','33116','96083',
                          '15382','44339','37499','57004','25869',
                          '28680','92086','74270','40074','57198',
                          '41972','96843','73330','30851','29879',
                          '32388','11275','86579','62900','62235',
                          '86217','76056','65912','40096','91596',
                          '60047','36851','43708','74653','27274',
                          '74125','92744','62105','10814','86837',
                          '10175','30188','34927','31872','62224',
                          '31013','95644','74024','64130','23608',
                          '38766','93566','21639','22407','91975',
                          '69494','83470','64993','88235','43273',
                          '40482','71082','78823','62046','24107',
                          '24247','84985','12058','86757','23303',
                          '84244','16547','13318','90696','10134',
                          '48763','99163','45948','97021','71196',
                          '57841','28846','71998','87083','67529',
                          '41636','44878','11351','52139','62853',
                          '10821','21883','91119','16341','70241',
                          '26030','24016','36814','66132','31509',
                          '37534','68944','51526','27200','86520',
                          '92344','71559','87300','16786','76082',
                          '84101','32747','79104','61326','61321',
                          '57976','74776','71698','16426','19785',
                          '37412','60830','89773','32059','72404',
                          '38070','51915','44623','15241','10927',
                          '92451','29179','14441','55376','86010',
                          '29958','32973','38565','70277','54482',
                          '65031','85545','76481','44995','30522',
                          '37482','88786','58409','90959','96279',
                          '94111','99279','56967','31473','22777',
                          '30204','29512','30954','27013','80679',
                          '81397','20541','86950','83081','91003',
                          '88308','27847','54076','31754','34812',
                          '13464','83427','40720','12625','19550',
                          '95032','36622','63927','36747','27905',
                          '30426','59968','35076','54477','56308',
                          '66046','14650','12612','78661','81040',
                          '73183','29915','66462','92199','21008',
                          '41170','12479','30232','93731','27856',
                          '33473','38330','76615','34328','99348',
                          '46113','25704','28898','49780')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
