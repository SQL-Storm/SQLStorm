
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '37091','33389','63561','44624','13471','18666',
                          '23796','91375','19541','59918','32125',
                          '73798','73894','15867','44281','23284',
                          '27724','25787','18107','64209','80979',
                          '43547','53822','89963','25771','81383',
                          '12276','48914','35016','33483','31132',
                          '50809','50087','15404','41042','89113',
                          '73621','80832','11509','92352','18973',
                          '51795','15946','17863','71576','42070',
                          '98883','61027','12314','12577','16849',
                          '31311','42607','78074','21788','36837',
                          '75209','23346','57110','71648','37013',
                          '61414','48230','32181','34611','69180',
                          '71722','79304','19108','32314','76032',
                          '71943','38657','40032','71479','62963',
                          '96996','26845','42713','75105','37076',
                          '71268','90137','60426','46873','67775',
                          '98782','76394','96964','91890','37463',
                          '65773','14318','14828','21453','57862',
                          '40169','91273','75696','88408','56322',
                          '30471','95101','80086','69605','83423',
                          '69488','23305','28113','50211','29344',
                          '26634','68436','29355','26529','26873',
                          '54903','10549','97577','17506','15181',
                          '56321','68003','52399','20604','10112',
                          '65640','56616','77131','46760','11448',
                          '95402','27732','39283','65209','14768',
                          '74798','25673','11157','65969','58248',
                          '60175','40420','92042','37630','41321',
                          '20092','73062','84375','15802','11013',
                          '20829','93803','27455','33083','15822',
                          '94685','30341','48910','21600','87761',
                          '61822','24429','62445','51911','32301',
                          '85280','44193','84973','38573','47567',
                          '23854','68477','33121','18021','29829',
                          '68698','43793','14988','42997','19695',
                          '46124','23259','57399','46362','49537',
                          '72887','40671','33771','71832','22778',
                          '94420','71316','66435','78058','15687',
                          '35727','42116','49877','73375','64082',
                          '17342','31099','43089','91299','96111',
                          '77650','54953','14679','99130','17606',
                          '56869','95027','28019','29630','41336',
                          '52915','57120','19630','85023','60231',
                          '29972','58910','88109','94580','16775',
                          '60312','59605','46683','57011','40870',
                          '47765','47703','46993','12350','35290',
                          '89997','83168','43414','16763','13632',
                          '82037','29031','19082','35755','29998',
                          '61438','53066','93011','91332','70084',
                          '72521','56866','37529','64879','85864',
                          '17949','51708','21166','38089','41548',
                          '40148','98628','85201','12344','75937',
                          '60148','91174','26443','52266','76747',
                          '91846','76248','36069','82398','71252',
                          '18641','21207','77718','79768','13976',
                          '28979','11754','58457','85872','45812',
                          '21322','52038','85991','64175','11484',
                          '95658','35687','70640','19215','22379',
                          '28933','25767','89362','85651','77791',
                          '82279','44804','17252','65459','94101',
                          '97602','96773','60788','72421','24339',
                          '36818','62910','45856','70449','54149',
                          '69327','95799','44734','83381','78913',
                          '49941','13473','23790','82961','33532',
                          '24922','69529','88227','35773','21290',
                          '46370','29324','44700','89379','11021',
                          '75061','29162','14411','14333','44518',
                          '86158','11399','87882','75078','33303',
                          '52209','84331','92089','23683','20516',
                          '37609','21241','22112','71124','30808',
                          '80664','72691','17496','26211','27581',
                          '71560','26308','65929','73946','28466',
                          '42383','21658','86200','55040','90086',
                          '86376','21434','69604','80530','14520',
                          '99947','16846','88429','21979','37615',
                          '72604','20138','38043','29590','50727',
                          '19442','78201','18832','69374','10125',
                          '27496','34727','45891','15430','69998',
                          '62695','83130','14724','80551')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
