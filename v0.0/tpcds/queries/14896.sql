
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12421','17583','19047','19066','67649','18877',
                          '33753','30346','37023','41475','34442',
                          '53151','70748','58267','70828','57145',
                          '11037','37779','50759','67311','30398',
                          '44572','85876','34715','15205','81239',
                          '33479','16862','12385','45886','39867',
                          '84322','22621','69270','24659','30172',
                          '84006','28905','12417','71483','41755',
                          '64627','66745','49912','30672','54901',
                          '99105','67161','25295','72346','70933',
                          '46469','75201','67026','53562','75595',
                          '29410','58332','91551','19534','21215',
                          '11514','28196','29408','30183','54253',
                          '67124','58294','48877','88972','58225',
                          '13728','86981','42832','63647','56075',
                          '27878','47459','91267','24078','81668',
                          '17917','10355','89284','36856','94828',
                          '42429','85059','96707','93312','93663',
                          '17904','45909','59934','67604','81706',
                          '20832','38614','85767','46829','89455',
                          '38840','10805','47405','82324','69744',
                          '59401','15415','55268','47199','43053',
                          '32818','88560','51258','55870','83077',
                          '70081','56978','16083','80689','62673',
                          '68398','50034','26631','56338','30970',
                          '67784','30779','13236','13007','89248',
                          '18527','31682','40678','59093','49958',
                          '56144','53609','55246','26806','48496',
                          '60913','76529','20555','53456','56031',
                          '11175','99759','49884','68649','39622',
                          '60272','49362','31898','58545','94890',
                          '66032','32981','60528','13803','84796',
                          '45019','69363','51995','83072','43978',
                          '64641','57671','46394','69054','52063',
                          '86439','82126','31099','19726','10712',
                          '79822','94421','70926','56237','53428',
                          '32316','46504','70432','55580','37408',
                          '65042','31321','36345','19318','56671',
                          '42653','91881','26509','35043','40127',
                          '18563','83123','38144','81481','23917',
                          '23101','67203','65081','35722','49892',
                          '86916','75979','23256','45157','17532',
                          '38543','45496','22845','26903','75718',
                          '22509','51680','83342','58477','41723',
                          '53050','28664','34835','22006','56065',
                          '92056','37141','18127','26543','48144',
                          '53758','19895','31227','11137','18416',
                          '81637','72790','49010','14826','50429',
                          '44357','10997','56425','76597','82112',
                          '64687','18641','18977','27013','90892',
                          '14722','97532','32903','94260','77605',
                          '16935','22525','82242','95550','99139',
                          '19852','70273','22283','28909','32738',
                          '96524','52077','69706','10849','95887',
                          '44541','33911','25613','48880','34578',
                          '38579','36963','11510','25094','99062',
                          '44494','15055','30233','35667','86512',
                          '32293','36851','89851','53698','62382',
                          '49682','55207','69112','58259','72838',
                          '52085','48368','38696','46396','92115',
                          '32638','54614','54313','14398','95047',
                          '59416','12493','26092','24223','25714',
                          '52835','19206','48423','17708','45475',
                          '73641','91444','13854','32012','28171',
                          '73458','29938','36563','32141','53888',
                          '34198','68316','21108','56651','11421',
                          '74015','18927','76139','90682','50810',
                          '32332','16306','60140','48607','43681',
                          '26365','99938','18321','98663','34992',
                          '59180','22494','20950','66136','73752',
                          '65432','87321','61268','33413','17552',
                          '66356','21144','68794','71407','47918',
                          '91846','10339','36251','13864','24332',
                          '27243','64754','56906','18966','31819',
                          '46606','49254','31551','28487','37037',
                          '72164','32967','28917','98905','78692',
                          '21266','71970','30317','36348','55259',
                          '63633','94169','96792','40342','21725',
                          '44148','10485','91278','26094','98777',
                          '40229','40236','21211','13790')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
