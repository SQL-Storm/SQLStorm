
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '25967','46784','17531','11441','95694','91110',
                          '60515','55625','41192','97847','23657',
                          '55389','85724','68518','49550','81574',
                          '35861','61672','32929','77299','64671',
                          '97709','66934','51845','73533','55418',
                          '25891','40450','57506','26466','46486',
                          '43562','22433','38830','70180','66621',
                          '82205','67123','54407','42329','40434',
                          '72213','85569','94399','19043','49087',
                          '85697','52841','49997','18495','25252',
                          '26091','32324','99518','14467','11001',
                          '27845','28226','58205','45316','65695',
                          '14564','51576','41742','52392','89479',
                          '91451','18455','60729','71605','25829',
                          '56802','86535','19321','36143','17346',
                          '31053','64325','14158','54795','94323',
                          '68548','74778','26782','24148','13428',
                          '33115','63523','16005','17405','92771',
                          '51144','20175','33190','37436','67847',
                          '11253','25976','76302','54037','52425',
                          '46314','28357','90379','66072','25240',
                          '88848','11439','24983','51633','80489',
                          '49218','99924','82162','93674','82097',
                          '72824','94062','55483','52623','24655',
                          '79353','59226','33188','54125','24001',
                          '23902','54719','38648','63674','72120',
                          '42818','69485','77686','26521','30815',
                          '92217','41121','13328','34434','26806',
                          '79901','14512','10926','78540','18716',
                          '92422','83562','21561','34593','91428',
                          '64660','76317','66738','21439','23672',
                          '28931','77486','86029','76903','11766',
                          '36298','33329','14904','84190','11834',
                          '11168','83761','21492','85568','10389',
                          '32240','41617','14498','81372','86625',
                          '95734','52960','56302','24223','84773',
                          '34545','97474','50729','17444','80904',
                          '43348','99642','16777','90657','68307',
                          '50803','40631','28776','18396','14685',
                          '53061','74115','79617','99801','51392',
                          '20818','42921','24328','28562','49619',
                          '97104','64580','28421','49971','67635',
                          '18837','34241','46526','39326','66547',
                          '79756','11007','54036','11416','58298',
                          '28456','55139','20337','63655','16105',
                          '17847','84590','68968','84240','38354',
                          '68169','59518','17926','12334','18568',
                          '42268','42761','90122','22022','85542',
                          '72829','82417','88068','25068','71229',
                          '84418','55493','45897','88296','46216',
                          '88810','38833','10451','29751','66806',
                          '22611','34421','85515','28248','34905',
                          '56255','76639','42953','48102','25848',
                          '50026','41270','32575','78677','22389',
                          '70214','11598','11850','83437','64946',
                          '46184','81464','40947','70508','58395',
                          '30898','13727','11977','85851','92153',
                          '33575','84518','76384','16407','67539',
                          '36906','27933','57778','73572','81967',
                          '51892','57869','41659','16409','64118',
                          '71768','30368','19254','80407','28105',
                          '47037','18253','35106','25662','29381',
                          '61487','84716','32514','27582','16135',
                          '38663','95988','45840','69065','53032',
                          '19343','42864','32876','90239','57124',
                          '31575','37106','34030','39929','58536',
                          '67597','27852','17860','74936','30142',
                          '86208','58544','15139','61590','31474',
                          '40268','94824','69431','52839','18151',
                          '15564','67182','62727','32132','31081',
                          '97275','77032','39931','62902','22348',
                          '21284','67696','55673','48491','40583',
                          '38169','36197','48977','71400','79685',
                          '50929','22612','42027','51722','99154',
                          '63789','21403','33133','25075','38808',
                          '23229','58376','57776','99392','16641',
                          '91565','39404','89955','34300','32617',
                          '42852','52011','64350','73296','84503',
                          '65086','13524','54568','60344','57625',
                          '31271','22630','74901','69236')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
