
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '64032','16649','89520','43655','76497','90076',
                          '55562','10232','23261','31565','45487',
                          '84411','69978','82463','28558','11847',
                          '20078','91861','66124','13911','65479',
                          '67978','99650','68134','99666','62037',
                          '27056','42842','29562','31747','29912',
                          '99050','95599','79809','77217','50990',
                          '42097','56241','50475','67646','26028',
                          '45862','41547','43757','23830','83240',
                          '12023','26252','14333','80076','93280',
                          '30482','51507','74373','31764','57904',
                          '31076','83303','19738','68655','84044',
                          '24391','85319','27208','17971','91924',
                          '68033','16455','26738','31914','94406',
                          '20929','27561','19060','71819','79637',
                          '46870','60176','51482','25450','10248',
                          '14152','38197','45578','77931','17052',
                          '53079','49157','53018','24382','44281',
                          '14180','22550','16519','16491','48281',
                          '60065','49397','65067','13872','96088',
                          '37081','58806','60718','34767','75016',
                          '22257','34100','53992','20100','41826',
                          '88665','11824','22513','42664','61280',
                          '38305','94630','81828','39767','69652',
                          '25070','10927','48051','39660','52369',
                          '32140','74408','81471','44768','14934',
                          '70664','30815','29760','59142','25347',
                          '16280','38526','25543','44565','70782',
                          '30944','24781','51075','12158','10664',
                          '37393','87640','70710','63997','79899',
                          '11273','42705','95312','27575','74927',
                          '16124','69237','31531','82729','77848',
                          '58253','45080','98991','17538','64523',
                          '73431','19756','14485','33490','88969',
                          '56957','49775','59162','56449','46876',
                          '21729','66165','84000','22511','87967',
                          '99718','33770','33541','65909','14303',
                          '36583','47140','20549','39510','16299',
                          '10606','67741','54843','45034','99415',
                          '23497','40330','76517','26923','57259',
                          '11398','51965','92110','75519','29770',
                          '39519','42379','41719','41786','36647',
                          '44238','39904','16951','91373','22223',
                          '17706','17846','64858','34211','34809',
                          '39090','88460','31751','75835','34915',
                          '45970','62765','44573','88338','70386',
                          '63795','36846','12066','76073','37586',
                          '61991','93432','40778','44460','18505',
                          '12098','97003','28700','30104','90119',
                          '71377','13588','12070','76503','95124',
                          '59748','40820','16799','24564','89868',
                          '46323','42114','48934','68658','27367',
                          '16271','23842','41613','80546','13846',
                          '24884','55032','29332','34496','96116',
                          '86120','34850','56374','58514','40046',
                          '61070','48992','10688','14794','98501',
                          '88898','51449','91188','76358','75704',
                          '80014','13896','17333','29896','38945',
                          '96453','32510','92335','22220','51343',
                          '58600','66071','37629','19293','67981',
                          '26235','65071','52983','66373','17802',
                          '87938','75030','13126','52024','28107',
                          '84288','27560','43140','17792','26087',
                          '66587','31793','92416','32660','87904',
                          '81045','48544','58667','12093','27988',
                          '32654','33712','98764','76541','64794',
                          '59212','96763','60815','63510','22897',
                          '13653','13274','12669','88026','59382',
                          '15335','55051','96805','51101','34620',
                          '80773','34461','90982','50803','22713',
                          '44046','16711','45777','68914','76001',
                          '41392','30992','75195','50364','11531',
                          '48202','29669','19614','63482','15916',
                          '44348','43163','28475','49059','71285',
                          '73434','13436','44358','85461','65527',
                          '71837','72646','14033','29138','63440',
                          '53480','91149','16273','84961','10625',
                          '63826','35356','10375','69669','39950',
                          '40391','13394','51150','27666','36136',
                          '79277','24935','73693','38937')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
