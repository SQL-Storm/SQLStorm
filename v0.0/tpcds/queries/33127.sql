
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '60773','83723','70186','32594','59572','19123',
                          '22179','62383','21171','56192','29819',
                          '12976','45176','12528','65374','60978',
                          '73832','23353','39195','86574','28132',
                          '93863','48078','74328','66954','44265',
                          '62945','90881','43517','23979','17512',
                          '87337','31419','89521','17455','57029',
                          '65111','49518','86309','98223','14369',
                          '17137','18037','68520','23901','81008',
                          '15172','14170','91186','35461','90487',
                          '52002','18407','50360','47644','59895',
                          '82605','52496','42863','85834','40856',
                          '40301','23232','20899','97608','11332',
                          '99447','85548','33126','63317','54352',
                          '25497','66231','46904','51771','88632',
                          '82502','33676','17858','81329','34163',
                          '58987','30922','66346','50276','24597',
                          '53275','21385','31562','80162','23721',
                          '80566','60856','87516','68205','62547',
                          '67151','69800','31195','59554','63850',
                          '11382','29635','48845','44756','31188',
                          '94766','76988','13197','63385','69083',
                          '69119','37441','66614','70202','51718',
                          '85988','58599','61141','13385','18425',
                          '74305','21982','17277','32153','98489',
                          '43623','14925','33230','80959','50569',
                          '96856','65919','15483','21398','20952',
                          '99436','29701','18637','57587','13740',
                          '42229','28896','31523','11975','54948',
                          '48369','38056','87966','47075','77613',
                          '13562','75916','27331','28076','37017',
                          '35669','35367','88803','40486','63743',
                          '51129','67939','47211','10057','33009',
                          '18910','84317','24696','82926','56198',
                          '14552','11951','67590','42841','33640',
                          '39616','19303','87920','47662','40989',
                          '25357','11696','16391','37074','22665',
                          '97043','41604','80596','22438','72518',
                          '82271','27422','42891','38205','77201',
                          '99281','20285','92594','26344','80375',
                          '23137','12538','75363','16950','54030',
                          '25978','79788','14392','45653','33555',
                          '25792','71119','19910','31262','17263',
                          '68592','52271','55867','47411','98363',
                          '50297','92890','37847','30761','45408',
                          '14228','73910','25386','96734','20038',
                          '43398','95320','41756','24226','75774',
                          '55959','79504','95443','38306','13134',
                          '85134','45494','60876','17216','29823',
                          '90866','17488','15705','11908','69082',
                          '27732','43494','69308','62569','87303',
                          '59612','34517','81638','21578','39415',
                          '44939','29409','22908','44891','60763',
                          '58215','16151','66133','94082','16305',
                          '56116','22733','54380','20331','61198',
                          '13882','58555','28422','60676','84414',
                          '15447','19656','12350','66650','20946',
                          '51944','29140','32767','37682','21630',
                          '11907','35768','35028','17156','57076',
                          '69629','17306','76400','11815','17528',
                          '82967','45431','62926','25109','37360',
                          '37727','26287','82391','20891','68957',
                          '40272','10222','99442','27780','80927',
                          '41848','31321','69987','56211','91588',
                          '11558','24868','49506','35871','57511',
                          '15897','75522','40439','37771','35449',
                          '50867','29696','27212','56042','61765',
                          '28135','41213','26315','30972','83443',
                          '22288','40034','55085','48656','79372',
                          '96260','72699','65833','71536','25008',
                          '56525','80167','24305','13863','65636',
                          '82878','74288','65444','95822','64088',
                          '51441','54230','40640','31526','40370',
                          '25272','14000','49085','31589','21418',
                          '36457','86717','44386','25951','22026',
                          '20894','11555','88103','53511','13191',
                          '64312','81393','94032','34996','86716',
                          '35355','12872','82853','41104','59280',
                          '31663','18589','99799','35785','53595',
                          '31365','22904','61936','56650')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
