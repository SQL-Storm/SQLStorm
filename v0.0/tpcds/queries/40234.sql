
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '52367','51575','31029','18172','58686','15921',
                          '41602','54937','38754','41929','35732',
                          '33868','33782','49647','66727','75628',
                          '22519','20544','30703','84960','24667',
                          '78783','22486','30920','18774','54330',
                          '31895','71734','80468','77083','80943',
                          '27337','87164','94558','49380','98426',
                          '62248','59990','24877','31420','21488',
                          '90149','72349','42101','26903','26523',
                          '63049','69159','67578','49095','96692',
                          '18149','14728','81245','58273','89804',
                          '14608','48481','10136','49178','92014',
                          '29679','32919','66320','43402','50797',
                          '33222','78551','64198','56445','15091',
                          '64294','59047','55569','22600','77194',
                          '16811','17058','39595','50706','46084',
                          '35138','39017','19541','99563','70834',
                          '93781','19211','66915','19415','22428',
                          '41082','35451','15506','54741','69671',
                          '15346','58932','98407','33870','14352',
                          '48336','32083','91344','21422','85273',
                          '38370','51334','79185','52816','53795',
                          '91014','28036','72964','41117','93254',
                          '15523','96537','54064','29424','14722',
                          '77950','27459','39621','38715','51580',
                          '13244','13610','16059','82387','45160',
                          '72054','66133','24620','95206','91195',
                          '92341','97142','82229','93590','30888',
                          '92081','62573','66387','84060','54748',
                          '32474','89958','16048','44125','20863',
                          '27509','77639','13173','64822','12554',
                          '90451','11834','13011','48581','94753',
                          '77897','86308','18353','29020','43707',
                          '36796','65794','41624','53931','39582',
                          '42914','40508','48692','25979','32807',
                          '37189','85741','59607','70860','20340',
                          '48341','18053','45935','69786','35892',
                          '24249','48908','19413','57743','16016',
                          '56768','44636','40889','96953','62470',
                          '11542','57770','24055','65021','94472',
                          '52069','52788','31146','18746','16422',
                          '64503','41357','82109','16612','49334',
                          '33938','41020','70808','31735','68598',
                          '58717','52273','10357','61270','36449',
                          '31221','12384','23303','18502','72719',
                          '68015','81860','95843','60639','55693',
                          '52889','29449','39548','15893','18841',
                          '31269','83290','68635','15405','22252',
                          '82402','64484','10871','20292','44615',
                          '19976','66450','58297','34724','38084',
                          '28703','40973','59426','11912','56412',
                          '64411','46217','31939','57563','27030',
                          '84052','35357','81414','53275','21044',
                          '12213','12202','49345','86647','27648',
                          '95734','10617','65487','69237','37695',
                          '53752','67896','47571','41661','47261',
                          '54273','19456','74265','88129','31561',
                          '14871','64434','82819','87161','47981',
                          '50893','50882','29577','11871','22125',
                          '42937','46996','12789','16646','47450',
                          '10819','25111','59141','24926','82867',
                          '14802','61473','67342','50795','54061',
                          '94057','80296','60058','41175','17320',
                          '19802','35569','12371','26422','53397',
                          '69295','89409','16613','28273','25738',
                          '46389','90016','79516','32275','17003',
                          '93582','94118','41714','90046','46314',
                          '84357','89271','10536','97696','18262',
                          '20135','24647','39264','66852','27607',
                          '49599','29726','32673','61350','88616',
                          '71412','49832','24787','97520','41054',
                          '47783','75065','66812','31717','27094',
                          '15321','68768','10903','50550','34511',
                          '47925','90275','32024','55531','31428',
                          '64067','63448','35645','82880','30022',
                          '67245','21100','30382','40833','12431',
                          '53590','31498','73921','13764','84760',
                          '23223','17756','17476','40062','35354',
                          '94923','12860','30222','18010','49660',
                          '30422','41263','80089','46196')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
