
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '84627','62015','11751','58670','32737','43122',
                          '28690','26972','28148','42977','53508',
                          '25414','45256','63992','57997','54476',
                          '40038','84125','21911','24021','75527',
                          '94559','73055','64838','69334','34056',
                          '62352','71795','47047','50506','47265',
                          '26632','82782','49613','65495','15096',
                          '63885','72273','46049','45092','90470',
                          '34436','46467','60442','63401','36451',
                          '13461','67072','86856','33647','51355',
                          '74057','98780','61826','20206','49353',
                          '47355','53742','16912','70984','15627',
                          '80678','42297','36353','15823','70916',
                          '54632','30295','24197','85570','30201',
                          '39561','51541','13591','47587','79405',
                          '22329','99796','38015','25441','21297',
                          '54787','71401','19371','59100','48563',
                          '86711','40232','61360','87399','29669',
                          '40350','85317','67719','11007','53927',
                          '32985','69626','78770','47507','53385',
                          '81438','86401','56814','75867','72745',
                          '30475','71268','25368','75376','96874',
                          '15037','86138','18122','70906','48149',
                          '16602','84464','19578','87292','82117',
                          '59223','41082','81633','22879','52811',
                          '96011','19785','43564','17392','13807',
                          '96534','52716','80770','46420','34386',
                          '70207','98311','52495','38791','49253',
                          '81207','18656','31621','32951','65349',
                          '76316','58249','37174','82111','33192',
                          '15335','25539','37292','78041','31352',
                          '88564','76191','77971','18082','87774',
                          '19855','96770','97639','48028','78463',
                          '14039','39474','16134','62018','70200',
                          '26055','35398','56763','65881','88610',
                          '25104','96312','27558','66922','40891',
                          '64849','79694','18666','24845','93800',
                          '59027','61011','10050','63492','27931',
                          '58433','88947','63372','72210','41085',
                          '44784','58803','25527','38409','27039',
                          '89201','25115','86759','60963','51530',
                          '94664','94922','35360','38385','32359',
                          '65372','19954','28683','92573','38381',
                          '25117','71343','41561','66066','73145',
                          '38635','96903','16806','72619','34515',
                          '60915','26533','42196','12394','12500',
                          '35755','93069','45055','75074','59945',
                          '54117','27467','76394','73846','40782',
                          '72338','98543','20364','12931','61711',
                          '10183','68720','84677','30851','22830',
                          '76760','26888','93790','63594','21311',
                          '89034','53686','70855','97788','48481',
                          '15576','98641','74090','62169','13704',
                          '39183','27239','64429','94612','41736',
                          '62291','99361','43060','50600','60227',
                          '14651','14366','22445','16591','92044',
                          '26986','18506','73333','95475','72281',
                          '28186','32727','44573','54209','69425',
                          '78160','87841','37621','32192','90581',
                          '21067','94363','33464','31284','42737',
                          '34262','81781','31299','20642','27452',
                          '26601','36370','19105','63858','12448',
                          '24291','61528','71994','20017','20938',
                          '21696','77924','75116','29514','46246',
                          '71920','44862','56656','66606','58334',
                          '44976','31382','84462','79123','63904',
                          '37471','24276','89901','93345','51089',
                          '46706','30819','40552','39032','49547',
                          '58820','54300','29841','70567','99428',
                          '73029','19353','80253','25360','54720',
                          '33773','88852','78834','95267','61374',
                          '26273','99297','73290','21147','73854',
                          '47737','93105','11517','31592','68040',
                          '91030','55962','46220','42871','32025',
                          '59362','58226','53400','10582','38696',
                          '48621','11874','19332','63559','42134',
                          '67348','90946','53184','13788','17564',
                          '74113','16172','25804','98541','92002',
                          '88469','51901','32901','89367','23420',
                          '99842','74265','94346','16846')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
