
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '61704','57847','83968','33581','83450','11838',
                          '70010','59456','30615','54037','40904',
                          '45140','48111','22988','32414','92497',
                          '37119','39178','11553','34308','28504',
                          '53937','24598','98428','46905','25166',
                          '28195','83043','21600','33181','37262',
                          '41757','47133','88608','34889','53386',
                          '19283','30695','53525','86404','34949',
                          '38572','22980','80481','60778','12841',
                          '80504','79396','27212','16261','22482',
                          '47173','15933','75659','60392','49125',
                          '37582','41457','75747','68223','48956',
                          '12821','61073','99014','32888','44058',
                          '32182','60304','83840','59682','50851',
                          '75478','95722','65536','18782','69839',
                          '33616','15027','62208','83618','77650',
                          '79851','33410','17375','40940','99950',
                          '32187','31997','53500','25693','90396',
                          '44456','15490','80266','55131','95462',
                          '74638','89350','73151','36917','51046',
                          '72890','58560','17504','12186','91040',
                          '77245','31654','77808','79436','18552',
                          '57390','20967','80158','96086','23928',
                          '71712','42509','34880','11544','49059',
                          '30835','24840','96575','23149','58676',
                          '81539','95436','36194','45125','49791',
                          '54229','11169','59579','10115','78633',
                          '10129','26373','45254','30143','61302',
                          '29145','50080','99562','32949','32029',
                          '70056','18331','57516','55115','39690',
                          '49483','32146','77741','68088','60009',
                          '27718','22478','96776','33611','72703',
                          '71193','70649','88021','72521','28744',
                          '78580','31902','61061','73652','45301',
                          '15960','90349','98784','34535','51923',
                          '77034','60520','83753','15111','75258',
                          '32289','81426','42327','49566','28849',
                          '66687','96453','20570','39693','86911',
                          '51321','49845','50273','64968','12033',
                          '61150','65302','56349','11756','60299',
                          '76929','17247','71669','40340','41043',
                          '60250','32505','52767','53470','24295',
                          '69294','45030','22374','40583','62922',
                          '67285','31486','76301','97023','15884',
                          '71565','59602','39491','82567','29819',
                          '13048','18298','82081','95216','41575',
                          '81311','83166','11352','57629','73785',
                          '47331','76921','96725','56636','69877',
                          '50664','45093','55770','24645','33294',
                          '20033','39656','96008','20348','44008',
                          '50375','64850','84121','72629','59644',
                          '86312','26105','87804','26038','48874',
                          '26603','17228','63042','99913','59680',
                          '44169','19266','93319','58654','66750',
                          '46715','80270','13776','18089','85708',
                          '31328','44125','35933','35931','10814',
                          '26958','33167','51972','32783','19767',
                          '16153','24650','40725','11123','23093',
                          '33139','44150','47492','98971','13120',
                          '98668','40684','34976','10292','49454',
                          '97731','61832','27679','26924','99918',
                          '63859','24449','12259','71803','79568',
                          '17260','36384','91768','43244','72324',
                          '11334','79320','42088','94340','47732',
                          '89586','31877','36604','68711','20025',
                          '27554','69969','78812','24574','30022',
                          '13260','79582','43094','58883','47321',
                          '65933','20936','44945','54213','11510',
                          '25056','78678','52302','31974','13714',
                          '18416','13148','25903','78604','67797',
                          '41445','37264','53159','60276','30044',
                          '28738','85251','82900','20786','78550',
                          '39072','39618','10846','40346','95373',
                          '92435','35868','24702','15102','88748',
                          '38736','68079','24696','84959','69276',
                          '51202','28817','44347','95124','69787',
                          '39937','92363','78202','80144','13271',
                          '23359','84474','59998','67943','69142',
                          '27205','58695','19289','34275','44471',
                          '24114','63073','16618','19873')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
