
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '20249','48891','96058','21444','67369','98336',
                          '35855','45630','37429','29751','11078',
                          '14996','75388','32880','59175','18236',
                          '47905','16681','86513','51911','17021',
                          '96090','53798','32101','37982','80536',
                          '50292','42002','14881','42500','10562',
                          '47287','23561','22656','64495','11912',
                          '54396','93810','59887','42981','67605',
                          '52921','14133','13255','30687','63966',
                          '14582','32987','75613','22481','38085',
                          '87930','69187','15862','85049','63854',
                          '22882','41386','30822','29429','52666',
                          '37088','70377','76750','73235','18481',
                          '53197','28927','16577','88031','26895',
                          '27890','11853','68211','70010','54101',
                          '47774','38923','53110','59348','19627',
                          '20019','11698','50181','17293','44257',
                          '34630','30421','47082','48593','13403',
                          '51131','80520','14047','58452','69946',
                          '39478','33282','48546','60109','89902',
                          '62238','27773','12177','19119','37436',
                          '37177','42335','99845','53525','37415',
                          '24443','14008','19223','57858','18465',
                          '21743','20252','72957','35920','95819',
                          '40759','90536','12365','33197','44216',
                          '86906','21003','63353','41472','61340',
                          '16559','81992','98145','66350','94242',
                          '35297','27355','39276','17201','50491',
                          '89011','29951','90574','57855','24807',
                          '90287','26676','12206','24179','12964',
                          '85641','71740','31497','45564','99196',
                          '32708','26644','26735','18494','36385',
                          '97694','58809','23623','88432','75848',
                          '47656','53004','31333','37235','55393',
                          '17428','73233','20509','15852','66909',
                          '58622','18529','25523','97199','81080',
                          '31404','25299','11961','86989','43292',
                          '54012','21932','64513','43600','45603',
                          '59698','38468','77346','50641','54113',
                          '35423','96111','31227','85828','68043',
                          '98996','33411','12859','83099','22830',
                          '26555','71332','55830','45780','60054',
                          '41305','84634','30783','55749','38882',
                          '19575','83891','79086','30913','59891',
                          '10431','30675','40857','49151','94051',
                          '35043','14536','43666','16174','86158',
                          '34475','94927','10274','56042','10434',
                          '13999','67106','87429','27382','98063',
                          '58906','10263','27571','12798','35718',
                          '87503','79092','70495','42948','40559',
                          '13307','30993','64233','42946','35370',
                          '75853','44269','86974','21072','61455',
                          '65180','64526','83805','18297','77429',
                          '13420','27805','31565','76006','14807',
                          '10491','23326','30262','36141','82291',
                          '33084','98943','56508','86951','31840',
                          '93007','30113','43740','31505','85937',
                          '73347','25022','23627','81907','46480',
                          '97271','19697','72650','90380','26235',
                          '21235','67579','95759','99313','49159',
                          '74836','94877','24248','13916','90163',
                          '39829','65778','19963','62878','51042',
                          '21514','31017','35613','65887','11214',
                          '65956','20527','56709','22301','58918',
                          '16936','28026','31307','17467','94883',
                          '52023','27849','12415','91997','37558',
                          '94870','50084','27350','88455','96969',
                          '79679','97737','31773','57555','91068',
                          '87184','32866','10390','97109','25647',
                          '53743','34442','79151','41423','32133',
                          '11562','60126','14384','25020','67613',
                          '41232','19278','94216','37087','72473',
                          '88076','46161','21971','68963','44395',
                          '96823','52135','25286','96455','91011',
                          '24579','69380','87683','68361','11225',
                          '68214','61686','90709','34653','30394',
                          '23462','96236','34662','10916','33914',
                          '49296','36075','86580','93692','48911',
                          '27309','10780','18817','78415','34497',
                          '13207','92320','30629','17619')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
