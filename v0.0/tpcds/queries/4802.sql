
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '27021','59180','16336','34592','40696','34792',
                          '73781','82147','21156','63165','37718',
                          '19973','84045','68031','80452','50285',
                          '64352','78421','85527','39950','43350',
                          '17380','43029','74876','22478','60278',
                          '17046','10442','55208','14731','78691',
                          '86489','13259','59862','64079','34671',
                          '26489','78046','39853','12606','80302',
                          '91025','24062','27751','81749','94232',
                          '48186','36220','70306','45242','54660',
                          '82233','81987','75317','88427','54885',
                          '81010','21385','23554','29458','58459',
                          '58474','20207','14824','98558','57722',
                          '44613','27283','32857','26478','31548',
                          '38740','43101','91164','74343','39226',
                          '52723','33702','59622','68615','30585',
                          '36033','19297','42184','94514','36708',
                          '58441','21662','92228','23175','62941',
                          '91286','89003','50955','94350','45298',
                          '29281','11116','90502','50133','15787',
                          '66095','97126','24710','59327','15445',
                          '24626','79971','99259','63431','89709',
                          '86204','31013','39832','17570','31994',
                          '39804','49576','62821','68115','29542',
                          '64944','28047','67648','93238','56719',
                          '87499','63532','64344','46070','22350',
                          '96520','13607','24217','43508','59951',
                          '44767','74376','44647','35092','84073',
                          '18255','21135','88332','14630','20295',
                          '52046','75287','76605','34993','67363',
                          '59728','95645','44407','13899','39481',
                          '30860','19321','19988','85802','65283',
                          '72934','42343','84796','60676','47480',
                          '96021','39017','31896','43866','99957',
                          '67654','63136','83497','96725','20827',
                          '61274','26958','44465','13366','58485',
                          '32951','20978','25810','59971','60834',
                          '12640','71548','31974','47360','15778',
                          '31790','42389','25889','33730','24209',
                          '34821','90419','24553','49006','84437',
                          '34326','39301','41780','72788','84671',
                          '97255','30107','63561','94469','84125',
                          '14985','16656','96653','94556','35326',
                          '82348','95759','28203','41567','61664',
                          '64212','67516','63794','15470','46437',
                          '31620','73451','46278','58059','92124',
                          '23152','35843','84288','24934','63003',
                          '81315','53290','37141','64637','40223',
                          '51518','42680','21297','23064','41582',
                          '46836','49846','15709','30970','29566',
                          '52869','23369','25884','22317','94190',
                          '76179','31469','47043','83494','58783',
                          '56947','29317','13134','47447','50294',
                          '49632','33931','46051','67973','16381',
                          '67861','88846','90752','69085','54874',
                          '68812','69469','37417','29949','34608',
                          '19103','11476','56234','31070','28254',
                          '27979','93683','56238','35907','96694',
                          '28902','80832','34426','15566','48639',
                          '96025','92393','49142','85797','61328',
                          '27010','32967','47965','48139','78869',
                          '29294','97966','14690','51435','38124',
                          '72771','27491','49853','38859','63354',
                          '57006','24498','10206','46833','69592',
                          '10972','59666','45802','51481','86310',
                          '71888','91204','49618','94115','74994',
                          '77782','52065','58649','73715','65217',
                          '18159','22314','12678','44068','80588',
                          '14272','11228','95140','23210','23662',
                          '71829','56557','45782','13571','96613',
                          '97893','34495','24119','40062','69349',
                          '60069','20004','59582','12853','39545',
                          '38234','14970','61834','57119','31852',
                          '85972','45953','73652','91911','44165',
                          '59684','22695','33389','48245','16755',
                          '41253','72718','43544','39322','58308',
                          '55096','52507','41012','25504','19037',
                          '92669','61648','76670','91897','64067',
                          '63114','27880','38622','27653','17392',
                          '54397','36883','34288','23295')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
