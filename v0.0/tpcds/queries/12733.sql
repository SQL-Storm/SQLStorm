
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '52645','10329','60214','99099','48696','54884',
                          '45741','52349','11714','92876','64439',
                          '22473','35277','40841','40271','98503',
                          '12362','26244','32121','40356','26448',
                          '19504','35744','49790','44205','88856',
                          '27552','88895','13566','58960','38027',
                          '50430','49382','56757','68463','92412',
                          '88769','65183','28539','75621','34347',
                          '22639','80492','64311','57559','92100',
                          '39458','17413','18944','97616','86308',
                          '56931','80116','58110','80614','89107',
                          '37250','60462','27048','17288','11526',
                          '79231','68455','19287','58974','12266',
                          '88499','73216','29518','21885','23279',
                          '83976','81987','10905','64722','56787',
                          '42807','79095','62172','74802','88699',
                          '17306','19709','73288','50804','82033',
                          '40608','17116','37722','63569','10811',
                          '92543','61343','75325','68061','32098',
                          '50134','35779','82622','78039','34599',
                          '78945','24604','20301','21162','76073',
                          '12924','63228','22217','40871','74579',
                          '82479','32223','68725','13368','90860',
                          '12720','53987','40237','77983','73689',
                          '31068','16075','11265','33784','48575',
                          '57160','80051','88236','29468','71874',
                          '82477','57729','59907','93065','23292',
                          '10287','15975','54085','53983','52140',
                          '68308','67287','30456','22112','21251',
                          '98323','31043','80172','21238','36631',
                          '32441','54215','39384','96301','68630',
                          '17879','21392','13599','19501','31637',
                          '13564','90619','22917','54479','48236',
                          '92600','40492','11668','33454','78641',
                          '23009','17441','87615','52012','22310',
                          '43581','16480','49360','63183','61626',
                          '73233','15134','11211','23994','18866',
                          '57317','27919','96937','24321','56663',
                          '47611','84102','89002','19685','45527',
                          '26828','15586','74646','84723','11870',
                          '29857','14463','47075','91687','20955',
                          '12894','67768','24341','49785','78382',
                          '39091','38350','61480','41232','45166',
                          '82210','53260','53676','10761','59615',
                          '15775','12754','53119','29656','61366',
                          '65876','97043','39325','17760','45427',
                          '10823','36774','20135','11841','90542',
                          '50184','23225','63198','86022','68452',
                          '16253','45845','76194','38009','67727',
                          '29275','78838','62758','74594','46984',
                          '96203','99463','32023','17380','68765',
                          '28124','24147','33859','96907','56570',
                          '44846','76765','93771','94438','41742',
                          '29666','98603','65769','21980','92772',
                          '19656','76190','17761','12520','14511',
                          '28463','15416','23848','32114','62018',
                          '16599','49117','64558','30821','12446',
                          '34634','76089','81142','48348','65550',
                          '29130','42619','57595','56899','62330',
                          '54373','61606','57915','62150','21283',
                          '38139','30845','78635','15961','15345',
                          '38643','15162','59932','56329','37124',
                          '77676','34315','38118','47509','48135',
                          '59407','10678','99518','24600','75482',
                          '72282','24290','57079','42235','15785',
                          '40069','70511','64510','63456','33029',
                          '35557','62444','15820','71600','82909',
                          '11750','89338','56350','51846','38058',
                          '81880','55813','85757','35776','68368',
                          '44796','51073','92372','43660','94239',
                          '85481','92404','69530','73361','46520',
                          '75338','12475','61642','70189','68842',
                          '73238','63232','44581','55631','54230',
                          '47288','30322','36094','94537','23799',
                          '24664','33486','38049','22545','67571',
                          '68188','22444','69244','38414','87234',
                          '96895','42130','21456','60493','98197',
                          '75693','68066','34340','10564','56404',
                          '79338','84737','53543','94682','44507',
                          '21181','12261','47814','65146')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
