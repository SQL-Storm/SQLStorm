
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '46140','17062','21693','36111','40991','71902',
                          '58802','16900','83138','97909','68702',
                          '42527','18965','12276','64851','35414',
                          '30414','15806','30056','19860','24769',
                          '51077','43954','47694','56709','22148',
                          '35733','24601','28122','56755','60894',
                          '27737','74768','29034','60475','25522',
                          '84117','63304','23916','70328','79916',
                          '51905','80560','90373','51857','51377',
                          '42976','48837','29795','98748','88275',
                          '88214','76844','36618','48773','92259',
                          '74991','46684','38982','97628','36014',
                          '16655','19921','28885','84595','86458',
                          '35888','90958','78462','54301','91359',
                          '28389','36763','61261','97285','96536',
                          '32276','48900','87954','74021','84314',
                          '15793','25056','82946','12956','17488',
                          '58161','62406','40138','49397','83304',
                          '41101','98203','66695','64701','53177',
                          '45714','49459','51821','33838','64322',
                          '55173','18265','80086','27422','94281',
                          '54867','49552','49382','12749','33278',
                          '80502','64581','14161','28086','92028',
                          '49094','15500','51646','31567','45075',
                          '40315','56599','28091','72382','19482',
                          '90956','74502','72406','80813','91018',
                          '61361','32697','87791','66258','33857',
                          '57919','54741','81095','15292','19849',
                          '67605','45591','61188','69628','52660',
                          '25405','53950','33682','86081','34413',
                          '30959','18270','67662','71516','65825',
                          '52739','29836','30574','47314','39580',
                          '19465','14215','67100','61322','30247',
                          '49247','70160','36967','37997','28915',
                          '55667','35833','29326','49572','46092',
                          '97780','16368','21233','31035','72784',
                          '17355','72045','33971','36575','55366',
                          '50794','38897','87410','48935','78636',
                          '74754','43524','30983','12447','28113',
                          '80213','31724','65458','28596','74767',
                          '43177','89272','19706','79112','38403',
                          '15858','31365','23638','62607','70902',
                          '40530','13858','25953','88014','60743',
                          '77717','98361','13881','12782','22099',
                          '44096','88887','54724','73199','54351',
                          '31589','95421','20423','39543','76052',
                          '45779','37120','14147','59438','50258',
                          '64025','77308','81385','81132','17878',
                          '34636','67224','60935','14141','33912',
                          '25084','76072','27739','64751','90422',
                          '41562','76631','68543','12058','50490',
                          '35214','98137','53634','75882','15137',
                          '30561','15879','31156','89454','17328',
                          '74126','15429','14425','51208','19268',
                          '95551','88046','69160','35026','17303',
                          '46792','52172','67804','83710','33538',
                          '11012','14528','41810','56522','97961',
                          '19765','61332','50285','85631','78423',
                          '45091','78985','23906','22974','35582',
                          '88655','40087','15891','80733','56589',
                          '26222','94588','82735','46170','40339',
                          '38656','12164','97924','38302','24107',
                          '59525','63486','33339','47379','50773',
                          '89606','13417','95194','85651','72302',
                          '88324','57260','30402','80333','14404',
                          '76438','56080','81837','39589','97131',
                          '59264','19796','10375','95601','48431',
                          '31987','45759','95114','15436','38718',
                          '67033','72162','58010','83491','90531',
                          '90146','19430','65166','20024','41525',
                          '25479','75020','11018','61311','16619',
                          '36994','97764','63781','37796','38155',
                          '97429','72851','29816','75785','35231',
                          '41229','11102','21355','78491','35245',
                          '37229','75364','86161','14281','74804',
                          '40126','28196','93281','23389','35883',
                          '87855','63829','74980','74485','12118',
                          '93529','31074','77447','85374','11759',
                          '16930','69328','69333','89667','76272',
                          '54178','18192','43888','27558')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
