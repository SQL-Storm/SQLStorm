
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '47249','48251','34495','37510','69697','42123',
                          '86531','13692','56240','37372','12603',
                          '77018','43201','49821','54021','37370',
                          '15026','15930','21069','18758','54955',
                          '13110','75098','55594','92474','95016',
                          '39698','29372','84160','26666','30270',
                          '53948','74386','50639','38159','34266',
                          '85742','16811','45855','42370','68834',
                          '31063','62568','34055','56070','78643',
                          '70219','30318','49923','49464','80487',
                          '28542','58330','37432','58069','21202',
                          '10177','95519','47007','52079','34687',
                          '67806','35861','22595','48850','32058',
                          '63198','43620','55409','61454','66835',
                          '20641','37341','69342','53545','70498',
                          '89202','53642','52112','50719','49574',
                          '59859','92379','23673','28579','90949',
                          '52607','30567','22222','51085','88977',
                          '39566','69599','54489','33936','26904',
                          '38746','37279','61237','88857','15236',
                          '43670','22104','36751','58015','24191',
                          '97544','71610','14372','45651','15029',
                          '50943','39031','49453','53586','67732',
                          '52318','31815','26076','21668','50096',
                          '91810','55346','74494','63109','30605',
                          '40715','11319','24195','79460','64774',
                          '15827','34028','43608','39844','23381',
                          '78871','41527','66150','80533','14997',
                          '19338','18570','56883','84161','16237',
                          '31448','49301','49264','19445','16159',
                          '63099','51274','41541','93690','25870',
                          '76012','91801','77769','56783','35631',
                          '24727','47044','32733','63667','99908',
                          '31403','17871','86961','27321','92640',
                          '13690','32249','60641','85254','56465',
                          '70152','17439','13133','46146','57806',
                          '98353','40759','75776','30860','85433',
                          '64807','19681','39442','56169','58353',
                          '53457','84756','30040','30038','10280',
                          '67634','23135','91334','89153','91188',
                          '81936','65986','20739','54402','51320',
                          '22393','62648','52733','89781','43111',
                          '10883','11555','22075','95458','89791',
                          '90812','44474','94494','58930','44931',
                          '25487','95619','97401','94241','17887',
                          '15954','12457','99554','35922','29210',
                          '77408','19761','17029','17780','82435',
                          '47020','57645','89432','90959','68699',
                          '84198','83609','58064','64226','87840',
                          '41420','27246','32465','26378','89722',
                          '78721','15982','80811','46279','43353',
                          '97232','10784','40247','77520','61044',
                          '80595','24684','35783','49544','81750',
                          '77697','13078','53445','51906','87510',
                          '21346','27446','74173','91054','33528',
                          '44861','54884','10417','24080','20498',
                          '42116','39960','99092','94151','44312',
                          '48532','62770','62732','26161','79586',
                          '99182','55702','53216','82213','75560',
                          '38021','21716','16929','94009','42330',
                          '26711','62156','66153','15942','61408',
                          '27387','37097','36569','45504','57674',
                          '44507','13426','52006','11302','11674',
                          '48765','28447','61923','39116','20526',
                          '18087','96349','70150','75596','19608',
                          '92502','18512','55479','22550','18626',
                          '24931','54686','53183','73740','24395',
                          '22920','59853','40084','21244','38047',
                          '64206','14531','32753','79299','52697',
                          '39834','23631','38006','59905','62976',
                          '36093','50549','10674','48731','31380',
                          '54503','54262','77883','42397','26570',
                          '61057','35941','58478','56501','58940',
                          '63108','53349','99404','72286','76554',
                          '21444','29834','62619','74539','80613',
                          '28896','70955','81331','38320','95797',
                          '64179','11518','24144','27372','91314',
                          '50670','56636','20018','97911','87017',
                          '73670','69955','32636','55796','58232',
                          '11509','54559','69646','85528')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
