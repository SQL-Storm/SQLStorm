
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '61704','40032','56652','84476','97416','23438',
                          '51936','30378','44410','77049','25162',
                          '44642','31300','44633','86386','59267',
                          '10384','73737','47583','76962','25928',
                          '97339','94159','47069','62160','64146',
                          '80920','56103','89934','14055','66139',
                          '69161','86916','17671','81624','64119',
                          '95803','85526','48259','33343','86186',
                          '27614','42729','90180','36339','28835',
                          '21645','29182','21281','25673','45900',
                          '29585','59464','27750','44104','26755',
                          '70948','49604','66485','64197','15283',
                          '89551','43496','48770','58003','32332',
                          '92398','29468','58888','89399','15045',
                          '19572','72880','25752','24344','48815',
                          '45060','13148','21054','13784','46430',
                          '77990','76196','83907','38658','45071',
                          '64528','56193','14610','32567','22338',
                          '47968','19808','46935','39134','37218',
                          '81450','25209','32520','43680','47225',
                          '57696','79433','43468','26287','40781',
                          '23524','33302','23146','20164','44778',
                          '36365','34750','21834','36976','68541',
                          '66228','80494','76166','36018','78147',
                          '14570','60601','85818','31542','93439',
                          '71296','99865','92880','74471','85415',
                          '41800','24625','68797','97969','57399',
                          '30853','68811','95848','18219','41542',
                          '53715','46306','14281','99671','10583',
                          '86658','39908','25983','36846','49273',
                          '78677','58594','25348','84198','84220',
                          '80486','24117','75058','36660','46965',
                          '66768','30464','99876','64480','24518',
                          '29813','44276','51321','56893','43922',
                          '58761','11551','90595','73613','29576',
                          '53043','87138','57642','71809','41327',
                          '66714','84467','48352','41722','41196',
                          '75534','84148','15130','38216','76586',
                          '27511','41358','71894','66525','81522',
                          '29868','42770','76443','87821','76855',
                          '36887','16220','11537','37067','14429',
                          '28028','72191','76061','34571','59250',
                          '37529','49463','26682','58752','74123',
                          '59842','73394','12718','30299','49775',
                          '55996','92914','33795','58885','27911',
                          '15398','39572','15443','30273','52645',
                          '16801','75272','14475','31796','22231',
                          '23267','80839','79759','47383','15280',
                          '60468','77446','26977','34617','31331',
                          '59137','51006','51702','44919','99098',
                          '86145','28548','31752','87893','65730',
                          '29167','30131','18142','94095','40857',
                          '37598','87324','43508','31480','40309',
                          '28871','13171','55700','90031','74291',
                          '79484','96249','19035','20111','23858',
                          '42173','48031','82497','60087','36701',
                          '97422','28953','39721','87060','67652',
                          '91397','73910','45959','40057','14254',
                          '58247','16408','30662','73037','22107',
                          '48570','94943','96639','35747','53952',
                          '21425','28806','51422','70406','96205',
                          '84707','95659','94860','42437','53548',
                          '56266','44568','52520','50755','27980',
                          '32022','53238','22049','68406','14660',
                          '50093','98073','78867','55275','34191',
                          '19142','84100','88164','37299','60362',
                          '12145','88698','80178','51780','56907',
                          '66797','25258','61428','36467','80375',
                          '88710','49259','28883','79541','74101',
                          '49544','99170','48157','30639','59746',
                          '19984','19462','69737','58092','58879',
                          '63351','10887','45727','85779','89808',
                          '62866','86274','24563','26522','63099',
                          '26220','72179','37577','31022','13255',
                          '63107','88314','97118','79468','81242',
                          '39605','98356','13821','13264','62170',
                          '21716','71733','53726','26423','31296',
                          '27164','56504','17612','23854','66192',
                          '54006','60862','27964','50500','24790',
                          '33221','73670','80426','87231')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
