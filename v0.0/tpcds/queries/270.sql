
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '41334','95186','71614','20856','64421','41621',
                          '11719','57167','19927','50055','47379',
                          '31340','27990','37322','72819','84855',
                          '33024','50475','22798','17437','40580',
                          '55625','90800','37984','20597','32812',
                          '35930','17535','68869','72102','67642',
                          '50070','60003','55389','78591','89861',
                          '65912','89373','29185','37360','26668',
                          '22990','49537','93483','56681','83070',
                          '85356','25798','62441','62389','33403',
                          '70977','34797','47953','18377','52454',
                          '69886','64163','19100','90581','12442',
                          '36396','31969','97709','84777','46553',
                          '49444','28248','56093','93303','54174',
                          '90032','83554','81430','14501','61298',
                          '83196','95679','25963','67089','81719',
                          '20073','30600','53520','15588','10354',
                          '86136','31175','52461','87370','79236',
                          '97662','40523','92274','26396','44348',
                          '64323','13995','35257','11650','30419',
                          '17350','14927','83841','43939','10466',
                          '84739','89172','43992','52861','97251',
                          '98467','21124','83395','54407','19110',
                          '37459','94890','96834','99012','60316',
                          '50763','44084','21479','72941','45451',
                          '26179','84271','64061','81020','35020',
                          '34043','19043','43889','59561','43312',
                          '43837','74987','21826','17456','66769',
                          '39701','59653','50315','49997','36146',
                          '77264','34444','78788','80623','44978',
                          '10238','89161','23339','95609','10686',
                          '78443','45162','96906','87061','96820',
                          '82053','90159','31063','37684','18611',
                          '23480','54106','51769','58537','67062',
                          '43890','12175','24166','33897','93911',
                          '49376','36064','25939','54844','52179',
                          '42470','26392','85089','85388','92505',
                          '23669','12021','16987','19881','80669',
                          '42268','91536','30760','48270','30406',
                          '32780','90585','75307','67453','92994',
                          '17054','60752','94347','87111','13483',
                          '21946','96444','65261','77309','32499',
                          '64645','45780','19777','37153','86787',
                          '23714','93723','17223','98848','60518',
                          '10199','51668','53257','93254','17346',
                          '10795','12669','57610','59071','51178',
                          '10858','63408','12456','69809','28613',
                          '15319','53639','61895','77320','62977',
                          '25789','60269','47734','64587','35362',
                          '21158','50943','40395','53539','25273',
                          '72781','26784','17262','31513','96769',
                          '60537','54738','62896','45785','11874',
                          '65116','49982','66948','48997','20089',
                          '16172','97234','84076','28655','22870',
                          '32471','81873','25507','44443','13218',
                          '41256','27487','49076','17875','40315',
                          '32379','38774','15929','32591','16481',
                          '73213','86555','34673','35572','31130',
                          '97219','21003','18303','54283','70344',
                          '47190','47327','85423','65291','56616',
                          '45479','51466','41463','27588','21557',
                          '68693','88425','79724','69690','27032',
                          '59091','66852','60077','58018','78552',
                          '21036','81870','86075','68991','87055',
                          '11439','18590','29464','39322','89868',
                          '26475','87407','50069','42681','73511',
                          '15495','66342','65424','59371','43637',
                          '75325','31371','59239','49976','14641',
                          '44093','19148','15958','19417','29166',
                          '13281','12858','63176','10231','30270',
                          '37914','37447','86919','55483','76452',
                          '44173','71788','83336','41824','42192',
                          '99029','84824','28571','20551','85325',
                          '55491','38322','13433','47738','59199',
                          '78932','63084','32869','16359','18135',
                          '41063','70097','63326','48475','24468',
                          '94589','39136','57902','36066','88648',
                          '11117','90285','83891','43018','29618',
                          '80151','48554','14581','78633','38406',
                          '61428','40214','61703','45859')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
