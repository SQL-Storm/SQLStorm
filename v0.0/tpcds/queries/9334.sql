
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '31229','23565','18895','27422','71341','65790',
                          '73371','72935','28738','24003','33171',
                          '34757','65132','52048','12693','27917',
                          '30024','21496','43247','25330','91061',
                          '58385','69600','27220','88590','11473',
                          '52409','62715','75223','95849','11946',
                          '38553','31880','12855','31559','31040',
                          '18179','72673','45825','33830','93928',
                          '44789','98875','56104','71373','88282',
                          '26577','73385','63480','95783','22435',
                          '47911','50029','23581','56420','12365',
                          '34985','13910','95063','24159','63859',
                          '99438','38142','40502','57133','50048',
                          '22322','18970','40836','49653','79159',
                          '67458','38772','77110','48115','72241',
                          '22250','55372','28931','70141','73344',
                          '54791','89467','90493','11351','33608',
                          '76703','19854','13904','48980','64766',
                          '20598','19514','44910','38271','68526',
                          '76239','23726','35049','44213','80034',
                          '82437','45579','61932','36465','97495',
                          '33519','18130','37153','38941','26935',
                          '67522','62292','72691','42613','50818',
                          '26895','10615','63446','12040','22106',
                          '52803','48851','43300','69139','11300',
                          '75795','71990','19589','55946','36479',
                          '71882','98660','44260','46851','47417',
                          '31756','31950','99886','14303','95024',
                          '26257','60502','17215','50915','30455',
                          '36469','36641','26060','60345','66608',
                          '21047','12231','84272','35228','32474',
                          '49605','31141','66133','11969','86969',
                          '32738','89359','43701','44575','69504',
                          '17923','96594','60899','80270','61921',
                          '46428','43290','59029','47681','75584',
                          '71761','81378','47689','19457','34110',
                          '41583','68353','81436','61964','48672',
                          '23347','53850','32503','32650','25157',
                          '42439','75505','32072','52985','88505',
                          '97864','68495','36588','35802','73235',
                          '66198','96241','37770','41175','23111',
                          '24300','39602','28104','78565','60107',
                          '45804','59244','98520','23500','93938',
                          '86458','90558','23217','62535','44590',
                          '37993','28030','36464','83460','69702',
                          '58903','58657','45047','54640','35509',
                          '16506','86892','77255','97721','16269',
                          '21668','51053','21299','26658','99293',
                          '25779','43581','10577','77894','51105',
                          '73842','79846','56659','58825','60456',
                          '14233','94850','10399','45193','60825',
                          '65868','54371','24837','33738','65986',
                          '18764','77945','46677','18707','82513',
                          '39449','33106','19620','84461','51656',
                          '44518','84473','72380','74385','46682',
                          '49392','88195','37189','35670','10821',
                          '61092','15026','28876','88236','78571',
                          '34797','32737','82226','18008','36361',
                          '97429','47162','53327','70901','15771',
                          '11989','60262','24589','64928','34123',
                          '51434','86479','54467','87327','18611',
                          '85649','18609','76787','13027','43507',
                          '27124','38682','57379','79958','86735',
                          '59311','46093','98286','18756','32192',
                          '53574','78980','97434','11140','76399',
                          '12213','25437','21792','23974','30277',
                          '16653','43549','45755','30572','34109',
                          '56583','50744','87555','56370','76631',
                          '71478','97486','92263','81672','29737',
                          '12474','32522','34741','34395','62278',
                          '35053','75590','59247','25758','30064',
                          '82129','38458','11901','32240','59728',
                          '17522','46579','22975','32225','15784',
                          '23604','46291','10512','71490','98160',
                          '55891','41748','19203','47247','46734',
                          '47813','46501','58809','95202','11459',
                          '15603','81645','74619','65505','26429',
                          '93233','29671','75802','66207','74627',
                          '96956','19168','71354','74276','53877',
                          '90153','90834','53802','21180')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
