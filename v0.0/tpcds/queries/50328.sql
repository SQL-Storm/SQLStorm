
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '14837','18833','46693','76418','96969','90006',
                          '50304','51721','35103','18913','56401',
                          '11615','18823','33146','77268','62728',
                          '59377','15867','40739','95213','24301',
                          '20429','58244','30058','22567','55095',
                          '25492','46340','41865','44008','58981',
                          '22271','57257','33987','41953','26952',
                          '94949','29849','68483','98067','31781',
                          '11212','47651','70883','24960','85425',
                          '79841','53214','25180','39370','80354',
                          '62904','24409','32171','47826','71254',
                          '71383','61820','77492','28662','16929',
                          '12847','48287','94428','30493','76021',
                          '42060','21102','84342','72397','40282',
                          '27069','10223','45433','35149','52676',
                          '88319','67688','51126','12705','97451',
                          '82497','64188','38850','54819','38954',
                          '33120','45543','49694','45749','91621',
                          '19288','83059','70856','30079','24602',
                          '61056','10395','93672','39924','12739',
                          '11071','73818','77400','15795','66138',
                          '73268','59706','20595','35227','41665',
                          '11772','15276','75986','33158','42395',
                          '88515','18379','93083','57562','59469',
                          '44912','52422','39045','91815','84851',
                          '78986','70843','97000','41432','87277',
                          '11968','64171','30350','74049','90650',
                          '77306','16349','39769','60357','85311',
                          '17576','70299','49926','32438','71290',
                          '56342','66040','94052','17740','14981',
                          '52988','27988','48183','55111','67963',
                          '36320','99840','55301','38258','17557',
                          '51308','21410','27132','39273','59204',
                          '24133','30399','44894','83123','29913',
                          '53392','68157','25951','70120','38113',
                          '90304','40741','48719','20491','29053',
                          '19646','36642','47468','98928','48240',
                          '67293','53986','11491','23392','34295',
                          '11409','33783','21386','34327','22964',
                          '33816','26092','67166','41726','55261',
                          '53892','97714','21342','62668','80873',
                          '29146','17885','67485','94767','90627',
                          '68662','56423','30317','16182','23492',
                          '77682','31446','26930','20096','21284',
                          '65228','90442','51018','93719','60242',
                          '76481','11790','49116','22770','27660',
                          '39164','39201','70134','81538','19327',
                          '63666','38232','52949','24526','49184',
                          '89102','11561','45296','37190','90328',
                          '48929','33297','24942','45203','35315',
                          '54087','59743','15125','62006','21069',
                          '45201','61898','14129','54430','60906',
                          '92882','94630','54094','52707','77560',
                          '36644','44645','40209','20118','54260',
                          '17234','37902','19130','90426','28711',
                          '21973','58714','27991','66291','16137',
                          '91477','53721','77942','55499','32383',
                          '59915','65550','95389','19516','19518',
                          '64801','89597','21601','19996','46324',
                          '81879','51636','38230','19815','31212',
                          '49004','67165','50242','72923','81437',
                          '47067','64079','30927','40493','54180',
                          '70470','11651','62954','51316','10102',
                          '63023','11572','39834','18806','54571',
                          '61131','39528','39017','76501','22798',
                          '84457','21388','40942','56712','41980',
                          '27436','44657','33694','42954','30535',
                          '51815','26473','81790','31159','23339',
                          '84104','45311','30071','11084','97878',
                          '30419','10559','77840','29082','11596',
                          '43462','82178','64065','55935','18597',
                          '12170','62711','11549','31932','25491',
                          '15880','10254','13468','10215','64320',
                          '59613','27920','37136','72860','34648',
                          '20146','35246','97597','16024','11725',
                          '39367','28209','10348','56902','47454',
                          '76558','85359','62617','49048','99906',
                          '68686','53841','41222','34891','41143',
                          '70677','20637','22871','94482','89431',
                          '16254','22029','63990','88714')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
