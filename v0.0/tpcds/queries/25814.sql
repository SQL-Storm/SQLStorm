
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '76008','13553','14546','77383','31276','20203',
                          '65729','22077','10518','60482','25083',
                          '94711','61671','57427','62217','17492',
                          '30536','40602','31214','65456','65208',
                          '33532','27548','27524','11711','23228',
                          '47756','45226','49795','15540','55046',
                          '51969','29916','21736','60088','81036',
                          '32890','37793','89016','43447','92775',
                          '27690','27473','21671','71699','57184',
                          '80379','81437','59589','27631','45786',
                          '18237','68770','84646','12169','41704',
                          '53240','60181','26356','13832','78025',
                          '59524','59628','68804','24266','37174',
                          '40774','23197','92399','19557','28700',
                          '22936','48710','74258','76438','54218',
                          '18172','96632','96512','99658','90824',
                          '31180','48283','14621','31968','72360',
                          '56910','22083','47627','27212','77322',
                          '88064','64135','67562','47601','67146',
                          '60942','74953','90499','12049','81050',
                          '30430','70012','24889','29340','59115',
                          '35408','73329','85899','57361','20289',
                          '34714','16005','36749','63159','69242',
                          '69677','13757','28445','15694','15932',
                          '39810','59836','88479','25220','14220',
                          '39588','66202','38494','71924','30071',
                          '45504','53974','29302','20758','47523',
                          '26988','23872','99809','50720','89124',
                          '66315','11928','85894','36538','25327',
                          '73908','63772','12296','44597','34296',
                          '42375','83366','27824','38014','21432',
                          '10552','81691','50375','76942','10103',
                          '89179','80077','39100','59911','29133',
                          '47098','64168','48239','43539','25311',
                          '46248','81289','62051','32181','33416',
                          '16536','40139','51956','21750','15604',
                          '35515','19143','57900','36125','70497',
                          '46829','20039','92908','61979','96467',
                          '25911','89949','67523','18680','46849',
                          '55836','38945','56445','35730','91355',
                          '11209','50171','48819','62893','64719',
                          '19802','58497','77307','38550','56018',
                          '82951','62125','20507','17630','76541',
                          '55851','20058','44724','46673','10404',
                          '32271','19531','75270','33503','70464',
                          '65575','73264','15298','44548','94971',
                          '68292','74641','41785','67451','13525',
                          '83650','15233','28144','30812','11141',
                          '30224','29820','22941','48002','42341',
                          '75944','54350','62262','12378','65570',
                          '98475','84458','77309','65591','30040',
                          '36400','70762','33318','49644','68834',
                          '54231','63010','99472','63511','25306',
                          '53985','18777','28318','26186','75691',
                          '73223','37858','20374','67393','32259',
                          '94153','72612','92946','32340','44637',
                          '16074','19577','29507','42476','21599',
                          '30388','31896','29465','40513','28273',
                          '47497','23893','47327','57405','64322',
                          '69504','47468','32800','13333','62815',
                          '45905','81123','62430','26979','82346',
                          '40768','19693','16706','71985','38740',
                          '65125','38186','64725','29471','48131',
                          '62699','69096','40612','45379','96789',
                          '58306','68404','48813','90721','19547',
                          '14043','19636','32715','56975','68084',
                          '25789','76578','36945','80715','87340',
                          '82089','50559','45948','44397','68923',
                          '32334','39319','43238','21583','24837',
                          '50274','37470','47918','12221','63865',
                          '34922','32358','16475','13586','52523',
                          '18944','65887','56379','49362','73552',
                          '60880','32277','33368','41745','88286',
                          '38847','80055','98347','64039','80120',
                          '71011','36198','72159','14866','25520',
                          '68639','73072','42881','43953','86171',
                          '11083','19747','56997','41135','88265',
                          '66409','33505','32785','35943','24952',
                          '20047','92748','92853','92691','83511',
                          '83788','13987','18375','47055')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
