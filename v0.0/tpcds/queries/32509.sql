
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '71816','42673','81948','11118','12613','94904',
                          '67847','18324','40176','87009','15790',
                          '10631','95497','51388','45779','99349',
                          '74753','18500','25677','30564','58095',
                          '74228','62805','67332','39409','70911',
                          '29069','68640','49826','25045','75877',
                          '22698','84408','73388','88040','29096',
                          '72924','97571','95224','49661','64180',
                          '33388','29411','49762','42256','65955',
                          '33642','59618','34603','51297','59176',
                          '32004','43606','46905','81041','94265',
                          '40129','67654','18312','24845','51225',
                          '87360','70624','76217','61186','85739',
                          '49989','57260','78805','88728','78025',
                          '19081','16744','75663','62302','56573',
                          '19759','99906','93615','57153','76960',
                          '32750','16775','30457','85907','33932',
                          '54732','56368','90106','92718','95508',
                          '80961','46164','35182','29062','45022',
                          '15700','24454','16589','94963','37993',
                          '42588','35703','38991','42918','49573',
                          '77538','92293','22509','89421','15993',
                          '33568','37062','37372','83144','45344',
                          '29370','91895','54769','39761','12557',
                          '58363','36398','30061','87057','43186',
                          '28651','57632','20118','56509','51460',
                          '20997','69511','15086','23814','89043',
                          '60479','56836','88291','14138','14001',
                          '74197','18840','27462','13279','96769',
                          '50332','51162','45759','47431','26750',
                          '13427','15171','20794','58084','63480',
                          '48986','69006','23879','11917','30124',
                          '19862','78762','82160','58685','75531',
                          '96025','99909','11873','38721','24379',
                          '28501','60154','41461','40422','17519',
                          '44040','97662','33423','12815','46633',
                          '37748','42127','62567','28503','24962',
                          '45196','91444','12351','57386','73814',
                          '13502','63225','55836','59179','23685',
                          '15020','78147','22192','90275','98728',
                          '48627','42207','33081','65716','90245',
                          '23781','98745','26255','59365','47640',
                          '57014','62196','23987','46836','55828',
                          '20833','50441','71657','56056','74376',
                          '17108','35587','53125','23410','24722',
                          '45093','44611','18127','17106','81802',
                          '18104','11972','68327','64147','88299',
                          '18049','83627','45658','30768','40494',
                          '48126','85873','44402','44550','56991',
                          '89044','26513','29379','47813','94222',
                          '58856','26686','12125','45870','86529',
                          '91158','13358','59495','19813','93521',
                          '31730','20733','93240','67308','42033',
                          '16816','84928','91369','79167','99893',
                          '43881','61034','13929','84345','21837',
                          '29552','64178','43973','44928','65309',
                          '81551','85412','80595','12586','56199',
                          '29776','31386','17034','70187','40291',
                          '55436','76411','23980','88079','27500',
                          '37227','33613','55630','22851','49007',
                          '26135','24897','83649','28158','97373',
                          '25473','80435','57354','17825','59506',
                          '11412','68547','93869','51891','75528',
                          '33752','74960','18903','31150','23599',
                          '48384','89809','71559','22922','67166',
                          '45161','47699','57968','93710','42707',
                          '20192','22318','71537','22197','53838',
                          '78801','84543','27343','43320','13395',
                          '98439','73291','31677','10423','33252',
                          '41906','58923','49102','44564','65550',
                          '98961','33338','77189','12131','96123',
                          '99679','95312','73489','23408','33410',
                          '47032','48903','71722','11590','78820',
                          '42557','23956','52472','84794','34597',
                          '72151','17011','86196','43629','34200',
                          '21343','65577','59895','30337','81572',
                          '55471','17235','18947','91000','40613',
                          '61169','22717','28455','73397','55965',
                          '26320','41186','89369','96400','23895',
                          '12158','71147','12170','21696')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
