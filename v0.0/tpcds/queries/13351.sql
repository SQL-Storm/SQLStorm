
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '61560','71296','39685','51118','12943','69403',
                          '97884','17598','79778','98499','59406',
                          '16625','65996','17055','43609','17374',
                          '30519','88896','81805','41452','23223',
                          '59671','63912','95255','71750','73129',
                          '16539','56829','84323','16146','92603',
                          '62650','16304','25032','24268','78485',
                          '49934','56633','22417','80454','49164',
                          '95963','27005','74375','60977','24093',
                          '44723','71205','26815','22830','18838',
                          '78457','18478','17359','38650','75563',
                          '79726','45622','39703','77755','22880',
                          '48374','79547','54357','66572','27732',
                          '75879','38000','85739','23972','73857',
                          '70557','26603','68684','20211','32431',
                          '99197','50010','16775','98638','58488',
                          '89357','47511','73561','13682','91850',
                          '26550','47255','66262','51013','11303',
                          '85795','45093','59871','91510','51517',
                          '32160','62830','43134','90465','74081',
                          '41475','37900','39163','47420','55684',
                          '30741','54276','52935','38158','48746',
                          '89502','57173','73766','11818','23512',
                          '83124','36379','17825','15155','50514',
                          '35298','13373','25271','70132','66008',
                          '67614','77664','89748','57491','25767',
                          '85529','36167','89825','46107','67951',
                          '19520','20965','15812','52903','99244',
                          '44061','91664','71823','35488','79894',
                          '52849','19429','42904','99316','78217',
                          '38460','39086','68288','11066','48088',
                          '71116','63612','63297','28162','72157',
                          '14324','27773','92981','43528','78162',
                          '93783','90596','20469','43148','20313',
                          '50090','32750','17104','51966','15750',
                          '30303','23229','81236','47624','16185',
                          '23228','20901','22051','62395','46073',
                          '88646','23921','29165','59523','35222',
                          '69533','39074','28241','98483','56639',
                          '10951','35453','87843','73469','54361',
                          '72461','99573','65344','72260','54700',
                          '14571','70129','93244','34437','17937',
                          '40327','56431','45985','20297','96785',
                          '65074','80338','51110','33438','52676',
                          '98805','26669','36613','15896','32048',
                          '12984','36342','11789','26811','26780',
                          '47643','18651','58730','76952','29421',
                          '64332','83268','21032','18542','29705',
                          '72020','70695','17302','65822','20170',
                          '26049','24747','12897','83829','49018',
                          '48116','43029','30395','37032','99026',
                          '45281','13105','93809','65019','19905',
                          '18962','52005','81767','37490','94326',
                          '50104','80672','80743','12199','18890',
                          '14060','96572','41550','85475','74352',
                          '75874','12336','41453','29611','18433',
                          '26806','69793','99791','94851','15111',
                          '19436','45022','97371','11748','49777',
                          '23566','33583','41492','46480','47936',
                          '26569','86376','13581','21042','57734',
                          '48278','55221','57944','93047','71243',
                          '27162','56208','44689','50056','88869',
                          '59915','70723','26627','29242','51705',
                          '41152','80009','88004','94440','87744',
                          '16121','25721','42290','91166','79634',
                          '33002','59774','59565','11930','29914',
                          '23612','69473','19784','16584','85156',
                          '23149','46008','48337','37484','91422',
                          '34415','16235','71133','15884','61310',
                          '35806','14734','18722','15505','82206',
                          '86807','58624','17142','85070','95796',
                          '11864','16253','19960','40094','51416',
                          '77647','21156','27788','38853','59772',
                          '21188','42132','13145','99641','40398',
                          '33696','50808','30361','17154','84678',
                          '28579','49721','28752','38994','13131',
                          '49057','97956','57016','18707','24861',
                          '60788','22645','65431','50642','37734',
                          '10660','28581','54989','42538','57302',
                          '49140','15312','87591','85968')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
