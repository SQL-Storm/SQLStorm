
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '65335','44221','49989','73918','30501','43017',
                          '26477','20700','74813','96259','63088',
                          '99880','37382','35989','40825','93562',
                          '26087','96763','51791','40108','94657',
                          '32137','23633','33515','98891','17212',
                          '81637','16474','55285','52516','96045',
                          '24697','34128','84171','24014','72017',
                          '47620','61154','42870','37352','71989',
                          '28440','32438','89458','10436','23569',
                          '18180','24840','67841','26572','76966',
                          '14276','25584','52849','42653','72090',
                          '77122','26763','42261','23607','72041',
                          '99692','11152','52301','81655','42625',
                          '68970','58706','32295','77931','87554',
                          '49380','54588','66858','71137','27721',
                          '29838','56585','93566','27799','20278',
                          '65596','80747','82858','30069','37377',
                          '18887','71018','71547','68674','11970',
                          '87243','47211','12386','12521','85284',
                          '89892','24531','41574','11369','75394',
                          '82322','18919','39310','62645','21158',
                          '50462','37646','84664','97027','24163',
                          '31528','67827','71368','56245','18031',
                          '47680','73268','54688','28826','70682',
                          '20070','18254','18892','49613','61977',
                          '66223','58730','37444','11286','39201',
                          '47612','95427','98767','90075','17980',
                          '28304','43171','37458','23775','24369',
                          '84651','18122','47289','55275','93743',
                          '10408','73193','35662','57131','95874',
                          '15432','51131','69345','12887','88150',
                          '35507','73064','54895','27086','84686',
                          '46055','52109','30436','76513','30636',
                          '45280','53240','72967','28219','98949',
                          '26391','54391','90449','63341','79888',
                          '33997','83510','84946','45864','23067',
                          '59363','11643','98780','85628','48719',
                          '35584','43586','58710','28851','11721',
                          '26080','35755','45928','22121','96367',
                          '41554','51512','70292','19148','35979',
                          '17689','84615','14313','54752','84780',
                          '30712','90397','13320','24914','44516',
                          '94450','54262','58383','25663','16048',
                          '76580','41453','81694','96849','29057',
                          '86051','53514','10341','37597','22631',
                          '25135','28384','78887','40009','27686',
                          '58923','12790','43631','95328','51790',
                          '27745','37744','40018','82592','49833',
                          '70068','29106','74471','17886','17906',
                          '10075','26378','91887','83002','74332',
                          '72266','56131','31525','74002','45188',
                          '35629','23609','87515','74126','62968',
                          '28887','52125','46543','77166','73254',
                          '10813','66736','60098','18503','48215',
                          '26974','97893','43347','36832','85797',
                          '90985','16810','30131','30144','54923',
                          '49426','49464','65288','78746','93179',
                          '45701','58154','64908','17989','37384',
                          '80924','40799','15904','17492','37907',
                          '42273','57334','36192','17149','31154',
                          '45795','11924','22201','17516','46629',
                          '73368','74473','55568','30848','63510',
                          '61021','33499','25791','93870','61295',
                          '88217','56896','37507','77208','28369',
                          '31489','46322','58059','18806','99257',
                          '15951','72590','31403','14692','77870',
                          '93400','72466','11948','44426','36243',
                          '37431','53339','19833','91348','11744',
                          '11021','94162','52804','29696','28421',
                          '11662','41427','73359','52944','41272',
                          '22929','38949','32649','34495','21417',
                          '88598','45398','70820','58337','66177',
                          '30835','53634','29489','12856','64195',
                          '80080','22650','56787','74327','15217',
                          '44061','18620','83838','22783','24945',
                          '12026','42856','66487','73826','54104',
                          '23457','42126','38855','38670','26170',
                          '63054','83141','52376','29279','89102',
                          '65005','35419','25349','48379','28636',
                          '82739','86515','57845','36035')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
