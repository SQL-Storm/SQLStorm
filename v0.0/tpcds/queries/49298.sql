
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '78521','88982','43027','42457','62616','63690',
                          '10397','18479','75937','81310','37587',
                          '68486','18886','78255','45491','10290',
                          '25633','35621','53847','13216','10288',
                          '59552','52247','23082','85362','72454',
                          '22709','84206','21375','70114','33354',
                          '12950','18692','91462','75053','35264',
                          '29999','76117','83701','67234','46220',
                          '15732','46825','23622','79360','25192',
                          '82126','33252','16861','34454','45994',
                          '34825','51804','52896','48646','16783',
                          '28472','21939','25879','99065','62522',
                          '44322','56063','76477','72769','76558',
                          '99933','70268','42426','96442','18103',
                          '69480','42791','15882','56896','98101',
                          '22407','74436','48102','53284','15867',
                          '62355','42096','26159','12547','83818',
                          '15844','99296','13337','17970','50138',
                          '14812','28482','58142','62798','18377',
                          '81179','24732','75635','17978','37765',
                          '50330','20767','91318','51652','55330',
                          '13802','48575','44269','79526','60217',
                          '66488','84524','11797','64227','84386',
                          '94959','17317','58816','93831','61164',
                          '47140','43592','36086','79309','67674',
                          '81646','76157','64071','65376','14774',
                          '83133','82587','90997','82496','12126',
                          '79528','54105','93489','49743','59143',
                          '25870','23476','26759','87228','61434',
                          '35779','44077','62056','21812','19968',
                          '71850','22772','24010','23137','24344',
                          '83682','81460','15133','17137','39602',
                          '96311','15424','85689','92761','90513',
                          '92855','98008','66946','88117','76807',
                          '96815','16599','53466','10590','14712',
                          '80706','14475','35174','87698','13901',
                          '23927','83125','22351','12702','24763',
                          '33117','49480','60139','98838','81102',
                          '44166','20915','37633','93449','12431',
                          '59885','33796','11313','23245','91351',
                          '49479','70434','57431','50141','83869',
                          '95190','60633','42835','53385','62260',
                          '49552','31372','30759','16962','35446',
                          '59058','88037','95442','20635','90304',
                          '29602','18240','14013','24347','39044',
                          '48682','18810','57681','58615','80990',
                          '94248','23063','62968','29503','58567',
                          '30583','91006','14907','23937','82975',
                          '13185','13890','14549','43597','15157',
                          '84241','28759','24350','95169','62201',
                          '35480','53922','90735','93527','57607',
                          '65136','17167','30871','59099','23519',
                          '70148','70681','99090','70873','36336',
                          '42828','41096','35701','43114','24758',
                          '83455','95453','76155','85109','74497',
                          '94984','13427','44204','50758','50143',
                          '29665','59377','93565','67598','30993',
                          '48620','60729','63906','66998','76127',
                          '63811','52535','88127','33517','30227',
                          '41812','52323','91041','70385','51335',
                          '55517','29523','72145','38279','23068',
                          '39681','28111','43083','90353','14562',
                          '54348','12963','64637','22995','31197',
                          '22668','53628','41229','54368','88179',
                          '34997','74778','90767','94529','73047',
                          '47434','51914','80048','66889','58208',
                          '46857','91681','46626','51074','58507',
                          '77554','68588','25120','11390','64742',
                          '95908','76163','12969','52842','77927',
                          '48504','66014','76187','56019','22963',
                          '91719','60304','60845','62971','28304',
                          '13359','45898','83603','31034','18232',
                          '58457','39236','51975','98446','81931',
                          '98435','13657','11137','59661','83069',
                          '70442','16111','31345','64878','83733',
                          '31974','24303','80818','94333','40536',
                          '21883','80360','73790','43094','86450',
                          '78967','68091','55538','42442','50121',
                          '94051','60205','50853','47499','11668',
                          '92743','16930','34127','10444')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
