
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '51569','90393','33055','59044','78846','15927',
                          '16583','54513','25777','82985','38543',
                          '54219','47473','18151','21805','30155',
                          '45886','26891','20549','43631','38898',
                          '72742','76289','62465','77380','99471',
                          '70383','66990','50283','43910','57144',
                          '18699','16087','64483','41774','57602',
                          '92134','50589','52257','42611','68228',
                          '17535','51870','79608','43860','15472',
                          '30391','14027','63903','35172','61144',
                          '44482','14267','41244','35259','41298',
                          '36186','91528','11593','39798','30089',
                          '87045','77070','50903','31793','12122',
                          '28610','92747','62066','23270','94745',
                          '49772','50538','28996','22780','49510',
                          '73280','24278','87880','30055','17279',
                          '91229','15661','51151','23039','55831',
                          '84533','78183','54266','39153','52021',
                          '71623','31164','14140','86143','36038',
                          '55483','28001','24883','49092','82219',
                          '58528','61703','33303','10163','12338',
                          '44433','29085','43111','15609','40265',
                          '35785','12315','51188','74049','43899',
                          '25039','25463','52255','64809','92794',
                          '30048','64237','20778','81422','63770',
                          '52164','66105','90942','13337','34535',
                          '92303','56099','45766','97132','45050',
                          '95472','41242','99227','66538','37726',
                          '35342','10881','58602','35227','48613',
                          '57415','86960','73263','91295','50514',
                          '36087','53824','60390','26969','76516',
                          '32298','71047','78880','12644','25009',
                          '47506','11566','59184','25744','78632',
                          '58468','24348','66756','62360','39393',
                          '11702','11083','58191','24993','60540',
                          '33480','19456','65553','84168','88983',
                          '77374','46047','11618','46623','27043',
                          '13884','35148','53056','72633','59126',
                          '78808','62223','86764','98848','40606',
                          '75007','51476','61753','83697','52552',
                          '28343','85009','33431','50269','22515',
                          '21970','23062','44563','40912','87444',
                          '64263','10457','12818','65231','43126',
                          '85482','64688','50226','79793','51284',
                          '49708','43573','23169','71846','10382',
                          '62719','96419','26377','12402','38997',
                          '77678','65148','69651','58187','17430',
                          '43969','71151','38972','73802','46577',
                          '61524','50256','32045','44685','62729',
                          '32736','61614','80703','43949','11020',
                          '88841','44674','38670','72283','55921',
                          '86856','29028','25243','96669','11805',
                          '10211','14103','89079','31847','33434',
                          '43353','64619','96394','10907','15878',
                          '87498','12614','83074','52537','50897',
                          '69909','60107','88201','93269','61834',
                          '44823','43731','24005','32121','37573',
                          '10361','27129','96662','48614','22575',
                          '36832','73100','42509','77979','50694',
                          '65915','67915','87843','18386','20072',
                          '39467','40183','32622','32109','16089',
                          '83358','47642','23171','34232','22438',
                          '18693','80972','80334','51312','97484',
                          '44492','91316','76642','83976','73538',
                          '10835','67159','72431','30868','95141',
                          '28498','59445','71967','74529','18556',
                          '10743','25035','16284','35150','85490',
                          '83902','12856','65187','78302','76067',
                          '85959','60560','42100','85501','86004',
                          '84415','92081','13413','29189','83646',
                          '51289','90580','18926','93812','66007',
                          '49491','63776','63761','33438','86734',
                          '38195','51100','63620','16298','93663',
                          '23318','26883','51046','12793','29131',
                          '12396','54220','63580','10982','53615',
                          '31060','85179','73185','36232','20809',
                          '97666','62699','35841','57004','37848',
                          '68873','24731','23635','49076','86287',
                          '25312','86701','23728','84305','25792',
                          '62738','60939','96355','40159')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
