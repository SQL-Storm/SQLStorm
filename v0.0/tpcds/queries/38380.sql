
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '79143','14942','72915','37998','25227','11605',
                          '92957','80061','14344','67934','17369',
                          '55950','35460','85448','81482','27554',
                          '96859','84055','24862','70588','59273',
                          '19878','36919','43591','98851','70157',
                          '59491','75880','68201','12372','87598',
                          '20224','50799','48996','60694','79466',
                          '40050','44627','39937','27967','44480',
                          '34263','58164','46130','48235','63092',
                          '94746','51151','51643','36672','69552',
                          '66793','83322','15107','64436','37838',
                          '12456','35791','26305','36683','71525',
                          '23527','63947','89299','28570','34038',
                          '23026','40010','63291','37630','67457',
                          '18626','38846','28258','40656','62637',
                          '14935','51551','20934','13988','66354',
                          '32459','21937','11886','39679','14133',
                          '41289','83270','85788','57083','34955',
                          '50897','76719','32235','44097','68740',
                          '11338','41382','14139','57051','81651',
                          '64967','98961','71963','72851','77134',
                          '31269','66534','97553','82366','89974',
                          '30946','75752','58406','86689','13885',
                          '69064','99830','14826','24253','55876',
                          '43638','57353','79698','10819','23226',
                          '13489','21593','35067','50030','96334',
                          '70055','64199','18726','70107','97284',
                          '29570','74518','13573','32838','18515',
                          '32241','35720','68378','27769','49848',
                          '61644','35993','30831','20499','13539',
                          '16533','94881','10095','31121','39248',
                          '71709','39103','99545','38611','70111',
                          '29741','92938','73121','60510','24629',
                          '11185','18417','12849','88610','87059',
                          '38699','48322','43887','57412','12699',
                          '57507','54315','53979','11351','22178',
                          '33040','11929','83149','94827','63076',
                          '59887','53038','72333','48473','74001',
                          '27748','69002','21340','99342','43934',
                          '73137','51308','54658','37022','56728',
                          '14841','82870','39489','37393','24356',
                          '67633','26728','70529','47329','58843',
                          '53368','73642','26550','38369','49086',
                          '84694','23091','37716','20049','85358',
                          '47383','70377','33685','19949','12193',
                          '34826','97923','14144','17081','63097',
                          '70673','37812','70901','94946','83340',
                          '93617','77546','56110','27156','94181',
                          '78327','79677','21029','98037','30210',
                          '55173','35517','16000','18463','34400',
                          '83769','61478','83979','11783','69451',
                          '50489','66067','79795','45011','33249',
                          '87500','71342','34687','66018','65518',
                          '85482','72348','44686','57690','30593',
                          '20232','40779','35470','95312','77590',
                          '80812','46755','45614','72854','38543',
                          '65848','42388','32344','60062','25412',
                          '38873','54703','79588','88528','65072',
                          '37481','36959','12767','80367','94482',
                          '36048','48918','52048','34694','23824',
                          '11350','20915','90670','42053','55729',
                          '24765','86592','28947','24887','20750',
                          '55338','86717','32844','98577','64998',
                          '38035','64509','56895','24411','25760',
                          '51425','54194','50741','67932','69003',
                          '76419','90194','94351','55268','64629',
                          '53587','85133','74194','36694','13629',
                          '10533','93159','32755','47230','45853',
                          '37555','61065','99789','26790','74671',
                          '86482','84158','94839','13195','28643',
                          '67930','32813','54845','44030','39035',
                          '61086','40213','62394','64020','84555',
                          '29180','93116','13356','65185','90484',
                          '91746','11344','72130','14588','87049',
                          '17875','52359','92550','84378','16828',
                          '37292','14299','64349','12219','28916',
                          '41585','36688','35019','24835','22490',
                          '34583','21271','65915','53461','10400',
                          '42333','87726','86389','31953','15833',
                          '92284','85162','24940','73730')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
