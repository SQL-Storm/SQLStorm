
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '21129','37033','24959','18352','40395','49986',
                          '30240','27745','93738','86294','90692',
                          '38798','49499','53575','54457','65300',
                          '43749','39659','10819','36865','45571',
                          '60227','25519','81209','41550','23585',
                          '33681','64109','11557','32190','41170',
                          '14152','47826','85754','18434','49086',
                          '66910','47885','74988','14605','74982',
                          '32206','45778','29400','57173','46671',
                          '24653','51158','73364','42884','19446',
                          '26608','22461','37831','52984','23247',
                          '68504','48275','80685','40674','85098',
                          '98874','36659','50761','96819','87658',
                          '71662','93804','77975','45069','18919',
                          '43748','48899','57672','64315','50915',
                          '78073','59656','12800','15782','29749',
                          '50103','43944','45175','54209','24213',
                          '59213','65876','36923','77006','25875',
                          '31865','22846','71971','37407','12984',
                          '32350','80929','21052','33435','71346',
                          '55184','42486','39599','67146','80850',
                          '42764','96839','13350','90919','66887',
                          '28608','54681','34074','72171','45108',
                          '54818','86367','52912','42002','89744',
                          '71680','65864','26995','45888','17982',
                          '33705','72169','25310','20882','95595',
                          '82101','78916','28161','52076','71764',
                          '75978','28032','64697','14385','39314',
                          '86186','47958','21685','60931','32326',
                          '10918','80797','43268','40112','17963',
                          '15459','39726','92895','49547','37241',
                          '52997','39180','50548','13201','19618',
                          '72330','21624','88675','24414','89199',
                          '69308','14822','81293','84209','69513',
                          '34825','49952','72364','32531','66846',
                          '38666','44834','53028','46373','77388',
                          '20146','79727','99515','24575','40076',
                          '23709','31075','79222','17895','82185',
                          '89378','71984','68700','49130','61934',
                          '31664','16484','78000','35868','29247',
                          '22752','23227','18485','83896','32664',
                          '19953','40096','63260','73653','69857',
                          '89885','38930','21015','48714','62632',
                          '24057','33270','57160','48447','23123',
                          '19544','33852','34568','99108','60422',
                          '99854','41894','58454','41817','58741',
                          '62021','31482','58268','66055','41431',
                          '78330','15908','79829','73427','75494',
                          '54962','33519','32024','26721','71389',
                          '42282','15686','64892','10019','40133',
                          '62871','46487','34836','90672','27489',
                          '27938','14620','69777','42160','51494',
                          '78692','24793','70109','59207','80664',
                          '31692','84886','49194','32219','46730',
                          '30100','28580','74596','57603','91135',
                          '41088','49676','18998','63762','23004',
                          '15263','74018','43109','15633','32360',
                          '28345','62974','67639','77649','66293',
                          '29486','84055','61468','41799','28496',
                          '27906','19464','17369','85893','18628',
                          '37208','32310','66860','59228','39804',
                          '81476','55214','23338','97196','39126',
                          '98006','64608','38037','42389','96285',
                          '80621','10383','82256','21201','23825',
                          '28611','58463','50712','64545','82602',
                          '92624','43658','99670','41089','27140',
                          '20287','89526','80004','60343','23285',
                          '61688','73212','57391','62957','15129',
                          '20164','68559','52174','10809','80174',
                          '12313','59546','59381','84719','91071',
                          '73454','33513','50729','31045','72773',
                          '97227','28251','87291','22695','84922',
                          '80470','52305','34183','29512','29952',
                          '75983','52237','87366','32691','57443',
                          '62293','42755','11762','75335','61921',
                          '87795','59970','53296','75010','68329',
                          '36124','33295','82800','52226','67863',
                          '23427','58005','97583','56270','39377',
                          '22234','19702','11599','81877','49976',
                          '34194','68593','41629','13224')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
