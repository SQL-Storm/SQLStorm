
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '85597','95334','56540','57540','53804','86539',
                          '84740','41302','41658','18988','89729',
                          '58391','13891','43400','48531','33504',
                          '43133','27898','60813','65345','88170',
                          '88972','46925','22666','18588','77748',
                          '28307','95738','54065','39958','33563',
                          '88277','14057','60794','16205','21078',
                          '74898','96087','74829','68257','42096',
                          '46100','62381','71720','98592','74916',
                          '10213','12017','66052','63347','37065',
                          '27431','66065','22894','91556','69743',
                          '86527','29170','12334','61816','50654',
                          '16920','43682','49075','15168','62644',
                          '32751','88531','95017','58491','27966',
                          '64125','10743','28525','99250','10587',
                          '41459','38208','98813','71236','71963',
                          '23687','51580','15112','14039','27921',
                          '36470','90068','98316','91199','18138',
                          '37353','88314','60841','36592','39770',
                          '86153','59382','47894','96142','55285',
                          '29847','95595','46242','16462','51319',
                          '31652','57641','78305','80000','35324',
                          '88606','18699','47682','43226','21857',
                          '14307','98086','27950','20707','15147',
                          '57235','73636','18890','91551','91202',
                          '46071','99720','63538','10547','42791',
                          '16666','36374','91723','83917','51816',
                          '49891','22535','72878','45111','39669',
                          '78035','56943','82691','43885','60373',
                          '11663','86079','34137','57949','47256',
                          '67188','45502','32124','58340','78489',
                          '61452','40739','91334','45676','44017',
                          '12863','26221','31894','49580','66001',
                          '54346','21650','58266','62481','26451',
                          '38609','97792','61906','71242','13712',
                          '77810','97757','64508','86856','65615',
                          '64199','13816','24951','36559','27804',
                          '62749','14917','97906','31364','33539',
                          '42440','21980','16105','10708','44835',
                          '75419','96949','70499','21446','22611',
                          '23737','64582','39233','25310','27881',
                          '25437','49123','40304','87039','28310',
                          '17971','69701','96550','14368','71640',
                          '91645','39107','26681','89841','54943',
                          '99256','22936','76807','88147','21079',
                          '83993','30858','42891','13106','38884',
                          '48350','14329','41293','54817','60764',
                          '19214','93460','24239','38560','70841',
                          '53466','15685','95197','19395','43016',
                          '40827','41146','87852','62112','49919',
                          '72609','84262','50501','21202','47147',
                          '73003','39259','20604','79969','35053',
                          '24367','34135','98925','25925','30673',
                          '62720','41172','35331','13051','22991',
                          '54925','10266','55098','55826','28168',
                          '53743','90751','86580','30038','47186',
                          '86713','70924','14320','24143','11553',
                          '47790','55447','70213','49930','66406',
                          '43098','53658','35078','54052','45895',
                          '79233','37048','98529','45071','18191',
                          '79777','55866','99827','86179','85539',
                          '30616','15558','20098','48187','70799',
                          '55514','20365','84792','85152','28092',
                          '42641','71684','80113','22380','56038',
                          '89457','26465','53798','28245','39375',
                          '58115','55991','19947','12874','55519',
                          '53336','28845','13285','16211','95471',
                          '76195','11300','75320','61374','17582',
                          '84788','56577','59140','31739','53427',
                          '23135','70719','39739','85358','70573',
                          '54208','41380','73523','45553','31279',
                          '32624','43377','24496','37863','20052',
                          '10157','29212','17258','51188','36972',
                          '49940','15238','44357','89251','54575',
                          '22294','13453','87213','33101','37945',
                          '20622','10473','24660','79909','71736',
                          '84325','34604','20646','10993','21045',
                          '93455','78441','62452','52768','55759',
                          '85614','22985','94473','44337','85326',
                          '81012','40021','16766','23206')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
