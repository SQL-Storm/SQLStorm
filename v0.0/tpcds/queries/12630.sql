
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '18068','61114','57939','46037','47343','31879',
                          '78874','56552','61204','52924','26208',
                          '12513','45551','23786','60438','96186',
                          '51972','54753','89973','98977','87161',
                          '68930','61585','27267','43335','83370',
                          '42856','89265','45432','12328','31630',
                          '46071','50523','75192','60742','42632',
                          '40391','66608','70324','15078','30993',
                          '78786','75798','68488','62933','12538',
                          '16733','54731','40686','89122','64704',
                          '46611','13305','58593','21736','69476',
                          '71224','25153','13673','13629','64321',
                          '82254','42480','46825','33818','26368',
                          '45711','35694','98059','54889','31967',
                          '95586','53578','82822','13254','55793',
                          '46291','81624','40047','28875','15645',
                          '26182','76163','63960','23863','81651',
                          '42453','60724','51451','93544','87420',
                          '31550','51169','65940','24370','11715',
                          '89909','84926','41569','94774','49284',
                          '65957','31186','52293','55091','38163',
                          '93866','21722','60384','24378','44501',
                          '73518','19987','94884','29856','87839',
                          '72722','69392','95818','17599','90264',
                          '45363','65383','67624','43013','34945',
                          '76046','79042','53236','67625','89691',
                          '34208','39176','43447','60903','92478',
                          '72192','49605','44405','57459','39844',
                          '93383','83751','85314','72725','47207',
                          '12895','64904','90034','94466','48228',
                          '34156','21600','83011','53364','23978',
                          '25065','16369','14379','27655','85805',
                          '45277','69976','46899','25828','14257',
                          '54405','50297','74941','44263','27503',
                          '97280','18122','47010','17738','90294',
                          '18712','34308','25945','16754','42005',
                          '32022','44225','78375','98263','68387',
                          '11303','79868','48459','26475','31626',
                          '20008','93605','43808','32906','75574',
                          '43799','11648','14892','20382','84047',
                          '61007','13226','65374','63866','49746',
                          '11220','49432','36251','29404','55922',
                          '97829','54703','86669','48907','12939',
                          '25066','18700','91031','65559','86676',
                          '77915','11097','37214','49210','17125',
                          '85402','53642','64005','29523','35264',
                          '70550','68400','10985','20194','32859',
                          '71335','30976','18248','67648','43310',
                          '28842','82318','31864','81107','45435',
                          '35334','41490','20509','19373','44123',
                          '95834','11554','53967','93831','11960',
                          '88213','45477','48345','77831','99162',
                          '45128','60595','67968','50940','44905',
                          '81782','67971','48500','27515','91867',
                          '12632','46342','88136','45914','21273',
                          '38647','58400','39016','53859','23689',
                          '13687','92555','14814','44471','42734',
                          '51434','89628','14759','35589','89624',
                          '17189','88994','45039','93107','77652',
                          '42784','79535','28539','88256','59619',
                          '19369','69949','96062','24480','15043',
                          '26683','32886','11457','95934','37356',
                          '55754','12872','58312','57839','20844',
                          '22253','28981','62993','34639','81397',
                          '31348','65680','19313','29603','25990',
                          '57502','11255','75427','73403','26717',
                          '75293','11022','61993','23525','11694',
                          '24593','34442','47696','20514','24041',
                          '47199','10771','48021','63312','74338',
                          '72128','59699','68294','91445','67987',
                          '74100','39820','11131','54406','41462',
                          '56119','28158','83052','73803','69678',
                          '13562','80216','45691','86932','74546',
                          '37095','19585','64950','49407','62466',
                          '78794','29983','11087','79372','24493',
                          '18966','94246','47483','85905','60829',
                          '68699','80403','83128','78797','73500',
                          '40402','26056','43021','90642','46692',
                          '24986','81214','33552','95959','72481',
                          '91921','53507','31212','15945')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
