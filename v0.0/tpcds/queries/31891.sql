
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '76506','74285','99998','56089','20356','80385',
                          '99351','17589','11514','35715','87082',
                          '11267','32828','11940','99021','45190',
                          '89992','34486','27227','77298','66521',
                          '25169','21173','58335','18217','36487',
                          '68585','66167','34034','45575','48574',
                          '62897','94952','61355','21156','30183',
                          '38772','12956','11346','84051','16428',
                          '77023','15758','36179','38896','65613',
                          '16483','85154','29182','58008','17592',
                          '43679','41944','71777','88574','87071',
                          '57044','51674','90114','59182','42271',
                          '48076','79727','84717','55798','82337',
                          '18487','33749','17856','32937','10777',
                          '64524','78997','67487','31165','34066',
                          '95965','62534','69521','29494','33099',
                          '79169','30214','26681','25185','81828',
                          '17436','38805','87406','23172','26126',
                          '64002','18422','74211','74142','24865',
                          '29863','44779','14730','27990','16762',
                          '68602','92817','90171','47433','91534',
                          '71838','32285','38174','34631','71024',
                          '62549','89898','27888','30550','57331',
                          '32961','17707','68306','55819','39981',
                          '83606','94695','23813','85010','53103',
                          '48721','10573','80118','88631','45434',
                          '49631','25361','46023','49909','30383',
                          '29485','55210','36564','94876','11060',
                          '10051','64764','51075','26633','38126',
                          '83622','53443','50347','78451','90489',
                          '89305','49223','33890','60515','51717',
                          '81049','64534','76242','40104','82062',
                          '15732','48251','23983','12669','25118',
                          '69067','53685','69912','86292','91601',
                          '53064','14321','36462','20984','95316',
                          '45056','32830','85077','62227','52277',
                          '43663','66205','29640','10041','21047',
                          '24096','54796','68316','35758','70246',
                          '69852','20680','92649','10343','66522',
                          '25009','23236','41790','52971','29821',
                          '26945','82911','12686','79216','66852',
                          '20410','99506','95465','75240','55483',
                          '37726','90403','70783','45451','31176',
                          '90480','88931','62005','56901','50389',
                          '77903','65060','31725','17834','14893',
                          '83911','15312','10094','71619','27285',
                          '39970','70034','48042','70966','40883',
                          '45650','37461','21084','53974','18189',
                          '54535','16442','88757','94766','14530',
                          '64539','30223','21189','81637','85288',
                          '53429','66362','62145','14455','59872',
                          '31115','75439','30999','94903','98918',
                          '28851','15009','89673','64149','92530',
                          '24420','85776','24554','79316','61449',
                          '34267','31950','62790','97534','15161',
                          '81776','26676','96499','22827','68235',
                          '82201','64944','59195','14062','62368',
                          '19205','20852','56030','81214','27767',
                          '54647','21929','42203','72149','83113',
                          '22956','81142','84786','53550','28990',
                          '22738','90484','91223','98937','11344',
                          '22273','58726','49776','98105','32223',
                          '25376','17639','67844','13771','60336',
                          '22849','86332','56107','45609','26342',
                          '27527','13428','45264','72136','56634',
                          '23261','65393','21351','20005','37796',
                          '28891','99285','34348','11942','50070',
                          '59191','28183','77697','77568','52177',
                          '86805','92456','74083','40309','27101',
                          '63187','21644','32752','39977','14725',
                          '92698','62093','58414','52941','59968',
                          '90760','77688','51027','53437','40742',
                          '42623','59244','12804','85553','40709',
                          '82804','12791','68332','35685','14267',
                          '11188','55952','95741','24126','50453',
                          '23338','33735','50724','65128','13405',
                          '22231','41993','76810','25336','49079',
                          '86983','67307','94126','89068','12769',
                          '56345','29547','80209','57629','35503',
                          '27642','13315','60064','72154')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
