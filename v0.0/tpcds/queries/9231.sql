
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '62474','97448','26277','55815','69883','60492',
                          '64775','40068','81194','33775','54051',
                          '57671','14237','23428','90032','58242',
                          '55717','47775','58670','58001','97966',
                          '31656','28325','69023','60107','36053',
                          '42556','18168','32509','73031','83245',
                          '96948','61402','68734','56256','21717',
                          '16138','38752','36126','33173','61874',
                          '96848','87546','19793','71953','95020',
                          '21875','24965','89619','64181','98826',
                          '71046','86942','62650','93120','89416',
                          '51701','33920','32030','72043','20886',
                          '99852','97555','39949','12099','79127',
                          '41292','24272','20485','19768','30082',
                          '97361','24330','44817','77925','96409',
                          '55738','79386','19659','18994','48206',
                          '30706','14739','13863','26579','65062',
                          '62945','92543','73567','78955','77870',
                          '28298','62468','15368','75862','11694',
                          '22600','97751','66476','15156','18512',
                          '20388','24754','18371','12976','90811',
                          '38842','30309','12203','61310','99183',
                          '26097','25641','47804','19519','15995',
                          '73507','10201','79266','81831','28465',
                          '67098','16454','98983','97574','80947',
                          '13282','56666','80942','90216','85927',
                          '82271','72018','84918','30331','59007',
                          '50700','46091','14024','27811','78219',
                          '56971','55991','17135','57756','27764',
                          '73303','33826','22443','13123','51388',
                          '92476','40554','32300','16449','91571',
                          '56791','47303','77034','28714','36059',
                          '60947','66368','82914','62256','25677',
                          '73430','67260','60218','29251','28190',
                          '53824','83463','99849','83117','57370',
                          '25085','28849','22364','99632','97331',
                          '63115','35011','19769','16045','57097',
                          '94176','46061','54434','30928','13454',
                          '54912','77049','30749','18023','58044',
                          '38108','28914','43583','59680','36724',
                          '19702','21145','38462','13929','43719',
                          '99744','15617','15373','15241','35698',
                          '44095','95131','12376','56234','45058',
                          '22961','39238','42452','57014','85132',
                          '25544','36954','21327','25709','79634',
                          '64544','15386','41793','72808','41776',
                          '12963','64762','25622','38059','10906',
                          '45660','73347','82065','65489','17399',
                          '43082','95106','78750','27581','69320',
                          '22840','23442','10284','60905','10434',
                          '98696','93356','94500','16462','34806',
                          '51653','27523','39323','38844','56111',
                          '83948','46025','21104','57501','38572',
                          '18764','62918','31337','99432','79484',
                          '79153','96161','23640','87753','54422',
                          '62857','23591','38845','78372','89523',
                          '57804','94400','31312','93510','49093',
                          '34309','52088','86856','11602','49260',
                          '67365','33298','85721','24682','80530',
                          '38750','24371','90307','30817','35436',
                          '59787','85043','71865','15612','24707',
                          '17806','73097','21517','17510','20221',
                          '21046','66432','80839','37805','26730',
                          '10617','76598','20788','48193','56790',
                          '22321','41771','85873','30362','16617',
                          '67697','53482','92251','71086','72550',
                          '80686','24811','25163','52302','89235',
                          '47355','92757','58978','88428','43678',
                          '32898','11970','67992','38834','31975',
                          '17120','57341','17016','46403','83984',
                          '19331','98559','69352','47001','67298',
                          '39128','74590','25994','77397','56989',
                          '56999','22692','41401','45558','76856',
                          '69172','38655','20228','56239','51304',
                          '55258','11799','20686','29103','10639',
                          '30274','89089','65987','74055','63303',
                          '27984','10083','18158','74841','30058',
                          '73284','71118','21172','13947','85765',
                          '32388','29090','57401','32561','73764',
                          '64787','59586','35579','11742')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
