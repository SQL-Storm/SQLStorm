
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '81435','59518','18754','28655','34442','68785',
                          '76756','13787','23141','57320','77817',
                          '45261','37752','77967','90903','89852',
                          '31438','35861','37647','23998','15981',
                          '55989','59995','49308','71779','17955',
                          '15717','49208','48746','16142','41218',
                          '96010','13872','14438','53348','40197',
                          '93663','53296','26052','92059','72042',
                          '10770','31413','50542','42531','62991',
                          '76219','56560','50628','87597','90887',
                          '26623','54260','49842','80558','20356',
                          '54771','97236','30260','20036','63356',
                          '73902','71279','70553','89030','16409',
                          '90331','36776','26391','78860','45039',
                          '34342','24712','77429','22786','87695',
                          '56671','58443','25778','24291','67373',
                          '72756','50946','75173','69106','13495',
                          '19672','56529','41723','28038','19717',
                          '38653','33623','54391','30501','15835',
                          '18697','36551','10627','12976','48461',
                          '70436','77079','18212','26663','70343',
                          '16140','46020','41844','57201','88189',
                          '57474','15355','48066','32276','71969',
                          '63227','41424','47800','93514','60523',
                          '74538','35875','81507','96724','84402',
                          '39922','69228','47295','63035','24294',
                          '71037','49591','34750','16279','71766',
                          '85863','82633','48708','39657','43399',
                          '65025','11989','85152','11221','13728',
                          '98445','12117','23413','14628','21293',
                          '56231','44525','18690','24983','36547',
                          '81331','75424','25770','88084','42139',
                          '18323','31597','74874','58500','98109',
                          '54321','20291','65560','22500','47886',
                          '64461','38851','43774','33432','55748',
                          '56590','69723','52371','62025','83273',
                          '13358','21835','27350','27247','51340',
                          '59856','49122','39514','55293','85191',
                          '50381','16383','21370','52206','46820',
                          '35091','13952','41978','80310','82463',
                          '69241','37290','65528','10601','14750',
                          '92669','54766','11041','46976','35479',
                          '52452','50008','98708','10204','75345',
                          '53389','25402','59910','24309','79365',
                          '42677','46042','22902','41110','40538',
                          '63998','66171','74368','25458','23890',
                          '91829','22162','49409','29761','31996',
                          '98936','92844','81304','67692','18276',
                          '43014','62891','26311','23532','97936',
                          '92671','85457','17423','30994','35511',
                          '51576','90237','34897','57640','24457',
                          '30913','49740','26677','78950','20653',
                          '49694','93524','47102','82097','33284',
                          '46260','51256','14265','20057','45626',
                          '50895','77679','45801','47838','32415',
                          '63373','44583','78248','15338','14452',
                          '68273','58815','29353','93538','23876',
                          '18864','90899','85510','82899','32224',
                          '39165','33965','82563','23982','49324',
                          '47411','83171','64160','64990','40813',
                          '96107','61305','69363','32017','74709',
                          '78776','15326','61865','97754','18755',
                          '60219','41247','93558','41521','34930',
                          '16657','26072','27001','14511','77723',
                          '27842','34363','87916','14994','59744',
                          '17473','73192','60155','29715','82705',
                          '11675','43360','98925','43481','89957',
                          '42191','64492','20354','35178','31327',
                          '38322','92458','31329','35828','32355',
                          '84486','42632','91168','97526','54841',
                          '24476','76507','22008','55861','35191',
                          '18918','34279','48977','78555','18949',
                          '40079','70277','14851','46321','48205',
                          '95483','28358','80932','60040','21400',
                          '21146','86759','16234','65824','73730',
                          '83105','56458','36478','87358','67450',
                          '24311','31160','48293','15345','39450',
                          '68911','92817','53953','26944','21707',
                          '42463','26924','36430','25031','94704',
                          '84435','72912','53178','87506')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
