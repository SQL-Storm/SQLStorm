
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '43961','17369','95072','66269','35090','49669',
                          '43048','85740','98700','16755','20611',
                          '26304','64821','70849','90209','57111',
                          '91141','40511','15858','97058','37863',
                          '63703','79069','52243','19665','55196',
                          '13080','63302','40269','47741','84902',
                          '66852','21026','13828','45939','50501',
                          '83575','26766','38771','43926','19278',
                          '11768','12671','91868','61316','44654',
                          '38078','80518','46114','61082','12897',
                          '96009','66490','22611','71302','32652',
                          '49019','30795','14802','73542','59525',
                          '66995','86805','71276','58011','60409',
                          '40471','31107','73359','47445','97083',
                          '77349','38968','27299','16605','93972',
                          '46277','17980','92450','96237','68765',
                          '53221','56398','30207','43682','77482',
                          '37522','57058','64144','59942','20987',
                          '97951','56201','40423','81200','74674',
                          '41158','81207','68770','98186','42411',
                          '23796','65876','86017','43810','45831',
                          '49262','56089','13844','81750','16548',
                          '66906','26840','31262','18531','44790',
                          '41411','73436','37753','16119','40597',
                          '45211','64564','58501','83828','56277',
                          '86700','16061','15311','32290','34007',
                          '36973','78271','23278','25910','39151',
                          '97783','41038','41090','31989','12284',
                          '21612','27767','94898','71842','44084',
                          '88383','76126','50859','14365','13660',
                          '43766','54692','76663','53032','39017',
                          '17503','34891','79673','25803','32113',
                          '86099','28249','13174','10057','24151',
                          '39194','33433','81159','18583','18064',
                          '96307','11386','49852','99117','91813',
                          '29676','79159','73686','77276','13883',
                          '33183','30725','35617','70629','11833',
                          '10746','31249','99809','78373','39161',
                          '61269','41797','99065','53501','32667',
                          '42542','24806','66428','39603','48449',
                          '33284','11698','45167','37806','69578',
                          '55171','67775','27443','83924','15054',
                          '75221','87645','31677','38250','82568',
                          '48006','20569','32803','47864','64535',
                          '84855','81975','78218','39039','72145',
                          '46306','70828','22917','18760','52726',
                          '24585','32498','33643','49882','57680',
                          '25670','59133','92255','58505','96203',
                          '79670','34749','88125','41762','39578',
                          '78377','39895','50912','58890','87326',
                          '13331','14634','51136','61199','97488',
                          '79574','38852','27033','93548','75251',
                          '46851','71970','23676','61659','17130',
                          '15378','48120','38761','24740','43430',
                          '28238','95198','73847','93610','60148',
                          '32881','70051','73073','22646','68507',
                          '34427','25609','52704','13608','25801',
                          '15624','72383','22290','11381','44782',
                          '10842','13485','25485','39217','93941',
                          '50588','24588','12746','41013','11527',
                          '30265','86323','21956','16915','60782',
                          '63500','16257','15440','21995','83737',
                          '60554','94221','64274','19597','13969',
                          '67311','13251','93063','35744','68280',
                          '68965','68612','47712','24594','23494',
                          '18893','62484','13119','99978','88557',
                          '13666','74893','75418','24295','34759',
                          '65628','89493','23544','17454','12061',
                          '14762','40355','91443','74311','22366',
                          '84926','51020','48679','16664','20254',
                          '22041','76700','26880','56404','26199',
                          '78587','17803','21912','56352','32584',
                          '33346','14866','60761','80377','61235',
                          '52313','65308','47086','80320','56125',
                          '34147','21171','30961','29936','29916',
                          '87414','62429','29373','11024','17944',
                          '43956','29657','20138','84695','62212',
                          '38234','18842','11554','12618','67317',
                          '44577','61528','45562','62150','71400',
                          '23126','47705','15981','39865')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
