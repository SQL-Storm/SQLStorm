
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '14069','48543','10909','33729','24694','37482',
                          '10816','16942','71222','32815','37213',
                          '74757','40694','69941','84528','65327',
                          '38683','56190','54873','47941','45886',
                          '66504','74239','75581','60473','80015',
                          '33415','76647','50857','36347','79671',
                          '91550','65205','34081','75865','30192',
                          '13463','28447','40321','20304','33348',
                          '22346','74681','22535','31413','92134',
                          '55031','24020','29512','70572','63802',
                          '25414','86357','50549','52211','47534',
                          '48853','70813','83620','62202','12744',
                          '48266','98602','73290','76572','72408',
                          '67782','87412','65839','14090','32667',
                          '59971','56851','13209','56178','31650',
                          '17812','55112','21957','31155','29543',
                          '66536','17331','42115','90622','67139',
                          '19519','44934','21045','65047','56608',
                          '83155','68442','55873','14039','40959',
                          '32952','70205','27235','88231','77870',
                          '72248','77805','13452','32869','86361',
                          '42830','31110','76299','78797','90567',
                          '75692','26503','41349','63740','45226',
                          '18292','91635','37142','24441','49533',
                          '34420','39785','90842','45061','57278',
                          '31156','87787','87601','53957','13059',
                          '10646','87497','30573','12178','81447',
                          '95928','59614','14471','79084','10596',
                          '28106','11101','28058','45487','55098',
                          '96554','75043','48444','30732','15907',
                          '18550','76574','97353','31206','25276',
                          '81284','11293','75188','73912','13445',
                          '20121','85396','33244','70357','49330',
                          '82010','18429','60033','23928','46741',
                          '68012','88427','21138','51690','43707',
                          '88903','70887','20275','14298','44405',
                          '60501','14230','78517','50565','15848',
                          '81195','54303','30799','11445','75114',
                          '75098','49602','83049','31032','30522',
                          '53821','90976','25870','85124','91226',
                          '60074','31719','31787','60336','41915',
                          '12539','42683','69657','11590','43905',
                          '63606','84765','46113','98362','31692',
                          '25456','56286','81786','25471','30669',
                          '87271','53319','12309','63219','98889',
                          '72722','72881','65175','23186','46623',
                          '25509','58023','33070','54090','67462',
                          '42626','66164','50054','43164','78221',
                          '24640','33472','35409','61652','75911',
                          '43071','74707','96509','46561','32684',
                          '99037','38966','42454','57329','88268',
                          '43829','58764','22581','51182','49782',
                          '36964','88704','58253','91988','31285',
                          '26134','66013','77757','97957','85482',
                          '30699','24762','24433','63171','13753',
                          '62860','29322','41344','86603','30822',
                          '51461','41660','21090','13822','41255',
                          '39304','76411','42285','94312','26423',
                          '85646','55376','69899','30650','88132',
                          '45398','40570','43263','35023','91678',
                          '31610','14749','71559','99134','17089',
                          '77609','51989','21082','25989','48474',
                          '92312','23772','27100','56849','98443',
                          '36331','68233','69214','90755','44270',
                          '39231','75516','42496','28368','58706',
                          '13756','94306','24081','30609','48082',
                          '75252','88577','21416','27708','86627',
                          '29231','47367','80010','92160','58537',
                          '15068','57130','76457','29920','61593',
                          '18810','68255','77042','36975','54527',
                          '61611','46241','42532','93853','99429',
                          '27460','24795','77201','10832','21839',
                          '35416','77245','21539','52139','66402',
                          '27044','50427','39499','23989','64971',
                          '38631','72999','88170','30290','35778',
                          '15413','17150','23310','89656','10214',
                          '84171','79050','14829','18375','20127',
                          '38591','32217','53416','28232','36479',
                          '43148','80420','16903','33177','58401',
                          '84094','59680','28743','71858')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
