
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '97843','27939','22190','55349','35838','42484',
                          '40807','60706','54965','15951','45092',
                          '66007','93307','32297','43806','39977',
                          '15766','92273','29540','66987','91222',
                          '57494','17473','96698','75243','38803',
                          '49944','87483','14901','76339','88004',
                          '66750','37888','21738','56160','47656',
                          '99004','44616','61888','78652','27961',
                          '14001','61564','40390','14193','14639',
                          '15401','86993','72202','34112','62678',
                          '90846','18645','33865','80309','76716',
                          '42990','67125','21494','57367','61746',
                          '95772','90292','38413','45680','66549',
                          '30571','73105','45401','42379','58374',
                          '40976','29168','49148','30353','53131',
                          '29658','22392','47039','60805','65195',
                          '11142','21655','62276','51155','76713',
                          '91389','32659','10527','40085','26641',
                          '13283','76087','89536','11348','42147',
                          '50734','38960','27049','51820','94554',
                          '72292','98291','21620','33608','53308',
                          '27725','20487','96042','13478','62037',
                          '73745','68452','58390','26106','26683',
                          '57288','34914','59507','19358','64490',
                          '15571','62468','55814','38964','61897',
                          '39322','58803','95641','35597','95542',
                          '61377','73738','98482','37278','42545',
                          '24288','45534','12350','44484','54369',
                          '51749','20868','12279','27251','73714',
                          '77880','34071','17888','42474','59516',
                          '30972','16065','90914','96368','81327',
                          '50426','65529','36964','18578','62217',
                          '69099','95417','74504','16113','15982',
                          '35767','58883','73318','43779','92415',
                          '97239','75471','31758','15739','78703',
                          '50131','26017','22984','24549','83357',
                          '39071','65810','67627','33623','79786',
                          '42397','99322','16037','49326','23247',
                          '10902','23813','82234','43898','35201',
                          '11851','48265','54367','79126','20162',
                          '17958','39482','47159','14657','20690',
                          '16905','48980','95727','13823','30005',
                          '85275','19120','16651','20652','48433',
                          '22995','62774','68161','36240','91312',
                          '56601','74057','29587','84645','18885',
                          '68698','69491','32249','19350','60395',
                          '16578','57873','92281','60583','77624',
                          '39585','47993','11681','78979','70820',
                          '86762','74648','17361','17931','83553',
                          '66989','51082','30606','63045','33711',
                          '88562','24868','40763','41032','14356',
                          '69244','46754','18832','21317','76403',
                          '62329','41752','63108','82053','69247',
                          '78161','33169','50892','16567','25824',
                          '74235','60777','48477','67173','24104',
                          '28408','49389','61763','70176','39782',
                          '26768','55121','31483','26374','30643',
                          '15991','37705','64168','78554','35143',
                          '74122','87364','14769','52973','86070',
                          '38929','58821','99972','38133','54254',
                          '60802','32827','22680','37009','33335',
                          '35743','72799','66223','13818','45193',
                          '11599','29254','40330','79225','28649',
                          '46098','76586','41109','66367','43272',
                          '19282','71820','76120','68377','72904',
                          '84188','15667','11843','33340','32725',
                          '59335','59573','96666','10254','86165',
                          '93498','82849','39510','17401','68352',
                          '64602','25679','94416','14360','35809',
                          '82985','58906','57124','94902','20424',
                          '78223','18307','43812','49400','71262',
                          '14218','70068','12051','21028','79350',
                          '27885','42783','92675','19497','29901',
                          '28149','94044','53241','35177','79273',
                          '83690','68676','17622','10021','31497',
                          '16248','55656','29810','58795','55577',
                          '89910','20157','92948','47240','65335',
                          '92323','69969','53207','97537','98780',
                          '76715','71704','47427','60058','30969',
                          '13048','55801','21395','56203')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
