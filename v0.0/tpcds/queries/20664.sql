
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '79473','66515','14092','68982','16532','76211',
                          '45009','45593','99033','35382','86630',
                          '13144','61038','12126','40413','44758',
                          '55351','86300','44480','84554','66305',
                          '62242','23188','96963','73899','44652',
                          '85952','11903','55571','22258','20336',
                          '14660','44263','96560','65803','48091',
                          '89129','20046','35758','49082','21839',
                          '17324','13503','47006','44738','90313',
                          '25350','24259','33209','18488','19556',
                          '63888','43935','90802','22891','17236',
                          '30414','89679','16299','42811','68059',
                          '39880','84884','60440','67877','96653',
                          '42861','53023','10910','98061','15010',
                          '40811','82030','32022','52290','54963',
                          '15079','39397','46921','52968','58194',
                          '77449','23738','73089','47842','41566',
                          '10928','63081','42332','13963','23301',
                          '66228','40036','17075','20609','52469',
                          '74987','74940','68389','54323','61774',
                          '31681','33403','67886','53790','11077',
                          '39574','19285','22825','84497','65566',
                          '83230','22062','55331','44952','38235',
                          '22685','62163','11698','63324','51725',
                          '10353','92184','44882','14950','30996',
                          '34050','57621','44630','79072','56618',
                          '16392','17988','17726','76163','23472',
                          '33272','40889','71280','51012','41931',
                          '30491','17162','93239','36689','86660',
                          '87787','39999','47682','82408','59057',
                          '52327','62347','96606','56771','43847',
                          '61734','92317','75755','53767','23825',
                          '72344','84605','39248','48797','59202',
                          '63918','51007','62592','61551','64604',
                          '52787','25969','86352','89405','43823',
                          '37734','25633','16906','73804','99366',
                          '32320','59446','14194','58346','22125',
                          '81244','87888','25511','79080','84446',
                          '35186','21972','11904','85268','55727',
                          '33648','10241','37953','35539','54887',
                          '33452','20151','52370','28610','86362',
                          '25907','17752','26975','13489','41612',
                          '18209','72007','23937','80009','17310',
                          '58398','94408','20131','24250','57566',
                          '26775','30164','31306','67484','71020',
                          '33432','36988','14716','37838','26504',
                          '89514','14460','52335','47447','98002',
                          '86625','55468','84262','11054','56911',
                          '89731','65860','55237','39251','99386',
                          '83887','88868','76012','77769','42944',
                          '30044','54462','19739','98604','14212',
                          '12973','13481','53183','33326','47055',
                          '21752','54600','89594','18632','64492',
                          '15281','41395','50420','14928','37500',
                          '58341','26159','36450','66371','97712',
                          '26675','51363','22441','14502','86689',
                          '34306','29270','52583','67173','26083',
                          '71233','37338','29411','24906','86504',
                          '35614','25368','11003','71062','58229',
                          '61160','21757','29281','12334','18800',
                          '37774','22510','25722','84866','43983',
                          '20846','60935','36907','85831','20783',
                          '62222','47492','51366','67242','22856',
                          '17555','32452','19579','59331','17384',
                          '59373','18832','84343','13567','17266',
                          '42033','19307','79402','33483','31735',
                          '42975','15569','74673','98559','31804',
                          '59195','12107','25441','56437','22295',
                          '99118','11635','22947','15383','23643',
                          '44717','38922','42609','22968','58238',
                          '40996','83568','48881','49401','50707',
                          '57999','35721','16426','79903','48919',
                          '32082','57262','35519','65676','20375',
                          '40768','36225','18778','67191','80115',
                          '62798','15189','27111','77966','55218',
                          '93578','72674','19944','54902','98109',
                          '80702','72046','54583','63754','64522',
                          '52114','61884','22279','55652','88321',
                          '85707','34324','18558','43057','15074',
                          '13524','34097','28863','61300')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
