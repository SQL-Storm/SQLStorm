
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '25883','40168','57100','16867','87469','63607',
                          '12284','19064','60261','29137','81246',
                          '66725','30726','95128','69433','64714',
                          '71491','20229','92549','66796','95941',
                          '64614','41952','25565','78998','88450',
                          '71784','59746','36773','84411','71610',
                          '83947','35009','74378','16625','25213',
                          '29147','93360','47284','12886','92540',
                          '61756','15483','63351','41753','23022',
                          '41133','77251','72266','68316','19410',
                          '47242','60278','26227','31932','78584',
                          '27005','31918','88677','41452','31659',
                          '81191','28354','76755','48172','20421',
                          '99677','23458','22375','56174','46502',
                          '15715','82072','79200','18268','42099',
                          '24290','94043','77268','74174','80061',
                          '42160','13506','20511','69745','62966',
                          '67810','11852','68253','59449','34877',
                          '34392','66071','36327','92234','28305',
                          '96391','34856','33693','52045','34675',
                          '14800','52276','46373','64873','32858',
                          '49648','86947','75688','43466','21801',
                          '34298','95211','26340','69279','59108',
                          '24113','92292','92393','29976','72157',
                          '21806','30287','43120','18489','16494',
                          '83244','63943','16962','34676','80760',
                          '49504','87771','21021','16416','50659',
                          '75625','69046','32741','48792','97806',
                          '30916','24168','11149','23269','90108',
                          '44189','13480','21838','74930','50007',
                          '90653','90492','66859','18075','48682',
                          '96066','22282','19628','76531','82847',
                          '69500','44018','10584','72490','83612',
                          '74760','35501','51506','93625','67798',
                          '27996','24668','29197','51303','67170',
                          '42966','93934','62224','94795','15144',
                          '36411','50781','89202','47222','21754',
                          '24884','38246','14038','27039','19696',
                          '57755','28047','19880','27506','65562',
                          '44888','40987','14705','39500','35053',
                          '30789','58170','39232','91652','45040',
                          '84530','69049','52802','12104','72464',
                          '34910','70710','46507','72391','25923',
                          '95166','88264','11064','10733','37585',
                          '32599','71274','85023','15022','85304',
                          '38781','56278','72754','36036','65585',
                          '25325','15130','64857','94741','58601',
                          '54545','66654','56784','56349','44458',
                          '58360','27284','12405','21153','11250',
                          '98998','53641','34903','16367','29847',
                          '26508','20901','98530','75603','15609',
                          '24542','88890','76109','54006','95459',
                          '52426','16192','15504','26483','56247',
                          '15149','83050','68195','22450','33364',
                          '48404','94558','19971','14794','74823',
                          '46806','36264','11340','81075','19218',
                          '65162','19063','18976','52231','41026',
                          '25805','81164','38757','33462','38706',
                          '56165','95254','53105','33695','93388',
                          '67271','21792','78940','11390','24861',
                          '93101','30001','73117','21198','25087',
                          '59237','45962','84806','92297','19983',
                          '38756','34608','40280','13882','20630',
                          '75448','67956','11302','40085','10759',
                          '73861','24357','53261','12521','11840',
                          '76846','76495','50989','79100','30236',
                          '67414','50642','42034','76374','24162',
                          '80674','13613','88966','76098','46531',
                          '28504','10452','43078','49901','24116',
                          '67194','76928','44554','91768','46306',
                          '40630','13096','72290','19066','64598',
                          '31517','37121','33729','21074','14678',
                          '83400','64158','38461','49480','88511',
                          '12575','60407','39451','24293','56667',
                          '29253','55124','63950','30517','77869',
                          '93414','17224','10094','68005','90135',
                          '16402','37278','17145','29570','29308',
                          '52373','85265','15888','80592','29578',
                          '99152','42256','33095','27533','56224',
                          '29320','21969','36331','93400')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
