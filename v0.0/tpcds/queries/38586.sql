
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15462','56664','64759','15869','51138','25156',
                          '11469','65198','50837','76457','83004',
                          '12328','81688','49450','32178','80700',
                          '26813','67736','57569','65858','26631',
                          '26423','86080','94532','88665','12083',
                          '83130','65561','50584','18891','12318',
                          '92398','88369','23001','44490','73447',
                          '31581','10282','37678','11684','40668',
                          '68687','54296','57766','86285','63970',
                          '78844','59542','19053','59043','69931',
                          '44473','28239','87392','66557','46191',
                          '80692','41899','66318','52775','91783',
                          '70439','47119','46428','57357','49379',
                          '13351','60158','55725','91919','51032',
                          '48060','65253','23283','33606','19959',
                          '97967','48932','45831','74119','29159',
                          '65897','25821','13149','78077','58363',
                          '87517','48592','58330','15966','11099',
                          '43399','67494','94659','70881','15977',
                          '62557','73332','51040','18002','15660',
                          '57987','43645','23430','57109','67660',
                          '33671','75206','53364','16965','14415',
                          '58607','11571','55939','85221','50492',
                          '85786','19336','81074','64982','84086',
                          '36670','10557','96096','37227','11056',
                          '49652','22738','92412','67376','27617',
                          '39813','65817','38517','88180','83888',
                          '79698','85138','63131','77680','58478',
                          '34622','94332','34855','87553','39235',
                          '72230','38350','46733','25091','79597',
                          '83044','26019','21455','50767','83283',
                          '86272','96779','34462','24597','92709',
                          '92742','65746','49554','54324','62375',
                          '49629','99179','46596','53282','44999',
                          '24932','28872','22954','49859','42626',
                          '16560','34915','11601','82165','10369',
                          '43907','94948','31137','70220','32015',
                          '35848','57298','41615','36138','82239',
                          '20909','15299','26041','60399','66043',
                          '47655','94795','45106','18209','55863',
                          '70716','78429','39600','68522','14103',
                          '29528','88215','38330','92571','75960',
                          '61915','23641','25191','92370','61973',
                          '48008','63317','79831','29232','89862',
                          '33505','16827','76362','45451','34236',
                          '24024','29061','52341','81243','46750',
                          '54436','48466','88660','38360','93146',
                          '90943','61045','21813','16833','19223',
                          '37368','72017','12191','77212','35340',
                          '85333','11425','31372','80664','31197',
                          '49460','37876','90845','74227','99414',
                          '88415','40127','57176','34445','91450',
                          '51965','69266','30493','15147','20257',
                          '70199','94764','26793','56999','39850',
                          '81605','16753','67461','45271','48747',
                          '19348','73341','38850','48030','44668',
                          '81272','49840','36296','38115','29967',
                          '24686','14715','63541','82073','11242',
                          '68822','42733','74647','72876','68440',
                          '24202','98368','49165','65482','31396',
                          '41291','28475','16028','68498','98982',
                          '55143','76286','54234','31508','65863',
                          '69579','46082','29971','50681','36188',
                          '49425','44398','46971','26766','57419',
                          '26769','11188','30730','19171','14730',
                          '35200','41586','90585','35869','25577',
                          '92163','51129','27376','18541','14378',
                          '92938','47727','24639','18724','32238',
                          '58150','17749','28462','79668','19955',
                          '54819','24957','40289','22287','81440',
                          '17202','18789','75641','53737','20562',
                          '23978','35814','31289','11531','75367',
                          '31446','22998','59553','52820','10799',
                          '36841','93833','69202','68616','65097',
                          '74120','75773','35564','64426','10685',
                          '47809','33420','23255','78999','31361',
                          '65648','96731','20648','16036','38864',
                          '81743','65988','76841','90761','66130',
                          '61436','92206','76859','12309','36300',
                          '37815','38598','53859','18553')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
