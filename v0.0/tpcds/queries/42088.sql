
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '25591','17767','13328','26871','15363','65831',
                          '49652','21643','31450','40347','70934',
                          '39787','13093','11733','29258','51535',
                          '26102','76034','30191','22941','14174',
                          '27629','75603','75591','71415','24021',
                          '79835','16031','15027','27698','22514',
                          '39527','27176','39025','12878','62998',
                          '21041','51866','89804','95352','19375',
                          '28058','71354','96842','21906','38970',
                          '27924','18297','20303','76773','22858',
                          '49404','18215','85306','25293','33604',
                          '20823','35150','55793','15697','99421',
                          '49818','35045','55193','24547','82458',
                          '55988','26279','68985','86078','68262',
                          '99828','79248','54874','35478','93310',
                          '16494','10185','52664','39587','34197',
                          '21201','24056','19138','10186','79305',
                          '37418','91686','22485','73354','76166',
                          '14946','57642','26658','15308','81825',
                          '35195','49496','69344','10689','46405',
                          '53663','15763','90737','14230','34654',
                          '10119','70720','54878','56886','72822',
                          '46193','10027','21025','37282','13630',
                          '43425','50021','19917','31022','24951',
                          '43408','61292','14708','81767','22870',
                          '15969','78388','16059','92258','45808',
                          '57247','51528','78232','78250','33671',
                          '29021','19578','22901','88587','79001',
                          '20959','67706','98684','43998','62338',
                          '40554','28316','98965','69665','64468',
                          '28631','11354','14544','85473','27938',
                          '75871','78743','98913','75406','23679',
                          '38626','21699','93621','12704','37567',
                          '89286','42312','70709','76029','22400',
                          '38609','71284','27086','98414','68264',
                          '74029','49887','79967','43282','94280',
                          '22888','29447','11587','93430','68991',
                          '16706','84431','91995','89032','49435',
                          '41419','80622','44626','15092','76006',
                          '59967','11715','20446','36545','64594',
                          '30522','68150','35793','13832','76027',
                          '17380','53532','77200','52241','97011',
                          '33071','54620','17216','97702','82143',
                          '58870','12855','20854','78476','38685',
                          '90647','17992','25364','11982','10802',
                          '23763','27471','18458','14118','39209',
                          '50490','40316','33339','61910','90055',
                          '69734','66608','51719','44372','93760',
                          '92830','22756','36001','16870','47847',
                          '85276','75812','34358','56970','92677',
                          '72656','40758','60482','53557','69517',
                          '38500','78325','40282','34017','87466',
                          '69323','51077','46682','16712','17193',
                          '10244','94993','30532','40733','44622',
                          '22392','15034','19782','47890','43756',
                          '58395','27178','34583','71026','16933',
                          '24960','92877','99261','10947','10834',
                          '53202','84412','49478','53881','24537',
                          '32230','85974','55908','65052','13671',
                          '18164','78668','27242','37816','62758',
                          '31462','58969','33106','61186','89620',
                          '49931','13797','30293','52553','93725',
                          '52659','46395','12100','28268','89441',
                          '43240','63578','56840','99787','56873',
                          '87165','11891','76851','59784','40167',
                          '23707','16734','35663','18277','50769',
                          '66041','20091','76951','28421','98052',
                          '76420','57060','18294','47054','49651',
                          '35459','54188','50038','80682','40365',
                          '47542','46943','64831','20946','88500',
                          '49239','72048','56637','99395','34024',
                          '48839','57187','78908','51413','32853',
                          '28548','45463','14010','36556','78173',
                          '63571','98547','80491','90968','50190',
                          '17163','64538','11912','98690','20591',
                          '11955','80698','99391','98078','28403',
                          '76894','59039','62858','43012','41933',
                          '72553','92096','63320','66374','69402',
                          '83598','28325','12828','26478','32731',
                          '88043','65514','97074','18662')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
