
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '10149','46560','78324','81439','80427','80713',
                          '31945','31454','70542','75716','65372',
                          '85059','27032','62581','14550','13630',
                          '56561','92322','28603','87558','75291',
                          '96596','32966','20839','11925','39136',
                          '91280','17887','22321','71469','52010',
                          '81073','73067','30610','17166','20025',
                          '46763','73771','14725','82069','43210',
                          '13021','16297','10313','69809','58144',
                          '43867','38410','80273','21265','51204',
                          '57635','47584','60841','91930','58218',
                          '79822','68579','70660','50910','94844',
                          '10036','37542','10320','42174','70655',
                          '16789','80810','92342','78264','99628',
                          '15709','87877','31296','39905','55706',
                          '64993','19869','38731','32992','96565',
                          '82961','60609','10303','30279','15466',
                          '82605','25309','57218','69639','98694',
                          '55368','75370','96839','94954','33384',
                          '78334','54899','70006','94778','53500',
                          '19568','10759','40624','26776','73735',
                          '19805','93495','59298','92216','93356',
                          '84227','48705','35517','69754','55293',
                          '27741','20052','88526','12152','19479',
                          '12018','71344','41171','43430','88962',
                          '38161','11055','34476','26785','26144',
                          '21388','26821','57513','39667','54789',
                          '11918','85489','95000','89391','42899',
                          '24466','18925','40849','41123','26706',
                          '42862','73597','90595','79454','41811',
                          '51828','11673','31910','92479','70663',
                          '75918','46075','99382','13883','59521',
                          '85601','13230','50140','14491','63800',
                          '74227','64165','57422','26645','26114',
                          '58877','11881','27112','42823','21802',
                          '29150','89675','78866','10964','62263',
                          '84031','37052','29888','12055','63846',
                          '51355','14634','63802','78892','34273',
                          '91427','57618','82000','36266','85387',
                          '12485','68802','62624','71301','77500',
                          '11038','31179','45069','17604','24883',
                          '43111','89100','10953','71460','29680',
                          '13758','46218','24274','68594','18495',
                          '37261','52786','52957','58797','74527',
                          '23638','22484','16588','13079','91240',
                          '18002','83814','59346','12272','49869',
                          '26934','15316','12462','45156','57515',
                          '85358','26824','34381','84580','66498',
                          '32489','78484','51206','46429','27526',
                          '78100','29644','66086','97968','68481',
                          '87706','50395','63381','46066','73223',
                          '39417','93486','11975','21292','23001',
                          '64122','44397','37961','98144','78225',
                          '67658','90279','58082','70222','34902',
                          '77717','27166','58569','78288','66522',
                          '51766','94531','16354','49610','41619',
                          '26853','36463','18660','35903','40492',
                          '23763','85887','65156','80306','70769',
                          '14737','94122','27888','53803','56823',
                          '10956','20161','50435','45313','42793',
                          '64346','97715','52033','17942','88159',
                          '22619','55799','83979','13972','15245',
                          '12340','57679','51360','55912','81391',
                          '26951','73450','14627','62140','31287',
                          '11233','67171','34104','85947','49623',
                          '47487','62371','17149','77798','44952',
                          '43277','10706','34793','37903','11382',
                          '71976','82591','45903','28362','81946',
                          '20749','33044','43065','50817','96712',
                          '30774','70749','72136','90323','52103',
                          '68896','15888','28544','25314','13442',
                          '64603','51357','17453','15126','48574',
                          '87685','91621','18710','48833','10581',
                          '31299','65994','58913','53211','67835',
                          '44925','28505','90936','53382','63541',
                          '90449','16468','97567','96099','68410',
                          '64099','68418','31348','17182','48680',
                          '69721','34521','25645','90045','54717',
                          '39784','25332','77229','80662','53175',
                          '49660','42727','68306','46555')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
