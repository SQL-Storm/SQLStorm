
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '74143','73782','90868','94254','21957','84716',
                          '38057','54877','93760','43559','48774',
                          '42331','10053','19487','98982','38700',
                          '52929','12505','31191','64489','88722',
                          '37523','60899','92900','24401','22949',
                          '27583','24474','90131','17140','52559',
                          '56339','46554','19343','32243','41188',
                          '86341','92790','17871','29389','99852',
                          '23784','12816','55623','45850','14055',
                          '14269','11836','34778','40723','26418',
                          '58071','78522','11924','25955','57479',
                          '28164','35512','72565','61885','77524',
                          '14082','44857','18374','94373','71072',
                          '17310','54280','51559','20926','29626',
                          '65924','19147','18144','39060','23839',
                          '88051','19688','35349','79966','50067',
                          '92104','62432','74940','15459','39885',
                          '74942','56344','64178','18560','44523',
                          '11259','95948','18626','54228','62287',
                          '97346','43407','38124','78202','89193',
                          '79211','16724','23092','21966','37363',
                          '34552','68898','12418','43352','74034',
                          '37540','19164','51640','82604','28525',
                          '73366','61760','73788','17966','26564',
                          '15955','81439','39713','14731','15112',
                          '18334','40728','68353','27016','73230',
                          '74423','26076','16488','67397','23529',
                          '64628','61113','47238','84741','62675',
                          '19754','81679','65213','96290','26401',
                          '62168','11337','41208','33816','55829',
                          '18893','56705','30947','78751','61620',
                          '70833','80540','77338','66016','68698',
                          '83282','75870','59470','28689','59637',
                          '55686','25570','65208','73290','82210',
                          '53007','97112','74089','91159','18011',
                          '11364','14976','36288','67917','74391',
                          '44999','62829','34794','42524','46716',
                          '21764','97926','74175','18654','39790',
                          '57449','18273','86420','92313','75951',
                          '16685','26482','30441','46870','41088',
                          '58032','44116','56952','15903','44417',
                          '28334','25683','10993','13441','72362',
                          '47386','11626','92045','45581','89422',
                          '99079','14465','68342','88426','19545',
                          '66391','19558','81305','30396','25929',
                          '20493','91922','73924','28867','18227',
                          '80182','37127','26118','65114','31605',
                          '11988','43548','13079','14872','26994',
                          '70287','90009','37891','61458','41726',
                          '69574','77644','44347','99919','17307',
                          '77447','91415','42885','64194','73989',
                          '86114','26259','50345','21242','37201',
                          '17760','47101','59620','80452','61548',
                          '89752','91767','40346','35293','50819',
                          '22947','25657','92517','17491','35549',
                          '52461','12935','73615','44384','99199',
                          '59463','30464','42839','89979','33514',
                          '77947','35847','24735','37171','19179',
                          '64620','85157','66519','74763','15897',
                          '30467','72827','51585','50121','71614',
                          '38665','41836','17904','19428','33990',
                          '73627','82753','52412','87093','26061',
                          '15000','39758','13769','23538','31886',
                          '10781','34323','40764','19432','25291',
                          '74990','69138','42046','56442','11183',
                          '16771','35295','15477','66786','16906',
                          '87411','34027','43348','10752','53273',
                          '57080','51298','83942','34899','18510',
                          '91303','29937','97730','37720','66601',
                          '81470','96812','81418','25000','63311',
                          '63811','42062','19322','20427','79553',
                          '22943','20271','69157','89373','42923',
                          '12668','35103','19353','13773','78101',
                          '46771','54900','81966','41744','66587',
                          '23249','21025','71099','58042','18238',
                          '89861','20394','31834','12565','33798',
                          '61331','88145','22967','76694','43790',
                          '24875','65703','91469','31501','13272',
                          '15774','19462','46565','77641','37702',
                          '64288','81125','35513','31558')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
