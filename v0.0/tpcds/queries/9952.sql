
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '93139','47160','97597','10764','27484','21800',
                          '26568','60786','54943','52340','35462',
                          '59021','16352','39125','93106','17002',
                          '64164','47057','33622','20852','12289',
                          '35420','79562','18653','67313','57204',
                          '23389','18342','15881','40051','37728',
                          '74203','36394','24888','59055','78606',
                          '54145','43009','92803','27587','28073',
                          '72521','41410','41551','74733','23464',
                          '36492','19146','20604','88512','55706',
                          '65835','99517','11959','22573','59170',
                          '87760','99304','23261','96253','47748',
                          '17916','16331','80016','64629','92691',
                          '42964','95261','68696','55809','29654',
                          '39641','45764','50602','43166','11629',
                          '39338','53081','97269','94317','47825',
                          '79929','59265','79582','65933','43379',
                          '33824','94946','27923','32516','19164',
                          '13850','24880','25136','31669','26364',
                          '94883','31093','23844','27425','32643',
                          '20690','25129','29612','59201','44157',
                          '74782','79954','51895','21936','44611',
                          '70873','87242','48452','84824','94341',
                          '72494','96746','29098','23686','35174',
                          '17637','44059','21245','76424','38736',
                          '35133','85409','49589','86282','80183',
                          '33844','57667','46967','22677','33951',
                          '86211','78275','67806','75820','62107',
                          '39243','42680','55617','46378','42216',
                          '31151','34360','25203','40603','84773',
                          '39195','11675','94436','19758','53659',
                          '18313','12267','26303','12967','42329',
                          '34272','53658','97006','71085','52359',
                          '27983','52178','18265','50237','71456',
                          '31873','28311','81260','76738','66726',
                          '22763','11990','85918','12061','16564',
                          '38073','88272','15313','78002','42454',
                          '57336','73748','13013','86457','71578',
                          '72910','90354','22886','66982','62641',
                          '21418','62886','72551','10246','47455',
                          '99508','46853','87640','19037','10636',
                          '98524','46051','36946','63555','37869',
                          '33952','84811','36995','10490','18041',
                          '31579','17713','94110','12790','32144',
                          '19200','18616','64948','69966','89160',
                          '95998','60464','27428','69228','14718',
                          '45305','42497','33406','22565','48447',
                          '50202','20683','52925','13103','25245',
                          '15440','14851','64855','97066','78554',
                          '12509','43692','18312','75323','58738',
                          '22325','85334','73531','79304','85147',
                          '86239','14027','53333','88148','21271',
                          '38994','27434','49130','15179','84581',
                          '91669','93816','87329','65576','90100',
                          '37555','48356','22146','91932','93405',
                          '94462','82587','39959','57771','84155',
                          '19955','30482','99206','71411','90510',
                          '59739','81213','44330','40901','60677',
                          '93304','31503','64375','31321','74312',
                          '12201','57907','80058','16944','98990',
                          '43616','51736','53422','41472','74428',
                          '16047','14170','22009','49947','97350',
                          '68465','41261','17472','77738','53816',
                          '14895','10562','83140','23516','37169',
                          '55021','92183','57233','38635','68839',
                          '79089','32218','88502','58006','57021',
                          '69758','70271','39038','78970','79380',
                          '27215','97970','78627','36609','10281',
                          '64128','60043','16191','87180','24437',
                          '27535','25792','47462','45883','91950',
                          '72855','43336','38124','73282','42409',
                          '78098','25637','30185','74679','25550',
                          '56574','36456','10592','35236','13001',
                          '37398','21166','10790','13479','85412',
                          '70143','66897','51067','48064','72116',
                          '69462','16865','46765','78398','21771',
                          '17485','22822','60518','52924','75142',
                          '97163','26683','43582','23659','42779',
                          '52009','40829','12323','35393','82942',
                          '15841','43269','88060','46662')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
