
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '48995','59069','30831','69467','11038','42054',
                          '61656','51291','21636','45573','99505',
                          '54699','50309','77954','54060','40937',
                          '24434','41614','58320','37949','91898',
                          '93786','31791','60010','17504','57254',
                          '30051','43594','61975','48748','48777',
                          '99548','90211','42363','82982','45874',
                          '44231','32770','22937','34830','40904',
                          '37316','12653','24829','14079','18426',
                          '25711','40563','25430','17994','36658',
                          '81551','58665','45829','14009','67359',
                          '38492','76325','54373','25652','78278',
                          '85336','58509','84356','55520','80569',
                          '55353','61847','33749','74876','11354',
                          '64440','22478','67104','29380','91243',
                          '46154','81104','18911','95843','30275',
                          '38733','15919','16550','94379','82441',
                          '42312','52825','46727','43000','80966',
                          '14982','27993','12012','70832','31353',
                          '62194','87990','84210','76551','23321',
                          '80521','59131','66834','48067','71272',
                          '10030','31511','48992','80993','67251',
                          '58610','52123','23246','55185','99613',
                          '82882','51432','13999','17807','19984',
                          '49011','16656','43666','46743','68310',
                          '61507','71164','53236','69377','53401',
                          '95911','51136','36250','19175','90301',
                          '31904','75400','56599','97021','49989',
                          '46152','16052','77700','18795','48473',
                          '23905','69162','21295','28887','36877',
                          '95260','80947','35925','34401','21147',
                          '88423','13982','62537','75317','13453',
                          '18583','17027','60739','18279','38791',
                          '45279','19382','81010','99584','27553',
                          '92960','22041','72436','85827','29097',
                          '64934','49082','51793','86599','25247',
                          '22326','37409','89085','82617','61909',
                          '11719','57495','21838','81559','54790',
                          '34912','48488','67780','85110','57722',
                          '65144','42773','33855','71526','59662',
                          '94411','59535','15338','80658','97675',
                          '46882','32568','16564','90752','74513',
                          '57211','34492','12663','64263','55621',
                          '18246','99981','55344','27405','16704',
                          '31499','25808','81380','24834','52021',
                          '75407','20351','25294','70528','89076',
                          '75692','27005','99693','91723','85360',
                          '38655','31750','25174','55702','65338',
                          '49679','13355','91451','61896','53487',
                          '19297','17855','31187','67480','12022',
                          '46780','18726','25524','46748','88018',
                          '77901','22002','97383','48626','67935',
                          '85458','25847','45063','88481','15503',
                          '92973','36021','23727','83439','14493',
                          '17881','24965','85729','74421','70455',
                          '60836','14758','54806','69845','13949',
                          '50013','27132','81206','93112','45298',
                          '79790','14795','39073','21721','18211',
                          '77534','40387','19276','39402','86366',
                          '92858','14991','43777','36715','14025',
                          '52590','88925','18708','71016','49311',
                          '12582','21681','41901','13985','78657',
                          '96943','11103','24197','71145','40956',
                          '26497','61313','13215','36850','73812',
                          '49218','33567','16225','23039','58928',
                          '33825','83529','51558','20642','30266',
                          '94572','16889','68778','12816','34746',
                          '27230','90805','32895','42286','27600',
                          '22429','34227','13967','49808','47122',
                          '15485','75520','39804','20711','12543',
                          '55676','30436','37196','37341','36131',
                          '76558','13125','20494','28148','23685',
                          '71283','90722','12851','73255','31607',
                          '57914','56447','20954','36244','81594',
                          '99383','29638','30524','34733','41831',
                          '50519','13114','26983','10601','64922',
                          '67992','95932','63053','64344','22495',
                          '52960','87648','42714','75689','37946',
                          '94898','48721','51614','75663','26871',
                          '34916','97165','47164','11120')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
