
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '74618','24550','30561','16863','14050','47359',
                          '57992','60490','36321','53951','42470',
                          '40346','81635','71334','47071','49008',
                          '46844','38572','65614','75486','30376',
                          '18964','78538','20221','56604','99563',
                          '88582','56022','50975','33361','20039',
                          '32177','10547','41379','51647','86253',
                          '29547','43534','66389','62827','21999',
                          '13318','64500','43038','78396','57621',
                          '68003','40483','54051','51151','74123',
                          '53913','30302','38955','77023','72545',
                          '74422','70686','92200','85151','45696',
                          '61563','32309','41513','65436','23974',
                          '82631','34910','77856','13055','81833',
                          '68230','27652','20851','50342','20354',
                          '41656','86948','60367','23798','11845',
                          '34878','91961','62441','30170','68114',
                          '41418','44781','30250','98821','70348',
                          '63604','23537','50156','57955','64854',
                          '17803','56763','94728','17960','25903',
                          '65041','32776','15964','36272','94580',
                          '44949','36609','71398','76758','52065',
                          '12341','73116','78766','46673','65734',
                          '53671','91896','66696','27799','26461',
                          '38860','59922','42911','75615','62402',
                          '34769','13149','73538','51046','13262',
                          '66338','70350','65631','26363','24401',
                          '46140','29749','16169','41806','66465',
                          '76586','43966','21816','55588','22790',
                          '45463','50200','81260','23754','49877',
                          '80447','84236','23133','19050','53498',
                          '10505','13828','24313','86534','40233',
                          '65136','60455','54328','10179','45025',
                          '16333','42315','78636','49743','34145',
                          '70572','40859','25323','60621','18039',
                          '64498','30166','64142','57670','49033',
                          '68522','65808','71485','69201','13827',
                          '30412','18867','69565','24788','53465',
                          '74301','22908','93503','14867','13364',
                          '89396','82995','33971','30318','13698',
                          '92042','97862','50028','62612','71909',
                          '26220','27077','23223','38234','31618',
                          '50237','45155','75561','70200','75202',
                          '75810','35547','31469','61447','35014',
                          '32838','26693','71807','48104','20317',
                          '57969','18899','91884','92155','99917',
                          '29016','48713','79491','25831','16350',
                          '44065','21403','24718','96284','39521',
                          '15876','18080','73403','10262','34511',
                          '27344','56454','82249','25235','31217',
                          '94929','11803','12348','35573','57804',
                          '27612','64231','26694','80280','34734',
                          '34209','99182','51574','55267','28115',
                          '26553','22054','80007','91187','69734',
                          '19934','33761','15369','48048','37012',
                          '11656','63475','52108','82677','85348',
                          '11245','85249','13103','15286','74351',
                          '59827','76694','60636','42542','81680',
                          '20570','83268','14150','15222','10460',
                          '52548','44888','41320','49932','70564',
                          '40534','23351','52793','40696','50039',
                          '21691','93147','19085','49887','26921',
                          '27644','10336','28707','63752','58089',
                          '49620','13729','14422','35033','45870',
                          '44238','97725','52107','80614','85349',
                          '42987','40750','89079','48742','32460',
                          '64574','54840','40684','35081','72455',
                          '69265','48635','29366','53222','49947',
                          '46710','63344','71272','56373','23579',
                          '82003','95642','58877','41845','94936',
                          '72678','22683','90798','20799','44314',
                          '22373','21795','24926','80989','75503',
                          '30565','25477','33073','16061','33846',
                          '30254','65121','19398','11796','48783',
                          '72071','76235','83093','77044','11289',
                          '22237','51359','48325','13919','88472',
                          '11903','67637','49531','32324','51921',
                          '59358','16464','52710','76424','14387',
                          '95563','34244','83925','41529','66778',
                          '90158','40303','78124','19162')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
