
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '89894','75048','16970','44247','97937','10511',
                          '62960','91353','90412','45458','43250',
                          '16991','49176','87397','15820','81592',
                          '10421','90388','17231','22722','90548',
                          '79548','30601','25710','93454','21783',
                          '29272','27715','38492','39272','32260',
                          '89567','45506','33776','48020','16296',
                          '12759','32134','94149','12275','67358',
                          '38946','30706','14812','72503','42074',
                          '91472','43994','27679','36172','99509',
                          '40751','48210','15787','22101','16363',
                          '68939','66844','55585','11347','21403',
                          '89566','91110','97467','95117','54209',
                          '89505','33910','58256','14700','25035',
                          '92113','41689','87998','17352','89347',
                          '91078','11597','29937','29752','75239',
                          '21110','36316','92286','30455','15773',
                          '61669','40461','32394','21430','23289',
                          '38189','86979','31732','44066','83427',
                          '82888','20289','22609','65797','40901',
                          '69280','32011','25198','39425','21749',
                          '48289','13421','97142','38476','52359',
                          '60798','36933','24827','50763','26843',
                          '35664','48843','73791','81415','93622',
                          '14500','24349','87882','45162','54752',
                          '90104','18341','31903','17941','72809',
                          '13345','48837','80103','74876','83886',
                          '29199','90637','28062','12032','78963',
                          '12139','39433','94203','73325','30632',
                          '74017','96864','73669','13139','15551',
                          '63785','71575','40731','56971','89595',
                          '50733','43557','26648','12997','26678',
                          '14219','84686','75458','56118','26334',
                          '28630','31216','28255','15341','87712',
                          '92780','39966','65398','46667','44505',
                          '95346','33986','45117','59881','15743',
                          '50795','14604','95363','13659','47502',
                          '79362','85432','14861','44649','85837',
                          '66289','36418','56848','29681','11420',
                          '23950','39920','25183','61867','14811',
                          '14387','35904','60443','78934','53349',
                          '21071','20735','52634','30749','76777',
                          '27064','61560','51385','84723','40200',
                          '16908','29355','81214','39506','96910',
                          '99325','58979','17771','60112','15871',
                          '18876','46784','46801','35356','25030',
                          '34719','95574','55120','91536','53295',
                          '18168','58645','53019','13932','39261',
                          '13844','10630','29291','41620','83527',
                          '30526','24732','47535','23549','26766',
                          '34847','28044','55340','18524','93231',
                          '51132','27329','39608','53161','87373',
                          '57638','19490','88703','95816','76120',
                          '60083','42932','26778','45087','71373',
                          '26582','89137','55146','30886','18970',
                          '81553','78136','20878','76499','40878',
                          '78533','92356','73446','40154','14129',
                          '23175','20101','75877','28143','62495',
                          '45643','65383','67816','91711','63041',
                          '65753','37898','32167','65739','10477',
                          '20355','12864','46953','51508','32380',
                          '92520','49856','25639','17229','83675',
                          '91827','85661','59621','36597','87514',
                          '63981','72493','52057','95545','88859',
                          '65675','60822','85921','71522','36746',
                          '36675','19965','28191','52767','28173',
                          '12409','34212','57486','87972','43612',
                          '38187','20088','17444','74190','68539',
                          '56338','58575','10620','64518','95633',
                          '67431','66033','65851','50990','53975',
                          '62391','66256','98356','42451','82385',
                          '65538','37028','89979','47968','51195',
                          '43497','42085','77474','17814','68681',
                          '36490','61621','61761','30728','25217',
                          '12489','20938','38898','43048','50014',
                          '11471','79823','64396','39017','11063',
                          '69933','11752','65764','73577','58788',
                          '16261','28558','46103','60758','68097',
                          '74255','75134','66469','58638','23169',
                          '47194','43871','79438','16957')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
