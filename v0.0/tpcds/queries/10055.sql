
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '77750','27190','12712','12464','33425','76968',
                          '79181','11642','51483','29103','19881',
                          '54266','52646','36554','96831','77358',
                          '65179','89878','20037','94503','64352',
                          '72296','64128','31764','10763','57221',
                          '29623','11465','86315','56516','20760',
                          '36468','72417','18182','31709','30377',
                          '40305','18586','66290','66268','39284',
                          '73603','43871','13188','39399','68903',
                          '32813','14396','10630','13359','10765',
                          '57884','25069','15748','39110','32550',
                          '95305','61365','38827','54128','18563',
                          '45096','11637','18888','57397','15789',
                          '94944','34054','64913','93043','31049',
                          '24742','43802','38366','25798','65626',
                          '41442','71087','41214','55464','41731',
                          '42239','17798','50748','73779','68121',
                          '69749','83758','21901','80660','56196',
                          '74843','75333','69595','23572','98763',
                          '37878','32497','33557','25911','17161',
                          '59820','51736','22038','94374','48352',
                          '44776','18373','17111','52115','77595',
                          '14597','93518','45523','97594','37521',
                          '77697','90807','65018','96663','60096',
                          '23058','26630','23861','58705','63771',
                          '73933','66156','50156','20603','70355',
                          '48419','34213','35750','47906','80580',
                          '57959','99937','40657','14576','68306',
                          '25496','26145','90899','42909','77853',
                          '65052','39444','17542','65195','76200',
                          '69274','30718','15023','20152','40759',
                          '95656','91654','97627','15890','61785',
                          '59222','47171','11909','75157','19145',
                          '19482','49165','38488','39193','34753',
                          '93989','68533','74825','83206','89886',
                          '34554','96476','95521','12285','63761',
                          '51156','32237','50963','43523','11582',
                          '21940','82270','15966','89784','20986',
                          '59895','32642','10621','16862','14313',
                          '68353','67169','86606','44972','68823',
                          '72674','24432','30216','89509','95260',
                          '27038','15889','16778','14301','86407',
                          '65267','11056','36458','48143','67077',
                          '36466','55922','96913','20558','52678',
                          '26751','63096','17099','88858','13547',
                          '90357','94316','67550','29727','68599',
                          '11423','97912','12171','60400','47457',
                          '14665','60250','66803','96738','17139',
                          '65599','61965','18112','31504','70781',
                          '87222','16023','51336','69971','38064',
                          '34580','76128','31964','29959','88064',
                          '12256','49569','45200','45170','66555',
                          '87563','16073','23771','15369','12325',
                          '34390','16624','26256','23673','29620',
                          '80525','92421','27444','43089','65368',
                          '11654','13372','38303','63332','36263',
                          '11827','20681','49061','33492','82662',
                          '56961','94671','23848','81909','18479',
                          '59250','56318','62392','17354','46803',
                          '49414','23233','13081','83062','15790',
                          '24404','44217','96726','73159','19826',
                          '73631','23525','77318','55918','72869',
                          '93791','92900','38329','98392','75402',
                          '58526','58280','87328','61417','40962',
                          '13251','82674','91802','24754','21278',
                          '75665','23142','94409','42933','21208',
                          '43707','95878','10651','87209','89688',
                          '82318','62866','93032','11964','20878',
                          '37495','66098','76617','52259','11526',
                          '25651','30303','47816','43694','15354',
                          '11758','69294','54113','52635','77544',
                          '16116','56554','98293','60269','35438',
                          '26250','49838','27152','34531','17034',
                          '74714','61155','51980','36693','82646',
                          '73013','88172','98932','63138','39551',
                          '62613','40468','96048','63231','39741',
                          '42414','57509','54036','28751','33334',
                          '82201','24041','14565','77956','75200',
                          '85784','62105','41732','87635','40566',
                          '16196','24449','29967','15218')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
