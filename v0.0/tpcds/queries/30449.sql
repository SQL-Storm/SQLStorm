
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '86759','27022','88631','55290','24629','42272',
                          '97909','83201','44182','63982','59448',
                          '61685','28480','39400','20806','83727',
                          '56709','95680','27111','44456','47228',
                          '15131','66055','84482','77411','65164',
                          '25038','82030','26196','21535','24074',
                          '81781','49580','69109','15768','84182',
                          '12610','12014','90391','13851','70535',
                          '30460','90314','11297','71640','34367',
                          '84520','91709','22287','29351','46421',
                          '20746','87954','83120','63276','22247',
                          '59539','90221','17652','97566','36510',
                          '87958','24580','12724','43889','12484',
                          '46501','65787','79022','16113','82294',
                          '20142','89960','68499','94125','62902',
                          '43777','66090','60871','24218','43999',
                          '36601','76860','28470','67895','13067',
                          '29746','28818','68729','16689','26752',
                          '62866','34567','32919','74350','55119',
                          '72125','64954','13346','43198','48176',
                          '59249','67662','45582','57833','10932',
                          '77727','59376','66255','71833','14843',
                          '84884','93104','24188','65973','65413',
                          '49572','34949','30254','40716','91654',
                          '10992','16486','74109','54908','32017',
                          '33971','26450','46471','57209','18473',
                          '93848','20460','61861','18795','44597',
                          '52961','58902','23089','97635','39586',
                          '73231','98052','79813','28580','70704',
                          '85500','90883','60047','28855','16950',
                          '75609','73396','58271','21011','34490',
                          '59438','55342','27571','28639','48789',
                          '26801','86495','83820','66974','49526',
                          '36165','15599','76524','88665','80477',
                          '47856','21156','21731','33976','62833',
                          '40638','53107','58469','18866','91211',
                          '86735','64715','85981','69730','75023',
                          '92961','49069','14528','65957','83640',
                          '20740','15057','92101','39514','31291',
                          '72684','73848','27829','67020','22333',
                          '57883','30930','59100','77934','96237',
                          '22850','56024','51642','72954','58607',
                          '74250','41253','20354','16631','90740',
                          '23684','25327','19624','57208','50184',
                          '71638','12823','65581','76904','46236',
                          '59787','70906','83057','26841','68988',
                          '35543','72778','11056','40427','55801',
                          '79535','74845','97764','16232','11091',
                          '13109','75549','43957','17340','32976',
                          '66120','10144','32702','76501','82614',
                          '17042','30243','81581','80244','94876',
                          '54692','18896','74586','97000','70570',
                          '51920','16600','77689','72533','14798',
                          '22751','58764','20267','89165','99698',
                          '24876','48665','26595','15549','14869',
                          '15799','55782','20654','32397','65927',
                          '86113','96427','59888','60968','17102',
                          '85384','72104','43345','13364','52631',
                          '29159','18627','28033','49645','18309',
                          '17280','71177','77993','21453','83241',
                          '83151','59166','26346','77961','13352',
                          '25166','40609','34381','33765','96230',
                          '65604','73540','55144','66337','11933',
                          '51959','98043','35179','16007','35614',
                          '48280','53519','21484','71053','54211',
                          '26410','12838','79459','16603','43856',
                          '25237','36640','59139','53689','91305',
                          '33085','14741','38133','82395','99347',
                          '60780','29127','12819','51348','35824',
                          '65867','49552','91425','25726','19264',
                          '33178','21884','87184','12090','20633',
                          '48565','43191','39616','22812','30044',
                          '94453','62602','42247','24133','98945',
                          '28702','10735','35661','22609','41177',
                          '58153','49341','22314','72485','26654',
                          '49511','95242','11407','18920','35446',
                          '20053','96772','31708','21574','26846',
                          '91451','77527','42953','68212','74366',
                          '31295','54540','29287','45196','18026',
                          '61369','48602','72403','13898')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
