
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '61395','93330','95438','50262','47299','58777',
                          '14620','66125','16403','32645','51121',
                          '44489','60393','28043','29943','15181',
                          '24053','58877','71787','77554','11988',
                          '36037','83414','18820','22185','26452',
                          '49559','91994','98970','96604','55540',
                          '29987','57173','57109','30045','20212',
                          '55801','88671','64904','86155','12308',
                          '72271','21584','47143','92111','14645',
                          '17407','20355','73483','16388','30346',
                          '79215','66247','96263','23309','74597',
                          '86431','50646','85953','18748','29002',
                          '10914','41158','40020','33677','33174',
                          '23968','73317','25106','28275','85166',
                          '70371','78766','12171','88101','53641',
                          '67414','39049','72992','78958','46506',
                          '26743','71507','71963','27049','53418',
                          '45214','95000','73830','72573','18982',
                          '73409','87297','37157','16466','64660',
                          '82950','46954','21022','98182','54038',
                          '56549','80132','29187','50337','60950',
                          '59807','29772','35827','11011','85255',
                          '75183','31454','62404','18656','70337',
                          '80039','70834','27628','35287','16801',
                          '95942','77937','32867','44860','88687',
                          '21599','87680','17303','40251','60710',
                          '79097','23275','89580','70917','26733',
                          '12575','31231','59314','27419','87536',
                          '49025','90730','76971','76163','62797',
                          '15719','24511','86785','15129','73645',
                          '70254','77639','93155','46366','67056',
                          '19171','55100','48692','42771','17394',
                          '26249','65139','72701','56710','16709',
                          '77932','90129','44202','18441','78983',
                          '21405','29434','63397','12765','11129',
                          '98434','41855','96596','28346','95876',
                          '89977','11788','90457','73190','40655',
                          '29098','15614','61162','98767','28453',
                          '78683','73771','60873','15369','14067',
                          '41155','68513','70002','43122','75466',
                          '88554','10200','39128','22098','30205',
                          '44531','28874','22659','14296','45721',
                          '60096','42367','11834','29052','57615',
                          '73782','33662','28112','61129','37063',
                          '32271','95130','66531','22437','29665',
                          '74824','34287','40998','94503','39623',
                          '27806','33799','66762','84555','52975',
                          '28665','13221','43358','12683','77614',
                          '97019','45845','26044','60758','61096',
                          '35397','43246','48046','12235','45470',
                          '72060','48377','19881','65372','37740',
                          '98359','43899','46915','20057','38501',
                          '10084','64348','72157','48090','61352',
                          '27627','91896','11701','88259','63594',
                          '88507','12232','22920','51774','62219',
                          '19380','11081','32207','89952','86612',
                          '28192','26153','43994','55588','28605',
                          '29510','42673','47203','59799','24085',
                          '39085','89559','47729','21335','89484',
                          '94514','64063','82646','33623','76064',
                          '61864','56188','95998','62969','24493',
                          '41437','28767','71547','11598','99248',
                          '37612','45867','14189','19660','65464',
                          '83828','19801','85177','55592','23728',
                          '73821','86401','67972','25216','74545',
                          '46708','26213','40040','12605','55193',
                          '18390','94693','44200','76794','72892',
                          '36522','11886','31191','32892','58201',
                          '36535','39203','29113','10944','16376',
                          '44557','28070','25078','92761','23113',
                          '96914','15693','27714','18279','35702',
                          '43823','41370','43773','44894','36587',
                          '18641','42996','64690','41132','62116',
                          '30133','14119','41108','76516','47293',
                          '71088','28797','52382','24058','37653',
                          '38790','14641','73638','62900','58293',
                          '25295','47104','97766','13494','74219',
                          '18039','85761','42598','31738','39324',
                          '24527','95895','57663','87273','71729',
                          '77806','56700','78509','71358')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
