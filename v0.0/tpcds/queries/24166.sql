
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '59850','86204','15354','63803','29532','69368',
                          '50075','21226','91188','35712','92931',
                          '78345','56807','83363','32141','82573',
                          '39392','28787','54552','81366','82143',
                          '50038','20553','82434','51970','22983',
                          '57932','90172','75095','20382','21543',
                          '51500','23545','26518','39258','19884',
                          '48144','12055','11106','94741','97859',
                          '64105','14436','60479','16484','21169',
                          '22466','36767','21070','10252','16682',
                          '23867','78826','52835','13981','31867',
                          '51703','71383','35912','55044','44231',
                          '31839','43387','15254','26956','39732',
                          '23470','77042','24170','98343','46795',
                          '27613','38238','56440','74417','27522',
                          '79916','38506','57182','44109','31934',
                          '32142','39090','22776','16903','78560',
                          '39747','63809','72975','39233','32604',
                          '31235','64070','38379','31102','90141',
                          '87357','40658','71565','24772','75485',
                          '91811','12498','18958','75282','55499',
                          '83126','69684','14865','56625','42861',
                          '52555','81916','98429','78383','49359',
                          '63862','13741','55030','29364','75170',
                          '64323','23213','46545','44652','18630',
                          '43844','31932','21447','86659','79903',
                          '95302','61437','15796','13732','68699',
                          '76506','55228','26855','36681','26714',
                          '20966','86439','40519','91664','73794',
                          '20806','52838','61495','16506','21121',
                          '27864','13221','21090','54903','36772',
                          '10746','76636','66617','71021','23844',
                          '15753','81711','72926','51680','72192',
                          '40734','88787','62980','69306','55123',
                          '28266','30569','23911','13850','19656',
                          '36248','64588','21772','16965','65121',
                          '28627','83945','77191','15263','55968',
                          '29262','63393','42465','71684','55185',
                          '46879','78234','89441','49418','72043',
                          '38755','77503','80824','34707','45681',
                          '49422','45101','78896','20486','68242',
                          '15330','18351','32608','24863','33874',
                          '45222','63328','60963','45816','87834',
                          '41547','91329','67292','23210','46474',
                          '30115','12853','92248','93134','10065',
                          '13030','57251','49317','67342','86028',
                          '12508','98341','14077','21969','46152',
                          '13493','21725','42073','38593','34800',
                          '44459','58628','85751','86698','26713',
                          '30202','91249','35337','11572','86980',
                          '74099','97651','54500','18464','77299',
                          '59037','95951','21564','83436','14440',
                          '51142','36411','12673','15958','58971',
                          '34435','85585','26472','21652','81723',
                          '59094','13744','95174','16237','55529',
                          '59369','90391','65235','19741','68248',
                          '92488','75451','81538','38052','83095',
                          '66316','23388','11070','83625','16434',
                          '39358','93345','19904','56885','35855',
                          '36985','44210','52566','56642','15436',
                          '34480','89388','45128','41280','93154',
                          '75388','88137','15156','41956','17597',
                          '61073','90699','29261','16176','82127',
                          '29781','79839','82169','10942','73288',
                          '69091','31691','61170','50107','37260',
                          '79446','62973','47145','26508','31212',
                          '33738','55174','55170','31809','25478',
                          '75277','65743','76040','30018','10314',
                          '13126','12435','18533','82699','26121',
                          '55494','68030','29767','25169','66359',
                          '26715','46177','55326','48600','53551',
                          '11957','44761','45627','90784','85325',
                          '74334','73374','73623','54865','86214',
                          '83751','35278','37346','69073','84313',
                          '98971','59551','58368','54998','99404',
                          '17899','77307','94069','22219','71536',
                          '74535','95836','68438','16338','13567',
                          '23717','23648','47043','30751','53442',
                          '53721','16425','94759','70645','11997',
                          '40339','61039','19341','78023')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
