
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '68857','45302','91000','19994','26104','68571',
                          '86573','66055','18964','39409','14540',
                          '66640','86400','86557','70872','31036',
                          '28612','29922','92757','71009','47916',
                          '91688','13541','99766','34351','40230',
                          '31471','70502','21323','25098','71969',
                          '47616','29272','17927','64623','71833',
                          '98232','45498','51907','58603','52531',
                          '30985','34186','52818','90733','74632',
                          '11468','91776','57591','15919','38078',
                          '81825','32566','85541','43813','76603',
                          '38182','76597','19727','31914','98598',
                          '60002','13992','11637','11092','77808',
                          '32400','95227','36431','73004','88349',
                          '43883','48473','94090','59238','83915',
                          '32008','75184','39712','27293','70923',
                          '30685','80127','81064','69064','83305',
                          '58664','84845','49943','41697','69166',
                          '16921','44687','19119','15032','37059',
                          '31098','44532','29305','27500','22822',
                          '79291','11107','97275','33866','85128',
                          '24119','21109','74512','95020','77491',
                          '58739','33102','52934','73356','47622',
                          '41613','72619','78705','56232','31015',
                          '38826','46658','82111','93454','26772',
                          '36775','14089','36059','10641','61812',
                          '20070','88244','55632','28037','11325',
                          '20040','11046','18347','30234','28241',
                          '53187','37090','80428','80567','54201',
                          '54258','43077','69896','51388','81487',
                          '81571','78682','30690','76625','58828',
                          '20624','16889','18254','18896','46474',
                          '46356','16870','51126','35043','14143',
                          '20300','17005','78176','95296','71280',
                          '17577','10722','54608','18525','33747',
                          '57818','14370','93613','10410','14315',
                          '46422','48579','60255','27902','30109',
                          '85424','60165','63686','24809','79887',
                          '58708','42236','81882','81949','27989',
                          '93499','78882','95597','14304','21926',
                          '28785','67925','81173','97804','28473',
                          '28496','51909','24701','44282','49068',
                          '37498','24322','67632','35845','75223',
                          '19817','57534','38015','59690','32917',
                          '64828','12105','33350','16577','94607',
                          '10489','18685','57024','39287','35517',
                          '31401','85445','69478','75821','30966',
                          '80659','34111','11226','97624','13894',
                          '26245','63695','53514','28796','53890',
                          '67047','95330','85222','67257','92513',
                          '81276','79910','54924','84777','11464',
                          '14407','12621','80684','25979','90901',
                          '93281','91448','95456','31817','22508',
                          '37078','18033','87248','94505','41105',
                          '64726','38653','99731','90296','64344',
                          '58208','49759','64261','71809','62096',
                          '98508','85425','22234','46963','15631',
                          '68943','74661','90359','68958','37209',
                          '86108','37404','91903','31879','61781',
                          '83539','49118','39907','56158','15862',
                          '28563','55778','79804','88295','66752',
                          '30080','52527','80450','40677','89153',
                          '51497','40323','15892','12486','60363',
                          '88636','28624','23621','95016','49375',
                          '18463','17157','98849','66232','11383',
                          '82069','33167','17544','71052','59423',
                          '47230','59215','76803','82138','97303',
                          '96596','35842','99254','27754','39887',
                          '18468','70776','17803','61308','37000',
                          '44379','66819','80195','99917','38898',
                          '32748','28321','11052','43528','67899',
                          '32248','27470','60197','28140','63027',
                          '89196','47049','52253','87405','28805',
                          '95028','76922','78137','38906','96454',
                          '42460','44770','24549','62189','44042',
                          '59155','30265','93841','39066','81858',
                          '67426','48503','55677','83512','83338',
                          '59886','72420','88932','36740','18210',
                          '91079','61044','56723','55553','23828',
                          '25183','61980','34597','24165')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
