
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '82897','33542','61563','72504','28425','13140',
                          '24776','88709','76372','44827','81590',
                          '66229','27864','91699','47444','77660',
                          '14685','58314','21667','72419','62373',
                          '43883','86598','55948','35776','29913',
                          '84886','33264','34171','60425','61386',
                          '22379','90140','98403','65089','41936',
                          '28298','69196','51063','63268','25551',
                          '96208','75279','99012','65193','28225',
                          '93430','43972','27514','30679','74665',
                          '33972','47553','12561','78473','91533',
                          '64867','59985','61083','88030','14217',
                          '96070','16247','94354','68155','14067',
                          '49222','64165','13505','90059','32466',
                          '58450','90805','30819','65116','74465',
                          '23858','85215','18531','30841','42842',
                          '98565','64188','92036','64194','50238',
                          '79621','29001','10242','26623','25968',
                          '57143','21058','89952','48558','68799',
                          '22610','80201','20168','97277','84680',
                          '40617','28197','72161','71233','27568',
                          '76628','73821','29229','84507','62968',
                          '36715','64813','46434','70787','44465',
                          '63347','28161','39781','23539','40150',
                          '26147','24084','49154','79503','21972',
                          '16219','35894','30106','94457','87947',
                          '70732','94344','39013','29335','15669',
                          '68607','44960','32490','78249','65846',
                          '72684','64793','26075','36106','91630',
                          '23372','71292','49685','11332','29098',
                          '16375','32547','17420','20005','39257',
                          '85656','74572','82898','19837','53434',
                          '13305','74352','73501','69805','73701',
                          '76203','18396','90502','38302','87156',
                          '59126','76435','55682','58086','15496',
                          '24445','54143','26218','71679','38626',
                          '33205','49300','94702','71143','18588',
                          '41341','20849','10818','97472','83514',
                          '44292','84420','52723','15148','39292',
                          '18111','18464','65673','84424','51918',
                          '59536','56967','19710','45052','45766',
                          '11066','10198','39591','19104','24472',
                          '66015','32995','11901','24048','81637',
                          '74369','60099','34549','29663','46904',
                          '41706','74275','47786','23640','44438',
                          '36906','85236','16098','22976','53421',
                          '25132','11611','62759','43940','14161',
                          '71987','21894','19840','49212','35436',
                          '52466','24507','36003','39108','78703',
                          '26828','49561','89340','28466','21824',
                          '62957','52793','23091','47634','54966',
                          '97336','57461','68832','29524','13631',
                          '54946','23021','27019','88789','89399',
                          '79845','33064','73031','66087','25540',
                          '89107','24929','88606','34758','25980',
                          '81049','45202','88615','12084','98218',
                          '84715','20979','81332','46399','52742',
                          '64495','18617','50284','25470','62436',
                          '20399','62285','52577','22466','17026',
                          '51921','96853','32077','28328','80159',
                          '10740','53279','13096','47426','32729',
                          '56061','33443','56281','45950','59598',
                          '98302','79915','79589','13296','26371',
                          '99574','51428','29286','38050','33293',
                          '70558','67902','46667','19031','29398',
                          '60272','13580','27955','15561','49077',
                          '53788','36114','57179','38370','88847',
                          '74606','70653','46067','28538','83439',
                          '11326','37654','44254','81403','46674',
                          '79771','51025','17794','60049','16707',
                          '53891','82118','30087','43097','18568',
                          '63542','46222','70062','39193','20159',
                          '62909','25860','94689','50378','10653',
                          '62890','25425','27701','16445','44216',
                          '64181','64950','18797','54198','24568',
                          '17649','39120','55487','40703','18083',
                          '23013','79241','31761','46355','17834',
                          '82662','35612','15126','66909','49341',
                          '58294','69015','29921','38458','32376',
                          '60485','88467','14449','31673')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
