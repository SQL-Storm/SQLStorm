
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '30084','35909','11943','33274','87789','25066',
                          '79363','90624','58205','97650','65818',
                          '97361','61921','48856','60473','21506',
                          '67218','33388','30384','56954','87922',
                          '23104','50154','63357','15943','40860',
                          '40567','86991','36951','99706','38892',
                          '29104','32553','37698','38658','67935',
                          '82280','58846','12523','82388','24382',
                          '16684','40152','78272','52179','18863',
                          '78911','13565','49738','16412','78715',
                          '19420','41838','80437','18917','14922',
                          '22936','56381','63158','57594','86521',
                          '91025','67942','36246','50162','90742',
                          '53585','86791','98063','27263','53716',
                          '31706','19050','10064','62772','38847',
                          '46720','29144','63486','91428','65912',
                          '48430','39664','14542','17967','95474',
                          '14804','78675','95946','60408','82445',
                          '50044','11492','19361','64814','23620',
                          '99855','59779','90500','77504','67859',
                          '82333','26097','12613','15305','82372',
                          '56830','12616','79310','17774','24602',
                          '75252','30859','22528','27606','35027',
                          '36912','11643','81092','54906','55218',
                          '37601','41337','41053','28049','79248',
                          '17378','30987','54366','93399','21062',
                          '35737','40314','16952','15256','45121',
                          '53963','81914','53440','21386','41319',
                          '22730','31867','57876','33116','84378',
                          '56858','42915','61100','57987','35093',
                          '49067','65031','31234','81972','59566',
                          '23551','94292','19266','80839','75702',
                          '23764','18061','21513','58547','55567',
                          '66691','87902','74909','74431','57861',
                          '85912','89184','30104','54051','41608',
                          '18551','46553','11278','53456','81918',
                          '20062','48033','59893','73992','53810',
                          '33804','62676','92400','33378','10281',
                          '11101','67425','39908','16746','87885',
                          '82986','17456','49144','32440','13453',
                          '82325','80846','51531','17649','87633',
                          '21121','24712','81621','80432','37674',
                          '69505','12980','17535','63118','47639',
                          '40059','75674','34973','32837','71641',
                          '50890','43543','77140','34670','77475',
                          '14975','12413','32868','91669','94022',
                          '94043','17905','83699','29075','27900',
                          '26656','43019','65858','72087','48037',
                          '13298','51929','45560','32013','29750',
                          '96881','83814','96681','83047','13007',
                          '14388','42413','60651','23284','67461',
                          '61888','89782','80324','75332','40637',
                          '58563','80044','22245','36693','74814',
                          '87800','73268','64578','47597','78189',
                          '23621','80546','51073','79561','16093',
                          '96439','64205','20959','61773','62334',
                          '31924','99977','62963','68674','89983',
                          '19229','53112','49387','24777','27434',
                          '38300','39919','76965','12944','18612',
                          '28180','45922','45097','12367','15757',
                          '18181','31014','85192','18682','88578',
                          '34639','54226','12350','91143','66074',
                          '70139','34621','86852','35045','87746',
                          '57726','53862','93671','11623','22036',
                          '35150','82300','91459','45622','72432',
                          '23755','64953','94398','93266','51171',
                          '65454','12061','63997','83046','31416',
                          '84824','57973','25064','77034','82752',
                          '42637','96840','46899','22534','15351',
                          '45031','62050','77206','34888','27865',
                          '79268','78369','42355','54529','31781',
                          '16955','27657','79184','70621','44808',
                          '64005','27698','32412','79670','45339',
                          '83833','45758','73870','85426','92115',
                          '50051','15446','26363','29664','26899',
                          '27930','63806','85298','19752','77904',
                          '21818','25395','42481','79333','89127',
                          '14568','44650','98276','12895','75571',
                          '80325','59440','85437','98894','69313',
                          '85898','26416','45713','97576')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
