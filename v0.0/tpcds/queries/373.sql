
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '60795','54920','90042','35896','42076','63299',
                          '17197','67256','57471','95524','83684',
                          '22261','13135','29001','97059','56264',
                          '86077','36685','30815','37040','68989',
                          '17468','57733','92104','84129','38298',
                          '44573','15020','55625','88567','91091',
                          '19282','45768','48023','59219','56481',
                          '72976','10456','93802','68372','77260',
                          '39018','23265','14511','10526','89051',
                          '61844','14067','17224','67315','66058',
                          '87067','70602','98069','68357','88353',
                          '21703','10506','99105','14565','95294',
                          '47312','81225','41787','35811','69571',
                          '36827','96448','78516','33188','65249',
                          '92909','58843','76778','72808','39347',
                          '16051','68624','53442','78212','38568',
                          '20794','83472','74597','49429','98354',
                          '12457','68233','16488','57395','43775',
                          '67620','20142','16941','41459','80444',
                          '18195','57753','11558','55877','17527',
                          '58594','16041','11552','14045','46233',
                          '88614','59968','16358','30949','98032',
                          '79283','22399','84853','27026','40015',
                          '12611','78722','37896','85106','45897',
                          '36468','54350','32343','63921','92197',
                          '80297','43469','82197','44693','18052',
                          '36648','43243','54144','19585','90286',
                          '97551','96649','55274','48147','89927',
                          '15909','28045','11531','26863','17532',
                          '86827','29622','71717','24722','26761',
                          '84199','54407','76008','45860','20305',
                          '71257','92024','97992','20315','17061',
                          '78188','11965','45580','98289','53435',
                          '19578','66735','58064','69471','53178',
                          '78820','81878','11480','89025','21715',
                          '96603','56793','11153','37610','21528',
                          '56964','23209','27521','17043','81624',
                          '66095','15278','23048','49868','74225',
                          '80267','82166','68845','60955','10561',
                          '64267','99694','24818','13092','85565',
                          '21227','17669','55160','32277','70623',
                          '39871','66064','83681','37178','39043',
                          '17775','56090','86211','14086','41367',
                          '12901','50520','24269','43195','81757',
                          '12880','17160','57698','45217','76620',
                          '27578','31479','57248','42723','22294',
                          '54486','44683','10990','51661','25100',
                          '85218','68927','31177','48466','33474',
                          '86177','63354','58622','29799','97555',
                          '14580','32191','37132','53181','94599',
                          '67943','58143','23283','95327','44918',
                          '78295','35415','64550','69690','30050',
                          '21370','88321','70868','75307','27433',
                          '37476','83165','89746','27411','91395',
                          '26615','41595','23750','12357','64124',
                          '65326','18920','99730','76152','86814',
                          '55377','24905','45467','56107','68609',
                          '68519','50775','11886','41978','89313',
                          '91134','10788','34470','64581','21190',
                          '62976','29864','73473','16909','21781',
                          '63530','93170','54046','14974','28343',
                          '21358','69594','51925','41219','59057',
                          '35444','33443','16258','94209','62592',
                          '78217','85392','21433','66257','73319',
                          '94260','44984','66138','75683','88608',
                          '72315','53704','92469','46010','94681',
                          '30359','63965','15938','94700','31244',
                          '34270','28930','49887','67178','14813',
                          '15065','93236','26551','91353','93126',
                          '53696','32105','92938','39354','25595',
                          '13054','20831','52427','30577','60124',
                          '89799','16374','12689','66743','39150',
                          '14574','33718','45685','51144','18737',
                          '49208','88506','74577','23872','19319',
                          '99149','54867','70564','37425','82964',
                          '95601','14689','50320','94589','74758',
                          '95760','28975','19939','62533','25142',
                          '20674','69893','48521','75618','50715',
                          '50562','24093','17951','19884','18746',
                          '11877','38291','51075','79647')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
