
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '80456','92346','63526','59908','46944','60230',
                          '67001','41381','74262','88604','57253',
                          '16705','45509','72261','49324','68512',
                          '35651','39563','35125','10311','75504',
                          '44979','43006','75824','42166','57062',
                          '13573','51013','69261','79041','61068',
                          '51618','43569','35054','60794','32787',
                          '27155','21278','53996','72259','97623',
                          '41580','65155','32912','33447','43822',
                          '40281','37835','91954','94063','11884',
                          '30780','37259','22772','30061','54739',
                          '11540','41280','70479','72951','15052',
                          '63262','38979','58526','47700','32433',
                          '24973','41730','42122','73945','46339',
                          '64703','27437','86113','78643','10633',
                          '26845','51541','36553','60608','16777',
                          '99015','11095','43901','15376','45122',
                          '48351','86912','66980','83675','62437',
                          '73240','17965','51781','53091','47741',
                          '45770','42380','64477','69797','15606',
                          '88470','68865','18733','84492','29484',
                          '66458','47279','72347','33825','90184',
                          '11654','10397','19101','94960','47106',
                          '55338','12514','15319','11860','26460',
                          '42940','33199','14347','19524','84507',
                          '84306','15474','53109','72638','77967',
                          '57786','58663','12113','90943','44047',
                          '42404','88426','20152','35951','66556',
                          '17554','30686','24223','13164','45225',
                          '21569','15761','35522','94203','96441',
                          '22001','21829','40603','78338','65601',
                          '49182','51958','31428','22713','74675',
                          '51314','40430','87820','24888','53686',
                          '17925','79917','82030','58899','24766',
                          '56591','57848','47183','93511','12888',
                          '90076','86407','32987','17752','18505',
                          '68996','24609','88442','16036','72506',
                          '98823','43855','52268','45101','45654',
                          '94717','43197','31659','78150','66374',
                          '13648','87244','82031','31983','63479',
                          '34878','33962','25215','41931','66897',
                          '29909','65839','52561','18356','90113',
                          '33290','98917','53114','40953','43915',
                          '22302','12718','63784','15070','24737',
                          '22356','57925','10301','28516','36614',
                          '37487','82417','98811','88107','37349',
                          '27156','29802','91769','72520','38541',
                          '54330','90172','12082','48811','14063',
                          '93541','12899','87182','51142','86553',
                          '76684','75115','54607','59794','15844',
                          '77833','55861','50120','98859','94145',
                          '37673','58940','47613','42032','19438',
                          '32196','71243','19895','89039','78891',
                          '87619','17334','86950','38236','97654',
                          '52506','40814','53237','79792','74135',
                          '78907','12277','43956','26445','64972',
                          '15242','99674','58648','87368','88114',
                          '20974','52258','84106','10544','34705',
                          '39912','72867','11876','99859','15239',
                          '80143','12140','31990','13590','23758',
                          '85812','21416','62507','82382','96110',
                          '21744','28626','54214','74995','35837',
                          '32099','82740','16585','18607','25552',
                          '82968','72975','40909','51763','85275',
                          '96376','94162','86631','28910','46694',
                          '71983','20674','71121','37138','15440',
                          '50424','60443','98993','11366','95110',
                          '50329','19968','17930','88446','55124',
                          '27502','72610','24411','22559','80957',
                          '31122','67351','11614','33863','58836',
                          '86558','34085','44042','46271','83638',
                          '49578','72132','18237','27904','77684',
                          '18166','58896','88510','28380','21101',
                          '52793','28219','58073','25562','32071',
                          '47984','94290','11861','64602','33978',
                          '55014','96238','46715','24770','79823',
                          '48575','69008','33163','90976','88789',
                          '66738','37867','42885','27176','76983',
                          '94373','14765','26206','97002','62722',
                          '27991','99024','84225','37000')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
