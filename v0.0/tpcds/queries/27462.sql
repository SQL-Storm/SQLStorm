
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '69985','20874','39960','41199','12581','19184',
                          '44563','77450','59668','48927','75227',
                          '14836','36440','46475','81953','45702',
                          '38170','82750','26876','36898','43327',
                          '61959','31825','67208','16294','59122',
                          '12626','76221','72628','96522','75613',
                          '52438','66849','79998','30265','80118',
                          '43301','86937','83279','14202','42746',
                          '71200','39268','72863','89441','83548',
                          '30141','14054','26436','94618','20385',
                          '54866','19140','26101','93105','58893',
                          '42477','79137','66989','27249','87909',
                          '59954','38941','17163','60126','20685',
                          '90116','44394','46209','46000','89603',
                          '97276','71223','13304','19189','12062',
                          '74005','62664','28839','26534','22474',
                          '13021','45021','13729','26204','84831',
                          '52814','39497','17080','60656','94368',
                          '44630','71821','23185','64100','87572',
                          '71307','16809','25786','89326','13353',
                          '79604','69686','22311','73348','39009',
                          '60646','81754','21736','53632','14556',
                          '48306','51924','27445','28550','36880',
                          '89414','22065','69084','12411','98337',
                          '78131','32933','59572','98370','84486',
                          '15204','77610','26925','64987','99348',
                          '63330','26126','36455','25400','70215',
                          '75965','29523','53845','29011','14246',
                          '46199','50791','52048','38866','81613',
                          '48997','53681','53341','19834','12096',
                          '57569','86065','61209','41283','95893',
                          '47445','27748','25322','35974','77628',
                          '51238','26482','17590','61789','95472',
                          '39713','23301','41590','67025','73964',
                          '63112','72252','20725','38159','56119',
                          '34582','71969','64172','28357','46597',
                          '93919','58430','74130','90191','40731',
                          '28431','71589','63539','81755','38567',
                          '94943','70674','45605','47691','66285',
                          '86389','98862','25713','38812','93050',
                          '90061','40649','94649','65619','61196',
                          '17921','67220','37439','62111','84515',
                          '94848','89775','98436','29842','36120',
                          '70155','44970','29131','54218','50974',
                          '38481','49505','27758','27553','30224',
                          '11473','76261','88905','52999','47765',
                          '12338','27480','56628','51990','92980',
                          '21660','34585','12944','72512','81925',
                          '70548','59891','98459','70326','10595',
                          '34032','61330','30064','14085','50838',
                          '93228','10159','40905','53248','46851',
                          '86599','29984','38719','25457','47773',
                          '22413','19595','69614','99804','75086',
                          '46445','97247','80326','61438','47877',
                          '52549','17166','74057','18765','80683',
                          '13178','79452','52061','51658','12400',
                          '79393','76748','11607','46900','87629',
                          '24396','34051','95325','79233','11131',
                          '79349','17270','51637','22171','43042',
                          '96322','25607','52775','53671','30790',
                          '57183','66505','16842','21953','13994',
                          '38658','79267','15803','26465','26938',
                          '61540','68921','29093','52967','50280',
                          '57231','84136','39061','35081','12959',
                          '97014','97835','34915','34982','71360',
                          '53402','10700','39994','58514','56632',
                          '29062','41675','80198','20895','18636',
                          '14429','99934','16127','66309','20611',
                          '39692','42066','34405','64339','43430',
                          '43844','72201','89117','29834','60252',
                          '44141','19482','85558','10478','41177',
                          '57655','16953','67131','36080','42291',
                          '35731','50768','66323','19402','62535',
                          '52024','66702','24507','22854','46451',
                          '49404','13537','15672','85194','21496',
                          '56921','76599','34634','92333','88724',
                          '31852','83016','38753','18902','89166',
                          '25454','33196','91161','52837','25809',
                          '21674','36761','62898','18495','50312',
                          '87168','30065','85834','75859')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
