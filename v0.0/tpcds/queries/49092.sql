
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '19824','79534','83236','19069','65380','19493',
                          '36018','57485','55278','25700','20463',
                          '13609','34246','28663','64884','42495',
                          '10459','97663','32001','13807','50701',
                          '16429','16170','25606','49620','15775',
                          '10246','38138','14890','86766','68114',
                          '16561','29076','27451','26209','36240',
                          '85466','45429','47951','90248','99316',
                          '16753','53692','41748','18240','77596',
                          '10824','62924','52600','26486','36078',
                          '74504','45927','93717','28611','31371',
                          '10935','18502','17857','22082','28581',
                          '12281','91909','15075','78683','52263',
                          '19561','30221','24639','98760','35479',
                          '12367','20954','40661','26516','51452',
                          '52833','35397','47723','42711','44416',
                          '85326','16074','34792','79911','31189',
                          '17052','29729','56292','60333','28598',
                          '29420','63096','55351','13164','69979',
                          '77082','82782','61691','35234','81220',
                          '37953','84698','88679','18472','30131',
                          '80751','68676','73768','60325','28772',
                          '99829','11410','35546','38423','20207',
                          '97580','30861','16803','72367','25503',
                          '18580','64525','77207','90996','26968',
                          '74016','21621','48287','63316','54526',
                          '94793','29303','95721','49456','78491',
                          '35753','73888','21476','29747','52056',
                          '66070','14454','33636','53241','26369',
                          '30753','57667','16000','79395','16593',
                          '42689','85383','23821','18797','33087',
                          '20877','13172','18864','10849','86377',
                          '21847','50711','30123','37377','89352',
                          '23869','32700','47988','31677','25403',
                          '28859','31523','12726','11469','93110',
                          '43418','36510','74967','50160','44695',
                          '39629','43589','20277','97264','53318',
                          '21104','58715','40296','14820','38291',
                          '75472','86632','98211','76659','49222',
                          '65102','85568','51193','35823','92216',
                          '42661','80811','11910','44788','81927',
                          '33922','29059','22632','32191','83103',
                          '99694','61730','32118','34812','29428',
                          '29454','93144','66315','45221','15772',
                          '43885','72243','50500','86204','78887',
                          '27324','28389','17041','29221','55473',
                          '39273','62952','44326','97048','69327',
                          '88900','82406','43379','93097','41158',
                          '46735','36195','51267','39976','32356',
                          '22788','62712','25701','23613','19902',
                          '60261','74851','14321','78765','27644',
                          '70169','56597','32410','55375','84406',
                          '41919','21410','87019','29139','60204',
                          '62572','17073','31925','79409','19321',
                          '72942','26708','12639','53128','16036',
                          '42904','15415','11980','48716','14319',
                          '47469','74601','89613','30771','83589',
                          '51077','56512','36261','87204','24434',
                          '90348','61359','84670','36698','63673',
                          '13385','36924','67043','15578','90445',
                          '25576','97630','75189','79869','66359',
                          '82756','38051','60768','46325','59449',
                          '77788','26024','58829','55986','57028',
                          '10567','69849','57857','46876','38264',
                          '20321','14366','37749','84112','60452',
                          '87736','58738','83814','55281','23244',
                          '15312','18849','28425','87163','47205',
                          '55176','55149','14828','11982','21090',
                          '62759','57483','83561','86133','78514',
                          '31758','73060','65475','37655','27945',
                          '30300','42497','24650','25061','48228',
                          '74262','38502','40957','26440','64021',
                          '22752','10017','90218','88631','80430',
                          '20678','12188','19931','21575','57321',
                          '62642','58604','57666','34005','64872',
                          '36244','52297','11984','82857','55526',
                          '79147','96642','64139','91503','41777',
                          '27044','17207','42872','50181','78698',
                          '38418','81662','43633','81511','21544',
                          '67840','23211','25242','37424')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
