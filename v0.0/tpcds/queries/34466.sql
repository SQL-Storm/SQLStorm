
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '10023','37427','48937','58056','19415','44499',
                          '11143','51283','83413','68671','75438',
                          '39342','11599','94859','64923','10936',
                          '73323','24853','45237','50609','29544',
                          '88229','87266','17400','89223','57348',
                          '77861','32345','23448','25201','20584',
                          '29449','43205','52750','98482','13468',
                          '58234','87536','59723','25786','70199',
                          '34343','30653','71364','44249','12034',
                          '33484','19151','44625','44331','31593',
                          '26636','46262','24060','64751','96560',
                          '40639','87033','48285','61116','88029',
                          '41545','99185','63242','46461','43037',
                          '73305','83822','71516','41003','56820',
                          '31351','38744','90789','36947','41803',
                          '18323','33769','72743','46203','35184',
                          '28918','73253','27235','44823','11860',
                          '21689','59492','46178','18722','60579',
                          '34344','19107','63743','61956','80781',
                          '95976','29939','25785','29535','68407',
                          '36348','42268','28762','25142','48225',
                          '33840','26143','31668','90359','78338',
                          '13060','81417','16713','71135','84940',
                          '10666','60563','30341','50930','40386',
                          '19900','40583','96880','43357','78148',
                          '48922','62467','46783','36643','20105',
                          '69847','54648','20747','75598','73120',
                          '35790','67834','67982','46235','37453',
                          '12960','72583','58731','79026','24119',
                          '37985','10495','15102','78256','56164',
                          '70001','44540','11622','66621','61847',
                          '10458','35965','19101','20655','22557',
                          '80751','14912','47589','56800','51339',
                          '25467','34362','65936','36437','45636',
                          '24977','38732','73715','41214','94137',
                          '25314','48104','23627','99943','45290',
                          '45528','27746','26596','60576','66597',
                          '60160','17695','64920','57243','40428',
                          '78643','93261','55714','18245','92564',
                          '23648','38663','33014','82017','18612',
                          '27278','23041','80616','76209','38282',
                          '14573','61041','48000','21880','88864',
                          '54426','85462','16068','13034','43533',
                          '92300','32797','20291','36934','37443',
                          '23738','27745','23980','62705','77905',
                          '98140','13432','30302','95513','20547',
                          '52272','64126','78686','43188','22976',
                          '12320','90906','11496','45201','80244',
                          '97107','18333','52864','62379','47491',
                          '27780','21876','47918','72029','32202',
                          '20285','58338','62584','68491','21613',
                          '59256','16375','63270','13958','39195',
                          '86510','22215','29760','63734','35241',
                          '29255','80191','44066','29006','26274',
                          '18109','96296','33307','62668','42539',
                          '97791','76820','13711','83264','94434',
                          '37757','12031','60302','13236','15275',
                          '65510','44786','33596','62725','38910',
                          '18405','24297','15393','83887','26234',
                          '76576','32172','88906','50506','84666',
                          '32308','26614','37439','94881','76228',
                          '62735','51145','38546','11603','82662',
                          '53384','58188','31909','14596','34270',
                          '82366','87668','39382','23974','22474',
                          '46196','30637','32264','68097','86604',
                          '81345','61864','13667','53373','13397',
                          '46792','15622','56685','31077','22977',
                          '21129','79059','50367','64218','21374',
                          '54073','12002','48766','52806','37257',
                          '67869','73917','13560','57213','86441',
                          '63777','33163','73857','83217','32801',
                          '41496','25306','54912','82864','61136',
                          '29935','82782','96507','46979','43376',
                          '99131','50187','97798','47456','80205',
                          '57389','64762','50954','24002','89598',
                          '29296','88731','67267','84836','48251',
                          '30071','34559','78664','46197','17651',
                          '43290','95463','10270','96689','77422',
                          '50974','65740','56258','49153','64437',
                          '71168','73701','38462','81269')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
