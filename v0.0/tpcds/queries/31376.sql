
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '52532','10297','61189','19004','81404','53136',
                          '44012','67712','77303','99474','89424',
                          '35702','36826','63002','74923','13764',
                          '38555','28359','75363','30386','81987',
                          '60901','50324','41788','20491','23324',
                          '21975','86636','29153','42668','41402',
                          '61005','49379','78151','35127','17270',
                          '95306','11001','85628','34139','66087',
                          '20920','66779','70694','42975','31124',
                          '54288','59034','78347','80686','58068',
                          '93552','76862','45865','50421','91259',
                          '57742','47201','44949','18951','58224',
                          '18602','78687','46757','76936','33035',
                          '18156','43234','62483','46618','10028',
                          '55878','54347','79040','52628','25960',
                          '70789','88719','73378','53595','57216',
                          '55850','86673','94290','96701','14126',
                          '64125','98693','46556','87855','11947',
                          '65475','18012','60924','46241','19667',
                          '55091','45419','34839','34838','77526',
                          '75194','69468','10362','25243','36246',
                          '22869','18705','88748','58645','69194',
                          '28938','77704','15915','11433','16363',
                          '22863','50418','79440','57613','50372',
                          '17758','32127','11341','59891','28841',
                          '31577','71797','43978','48666','28415',
                          '73672','74252','28561','43761','42053',
                          '48194','99856','25552','72416','16294',
                          '21739','42209','92785','42289','71845',
                          '43701','92201','99114','27860','37001',
                          '78577','92577','47507','97835','34994',
                          '20626','83531','24639','12657','33738',
                          '35057','89265','72273','37264','94415',
                          '69345','42639','28181','23149','22264',
                          '50580','37783','78305','46842','29855',
                          '32878','14956','44247','83397','83014',
                          '51516','47623','32457','30888','66716',
                          '77555','95580','43756','47683','83298',
                          '14032','87534','48876','78382','74819',
                          '60059','88779','85134','78928','65026',
                          '51759','39550','30561','30111','10009',
                          '10539','28062','74576','93455','44038',
                          '64535','23742','42965','32897','93399',
                          '49096','17697','28005','24414','89341',
                          '80644','33465','94017','74607','52880',
                          '79959','73000','22937','32480','30562',
                          '48967','53479','73233','14052','50364',
                          '10067','59694','26209','27713','77778',
                          '25222','44322','54560','10832','79203',
                          '99591','17258','94748','37887','63131',
                          '88755','64155','20505','82131','91533',
                          '31283','17429','74065','48756','58459',
                          '82644','86963','65081','94360','20931',
                          '11850','45567','17688','19014','97883',
                          '46588','41627','75248','46593','25734',
                          '42120','39497','82878','18262','31439',
                          '42304','39961','62201','30861','89886',
                          '55381','32917','91607','12079','78907',
                          '89947','91982','65843','84673','76930',
                          '78770','96460','98223','43805','95933',
                          '79709','21182','24634','92374','49760',
                          '23182','70167','73916','84388','55026',
                          '46534','91560','55769','51613','21469',
                          '32339','41968','63489','11878','74780',
                          '12900','47317','84598','84852','66169',
                          '11533','96396','51097','45412','92065',
                          '75499','46114','53938','12509','32379',
                          '77305','46312','47163','35958','26439',
                          '50461','34243','75733','61560','50939',
                          '13333','88137','34127','82236','91780',
                          '40834','61526','17932','83184','17535',
                          '25430','28749','92667','39270','73814',
                          '64538','79419','21588','96116','53535',
                          '77772','20579','42690','78280','43543',
                          '45629','80592','28107','92960','90319',
                          '10943','38529','10042','42879','24196',
                          '73945','71346','11214','40273','62006',
                          '97730','92632','73400','11674','43019',
                          '55576','95579','68449','27347','37206',
                          '51824','12849','72561','61140')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
