
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '94397','46247','18365','22174','97931','86259',
                          '43231','15669','20503','64398','17709',
                          '43552','46401','56844','87084','27897',
                          '79177','24572','65701','31051','50255',
                          '57830','76096','36356','28525','10358',
                          '94794','28884','43821','15733','91371',
                          '37490','58816','32747','14391','68051',
                          '48161','15392','34061','88850','36306',
                          '22551','88588','24269','49224','37413',
                          '56137','10113','46478','12139','72020',
                          '85606','47339','16836','10815','29691',
                          '80042','74381','35872','39903','65995',
                          '26134','21141','66952','86802','48239',
                          '99853','49083','18068','86593','40236',
                          '46833','50214','59693','14153','22098',
                          '46008','33339','69102','17468','53862',
                          '15422','28186','81567','14433','32355',
                          '30605','36434','73055','48987','68128',
                          '45796','78829','52105','47497','51271',
                          '25179','24851','39433','78643','19180',
                          '75285','23286','30776','48092','28585',
                          '18480','18663','85463','92955','40767',
                          '99056','73708','98103','37854','39751',
                          '47179','55515','23760','34062','34803',
                          '29988','26495','15719','16923','85567',
                          '54904','10522','27167','20107','24117',
                          '57350','70828','98860','79039','95205',
                          '52238','25027','63516','50398','32720',
                          '28737','13954','78295','73330','82965',
                          '41502','11925','20578','47469','80636',
                          '25765','45361','44058','40039','25810',
                          '71210','58979','51674','54442','91191',
                          '13983','13552','79893','96200','35127',
                          '19744','57828','80091','97107','60529',
                          '15415','56784','46549','12216','46504',
                          '60106','43183','24633','79412','88497',
                          '53375','78031','74292','30757','14637',
                          '43612','62314','47988','14297','23045',
                          '67115','95961','94825','41135','22498',
                          '47562','92036','58906','80813','74638',
                          '68382','65360','71954','18157','23530',
                          '36224','41331','23494','50873','63871',
                          '15557','27630','10509','34303','86092',
                          '28625','30004','38207','40152','47755',
                          '39404','71916','89778','34097','26473',
                          '73455','42400','97661','20288','57418',
                          '87377','15832','12706','80520','30690',
                          '45662','12373','54031','52616','89241',
                          '96062','15148','65012','69104','39049',
                          '14954','80485','96278','68748','95584',
                          '94208','23105','52507','25965','16668',
                          '92416','60136','82183','46972','44153',
                          '85686','32421','91335','11292','18398',
                          '43120','94226','75043','81569','52823',
                          '35799','32043','42115','49918','72127',
                          '84068','88006','19950','53089','57433',
                          '83484','90614','69803','84589','65093',
                          '32781','55052','40600','73814','43618',
                          '54244','60583','88415','78347','19118',
                          '85152','41662','33061','82561','45949',
                          '84239','25821','10203','70021','85079',
                          '26504','93827','70316','38736','25835',
                          '67537','97739','64696','48184','28655',
                          '51475','17041','33132','77769','49923',
                          '44257','65881','36022','73825','59698',
                          '22049','22205','51501','22281','25586',
                          '83576','22949','38174','71907','16222',
                          '81324','18965','89102','58980','24559',
                          '15066','48325','31294','21900','52664',
                          '59317','24192','28057','36231','73391',
                          '86471','31311','84627','21107','49592',
                          '12908','43701','40913','65378','18218',
                          '15921','16371','75941','87060','45697',
                          '38691','78220','12508','89921','72807',
                          '57952','65493','84572','29379','15782',
                          '86500','33652','35542','89002','82354',
                          '65949','94620','84476','39286','19476',
                          '88480','19511','10714','93759','72887',
                          '86349','46195','11838','67310','14235',
                          '35137','25823','35502','51754')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
