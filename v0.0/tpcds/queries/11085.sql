
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '35698','12747','56383','78971','82637','96383',
                          '40560','51720','26372','71787','54701',
                          '83617','32900','86510','22707','55540',
                          '93703','28567','38720','85601','46605',
                          '35513','64340','82098','80970','52962',
                          '74152','28570','30983','85637','83902',
                          '34801','18107','86598','66428','61080',
                          '76507','94336','55664','93078','46506',
                          '91135','27049','11694','12246','22056',
                          '85807','72021','15342','59123','20469',
                          '57453','34457','39568','89604','25102',
                          '48216','28968','92977','11198','61654',
                          '77937','67403','35835','77368','33990',
                          '31403','41547','19439','85134','46875',
                          '85186','53779','41248','22438','16697',
                          '27610','14227','86025','17795','71979',
                          '87053','56710','29267','49467','73533',
                          '29434','77698','83739','39517','61399',
                          '12802','59500','90527','80086','98198',
                          '43592','56819','41155','50915','75466',
                          '49270','39540','64594','14304','40907',
                          '42367','73387','32757','12786','47628',
                          '61367','45619','35089','56152','73909',
                          '33799','15120','15638','22773','77614',
                          '10807','40900','35397','69254','80948',
                          '71273','12336','74589','34917','47569',
                          '95066','49692','20586','70397','63594',
                          '14578','65616','89917','86277','10016',
                          '80707','47189','29510','20359','69713',
                          '11923','15046','17820','82646','60620',
                          '29123','13615','18288','66394','20912',
                          '45867','10813','83828','28054','23728',
                          '47210','29810','42435','69033','66904',
                          '70657','64984','53532','25413','13082',
                          '39203','91174','81699','65552','59903',
                          '51041','65212','48675','21106','12825',
                          '20021','65773','26235','83419','70328',
                          '25713','46698','98050','59487','15177',
                          '19614','13494','24388','73163','82683',
                          '19406','39257','81825','60753','53722',
                          '20926','49199','28177','68607','77537',
                          '45031','73597','57683','43667','56238',
                          '53508','43501','12851','90895','52376',
                          '67906','11346','25296','85532','23532',
                          '26382','67765','24056','81580','64833',
                          '58539','81030','22323','26287','36484',
                          '59912','53735','80205','19866','11087',
                          '19333','11611','74364','14702','12871',
                          '53510','36243','49004','12840','76222',
                          '17997','97672','31096','55627','88422',
                          '20975','38314','52103','24627','32893',
                          '53164','25945','75220','66939','96428',
                          '28799','20674','16735','81693','49201',
                          '73246','37679','13761','18787','21442',
                          '35596','35193','51081','36507','82146',
                          '57737','38379','38419','35113','90130',
                          '15118','14211','68821','12096','94182',
                          '54471','67548','73666','72100','62043',
                          '63379','31984','28865','66989','46566',
                          '71431','11632','95076','38425','33923',
                          '32866','97649','17589','56546','88523',
                          '22580','90164','40774','22101','32902',
                          '59551','93580','29184','48650','40542',
                          '35493','86092','14784','29620','13667',
                          '33574','96309','89682','30162','81832',
                          '38438','21587','59436','23795','32597',
                          '34138','97347','77182','85484','40455',
                          '65085','52767','64100','40986','28880',
                          '22106','14905','13579','86376','68558',
                          '32097','18910','50324','34506','25510',
                          '74242','61770','14686','14177','36951',
                          '87136','61912','70646','39356','13377',
                          '49424','47042','82587','89457','96580',
                          '28849','46927','22378','41069','69942',
                          '12532','18660','56118','65643','79252',
                          '49385','42999','38643','11054','79147',
                          '70154','68861','67976','75239','77516',
                          '66290','96847','33926','24160','40071',
                          '74706','99310','31597','35434','85865',
                          '78553','38597','44821','27957')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
