
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '97717','70478','94692','86208','97141','74231',
                          '30315','12479','24785','44464','22296',
                          '30111','38879','87418','59511','11751',
                          '38053','85031','83956','38558','70333',
                          '69076','14363','20092','17846','36444',
                          '67704','49092','86729','51192','48568',
                          '21212','47973','66097','98701','39726',
                          '39839','19735','46606','91221','40224',
                          '22060','38195','51766','55032','28267',
                          '55109','19973','15333','61566','59806',
                          '52097','34581','27362','13705','16858',
                          '21418','82065','44630','20940','32553',
                          '71253','33987','52849','34731','81865',
                          '63219','15988','87650','16575','18990',
                          '84513','62157','10096','24806','82404',
                          '15818','45070','43058','70115','26438',
                          '53538','22500','40532','33608','41116',
                          '55280','44945','15584','49803','21962',
                          '15096','55475','17322','33246','15346',
                          '44245','79332','34523','11933','67803',
                          '17357','36761','37738','61451','90478',
                          '30993','81056','42206','85679','97571',
                          '36492','45855','19373','43523','22218',
                          '38336','24187','85878','90931','86656',
                          '46383','19401','42469','63310','80010',
                          '15474','72124','77719','57412','61311',
                          '81846','32277','18008','70360','14408',
                          '73685','69910','35103','34872','54601',
                          '52126','43338','29410','54338','60748',
                          '79453','27160','20362','25062','38784',
                          '37649','64104','38787','40751','48500',
                          '10646','86239','75679','73616','47462',
                          '91957','34563','71747','56087','49388',
                          '53573','17874','40014','62516','96452',
                          '73699','27203','75985','86978','64170',
                          '63057','97575','63243','19133','50132',
                          '17824','28594','13763','59338','27957',
                          '61236','14368','30896','91039','87973',
                          '26804','55710','51842','71461','45764',
                          '23195','27161','17336','25487','60549',
                          '23190','32506','79878','32392','87990',
                          '15383','56480','16614','52762','49350',
                          '65616','32435','14055','61698','27233',
                          '45393','90966','99698','17608','27333',
                          '43524','17184','53646','55542','12444',
                          '56891','23078','33731','50447','85079',
                          '63420','51200','21842','32405','23557',
                          '41042','92569','88453','79868','49894',
                          '11137','94444','13679','24117','41594',
                          '83912','15755','34994','71268','34615',
                          '18998','49663','12076','29274','99381',
                          '14597','22323','13653','92996','98784',
                          '75308','66436','82642','23956','67675',
                          '82473','14215','13747','64026','16260',
                          '96987','71372','88985','85108','61078',
                          '35884','52679','48549','88403','27365',
                          '77689','34008','46508','25074','16562',
                          '55157','57641','35494','25075','61772',
                          '73682','30418','39366','78886','74208',
                          '57995','20100','82258','25686','49980',
                          '58205','39279','12564','35766','44830',
                          '94866','20094','89242','89884','12068',
                          '27718','44513','47883','72747','51838',
                          '28676','68995','63495','22433','32411',
                          '92795','44821','71867','67027','94009',
                          '58901','67408','21659','32877','64920',
                          '86422','54867','48642','85302','31777',
                          '59716','44811','96176','49962','17355',
                          '71817','12577','70699','26973','51446',
                          '32679','44230','57253','42353','75257',
                          '73120','59947','49866','90715','95107',
                          '49332','30469','11670','69011','32286',
                          '80130','34797','66753','36462','41466',
                          '79102','26276','68290','17652','52794',
                          '76448','14515','37459','47707','45988',
                          '28785','68041','28192','36845','11136',
                          '19672','51130','33925','23032','72500',
                          '86864','11037','35800','66175','98135',
                          '30139','34807','63425','46229','14792',
                          '27782','17403','66320','18979')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
