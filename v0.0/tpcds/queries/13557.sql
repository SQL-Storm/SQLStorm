
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '87879','11095','20200','60889','30207','44561',
                          '24012','79299','19490','27513','67466',
                          '16337','58569','69447','65433','21154',
                          '29251','97516','44717','98754','41262',
                          '33477','46688','54924','40913','68156',
                          '49482','12108','34781','42445','91641',
                          '21606','62795','14615','33878','30490',
                          '28523','47430','72356','18716','42514',
                          '32005','83211','43482','23916','26019',
                          '28821','73238','63099','32432','72787',
                          '43769','11732','79375','90304','40409',
                          '69693','84894','75769','61464','60076',
                          '39129','70159','15707','21836','61866',
                          '14318','84400','78173','73173','79888',
                          '14382','15991','98257','32148','38185',
                          '92229','34657','35319','23355','46300',
                          '30839','13675','64928','99649','24050',
                          '51873','57467','76163','41051','41534',
                          '11504','58639','28672','47989','84500',
                          '79228','88654','92089','80007','52720',
                          '92789','12212','79511','51495','58849',
                          '30327','44737','17960','88713','19121',
                          '44794','63372','20020','73871','86699',
                          '26179','20795','87138','62703','36333',
                          '88558','55861','76857','64539','47760',
                          '74680','12236','16754','91779','14815',
                          '82759','19924','22425','35936','11677',
                          '14055','36995','35172','43272','29819',
                          '11004','65453','88508','95272','17139',
                          '37691','65177','93711','90845','68988',
                          '75490','49833','17796','41219','39990',
                          '69901','69440','19853','22175','75687',
                          '78163','41156','81200','40588','37330',
                          '82825','68134','27678','36876','22302',
                          '48971','94536','23988','95779','30609',
                          '73712','39988','77764','69239','13399',
                          '33987','46755','17750','90440','53734',
                          '71693','44889','28805','25515','42235',
                          '33162','98791','93684','48375','24764',
                          '39406','46096','87080','92953','47143',
                          '32731','74576','56742','38678','56642',
                          '15130','70553','11618','26527','95807',
                          '66926','20149','15602','66454','77970',
                          '89362','15203','30187','60199','35833',
                          '40406','30113','59297','50293','58396',
                          '64198','30237','26825','90612','53075',
                          '27263','65403','19599','52782','43446',
                          '99995','87939','53170','40308','51281',
                          '87512','12704','30020','87460','10820',
                          '89027','58446','55365','60664','43500',
                          '93581','39884','39627','99289','92264',
                          '84003','36547','11264','88299','22817',
                          '17616','69074','64024','90065','70452',
                          '30124','70747','42174','10479','53180',
                          '88583','52637','82543','27456','53237',
                          '13455','66179','51882','67493','10760',
                          '93822','23719','32598','91499','19398',
                          '57448','28892','64948','28655','47036',
                          '14646','35326','95469','17334','18221',
                          '51007','61213','56758','50943','23313',
                          '96448','21723','23154','49007','94361',
                          '37493','67978','54083','94084','45806',
                          '60847','11612','38932','42278','83664',
                          '29270','47133','60710','55934','34790',
                          '85283','93002','12401','12083','76621',
                          '42487','94813','14576','70593','30654',
                          '13594','41816','28063','71533','85905',
                          '92973','58502','34511','85513','31184',
                          '14078','74583','35210','48655','95806',
                          '52569','31464','54172','61122','60908',
                          '37990','81226','64202','30631','56766',
                          '15358','22320','85536','15416','10759',
                          '84017','68551','14538','35849','84408',
                          '99164','23721','92634','91002','27885',
                          '10684','86759','17724','47302','94723',
                          '82919','13343','34302','81288','66491',
                          '65169','94369','74694','16650','39357',
                          '67802','93944','98411','25464','28975',
                          '84732','13163','86735','17778','90606',
                          '72555','75336','95286','18097')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
