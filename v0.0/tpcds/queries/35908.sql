
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '20609','37095','52945','27804','58667','67387',
                          '46524','18475','16260','82090','67369',
                          '31380','52489','83980','81609','35410',
                          '53537','36832','21706','14748','14214',
                          '37691','98713','24040','91377','37219',
                          '96647','14652','15492','69457','27084',
                          '38472','43041','56669','76309','25797',
                          '54044','14005','35612','49904','11003',
                          '91292','53606','37011','40499','10965',
                          '34629','51517','75444','35972','47076',
                          '45426','10393','62731','89305','64399',
                          '77255','22711','41107','21879','47745',
                          '82035','67800','46257','34876','48973',
                          '42070','40958','75630','91886','44247',
                          '42705','51076','35329','75960','39590',
                          '40316','20389','23935','14197','12137',
                          '99356','11839','71027','28894','46833',
                          '55053','51010','16266','17307','34211',
                          '10455','78875','25596','57271','66861',
                          '22402','88702','25322','27959','24100',
                          '12503','63810','87247','55601','39939',
                          '47699','12762','93587','25413','89788',
                          '76785','77189','31640','24294','67695',
                          '31054','93354','10988','80745','65292',
                          '86668','72588','69275','10599','39888',
                          '40863','71100','88765','56549','41166',
                          '64557','42301','20881','89601','60836',
                          '23727','53360','28672','52335','59900',
                          '36505','67068','45183','46248','10276',
                          '83459','32541','18814','16144','26142',
                          '10657','76713','85349','22478','70488',
                          '10009','76017','11671','18105','48269',
                          '19863','32936','22289','42641','12995',
                          '77000','12735','98308','69265','55159',
                          '63613','46755','55462','13317','63099',
                          '11229','74616','32035','40113','54917',
                          '20659','45026','68605','19918','23459',
                          '38119','18685','56020','18619','94697',
                          '43732','96718','83081','73567','28964',
                          '25274','93798','43050','48850','29424',
                          '24989','11450','34798','71529','67250',
                          '21781','25609','54939','45391','65915',
                          '65982','78908','50974','81861','74956',
                          '82316','65979','54333','11871','35834',
                          '88008','65619','20449','67572','55827',
                          '82462','67579','99143','36482','50747',
                          '12320','73118','71337','85444','65444',
                          '94667','42890','71380','39933','95936',
                          '10776','88137','72215','14996','13121',
                          '24262','72182','82390','34243','14672',
                          '51695','19027','14293','93168','29248',
                          '83495','61818','68517','54890','31954',
                          '58681','28677','67291','27070','39052',
                          '45935','40792','44573','49972','22276',
                          '34613','31511','10516','99635','29157',
                          '92735','52781','34534','73307','25771',
                          '15032','36611','68567','74767','85403',
                          '96197','24195','98497','45877','84416',
                          '54077','96012','41761','27039','25067',
                          '67976','48157','49941','81128','46586',
                          '27727','12800','17849','36430','76454',
                          '49144','69262','81346','28364','32100',
                          '61964','10332','84606','23531','79676',
                          '65399','13126','72771','59929','75382',
                          '58195','30844','35273','97011','56258',
                          '53423','62018','22945','79852','21124',
                          '37438','25856','42527','84555','11237',
                          '73605','54521','19000','65406','43560',
                          '15995','76442','47666','97762','53776',
                          '42857','16307','13255','31496','24542',
                          '18284','57227','47351','76815','13669',
                          '74320','79921','38428','86407','12034',
                          '10165','51680','38068','44732','16341',
                          '22006','15209','36905','13312','62765',
                          '57681','64015','99323','96366','97204',
                          '65249','52271','16617','27247','80238',
                          '11515','22821','84381','66364','90266',
                          '48566','15260','11976','71325','41509',
                          '68369','44121','76905','84779','89892',
                          '69620','89069','38341','58387')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
