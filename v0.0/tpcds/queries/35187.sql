
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '60316','24993','33097','92612','81368','64940',
                          '89247','91364','42511','40160','24582',
                          '11589','32044','40092','47027','43159',
                          '99750','82757','19332','27244','62621',
                          '44294','95628','32955','72469','60267',
                          '29793','47803','26319','75868','75668',
                          '22416','63015','24590','69169','50516',
                          '49074','91576','17665','49137','52742',
                          '86749','83953','18424','29124','28719',
                          '96639','54821','62972','14944','38028',
                          '81031','25151','59759','30934','33985',
                          '96201','81857','75331','14686','74286',
                          '32864','97147','86890','13056','38240',
                          '89641','21222','23386','46202','92357',
                          '96308','93287','98364','63384','31305',
                          '71057','52003','36325','94452','43503',
                          '14974','80425','13566','94685','23536',
                          '32049','39492','15663','20294','91232',
                          '51101','64060','16941','22917','64615',
                          '39556','25620','58951','48743','67238',
                          '18554','98039','83173','55187','76415',
                          '51450','34766','79423','64787','63859',
                          '31705','18668','94419','17793','34494',
                          '86571','45811','20278','56192','17630',
                          '56197','81660','56882','57165','42843',
                          '21735','22081','58526','10178','95258',
                          '51197','16748','42676','19034','17004',
                          '90986','28892','57265','48032','90500',
                          '36157','55480','82193','83620','88878',
                          '38242','39663','62750','61272','86153',
                          '44652','37496','37028','57396','45776',
                          '56509','41968','10768','45937','16158',
                          '26156','97984','66905','65629','38824',
                          '27981','87779','26550','32982','69899',
                          '87868','64678','54927','75442','54805',
                          '21041','25658','76037','50547','86411',
                          '14512','24020','60272','87637','24213',
                          '76548','39758','60470','42755','56678',
                          '16714','86877','85782','58273','27149',
                          '16234','77576','18446','37445','91514',
                          '34137','63897','57707','56782','50562',
                          '96061','93930','77775','25711','97699',
                          '96146','81495','25533','20167','62249',
                          '42308','94388','70209','87359','85721',
                          '30946','19956','61983','55686','64829',
                          '58040','47338','96970','58315','26022',
                          '87582','81500','15182','93049','19793',
                          '95317','45746','42735','90648','88090',
                          '54603','35837','53040','24234','43680',
                          '34672','45876','67898','29634','35459',
                          '59042','33263','29750','26150','63366',
                          '96872','41331','71377','46709','18784',
                          '69347','70446','28542','98559','14171',
                          '86924','52721','39589','82645','45833',
                          '20304','26115','65309','35829','48295',
                          '89179','49811','33420','74346','20390',
                          '62355','10529','14414','37064','43511',
                          '92997','21626','64780','40316','59036',
                          '76149','52409','52835','10463','36706',
                          '12974','14518','94111','48100','94706',
                          '45441','12975','55967','56170','81131',
                          '50717','36250','27095','35043','33021',
                          '12674','53047','28456','93578','93769',
                          '77090','46858','68912','83775','28167',
                          '21606','87031','23383','80542','71431',
                          '23902','98572','37312','78814','21555',
                          '25376','99591','46676','39040','29761',
                          '18310','21015','55844','19812','45553',
                          '87863','45863','18074','55190','12187',
                          '78573','46740','72658','97165','94407',
                          '41025','36677','58679','18797','10459',
                          '34556','22512','53780','11353','54385',
                          '35830','73736','19599','45880','13109',
                          '40449','44936','22195','47547','92468',
                          '84077','21186','14369','61789','93401',
                          '44096','75787','79375','33444','42187',
                          '16685','70139','91643','41505','20188',
                          '15132','17162','70947','58243','89578',
                          '18665','75232','11180','62956','78668',
                          '61799','11022','46264','77679')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
