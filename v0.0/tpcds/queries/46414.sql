
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '11545','85886','52677','75632','30684','38690',
                          '18655','39264','56216','99221','10892',
                          '62318','62582','88484','59433','43570',
                          '21717','66099','23402','27729','95627',
                          '26853','37597','47434','81490','79609',
                          '12587','88518','74064','90675','83018',
                          '35067','31165','76249','49140','68215',
                          '49623','43913','66009','87248','41643',
                          '56448','43860','76571','27327','20101',
                          '72706','36058','44611','66276','20567',
                          '75109','96961','12407','19793','75704',
                          '44486','13886','46102','81186','58594',
                          '15627','92188','12954','97330','18256',
                          '90447','97735','17842','40520','36896',
                          '34066','10598','51779','68870','94087',
                          '91535','91627','80269','76057','27258',
                          '13163','42932','29671','54581','19659',
                          '54321','37162','73716','65151','34108',
                          '73326','57020','14287','19309','46217',
                          '84403','94906','59316','54952','81321',
                          '60589','74036','11096','85331','61204',
                          '67378','45529','16128','43233','59207',
                          '27511','72705','34081','93391','42396',
                          '10754','30474','94027','54270','65527',
                          '28688','58833','11896','23751','50496',
                          '89094','17337','10494','40388','47403',
                          '19914','89434','31891','50877','46652',
                          '72200','83884','61496','12289','47706',
                          '23258','71789','42923','13176','46705',
                          '95691','28957','50598','25278','61348',
                          '28076','87212','30263','86922','13287',
                          '75824','36470','82605','93174','96518',
                          '37237','11551','43374','22170','16819',
                          '20698','20459','58303','80488','68871',
                          '46023','77309','20892','46817','36983',
                          '89514','17395','24720','30344','67349',
                          '79897','28195','18605','94327','27896',
                          '45988','42882','72826','34055','55585',
                          '78811','48092','50313','83918','54334',
                          '37373','15038','50825','95006','83344',
                          '64236','30794','33687','18102','80243',
                          '72321','72093','40223','16745','36348',
                          '82166','26271','28430','71723','27530',
                          '31134','69952','81652','35162','40565',
                          '14985','16180','86580','94090','17693',
                          '58086','62945','38168','38275','48994',
                          '22014','31756','44126','97026','22948',
                          '80657','42841','37644','19844','12848',
                          '80809','36707','80110','51738','83516',
                          '10872','75288','99707','32689','11698',
                          '67930','56065','83853','44992','17184',
                          '47028','10407','58478','40380','17339',
                          '55153','69387','26668','71028','54775',
                          '17711','36778','26479','94891','72294',
                          '45212','56432','70987','75999','15711',
                          '58671','31472','93353','82671','54859',
                          '32213','50033','25531','11643','43025',
                          '40047','98297','53193','30765','68305',
                          '81309','21007','98913','91428','38086',
                          '94197','24959','91816','86617','35800',
                          '25472','10657','44617','41448','22202',
                          '11630','68148','65144','23144','25686',
                          '24409','84609','14388','12137','91291',
                          '61278','94385','82567','10192','57638',
                          '13773','92718','42292','26631','33081',
                          '78437','56866','14138','32877','71674',
                          '23462','16173','22756','26129','94722',
                          '70613','89278','10591','35490','89711',
                          '92275','34421','23867','36063','41798',
                          '10755','91286','11837','28919','94294',
                          '92727','91663','79392','60341','96523',
                          '30174','87165','71111','67471','91738',
                          '37144','70162','72789','36021','95743',
                          '73270','41928','12069','38725','53972',
                          '10570','25488','68901','48858','43409',
                          '24919','35088','74059','38714','49075',
                          '55038','11399','38571','46042','47954',
                          '18942','88348','63938','46928','28770',
                          '39817','63756','31822','72418','94892',
                          '92139','38724','60613','95848')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
