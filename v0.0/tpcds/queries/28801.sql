
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '41470','72726','47958','64729','72051','91437',
                          '12283','23970','12392','77232','58991',
                          '79848','60541','33539','90697','53725',
                          '22354','53532','98272','79993','59593',
                          '52771','16349','14153','73198','27448',
                          '98307','13534','47723','85120','47008',
                          '34922','25849','72131','63269','51134',
                          '48989','96699','82878','16327','70198',
                          '18074','51884','44508','99390','23331',
                          '94072','75697','11956','78956','18531',
                          '57566','78512','18334','10648','80940',
                          '93034','20819','77075','34911','63317',
                          '16008','80625','30864','16690','74467',
                          '42292','71185','47407','61799','85718',
                          '91496','49180','20254','46445','22812',
                          '99654','30853','67107','31915','21063',
                          '72798','72018','38085','10634','90596',
                          '13569','11632','63409','27240','97961',
                          '12954','22529','69583','56730','65062',
                          '66069','10710','19464','44773','23423',
                          '35816','23664','52911','57302','13365',
                          '31454','79167','97440','29629','78118',
                          '38285','65110','67332','83142','26159',
                          '72473','27132','22890','40567','84306',
                          '40413','26180','31701','89341','51154',
                          '31874','14387','26471','98441','35361',
                          '19834','22427','48355','68897','13293',
                          '98150','41567','11101','38425','67176',
                          '72742','91708','48281','69050','85852',
                          '82599','25883','39011','88589','71326',
                          '64518','59407','25669','98082','43863',
                          '91217','50287','29254','65984','29092',
                          '54388','25545','52950','35984','61841',
                          '66237','62616','83173','18079','67627',
                          '93333','77661','86215','68313','49017',
                          '13656','34465','18513','92762','67198',
                          '55450','41749','84335','59795','74322',
                          '33352','20448','29752','51804','20734',
                          '29432','66748','42402','38709','77554',
                          '19442','92251','76223','14162','32894',
                          '59545','58529','74497','41127','99760',
                          '19511','59641','51992','51637','37793',
                          '61520','15293','23037','26270','84115',
                          '99380','28250','58914','48375','97748',
                          '72459','85485','35764','10988','98158',
                          '14514','71808','84225','47545','68177',
                          '25047','78040','37949','15057','62363',
                          '66648','77979','76922','93382','18993',
                          '97155','72229','54401','44195','14549',
                          '30263','56185','10071','64722','34186',
                          '72421','11239','34181','68333','22393',
                          '46696','20637','81225','23002','21670',
                          '25480','55613','15914','51561','90197',
                          '81499','64326','61672','62033','68288',
                          '29123','66940','17245','23868','25925',
                          '43133','50236','15385','20368','28096',
                          '91365','84689','93164','87421','67856',
                          '34690','20198','13818','47851','67756',
                          '28481','46484','24898','35630','19561',
                          '79112','39053','38745','70524','19241',
                          '17682','55739','21634','20424','78459',
                          '48901','89635','76977','21429','46996',
                          '14369','90332','66002','57825','36337',
                          '15788','54030','27774','18296','37638',
                          '39542','17527','47366','46275','26728',
                          '98868','21654','47505','32369','60033',
                          '57598','45081','10323','39488','14679',
                          '98184','13611','80846','27408','57659',
                          '56812','25901','15522','63408','70755',
                          '55837','39987','12176','32881','14797',
                          '77215','52245','88178','49519','26059',
                          '58216','66390','91136','84585','67519',
                          '28379','53708','98786','93615','32818',
                          '17618','24088','61719','83832','40193',
                          '26678','35227','70045','22964','40356',
                          '48237','14038','65159','38063','35718',
                          '12498','33503','31143','11891','64343',
                          '42406','81275','18849','54100','30805',
                          '37188','59386','63140','40639','74617',
                          '44247','80184','48593','18853')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
