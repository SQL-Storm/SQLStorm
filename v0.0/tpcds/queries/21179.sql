
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '28985','27031','88610','55301','14519','18821',
                          '14681','48458','34474','45201','46804',
                          '50493','73135','29229','70864','38825',
                          '45692','75524','53006','93861','90236',
                          '56601','21210','38620','85686','43383',
                          '45520','75332','13955','82973','26786',
                          '47803','10095','42836','14408','28725',
                          '19325','13512','40043','65698','84168',
                          '35541','41898','28788','68891','57412',
                          '19623','66642','54309','62481','91059',
                          '47491','21680','79699','14588','26479',
                          '43520','66302','79270','33227','71220',
                          '88107','75392','71462','46739','93520',
                          '69701','34023','75642','33373','74276',
                          '76323','30740','24593','94305','72322',
                          '99118','18163','43854','53338','80962',
                          '18797','54478','48330','62859','48006',
                          '78930','99694','26687','37010','40627',
                          '30412','17903','15090','30911','99335',
                          '39372','37612','40148','66825','91313',
                          '57611','56522','87289','13950','77003',
                          '52402','75812','52189','55558','24919',
                          '23575','29213','55500','46923','79515',
                          '82050','11631','35647','89186','68361',
                          '54882','37550','48784','37098','44718',
                          '34879','36523','93106','86639','80835',
                          '23921','81852','80390','98460','82512',
                          '89542','13050','77021','25435','55015',
                          '26344','45620','98328','50685','98753',
                          '49935','14111','11484','58616','69375',
                          '60161','19197','23245','58099','41877',
                          '27740','41765','97223','11233','84618',
                          '18516','98152','37383','31237','37577',
                          '13080','18229','62936','33779','79462',
                          '71181','18593','50385','62979','71095',
                          '30085','16605','75973','18281','79518',
                          '21294','81292','27230','73534','42401',
                          '54744','47009','34329','88236','36224',
                          '80981','78489','81057','27856','98206',
                          '42469','16294','26999','47126','81842',
                          '72395','13550','47956','97597','88354',
                          '16754','49553','92367','95408','59782',
                          '66392','48227','16143','34545','40191',
                          '28201','86973','31666','96089','47474',
                          '49742','82819','16636','25649','33963',
                          '55281','87124','91871','38387','75907',
                          '49084','98382','45644','38375','17218',
                          '62355','48073','62933','49510','18958',
                          '87991','80444','54582','35971','38906',
                          '39513','75363','43896','41162','20395',
                          '85528','50316','81904','50938','54370',
                          '68354','17001','41267','57327','62731',
                          '37609','46849','87299','29500','97844',
                          '67083','71186','30016','99153','66704',
                          '83647','59447','21314','51343','54454',
                          '45560','26174','75457','79799','78392',
                          '67850','21474','17881','89460','40084',
                          '29222','27485','84314','69642','45088',
                          '59382','63427','60574','28036','70765',
                          '26027','23759','14613','98294','52057',
                          '98506','78433','19033','22765','59605',
                          '86210','38579','65659','84061','93870',
                          '35964','92832','74306','75966','37520',
                          '39955','42134','29634','72269','86850',
                          '46931','41427','25599','34691','99851',
                          '73854','65513','38623','69608','17140',
                          '67844','31223','88203','11388','73585',
                          '47402','92675','17949','59700','32146',
                          '23154','71002','17478','55926','13850',
                          '39255','39478','51146','23463','83964',
                          '91753','51571','43943','87352','60598',
                          '82330','76379','64786','17743','53863',
                          '47447','68320','66912','25377','70301',
                          '59531','87990','19169','59015','78321',
                          '11191','86759','83681','35133','63807',
                          '15158','57255','22479','70637','55421',
                          '76633','32722','27435','47455','88827',
                          '88047','69442','25429','54186','37133',
                          '10812','47608','39446','50808','74124',
                          '71559','22987','87992','10013')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
