
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '37638','16344','66095','36266','43918','16690',
                          '61493','63427','34494','20487','48602',
                          '70924','76789','11222','28609','19512',
                          '27858','49688','61372','16460','94618',
                          '62385','19281','53934','64408','66045',
                          '59382','82045','38345','86859','53455',
                          '89320','55219','92079','79765','96199',
                          '46812','73406','80282','50783','19177',
                          '38009','55834','15651','40470','79763',
                          '32635','61655','73951','59375','21496',
                          '56433','53940','32408','79891','61123',
                          '61012','19979','32560','39814','43211',
                          '98081','45397','57055','40571','51597',
                          '50823','12039','12823','37183','90685',
                          '84687','51818','35184','72874','59020',
                          '49213','49508','94268','45526','10628',
                          '46821','90856','25586','13390','79298',
                          '61266','25974','78909','87833','95527',
                          '54918','46033','76699','72130','41115',
                          '93673','85090','10178','15232','28620',
                          '66801','11643','86685','48624','82564',
                          '62837','29798','86385','10265','40108',
                          '84013','13395','35850','43759','17131',
                          '82299','26827','26644','66870','80079',
                          '54554','50580','57332','23464','69184',
                          '54227','22148','73236','53709','34898',
                          '18442','61450','11464','27863','45034',
                          '15062','89503','25045','45784','38807',
                          '33824','15832','38285','10519','49129',
                          '31060','18883','14176','11386','55429',
                          '85562','13722','53184','58654','80430',
                          '68351','87940','61827','71265','17786',
                          '78502','84501','13778','18747','30700',
                          '69066','91955','72307','59422','20987',
                          '89806','59430','14810','63925','98709',
                          '34307','34736','33422','77258','69651',
                          '60714','39249','60434','50290','88119',
                          '63048','66167','10224','92795','37377',
                          '56379','82745','14386','65445','25122',
                          '69281','90702','22245','23670','35489',
                          '24607','29157','32994','98224','10202',
                          '10100','43007','41332','75558','85480',
                          '68094','55630','13547','24779','29699',
                          '24384','74782','28063','23556','44445',
                          '61886','36528','82374','74578','58109',
                          '26626','40570','29188','10936','12999',
                          '27817','14686','36028','67817','74453',
                          '29319','83844','47303','53472','11759',
                          '69265','53699','58630','83754','40305',
                          '18118','51106','22716','42070','71129',
                          '10080','96141','24060','55646','28221',
                          '63915','32211','84253','59279','40510',
                          '91507','73177','32033','76819','65068',
                          '29218','88666','53114','80036','45543',
                          '73440','94243','19447','92972','57134',
                          '57769','64674','24533','97354','42318',
                          '89484','63924','10862','35239','88511',
                          '50847','97027','27667','43330','58193',
                          '45383','39423','42509','22360','17536',
                          '95994','61093','73243','49871','20539',
                          '50549','85407','11095','13821','26043',
                          '90708','93676','38586','64671','62929',
                          '85958','19213','95678','26849','20332',
                          '48576','30979','72795','35524','39244',
                          '35561','83601','39729','93203','13187',
                          '98721','74296','56516','20597','44160',
                          '38939','10753','20809','46790','39962',
                          '68941','21003','86941','55904','62551',
                          '16818','40260','20157','68096','11486',
                          '31813','51951','32844','21712','67248',
                          '97778','75690','63301','22849','23409',
                          '63972','22239','32867','44282','32137',
                          '74176','60334','15122','76315','43371',
                          '94847','87960','25415','13006','19670',
                          '29589','38782','83184','54517','11604',
                          '66166','81143','10402','22318','47514',
                          '12307','17321','79427','71243','23405',
                          '83242','32036','68432','16388','27198',
                          '72875','46185','48963','72567','67012',
                          '96598','39362','30785','54735')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
