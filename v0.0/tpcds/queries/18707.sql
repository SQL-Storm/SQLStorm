
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '79307','21533','47103','27753','52661','77032',
                          '63710','80490','44987','51293','38803',
                          '29038','34394','40678','60864','48116',
                          '17032','13637','81883','66784','17797',
                          '53669','83221','44439','68570','55833',
                          '82676','16386','87225','91697','85832',
                          '74109','58020','15709','21810','32608',
                          '93723','92249','53663','39205','26288',
                          '58854','63156','76128','69600','69777',
                          '15520','46769','59571','91565','20345',
                          '93330','45203','80920','12839','93537',
                          '59969','70300','43368','95193','98548',
                          '25182','38553','49548','51537','84514',
                          '40996','36282','90669','89305','22393',
                          '41133','42429','67818','68052','84828',
                          '53656','52299','29620','40281','82635',
                          '10930','15814','80985','91783','32476',
                          '56632','83217','98123','87959','15692',
                          '13895','86631','21126','44280','65329',
                          '43685','61566','24199','42516','60067',
                          '95147','85569','30216','38402','49186',
                          '83211','88331','11301','47218','93331',
                          '47881','27611','34772','59584','43984',
                          '43789','34634','24159','12346','34211',
                          '11958','12099','28719','47212','18952',
                          '50905','54541','47111','26002','69310',
                          '43763','46385','72837','42604','78505',
                          '67501','21960','43760','41573','96400',
                          '57672','27552','39727','32643','75663',
                          '31249','41818','12728','27042','88774',
                          '48382','34303','18118','53436','29993',
                          '95562','56438','89818','13937','73937',
                          '41543','58148','16899','21437','27976',
                          '32198','41794','33328','19597','88409',
                          '61484','76703','32913','87058','39237',
                          '13904','51777','91730','69476','95741',
                          '25794','25002','69224','96436','72722',
                          '84104','74400','12481','45873','39854',
                          '23887','54264','41165','10790','83201',
                          '35438','43342','18116','65535','72105',
                          '53485','19202','12602','84747','41662',
                          '16399','46965','48326','34924','39378',
                          '97667','48741','13392','23811','80368',
                          '60071','68183','38941','20881','23260',
                          '97056','99773','60451','66919','70929',
                          '72691','54502','75413','20446','38702',
                          '18025','79634','65896','54544','23181',
                          '36835','41936','94798','20575','87012',
                          '67429','78743','57493','40199','37416',
                          '23847','77283','19670','41955','40034',
                          '81362','96052','12218','76122','79773',
                          '81459','32620','55946','50313','63037',
                          '48177','55889','75744','76630','61630',
                          '57110','40761','42004','58059','47465',
                          '65630','33172','93216','60394','11201',
                          '99886','82742','77210','52442','51713',
                          '94674','56288','60514','41504','68607',
                          '23923','75596','81881','55967','76910',
                          '64992','21783','13006','41801','17184',
                          '57029','13159','22074','78140','30083',
                          '99220','72957','98933','65884','62281',
                          '77650','68486','63390','34110','47283',
                          '35127','43553','21110','38114','73469',
                          '89695','57875','12924','44442','54383',
                          '17666','95064','48107','39985','59150',
                          '56023','70304','15843','19056','30001',
                          '11056','95803','53976','57496','79218',
                          '22443','98952','32237','35215','87574',
                          '88937','11324','25175','69696','47746',
                          '60634','21199','59481','58789','72836',
                          '42044','24097','99484','29756','82393',
                          '86741','21403','14247','54479','69354',
                          '46431','35190','54710','26832','35451',
                          '42905','27312','71388','58533','48672',
                          '14015','95606','92172','53419','56234',
                          '85625','39968','54352','49632','12917',
                          '27558','83992','92719','21225','26327',
                          '46589','67235','52985','24056','49253',
                          '72334','16187','86325','48551','19609',
                          '84731','88235','28627','64896')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
