
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '66745','38643','88283','95149','45154','53372',
                          '87183','40459','13725','69597','87032',
                          '70962','11709','73101','29040','18345',
                          '34531','59285','72459','75660','90205',
                          '24451','99508','37033','26179','24415',
                          '47370','52486','22796','52255','78562',
                          '74325','68361','19997','17794','71436',
                          '15241','14725','66212','46234','64708',
                          '92041','21073','62353','24306','15350',
                          '54276','34344','47855','60498','50839',
                          '82030','64524','68675','99246','95994',
                          '79402','88898','39018','33419','69570',
                          '64457','49965','73869','74130','25621',
                          '90961','84363','20598','48724','38027',
                          '59021','87502','40066','93322','20007',
                          '81874','47161','21101','25767','24588',
                          '94443','23618','69462','54033','55286',
                          '80149','47869','41454','92717','18641',
                          '77397','78814','42801','66741','52941',
                          '63787','58834','62096','32047','16965',
                          '89411','36529','60053','59786','17512',
                          '29995','99463','65506','36665','67970',
                          '61838','32889','30863','46582','71442',
                          '28400','73007','17264','80839','15479',
                          '65860','79942','39195','53818','31072',
                          '90541','34086','32412','13654','37171',
                          '44708','80701','64846','97597','36195',
                          '44968','93736','67839','31007','30986',
                          '28750','66044','24090','79464','36257',
                          '53389','83844','12172','16568','92473',
                          '19125','92560','49550','81214','49059',
                          '98309','70531','99767','74628','52461',
                          '55071','53501','16389','47038','95775',
                          '19902','91658','91696','68582','32032',
                          '82122','82033','83888','51868','14117',
                          '15647','21373','91509','31772','21657',
                          '95111','84138','71300','84826','68519',
                          '14538','74318','53473','84736','17425',
                          '59135','74228','84344','37865','19179',
                          '20547','95386','53086','56675','78116',
                          '20999','50994','78980','67364','27352',
                          '25694','37183','18473','61853','37437',
                          '45957','45742','58390','60688','32916',
                          '29497','55966','18812','45075','44671',
                          '75656','90564','16918','48011','28231',
                          '27650','18061','31897','35179','80278',
                          '16884','95320','28994','29443','32359',
                          '99926','32632','37201','85482','20749',
                          '90416','31160','26918','27404','23619',
                          '26747','16904','77090','20414','13930',
                          '73914','12670','27478','27356','35356',
                          '33971','34826','60929','59014','93994',
                          '11505','28786','11555','10328','88814',
                          '93177','82979','76539','88179','55092',
                          '47011','79219','16412','91620','54344',
                          '12696','84020','24679','33855','84353',
                          '68450','95616','74601','79797','23847',
                          '55245','53334','93673','31862','69898',
                          '86486','93335','93876','64045','32606',
                          '94333','79630','11124','49863','28620',
                          '64631','81527','69799','65424','43708',
                          '91957','87379','34506','26105','71538',
                          '50002','86037','67916','11656','16342',
                          '34722','94861','21278','89531','82126',
                          '80397','63507','74249','68835','25912',
                          '18867','33852','44824','41789','35184',
                          '28926','18610','40891','23603','53128',
                          '13174','49360','66367','76815','13445',
                          '10219','14838','44195','92906','45053',
                          '13734','69330','91236','24020','46535',
                          '17596','15252','86254','48545','50193',
                          '93911','30623','97233','54114','18846',
                          '17251','30897','41782','26497','61885',
                          '30034','70231','11318','57332','24437',
                          '67997','23464','92400','64035','58401',
                          '56751','54793','23623','59658','39879',
                          '16919','59380','38995','12394','39610',
                          '49724','97215','15778','15632','57543',
                          '40925','22502','45446','21146','95739',
                          '22368','50353','40810','27351')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
