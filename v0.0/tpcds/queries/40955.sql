
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12660','71137','54273','35408','60652','99325',
                          '21129','18346','44334','92894','54641',
                          '56424','86545','53419','13174','46975',
                          '19755','24646','94798','18726','71943',
                          '50314','20506','14986','86210','15438',
                          '37331','89365','78415','69322','28283',
                          '36359','68502','55016','63620','49601',
                          '31523','42144','53910','36214','34948',
                          '33093','26179','21946','53588','33922',
                          '17625','34451','57544','23687','61567',
                          '49849','10991','83535','85054','59112',
                          '81464','63644','76077','67726','53071',
                          '32448','31328','22432','47581','20558',
                          '19531','15951','33304','79287','20096',
                          '11503','86550','90200','87035','70410',
                          '27211','13056','27205','90001','29416',
                          '25681','45191','76149','35313','36346',
                          '48698','14970','58883','73291','20347',
                          '11680','39128','35947','32487','29131',
                          '21139','79770','46752','49860','20457',
                          '18020','51438','50251','96974','31959',
                          '14840','34537','18397','52661','16859',
                          '44732','55599','42286','14502','35211',
                          '99393','10029','80875','35189','32606',
                          '62821','99084','34541','57762','10532',
                          '96839','56822','40612','39199','91928',
                          '19537','99423','72962','72739','48748',
                          '35066','75129','47774','49702','83935',
                          '37915','71998','17714','79715','38459',
                          '45496','39400','89512','45973','42056',
                          '99332','87603','42124','16036','12773',
                          '60989','69877','94930','36237','30589',
                          '87494','28469','60770','22679','50443',
                          '69863','29506','79606','86209','15889',
                          '13319','34576','84404','83313','38723',
                          '39398','60405','44891','48453','23731',
                          '17108','34943','33062','68773','13376',
                          '13269','25170','78313','16305','15294',
                          '49466','58279','29806','81568','99622',
                          '54012','11854','28017','27858','94497',
                          '50070','33913','20483','65563','78839',
                          '25947','24262','71441','73300','29040',
                          '15676','76555','13957','24019','58719',
                          '29512','23715','33964','18584','34908',
                          '23692','80676','39309','83666','40575',
                          '95171','22913','16410','59371','28635',
                          '52050','76078','23267','43233','19341',
                          '75768','59895','29700','41317','54505',
                          '10593','24082','18326','45038','94864',
                          '54779','30611','77687','99799','27911',
                          '60230','31203','55229','65244','53612',
                          '99434','57346','95495','77495','63196',
                          '71152','78468','83386','44681','45925',
                          '11261','15460','55877','15975','28911',
                          '54136','75608','43704','79507','47653',
                          '13991','17797','45579','64602','45607',
                          '51311','35480','23198','88845','79910',
                          '52954','14976','20206','91481','19949',
                          '30984','23157','57087','72130','19856',
                          '22049','28532','12224','12572','84855',
                          '76420','35497','17483','82979','70182',
                          '19161','12398','40915','52447','55056',
                          '24899','37064','68933','65289','89068',
                          '89160','88965','35196','23785','32380',
                          '73843','24090','10791','16509','77560',
                          '96373','77953','72688','50849','81546',
                          '55996','20029','30439','72319','33743',
                          '15413','10837','16013','24564','45108',
                          '91298','91519','42861','17702','37986',
                          '34477','91716','94317','93947','24393',
                          '48761','17657','38982','46742','22865',
                          '88691','59017','26516','77071','54189',
                          '79406','68527','53876','15194','20515',
                          '53923','41407','96317','58012','57264',
                          '43761','73413','71571','49308','33825',
                          '91555','11275','85997','16275','24532',
                          '64603','20791','81226','91252','25539',
                          '24582','67280','19323','40901','42280',
                          '41491','48767','68791','35823','16405',
                          '92749','97056','16453','55206')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
