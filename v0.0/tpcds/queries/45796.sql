
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '52881','23888','28772','47259','76398','37410',
                          '45920','30695','30011','58706','88711',
                          '59503','23520','77146','65323','37512',
                          '33521','85522','29167','93511','21645',
                          '62792','54100','95891','43979','92256',
                          '74359','73211','39975','77560','51383',
                          '22913','93553','92320','22243','82142',
                          '16919','20580','60146','67946','15249',
                          '26714','81808','91124','84210','51952',
                          '24986','46756','20388','33147','34476',
                          '16579','93252','44938','56390','66221',
                          '92010','65400','81334','67325','10230',
                          '30123','86452','24529','31425','57379',
                          '17168','33233','74679','56940','11976',
                          '14111','29650','54454','26213','23362',
                          '28833','58687','70552','26473','48906',
                          '37376','28570','18332','40850','24587',
                          '38882','24270','34543','73464','76074',
                          '26171','55773','94538','70166','79137',
                          '12081','37529','38427','60680','48463',
                          '42359','69371','76817','89846','12515',
                          '48377','48060','60789','12110','62232',
                          '24226','19223','92070','67248','35208',
                          '15235','34343','82708','22480','38936',
                          '62027','33483','61427','71518','34064',
                          '90690','73457','99706','86979','72310',
                          '56283','96876','14725','24571','50572',
                          '18302','48407','90775','82944','10107',
                          '48292','50102','55928','17631','67947',
                          '17112','50335','30067','13056','94368',
                          '53034','18892','99755','39126','24574',
                          '10045','13674','90304','86062','23544',
                          '77490','15940','86894','20247','30335',
                          '75813','32413','64767','33541','80053',
                          '30091','27764','57619','17978','84944',
                          '57709','14781','80733','26022','32262',
                          '63768','20511','91118','19914','40607',
                          '17054','59345','89227','78485','78545',
                          '37113','70655','45694','20842','10600',
                          '28612','98625','38972','97831','15429',
                          '89673','10541','56388','45002','88037',
                          '29095','83744','93562','12040','15204',
                          '65648','48015','28450','76137','98162',
                          '68343','42874','52531','40403','32557',
                          '28544','92265','24865','12754','24910',
                          '29868','86363','85743','33284','20758',
                          '29580','41463','48687','98356','90417',
                          '63668','33174','15921','62821','71030',
                          '40914','46853','49002','58101','81477',
                          '15481','95592','96991','67300','35260',
                          '46725','44952','77095','64319','23648',
                          '38351','85167','36335','95761','57314',
                          '85527','88870','97145','43908','54916',
                          '28222','89740','47257','23776','40203',
                          '51037','95838','57331','14207','93569',
                          '29282','39988','89603','22225','77878',
                          '23865','34219','12576','40110','90113',
                          '46217','81775','40473','37284','58344',
                          '29966','60982','87865','84048','28496',
                          '65987','69297','71957','24902','67361',
                          '22718','52645','74290','45217','96773',
                          '19147','76871','96619','59584','76700',
                          '55235','54554','18785','70557','81368',
                          '56600','99404','43820','27197','70674',
                          '39258','60900','59630','39248','26356',
                          '52652','76776','22305','71655','55443',
                          '12474','13679','28511','60156','11368',
                          '32023','37591','53149','97602','89644',
                          '84324','98045','55080','77814','60062',
                          '12658','58130','41039','76636','20526',
                          '63477','14930','27503','80266','81547',
                          '82620','25823','53948','43021','34323',
                          '61355','30429','13871','34567','54218',
                          '63204','64540','82499','44211','40751',
                          '31342','70954','67152','53682','47147',
                          '25919','54414','51056','44536','39427',
                          '26051','15928','94274','61189','87994',
                          '72109','35280','38565','75930','24898',
                          '73649','71829','36864','56492','51628',
                          '63761','73441','56568','37996')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
