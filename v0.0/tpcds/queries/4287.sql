
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '30143','40807','21133','15075','99013','60469',
                          '68546','34254','55504','62114','30342',
                          '45100','29965','80458','73729','48455',
                          '59460','32576','59192','44401','58816',
                          '15749','22011','46410','93757','14863',
                          '10833','11383','38423','37119','45865',
                          '89188','20407','29644','59865','21827',
                          '16415','86608','54440','35634','24695',
                          '37259','18601','29527','82992','94085',
                          '94294','59047','99500','49104','23073',
                          '78628','98811','86718','62131','30826',
                          '12779','69401','63388','76425','43664',
                          '16419','36833','83460','60934','11401',
                          '73027','46283','98011','57053','35976',
                          '22196','85019','90918','56455','47605',
                          '55145','34781','38411','89233','62171',
                          '14232','81293','32600','58503','94564',
                          '93495','61849','37971','95756','91250',
                          '85656','34048','50133','14002','42844',
                          '28654','50951','16291','41116','93799',
                          '47282','63203','53761','50875','44736',
                          '17811','83480','15758','47742','83849',
                          '57878','17357','48453','42132','24974',
                          '37232','49889','48252','14199','38882',
                          '46680','56682','71653','41985','29415',
                          '88829','54202','27295','14267','23199',
                          '87023','41554','47307','82851','27486',
                          '22300','70629','26899','23238','32528',
                          '27091','19463','83243','17560','36297',
                          '64389','77681','27490','21755','99935',
                          '95288','70383','95310','82262','42067',
                          '93601','42724','88436','46502','29891',
                          '15974','78666','48810','50269','41336',
                          '99410','31682','80165','74848','45720',
                          '24966','30177','96803','22663','14720',
                          '35961','40548','53133','33204','12274',
                          '74846','79915','25704','85023','19771',
                          '89223','28775','86007','26261','72883',
                          '92602','99568','35981','72474','89201',
                          '10727','24883','71515','54814','57482',
                          '94453','89599','85919','85777','13029',
                          '99034','88321','37171','66574','12856',
                          '80429','91897','75292','36482','12171',
                          '70049','13194','69333','99080','13128',
                          '36525','11053','89408','18249','45722',
                          '55666','59590','29087','86509','14947',
                          '28352','17353','19479','12133','36188',
                          '42559','44999','82143','81443','86425',
                          '71727','29987','24290','38395','43329',
                          '11936','30498','64843','19215','94633',
                          '29986','42496','61475','88490','67459',
                          '34408','91865','43679','10232','17751',
                          '59361','13282','12869','19892','27255',
                          '21361','45425','24231','64159','10550',
                          '50388','99598','50622','69603','52046',
                          '11869','16987','23038','88401','35568',
                          '79008','82846','24852','52918','53091',
                          '81577','83952','27037','27054','41001',
                          '69993','85500','86340','32163','46898',
                          '79620','76034','17216','69300','17750',
                          '19426','27442','51293','58743','14662',
                          '88135','51081','12380','29526','81903',
                          '35741','26943','18131','32303','19330',
                          '42747','45809','31742','15160','70252',
                          '79580','59306','81341','60495','78149',
                          '93421','15553','57779','76272','40289',
                          '36005','78263','45806','48165','43691',
                          '23599','80509','95491','23007','29432',
                          '81532','72614','52777','72195','96501',
                          '15622','62093','24462','73515','51444',
                          '47136','52692','24004','41640','88196',
                          '51022','43567','18317','34816','30824',
                          '49121','43470','68780','99466','16201',
                          '93040','17207','93800','99503','14726',
                          '49106','68067','19366','43816','18057',
                          '19967','89652','98978','44404','17597',
                          '73345','98203','66537','13031','74034',
                          '86597','90715','22372','11007','15008',
                          '80356','63628','56218','49521','89463',
                          '11282','58190','92978','74319')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
