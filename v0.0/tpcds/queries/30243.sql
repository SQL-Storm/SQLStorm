
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '39601','74274','12741','66502','25328','39550',
                          '43936','12865','77459','55020','57711',
                          '62115','17203','23430','10496','30302',
                          '34937','21706','85455','17518','92526',
                          '60362','35836','30837','51483','90774',
                          '53123','11335','14833','33890','14961',
                          '62428','29300','76561','91752','88004',
                          '41989','42109','78826','11508','74347',
                          '11087','96831','10551','30698','79015',
                          '60052','36461','16681','32980','50629',
                          '76356','15226','65418','46676','39113',
                          '84713','84113','65233','30595','42040',
                          '66126','27615','95917','41744','73400',
                          '70063','54127','67554','17483','79498',
                          '80083','28429','70715','63745','93229',
                          '95845','28328','43804','56390','83935',
                          '98897','59045','41618','99131','20592',
                          '53705','44702','71459','21010','77934',
                          '65991','14219','15353','55432','44664',
                          '80766','37962','79443','18182','29324',
                          '93626','58298','65380','92191','95600',
                          '58629','70497','69359','40881','32783',
                          '23789','39805','18755','50756','92561',
                          '24613','32744','97758','62546','70286',
                          '65122','90496','17383','26348','75521',
                          '34503','84358','66471','39863','54989',
                          '15508','70055','32908','65425','92969',
                          '52810','13366','32813','28298','83270',
                          '51054','61477','72695','30126','53274',
                          '30717','33761','48473','27863','68049',
                          '14070','16969','86223','20744','73522',
                          '93319','71731','29800','98096','40843',
                          '58049','36298','22078','85340','37433',
                          '57179','37030','10034','12157','12452',
                          '25829','12657','26027','38827','13550',
                          '62059','40556','73690','16853','10659',
                          '24333','84314','61687','30319','51048',
                          '19914','14394','42487','95417','96528',
                          '57111','18644','50081','73942','85001',
                          '76163','44284','38463','79104','39026',
                          '23598','19212','68534','33639','94295',
                          '38267','46111','32897','82284','57362',
                          '86704','43011','14795','49616','27582',
                          '83103','73029','42523','41672','97953',
                          '22022','85364','31754','93446','83560',
                          '69336','82946','98025','82747','81465',
                          '77292','47321','16263','18968','45075',
                          '42852','99325','59182','24658','85916',
                          '42059','82246','46381','62135','47705',
                          '20637','21005','34498','99911','27413',
                          '20291','24445','28495','14506','24648',
                          '80390','43427','65736','60035','37775',
                          '74801','82173','34605','78459','44886',
                          '89521','42369','13834','51000','51936',
                          '54428','39810','26326','51924','36005',
                          '32066','98836','17613','11072','89130',
                          '52457','92062','31766','30131','20148',
                          '55133','48773','76385','83354','17460',
                          '40784','17553','54272','24868','76245',
                          '71363','15924','17693','13212','94372',
                          '80547','98749','35398','32001','38318',
                          '20891','11399','15196','50245','80081',
                          '77559','54719','80596','30796','91757',
                          '15594','60779','41845','22548','19876',
                          '56929','13169','21187','83917','86382',
                          '67629','66598','64388','46128','53630',
                          '27472','37835','75900','97149','63985',
                          '46952','59244','60112','39315','19609',
                          '92483','46877','63112','89083','96818',
                          '60368','23120','12799','65111','14489',
                          '31711','96067','30728','70533','19198',
                          '80019','24632','95878','29479','95192',
                          '25893','30306','18519','18962','12792',
                          '30493','28666','80446','94300','60585',
                          '39148','29259','34951','99711','25039',
                          '84190','20447','77055','86584','52021',
                          '35360','94081','54765','50156','22221',
                          '44291','43428','58989','56350','34785',
                          '11319','37767','21547','71719','96355',
                          '57497','78400','60356','84750')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
