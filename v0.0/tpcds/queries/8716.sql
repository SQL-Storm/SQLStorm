
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '38500','75366','12133','67616','35178','35140',
                          '21680','69367','57001','83218','17261',
                          '67079','36498','14473','53146','46569',
                          '31802','32549','78945','62452','82445',
                          '15368','64921','10384','61045','80338',
                          '87172','57814','17218','50311','55651',
                          '16000','92828','38491','93681','77055',
                          '49579','27645','94273','40893','65051',
                          '11781','67641','85603','95801','37664',
                          '80636','60933','70225','13054','79164',
                          '83453','29498','80278','83914','65357',
                          '76834','97391','88299','86247','17990',
                          '93960','13970','18055','47113','38169',
                          '45814','35318','36798','50343','34934',
                          '92345','50831','31416','82039','66869',
                          '95364','95137','63954','62659','50465',
                          '24010','26622','26392','48760','94923',
                          '26456','67108','55820','61536','74159',
                          '47792','95231','32894','64564','24144',
                          '27078','45657','88163','37888','42853',
                          '84458','91405','94252','22791','37668',
                          '46508','37769','64963','39100','67105',
                          '70656','73116','35544','90402','78298',
                          '46462','14484','27565','68099','45137',
                          '20144','60184','70887','71302','75535',
                          '40013','51025','85942','48563','92534',
                          '23215','14344','57266','31378','14471',
                          '28086','75775','33877','88998','65135',
                          '14700','33436','19545','84290','34112',
                          '21198','18692','80922','18158','10648',
                          '19188','66951','63709','37038','94157',
                          '92721','45127','56344','34261','76379',
                          '86401','41413','43366','44000','17874',
                          '80965','22557','57064','34613','18730',
                          '30693','53180','17077','27191','81240',
                          '36697','12369','24672','20897','67600',
                          '62916','35778','92559','84549','52598',
                          '25209','86940','14186','82719','46583',
                          '61288','12959','76672','14230','83085',
                          '84310','24752','56186','91568','56354',
                          '27257','69501','66776','93021','23182',
                          '11523','15937','89114','92277','78982',
                          '23307','78267','12746','64709','82586',
                          '97241','57253','67485','11905','74170',
                          '30042','73346','63639','90601','12790',
                          '19325','75382','24613','42554','34772',
                          '21224','64955','51964','61148','74091',
                          '90051','55425','67112','69319','76988',
                          '39808','70025','92639','13360','17848',
                          '51528','77792','57122','23077','45380',
                          '81298','62985','85994','38216','38649',
                          '32759','99083','92694','98049','19131',
                          '18076','71971','43250','74237','84697',
                          '89336','41792','48323','39268','43770',
                          '33653','61282','42227','19635','88171',
                          '17867','96711','34419','43320','47045',
                          '65933','83842','17020','40015','68315',
                          '80902','30012','67621','21730','42058',
                          '41727','29438','42279','24221','22918',
                          '30034','62667','42017','28001','32329',
                          '47671','52744','75190','42065','26885',
                          '19333','36955','54093','43494','35051',
                          '69430','35369','89080','48201','76812',
                          '65799','75104','14803','35577','20862',
                          '41145','85936','30641','94998','90312',
                          '57241','66572','16182','33813','52023',
                          '94909','39520','12203','74059','45539',
                          '78462','57479','46894','64986','45345',
                          '42783','29605','44687','88291','55813',
                          '33755','53223','28260','56928','99082',
                          '25697','67214','80865','92234','26063',
                          '84915','95659','45574','50871','64080',
                          '55844','11634','64507','79756','88436',
                          '19120','87276','10829','78019','46487',
                          '29563','68119','80164','99058','42965',
                          '93060','69760','63276','75616','84794',
                          '75689','30523','61646','97808','79559',
                          '64479','32271','68206','53711','31805',
                          '49375','49791','84003','11848','38748',
                          '15322','91124','85849','75159')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
