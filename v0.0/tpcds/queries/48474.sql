
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '63245','20715','65813','29009','19779','35960',
                          '58265','45456','24807','42738','29238',
                          '53806','62081','25113','84884','44656',
                          '28410','96749','41251','76388','55036',
                          '46564','88038','25483','17388','59914',
                          '20180','81380','17199','52564','45088',
                          '11962','64397','87567','30146','18994',
                          '67886','28070','55673','38162','93811',
                          '97865','78897','28061','14880','38347',
                          '55665','25047','48721','82617','85429',
                          '47807','70532','21806','46661','21099',
                          '77024','69100','29511','80192','13481',
                          '39433','83367','63924','12778','96942',
                          '77125','71021','65137','43715','55958',
                          '11152','70241','57408','24765','87465',
                          '86443','93172','33827','94220','98084',
                          '27381','75738','81410','93499','11397',
                          '25513','25283','84163','53531','86931',
                          '22251','31426','24617','28098','35843',
                          '58535','12195','19672','57555','31585',
                          '71642','83785','93410','52729','60304',
                          '65403','92915','25751','23508','89273',
                          '53093','24419','25657','86212','18005',
                          '16443','52909','99581','20915','34728',
                          '37959','38327','60494','31701','84850',
                          '83774','37105','90983','89984','19936',
                          '12031','74879','24784','63916','38412',
                          '90128','24704','59749','98060','84782',
                          '54541','77388','24988','40052','69008',
                          '96411','32820','31034','81129','79295',
                          '59686','11904','24635','38341','39691',
                          '34810','75286','62460','80156','75787',
                          '37079','92765','74619','31720','28014',
                          '56219','73304','51580','71109','42481',
                          '85562','36030','28357','33378','98937',
                          '63040','15900','43091','44121','22771',
                          '12055','25229','80419','74597','46137',
                          '88223','29444','36323','39119','77373',
                          '64424','44135','28844','17100','65152',
                          '67712','41825','41263','45001','23870',
                          '15445','19801','90367','72654','40482',
                          '30468','95321','62769','45903','25381',
                          '51396','57397','53522','45446','65629',
                          '46590','50811','26882','30606','72311',
                          '31598','67636','37326','54018','34718',
                          '42490','43332','14220','43015','16761',
                          '59845','34397','16106','25124','34549',
                          '89993','43208','31697','40246','64733',
                          '19040','47031','66766','14386','18491',
                          '29865','68407','23296','56834','29576',
                          '22631','21791','15942','96522','55376',
                          '63488','21684','71802','60509','96156',
                          '11312','20123','50160','81594','79264',
                          '27202','21874','78023','10931','95045',
                          '70026','27779','82868','28126','56251',
                          '17974','50326','80269','54291','20257',
                          '12983','10145','24082','64659','45697',
                          '21584','33998','12085','29709','12079',
                          '53384','88114','85397','33532','12885',
                          '51196','98344','40366','46399','27775',
                          '95458','27187','37658','67925','92292',
                          '97157','83895','48730','10594','53329',
                          '46875','46443','19713','13321','59513',
                          '48989','74988','97978','79932','26934',
                          '76482','41236','47453','74222','64537',
                          '37746','97983','88759','18819','58870',
                          '94324','15956','17380','43274','10015',
                          '97714','29844','42727','43557','51314',
                          '55263','28388','22970','65967','19963',
                          '23499','10054','20803','82459','61787',
                          '50112','12483','53287','97684','46589',
                          '35366','28344','16818','55154','11527',
                          '18343','77659','27175','13466','96911',
                          '89114','41191','96714','11155','43083',
                          '89107','22990','89224','53868','73636',
                          '97814','44122','37962','81756','25378',
                          '77265','25913','79054','53157','54536',
                          '62042','79305','81235','17099','99594',
                          '88834','72241','12380','43565','71211',
                          '48633','83679','40378','21899')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
