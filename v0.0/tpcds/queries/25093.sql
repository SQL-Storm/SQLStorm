
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '39830','50364','11116','17028','27191','60166',
                          '46719','29616','50025','50815','64200',
                          '31156','26189','31367','59178','45578',
                          '17562','75614','99296','12605','81778',
                          '31314','41855','18326','10634','55767',
                          '50163','47521','32553','29353','75650',
                          '24830','48007','52424','12394','52391',
                          '74017','36065','47236','50412','93411',
                          '39438','81799','41826','66524','52662',
                          '45720','32111','43068','48549','76199',
                          '26795','89881','18151','89087','99804',
                          '70417','75022','35291','30274','34171',
                          '21150','31491','87706','63549','12516',
                          '64865','22936','24384','91351','10028',
                          '99432','10792','65978','39849','80580',
                          '85164','31893','87594','13486','49117',
                          '35855','83787','19292','52188','40595',
                          '56211','28053','58026','36935','95628',
                          '97075','78342','22481','90484','48765',
                          '22453','18395','26505','60020','82021',
                          '41558','98964','40883','71686','44378',
                          '43838','11881','17048','82376','86265',
                          '55085','55548','94618','99876','90621',
                          '59379','26809','20677','66936','32116',
                          '19315','15962','48220','93688','79073',
                          '89756','98874','32824','56213','64441',
                          '40352','82536','53781','83332','35748',
                          '96075','29132','11769','28857','48073',
                          '20662','92565','48498','79310','80071',
                          '36961','36501','76088','39747','13601',
                          '15169','70701','19419','32529','62760',
                          '54501','14825','40982','18687','46673',
                          '39248','67510','16221','50906','74991',
                          '23470','23869','83022','16583','32729',
                          '56583','93399','31740','20051','97090',
                          '24809','36877','25377','25173','91048',
                          '36253','80538','45161','97440','38413',
                          '53442','47085','91005','22369','32734',
                          '33958','12570','20611','63767','90392',
                          '44033','15773','44212','59110','35093',
                          '52380','75399','54155','62089','77965',
                          '50421','20248','36965','43909','12580',
                          '51087','61345','76800','25790','83748',
                          '15843','48467','23754','24517','51721',
                          '60629','94101','70752','72893','33956',
                          '42885','53023','55634','81443','38382',
                          '98410','78907','77316','60910','10910',
                          '27547','96564','86670','20718','53549',
                          '68618','48895','87239','70545','82092',
                          '73518','87356','78405','88151','18455',
                          '34463','20274','95542','25594','67849',
                          '80970','84258','19308','64400','41815',
                          '38246','80793','90065','18039','90425',
                          '62535','37807','24888','30129','43036',
                          '24821','78923','60928','59416','69452',
                          '69487','82273','88765','37132','81896',
                          '81219','69969','15675','16204','48267',
                          '21019','18512','86876','62519','81146',
                          '77733','24127','32159','16634','79003',
                          '84898','40627','37370','17391','50037',
                          '24250','45329','23775','23314','48450',
                          '70734','21932','43133','67222','82310',
                          '18261','41116','38403','84456','47536',
                          '37206','68415','55874','80671','16787',
                          '79886','55633','58577','48070','41490',
                          '62575','61117','96881','77084','37012',
                          '47926','77473','11882','40119','70672',
                          '17705','86579','36199','23396','67513',
                          '13301','67904','61316','80324','26022',
                          '65396','31525','32550','78795','28166',
                          '95906','32598','99167','67254','32916',
                          '36459','90103','96675','41091','46894',
                          '77771','21778','49794','42893','96076',
                          '10155','29334','43360','22227','54284',
                          '97670','33015','30487','76994','48456',
                          '81484','81741','13158','89635','43709',
                          '62917','59100','49692','97436','13429',
                          '22234','67744','50428','94605','18026',
                          '34590','46419','63096','74878','71455',
                          '45321','35743','91369','50645')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
