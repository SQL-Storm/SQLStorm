
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '46327','78463','30809','71933','32849','31427',
                          '44275','15095','77437','71883','69343',
                          '88148','36316','11230','25937','11896',
                          '45705','21919','18812','26206','40211',
                          '29671','50852','59969','19891','51040',
                          '31601','47892','45889','33778','98232',
                          '26028','17042','78552','81572','60771',
                          '82832','30935','52261','19483','16512',
                          '20808','17429','29680','20959','23901',
                          '22330','38530','21354','37615','37662',
                          '99959','16658','63571','14083','43483',
                          '61650','20342','73353','49691','74596',
                          '50265','50007','29919','57447','11765',
                          '55103','15447','46085','66435','98371',
                          '37624','39880','31236','89000','25217',
                          '43987','49750','73294','18015','39678',
                          '80309','40557','25183','16256','94122',
                          '47226','36358','44938','17540','70164',
                          '82026','53012','43043','28461','41419',
                          '51744','10689','50893','82051','92326',
                          '16149','24318','77846','49501','48817',
                          '47937','32513','66847','49339','89095',
                          '37477','34257','39275','26654','29900',
                          '22273','56957','72207','40898','15336',
                          '86643','34980','89250','18690','15889',
                          '86780','56670','73236','50135','78908',
                          '66689','39124','62878','67929','17411',
                          '19317','17211','66872','34037','12254',
                          '22691','97030','70582','66810','81035',
                          '42867','36985','13923','69703','91060',
                          '28749','71042','83612','10220','31102',
                          '81347','91772','33745','87374','11448',
                          '32883','15859','44580','29300','17195',
                          '66293','76152','42186','18496','20847',
                          '20073','97105','21290','48386','21860',
                          '46676','29589','43165','24963','59072',
                          '11761','74647','49020','94423','35466',
                          '40505','22552','73083','55868','43934',
                          '55911','14297','40565','43986','82964',
                          '42779','55820','58469','34378','55939',
                          '85066','49348','33833','14491','72227',
                          '24116','39929','86383','27853','49245',
                          '48664','54656','14022','37949','60850',
                          '39370','26157','85908','82534','61696',
                          '49426','88903','17076','22223','32660',
                          '89531','38467','25187','12992','41095',
                          '69700','37584','38516','40135','54447',
                          '15181','43951','65177','66220','17118',
                          '70881','73672','18964','19230','10511',
                          '17250','15406','22255','90890','44571',
                          '73596','24596','28790','49286','58958',
                          '96209','57535','44834','34554','11907',
                          '93657','12706','62806','69490','32211',
                          '52067','26478','26785','29734','27777',
                          '39336','33756','24545','65881','45314',
                          '11091','10931','70500','36735','91408',
                          '18693','53122','46430','11508','98755',
                          '89178','67010','79639','19289','31081',
                          '76916','95850','58064','89810','84233',
                          '38974','91922','36694','23069','59767',
                          '30210','55331','75036','32599','54226',
                          '32308','70364','68359','87572','95942',
                          '45112','72421','58019','66953','69766',
                          '62610','19727','25233','98722','13773',
                          '70056','57841','38573','89129','60549',
                          '40477','94035','10671','25864','77926',
                          '91493','33688','54582','21801','26099',
                          '63565','55753','51599','47586','19041',
                          '52012','44685','82095','54132','88268',
                          '79371','34947','43802','73329','37147',
                          '77186','70021','39821','41657','97893',
                          '75306','40275','38401','46872','68585',
                          '95043','83105','11876','41054','38549',
                          '31983','62734','78666','93834','17309',
                          '52394','76348','21671','20811','92173',
                          '26244','47542','15080','28794','29367',
                          '65351','97805','24770','96405','45206',
                          '89447','54827','52854','85766','20565',
                          '15229','72994','76443','58624','29431',
                          '79151','83020','70240','99768')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
