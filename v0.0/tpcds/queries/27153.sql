
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '53778','15168','83297','28130','10531','51774',
                          '46882','58597','23728','56565','73511',
                          '61363','80212','35379','68119','13965',
                          '96536','42001','79433','14284','31337',
                          '96764','68678','50628','57194','36311',
                          '14488','19535','41816','20422','38801',
                          '91328','30782','63054','57755','82881',
                          '83983','10478','34987','19200','41262',
                          '49442','33477','32504','54077','76126',
                          '83160','52828','44206','30340','45573',
                          '11084','65350','32268','16852','43187',
                          '66239','76140','14314','29280','23690',
                          '40411','21606','28604','68997','17803',
                          '25820','10696','62698','12864','17725',
                          '20963','20449','67639','38986','82494',
                          '72356','11274','11191','19157','91892',
                          '68231','83900','54032','53667','78125',
                          '93745','96358','59451','55772','79170',
                          '51914','30881','47909','41352','42709',
                          '63099','53071','32432','37607','85758',
                          '28046','27328','46980','11732','12272',
                          '10729','44037','90304','83778','26331',
                          '13717','58405','57824','92697','28539',
                          '64411','44024','15794','25405','52481',
                          '93415','98331','60066','35430','47412',
                          '36130','11101','56158','49673','11128',
                          '99313','29847','41202','61871','41372',
                          '51136','89455','17802','54705','79888',
                          '87721','40862','23102','90543','11000',
                          '69332','18987','41053','71469','28494',
                          '50979','96905','25288','97838','39449',
                          '40454','45232','23355','27022','21688',
                          '27378','47509','31718','76622','36304',
                          '96571','22627','89822','43846','24050',
                          '25201','45513','89124','57467','17402',
                          '50938','86373','70258','88899','34423',
                          '53386','97807','44576','95839','70932',
                          '49353','86130','70879','35253','76990',
                          '84110','10819','25413','88654','58525',
                          '34612','68580','80512','89464','53779',
                          '59497','49151','37810','63761','52644',
                          '79511','32252','33256','23967','85764',
                          '63777','23598','48243','39260','77490',
                          '78723','18727','66898','26750','61665',
                          '16841','96451','24946','32630','82623',
                          '59241','32804','35910','41120','96149',
                          '46241','55719','92666','19124','23763',
                          '82247','63568','17193','70615','32801',
                          '52121','22155','79698','49551','95274',
                          '36262','30271','58793','20595','12530',
                          '48221','69388','85780','19307','52757',
                          '29596','97777','91779','15308','64766',
                          '24995','88771','34400','62795','57147',
                          '50247','19389','81209','15333','19914',
                          '86324','41090','14436','27395','19384',
                          '78442','38339','28794','38639','11519',
                          '25026','60842','61548','82997','24978',
                          '88508','16717','15701','45779','18413',
                          '27790','34415','57819','99362','26441',
                          '93711','53424','71073','64637','39953',
                          '53037','25040','42660','49833','13226',
                          '71338','49545','41525','98351','56717',
                          '77420','69901','21325','86421','15604',
                          '19853','47517','46634','17827','59579',
                          '76918','41269','88635','95661','59594',
                          '42133','55622','68265','31830','23118',
                          '30173','19676','50056','82375','25342',
                          '27678','31599','75627','46697','22302',
                          '89952','55518','60419','19472','91611',
                          '55547','41571','98343','54793','73559',
                          '26156','95863','42448','67295','60195',
                          '86318','37635','69239','11419','45045',
                          '84373','90640','30511','68050','68815',
                          '12891','17263','79917','49073','36286',
                          '89481','80344','15032','84711','89445',
                          '15401','13211','68789','68928','82554',
                          '55814','53881','49387','43658','98722',
                          '83361','26795','48375','76539','15236',
                          '69463','78362','67243','46096','28049',
                          '51462','50671','71134','13523')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
