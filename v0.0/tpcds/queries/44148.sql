
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '24354','27487','61607','75593','64498','10208',
                          '80038','89291','18371','53856','49890',
                          '17059','93481','49473','49329','23601',
                          '26947','24467','10328','57588','68595',
                          '77585','58037','47923','53933','81740',
                          '38075','34510','20589','15420','33288',
                          '26689','49979','79422','47366','57163',
                          '59413','10725','77868','79538','52033',
                          '79151','53623','39932','62301','37910',
                          '71410','52308','62691','50102','83401',
                          '87453','76612','93974','68734','46193',
                          '96623','77969','47007','69621','89006',
                          '57870','86397','83075','94568','60425',
                          '13770','14681','83870','26633','43229',
                          '23590','25000','85821','81984','97348',
                          '47896','25918','28522','28056','33796',
                          '60287','37170','95865','53857','96482',
                          '11085','55068','95199','67406','63636',
                          '14795','12324','66804','44538','92406',
                          '11577','16445','28216','67050','98475',
                          '15370','33698','31156','99418','78809',
                          '66963','14618','27662','31021','75908',
                          '75466','62751','85331','44863','82446',
                          '72845','55294','25348','71959','68373',
                          '74740','21466','41405','58109','78119',
                          '73196','25744','26525','29548','65700',
                          '69417','88839','93776','94683','59932',
                          '58870','23488','38601','92433','33562',
                          '86399','38751','33435','59306','63144',
                          '24440','11556','36750','53270','75681',
                          '42048','72470','38693','87123','47779',
                          '34857','76251','84125','56035','64163',
                          '38620','29458','30692','61616','77829',
                          '12307','60164','87266','52955','90904',
                          '66010','81448','79584','46217','10714',
                          '15669','24782','83606','72023','22072',
                          '63901','93003','69480','53288','77855',
                          '22475','21740','43869','50294','52848',
                          '26128','24612','79995','40011','65922',
                          '39261','15690','29085','39019','16835',
                          '66218','32231','11199','21797','77647',
                          '20342','17001','44150','68968','22047',
                          '33416','17662','26616','59204','76779',
                          '26363','37019','26630','30951','76004',
                          '54218','57276','41566','39417','18698',
                          '62103','18908','52900','38781','33311',
                          '40397','44052','28706','40973','26290',
                          '29801','44564','95099','94078','94370',
                          '64719','33080','21812','80505','72202',
                          '35218','10987','95641','41267','65667',
                          '52849','81798','70815','36540','60297',
                          '39828','32807','24581','68038','82053',
                          '28356','27495','66566','71703','50241',
                          '65317','85609','47319','97855','50552',
                          '36908','51274','24790','58524','37061',
                          '60997','22109','91403','18297','36556',
                          '11128','83750','72059','75546','39170',
                          '31160','43694','51316','12656','89194',
                          '46295','22701','86286','11370','36716',
                          '99610','51013','88526','79008','50996',
                          '42373','60910','86366','43402','41157',
                          '52637','29544','84600','12532','82149',
                          '94354','39952','68743','13863','97984',
                          '61195','57155','10244','13991','35834',
                          '90550','51514','67394','66800','36603',
                          '41463','26277','39727','19616','36875',
                          '11055','59465','26085','45789','39725',
                          '21244','35436','74421','20766','18114',
                          '32241','49136','67842','45509','23273',
                          '17878','59714','34380','12018','86018',
                          '10685','18216','31126','32948','70399',
                          '99170','87068','64446','46926','68834',
                          '77480','29090','62521','45557','24619',
                          '81399','32091','19564','94831','34225',
                          '71515','83644','46770','49335','29134',
                          '70475','74162','83950','18691','17782',
                          '56182','63928','22518','52940','29388',
                          '31246','12343','22389','86834','30859',
                          '96965','91503','60353','97163','16918',
                          '87831','43928','32227','60980')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
