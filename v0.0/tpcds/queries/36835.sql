
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '22054','25755','95967','17374','68851','15148',
                          '79863','61912','14594','71535','76987',
                          '72696','17292','69284','61342','27606',
                          '56438','91120','87256','28517','42488',
                          '18967','73657','39971','39518','51716',
                          '97140','25597','40108','49191','87959',
                          '70657','44203','80649','89999','37553',
                          '30526','17192','17476','15889','29966',
                          '46612','81640','65276','94400','49625',
                          '57515','30450','84492','90400','32819',
                          '14012','64931','18938','14450','55661',
                          '62185','48461','32641','33373','49317',
                          '77573','61834','25232','77222','60948',
                          '69875','69401','68661','85652','34042',
                          '19613','85285','49248','84023','92648',
                          '75232','40115','36442','14701','55058',
                          '49786','10530','94221','35549','47892',
                          '10389','23770','41583','88473','53412',
                          '30151','21591','27085','44362','87658',
                          '28301','65404','77885','47444','66851',
                          '77177','43700','89104','30372','33612',
                          '61055','19782','34619','61603','31041',
                          '48489','25110','59688','41847','50638',
                          '41437','40452','17820','26587','12523',
                          '27155','71966','36331','28257','92138',
                          '39900','66278','20977','54935','19894',
                          '94311','54598','67995','66029','63148',
                          '54763','57825','19439','24610','62910',
                          '19367','11292','51523','49960','24005',
                          '25914','37045','23138','76531','45338',
                          '79936','59598','32866','91839','17658',
                          '44239','52013','29774','41049','18783',
                          '25202','83211','35863','12127','51495',
                          '25140','12397','23416','58593','54288',
                          '24571','11149','44116','15040','86210',
                          '29649','88780','33232','57820','43846',
                          '55263','13238','61918','55897','68915',
                          '89041','92028','77828','58640','49407',
                          '72208','77168','33248','42981','63202',
                          '44848','32940','48319','51441','28650',
                          '45813','80056','83394','84107','33068',
                          '54593','57067','57887','14974','50974',
                          '29993','32041','20860','43725','15110',
                          '48463','11703','23223','60560','46003',
                          '55763','13622','42532','30447','28939',
                          '40895','69704','15010','16398','86748',
                          '19453','88934','94547','54844','99248',
                          '14250','74083','34153','75441','81217',
                          '99637','93471','76045','19717','89805',
                          '75757','72408','52198','80958','58977',
                          '20810','41504','83837','39562','85611',
                          '39350','22382','59878','79161','78107',
                          '76364','36537','92010','64936','61815',
                          '99519','30352','99504','56726','73589',
                          '92968','81550','90475','22845','41171',
                          '55830','27241','97370','38906','43573',
                          '26686','64172','92704','41488','21124',
                          '91421','18051','85003','87240','37491',
                          '35787','11132','44426','13116','20070',
                          '14052','18413','56950','38302','84591',
                          '14969','59336','94561','21347','65016',
                          '24306','41747','12303','68424','52292',
                          '37152','87664','34190','85091','43367',
                          '72416','20205','43699','46932','87435',
                          '85401','60056','15619','11327','31725',
                          '49443','68813','50931','78416','15999',
                          '77535','76112','16057','49882','62541',
                          '23726','12622','48094','46884','88096',
                          '86323','45024','56562','46010','29279',
                          '42554','88415','92611','42169','73136',
                          '36126','50171','91192','70138','30951',
                          '96454','11308','10070','16327','91228',
                          '77895','27528','36141','56645','58859',
                          '20835','23629','18134','11616','93260',
                          '79890','87539','99626','77444','13298',
                          '17306','56273','43041','43923','12726',
                          '68264','13882','75483','15883','75664',
                          '33791','47436','41778','19689','36571',
                          '60418','59276','41985','14106','17633',
                          '17228','79125','70370','67214')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
