
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '68100','44393','74096','12305','76537','17530',
                          '46231','34120','69991','83592','40823',
                          '28048','15481','83418','52715','24288',
                          '55113','42531','73987','52311','13500',
                          '66703','73529','11755','36396','46733',
                          '89663','48151','42882','18909','31633',
                          '68427','85436','67382','84471','48536',
                          '57682','75572','36242','27628','36629',
                          '60241','89616','70100','98237','83620',
                          '47040','87302','51646','13331','40247',
                          '56016','20548','73653','73276','78386',
                          '68864','54115','18802','44856','93429',
                          '17750','52546','76075','36298','14890',
                          '24618','11517','60807','64178','14431',
                          '20349','81575','64361','10719','67086',
                          '13102','29275','89272','98992','36143',
                          '67359','40311','52659','73949','85034',
                          '96326','13511','53955','44527','14827',
                          '65583','80657','60786','69879','77419',
                          '25622','47232','50089','60392','86848',
                          '78083','64270','69823','91317','75427',
                          '56581','10513','34321','26657','89887',
                          '10669','27078','81295','23901','69457',
                          '66632','11759','60160','56440','65408',
                          '53605','52416','38892','44249','63198',
                          '27219','52196','22874','12068','18076',
                          '46577','91945','63564','96132','34631',
                          '65324','32172','91867','23648','27820',
                          '76850','44592','58531','14667','21109',
                          '41914','30190','24802','77003','45305',
                          '29713','15894','15556','81264','67678',
                          '86039','32131','99708','19371','27143',
                          '50895','59574','24835','93994','80208',
                          '22371','71686','91400','12137','21181',
                          '65984','63955','80986','14042','13320',
                          '23050','30459','30880','36225','22119',
                          '83880','72543','13596','66448','72656',
                          '50518','12161','28307','24174','36111',
                          '11508','87316','91238','41402','14682',
                          '14012','92864','28707','81677','41427',
                          '89406','12245','64311','11807','23829',
                          '33702','43404','28363','52806','54293',
                          '76258','13787','22473','49834','34044',
                          '92989','28009','23726','13048','78475',
                          '15388','35553','40412','24035','19037',
                          '45136','34074','43540','25300','63528',
                          '13558','46373','65009','28789','25518',
                          '25478','68794','73810','72211','90112',
                          '51803','58623','54108','27209','27833',
                          '62705','57582','14015','41244','84022',
                          '24275','53460','43330','91638','69340',
                          '67914','71894','15044','42604','21499',
                          '54508','27673','30770','62450','41994',
                          '78856','12642','13441','76923','15254',
                          '83549','98467','14427','21479','26951',
                          '95851','95546','48384','47283','25304',
                          '84029','64744','44200','76665','90450',
                          '19317','68389','12264','13207','59375',
                          '35132','19189','10491','18073','39474',
                          '27988','84823','45825','26044','29727',
                          '84217','64920','10587','70418','30833',
                          '85928','44706','83035','94168','59736',
                          '56499','99825','33204','51242','58838',
                          '23674','90025','67982','63614','30737',
                          '85264','62021','70351','36574','83046',
                          '36409','47438','10202','88674','86045',
                          '65253','73707','39927','61747','15876',
                          '25413','13209','21728','93666','22893',
                          '35265','55964','24326','24613','21494',
                          '98514','47061','32651','70834','62438',
                          '33756','25390','77165','22870','70685',
                          '20129','30118','58748','78072','32301',
                          '96503','69115','73067','11813','25888',
                          '96267','14117','40076','72318','57020',
                          '19267','67795','15114','97528','62074',
                          '83602','58251','12448','28291','53180',
                          '67742','94958','13751','99688','25841',
                          '23842','16039','35973','30900','93212',
                          '78107','15183','97462','89423','33566',
                          '17799','49250','49812','72221')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
