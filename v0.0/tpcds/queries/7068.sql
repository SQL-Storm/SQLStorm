
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '91595','64370','14865','58019','49672','89837',
                          '46881','63503','60756','10039','21563',
                          '38716','78284','53926','12319','94891',
                          '39681','76948','26367','77462','70382',
                          '84921','15939','82611','99264','15530',
                          '92669','41502','97895','39502','98792',
                          '37281','12038','28014','41926','32975',
                          '24984','29037','71176','17635','70135',
                          '12967','87338','19465','19450','21286',
                          '83211','11934','32465','58208','99853',
                          '31601','77031','52451','15702','83318',
                          '65951','14786','53296','54854','18679',
                          '31363','79891','27905','77026','65052',
                          '21039','68624','71598','34889','58530',
                          '25663','28497','14064','69702','26779',
                          '37087','89537','70336','66890','45823',
                          '33816','87348','16698','33833','49885',
                          '10279','91474','93309','32901','55368',
                          '44822','35936','13375','93610','43715',
                          '95760','32276','91260','87476','12491',
                          '67948','34908','81502','10392','36633',
                          '40099','41706','96148','39028','28864',
                          '21721','10287','51364','24461','45184',
                          '42866','33272','70573','94269','73482',
                          '38408','29055','68026','88616','48479',
                          '64694','40187','51700','30605','26865',
                          '15058','51528','50113','30705','11447',
                          '74900','61407','93450','68867','92725',
                          '86032','65116','38512','87783','82984',
                          '51272','33756','48338','21203','90113',
                          '80103','43387','40172','48365','30609',
                          '14991','11497','43568','50371','31219',
                          '74208','75344','19253','42122','72515',
                          '62724','64629','74547','10908','29581',
                          '57041','98213','11161','76786','81063',
                          '91221','40794','19708','24920','20273',
                          '79383','16339','30619','61554','99039',
                          '66168','46647','38543','25464','27013',
                          '12025','94181','51573','73610','46685',
                          '78057','21938','80565','85560','17745',
                          '86442','28624','89276','63106','10158',
                          '98042','30258','67197','50492','45806',
                          '31247','71615','23549','14181','96990',
                          '18447','99263','44406','10028','31734',
                          '20611','28918','32505','60232','90894',
                          '39913','28763','19805','39268','39303',
                          '20103','88655','55336','76277','28400',
                          '60316','83771','56243','70747','90214',
                          '97269','46307','60986','95479','98573',
                          '22070','68295','52593','10184','90199',
                          '84974','36010','59421','49827','30248',
                          '13041','14360','80940','53642','68165',
                          '24262','46614','40139','12032','16335',
                          '64821','18987','86315','27353','41708',
                          '65323','82903','78031','28053','48123',
                          '21315','86797','17660','74633','64951',
                          '76023','47988','69051','59158','63583',
                          '17377','16905','24782','29109','21025',
                          '74133','81805','18473','91410','38571',
                          '80696','55623','79178','79915','50184',
                          '75309','11814','46663','77565','35005',
                          '24272','28307','70074','63840','43146',
                          '51305','94634','53616','14898','63987',
                          '63798','13694','75692','21653','41076',
                          '67738','59313','99673','91342','39531',
                          '64122','94806','24957','79774','75202',
                          '46363','47083','51433','28306','45900',
                          '48881','17446','21880','41646','19310',
                          '52785','12776','17382','97471','41883',
                          '11172','48299','31607','23983','80115',
                          '14007','31334','94022','45820','21211',
                          '23017','84051','11369','34636','50534',
                          '63881','37793','75035','33475','62040',
                          '98036','68125','10585','79231','70149',
                          '38850','93239','49014','15263','19924',
                          '20660','32187','38595','62985','76707',
                          '83526','98662','30207','28897','21936',
                          '42567','50488','70891','46162','45579',
                          '70314','30132','61992','57560','61352',
                          '92705','89690','14440','43120')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
