
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '32388','86978','48807','29594','43496','26346',
                          '29338','85260','64937','97859','30611',
                          '80212','91351','19950','15547','69596',
                          '44512','92121','17510','42079','78562',
                          '49448','65437','12097','62891','38442',
                          '23152','43838','66689','97166','35806',
                          '78639','16790','84157','86952','98750',
                          '69180','38915','14846','11702','83662',
                          '22019','18020','27944','47079','47139',
                          '33934','24112','95709','18855','32991',
                          '36186','30971','31142','66134','43369',
                          '28376','92599','40444','16811','53455',
                          '89318','34526','20462','75816','61627',
                          '96092','27458','30330','37934','88685',
                          '75726','23004','20881','52100','57779',
                          '81600','59910','88535','22529','39859',
                          '66434','65972','21249','37238','33706',
                          '96646','59568','63099','46046','91053',
                          '40411','51641','59750','75710','99042',
                          '73951','78101','49679','33583','35476',
                          '58169','56433','57026','48657','82318',
                          '74628','35407','79122','57777','93529',
                          '28621','85759','46757','54673','30614',
                          '64597','43480','18887','58471','36747',
                          '47905','27702','59688','22105','55737',
                          '43469','40824','38573','38867','23614',
                          '23423','15855','86350','68677','22649',
                          '85142','86208','37183','33838','58828',
                          '91182','14738','98653','25681','14903',
                          '52119','97747','18351','80563','13636',
                          '83005','42867','24850','54357','33922',
                          '68873','47149','16735','58530','89120',
                          '58997','35598','33873','13678','95336',
                          '43927','11775','96582','62075','26806',
                          '19781','10436','14839','52706','32627',
                          '13765','57612','59492','19754','45654',
                          '27158','56361','62163','69870','76237',
                          '24456','48093','21261','85589','79027',
                          '12757','10999','18771','30889','57156',
                          '64045','50051','61508','79604','28620',
                          '57415','65212','55987','61781','63460',
                          '10100','82366','91609','57824','52251',
                          '42540','17612','85641','33531','45969',
                          '41305','31214','12315','61266','41400',
                          '74315','91592','33235','93261','97504',
                          '13376','71139','18009','88082','26944',
                          '37380','58259','37113','23590','47635',
                          '54990','74040','91643','39548','53906',
                          '20844','24486','21279','73860','56518',
                          '57332','95143','21003','98688','61710',
                          '43278','71712','96433','27931','21285',
                          '13279','71275','35574','77400','21990',
                          '44860','37146','22905','99917','53204',
                          '32952','27378','96283','84309','60303',
                          '25221','15062','50877','73986','80462',
                          '15710','29347','87728','91802','38807',
                          '78967','10405','70575','10838','83374',
                          '91202','16086','13291','29200','30526',
                          '41900','65557','39839','79814','12798',
                          '98340','36743','33221','64701','35543',
                          '39928','40375','35853','13722','79243',
                          '16286','42760','58654','60212','18908',
                          '29178','97693','70453','28638','78208',
                          '61827','29580','93346','61070','58624',
                          '10440','34600','31795','69599','28805',
                          '22055','19725','51522','31193','64986',
                          '79309','22845','31617','66083','69923',
                          '77820','76156','81517','60111','45178',
                          '11514','28798','76069','59430','79498',
                          '62473','33368','62040','26285','92387',
                          '31405','48174','26601','60530','88054',
                          '33370','43891','95331','76282','60626',
                          '48419','20667','93524','93742','40355',
                          '81731','43801','19163','22444','49625',
                          '78665','48188','28296','11759','23751',
                          '51315','17068','74847','40988','57802',
                          '14613','30175','82546','82745','58502',
                          '82104','54071','31168','21035','42669',
                          '83280','41946','47928','90702','88071',
                          '13154','68723','87666','34097')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
