
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '49410','42514','10568','94234','44145','24883',
                          '48186','29014','18764','73323','34875',
                          '43914','55142','74352','98080','84130',
                          '13355','15438','21101','31311','84061',
                          '60539','39998','51079','47101','41604',
                          '77955','67813','52487','24949','21964',
                          '15353','80245','80738','76282','67229',
                          '46124','79354','77006','55141','13648',
                          '16841','20333','30283','24838','93421',
                          '20828','60880','23688','16772','80445',
                          '50277','24067','18782','60680','22134',
                          '14233','88928','20038','39202','73691',
                          '11657','13514','29027','28934','75497',
                          '14552','76934','46665','27238','53354',
                          '16858','95324','80807','44681','31188',
                          '37368','13987','49101','33661','44703',
                          '40486','44904','43725','35373','22638',
                          '77277','11257','46322','16090','66044',
                          '99053','23159','45921','10417','48256',
                          '87930','46107','33552','54548','91895',
                          '60657','30075','43502','19882','90012',
                          '26301','40131','86775','57223','37935',
                          '53871','51717','58491','87042','69428',
                          '14738','50818','66759','80015','42580',
                          '23213','54346','86494','26610','53671',
                          '89923','44764','78275','28581','51598',
                          '25358','36400','26234','21405','30378',
                          '10774','65754','73321','77553','41915',
                          '44925','65952','30304','39712','52509',
                          '23617','87398','49525','13957','25873',
                          '85287','48783','28080','17429','69816',
                          '70726','69535','23780','12774','16163',
                          '50334','12171','80229','33121','55122',
                          '73034','70547','35602','87941','14335',
                          '93161','51478','23835','50600','37562',
                          '44729','43474','54925','18244','47747',
                          '39247','97899','80090','19160','97664',
                          '98559','70825','19888','37755','85751',
                          '35964','66860','16287','76429','37522',
                          '53884','24786','10369','76823','55260',
                          '46080','88807','89246','51406','96024',
                          '67400','58899','27146','60259','44602',
                          '79820','56352','75988','59720','70167',
                          '33268','49652','16123','82687','87907',
                          '43703','34572','67180','20662','83385',
                          '74677','30680','13454','14880','24855',
                          '97948','85223','52717','18082','36751',
                          '78324','24361','56667','52959','24299',
                          '65167','18406','75684','30486','11405',
                          '88448','59436','76057','46093','16311',
                          '29866','16897','98650','63217','28615',
                          '40627','65053','77952','42318','48304',
                          '92765','89188','33474','35786','66849',
                          '21686','73151','95390','56432','28331',
                          '19359','12387','23884','31378','18883',
                          '41023','12088','50050','28282','30259',
                          '67568','10604','72475','36464','42385',
                          '99114','12050','53920','97533','21393',
                          '18814','25112','89286','27967','42562',
                          '21740','99962','50705','37076','60095',
                          '90316','56104','47161','57483','43630',
                          '12625','60167','24564','28323','49539',
                          '62402','68479','98210','98053','41489',
                          '63548','29698','96269','72318','16221',
                          '66410','29915','74345','39924','38113',
                          '30324','21958','61748','46790','11175',
                          '53578','13660','51203','23523','80377',
                          '12488','24034','20259','44315','20672',
                          '26897','11779','91783','94966','48148',
                          '16187','66304','24897','38515','65229',
                          '61210','54690','88004','61270','57510',
                          '75298','55185','96758','70325','46607',
                          '56897','10424','30164','58840','62492',
                          '27374','21461','16284','93940','21925',
                          '10222','86516','61664','47887','93026',
                          '43864','80421','18722','37883','60718',
                          '32170','38017','28021','87690','14011',
                          '78972','21305','79123','45872','20029',
                          '70795','28613','80602','96389','99759',
                          '87884','56377','29804','98314')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
