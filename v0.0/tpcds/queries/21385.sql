
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '22985','42832','18073','79397','79331','90856',
                          '40918','64603','53736','46139','77402',
                          '70329','34081','18841','10089','84854',
                          '42075','64348','93967','10593','70149',
                          '68451','68273','14622','38070','17353',
                          '62806','69467','69444','87788','34017',
                          '41510','77983','33600','11564','54358',
                          '88415','10071','70949','55474','14850',
                          '34418','25504','58794','38989','11308',
                          '87368','84066','67560','56116','99394',
                          '15681','65846','93774','93110','25467',
                          '31491','72410','31210','83488','39754',
                          '19939','20122','10686','89799','79453',
                          '20362','15498','68076','37256','56900',
                          '46488','58376','89436','70236','27711',
                          '18746','70066','76110','31921','13039',
                          '74553','22631','89674','24396','69035',
                          '33949','34184','47424','61432','99169',
                          '48895','30832','60530','31782','23572',
                          '53856','74885','11555','56367','79197',
                          '69759','82591','72543','86070','11541',
                          '92686','98841','54596','65583','42458',
                          '25763','53288','98473','29468','97562',
                          '87523','31980','98878','61140','54157',
                          '22473','12097','57275','42452','85424',
                          '18938','84803','45530','68206','57494',
                          '36259','43541','19343','88633','34140',
                          '99661','84456','40714','80457','69523',
                          '69801','22205','39104','54592','74748',
                          '65008','43355','63568','87258','11877',
                          '82458','15237','53072','79855','40881',
                          '66482','41193','24558','76893','50926',
                          '94433','45644','14416','59827','88141',
                          '35369','96714','57846','73148','36232',
                          '57414','25408','60439','23145','74470',
                          '46296','55616','58330','80177','45519',
                          '35417','13704','65150','38732','18304',
                          '81833','18147','93773','33906','32514',
                          '91064','33328','62039','85337','23927',
                          '34461','70189','40368','48270','24769',
                          '97036','43730','70602','49491','38631',
                          '17313','28796','14125','24209','85050',
                          '73960','68040','67456','27599','96126',
                          '73597','36890','64690','35919','60845',
                          '99358','36955','45773','51151','36238',
                          '77609','64953','57814','59602','72996',
                          '67166','19739','28087','27243','25430',
                          '49137','21141','49528','66617','31436',
                          '16714','67394','11737','50701','45645',
                          '97083','13214','56450','18843','97312',
                          '52985','35740','88770','17967','62190',
                          '43008','87873','26447','96054','16551',
                          '33661','11912','28853','62198','45542',
                          '88647','96934','83055','16280','44317',
                          '84619','92380','42336','89677','10146',
                          '93301','41761','85549','13463','20951',
                          '32350','19480','21833','67513','67500',
                          '95643','25975','71706','82454','31681',
                          '56316','81632','95116','35695','15586',
                          '20731','17275','60555','13454','23268',
                          '38453','57144','77604','42641','57800',
                          '11490','59840','64993','58779','81046',
                          '14209','82900','51102','26378','22350',
                          '66473','23420','80350','26727','58518',
                          '67106','15456','33098','72907','97331',
                          '39582','67826','72574','35752','51475',
                          '49295','18968','19348','73879','43240',
                          '14158','60339','39163','85584','32223',
                          '26011','62034','86013','56906','36503',
                          '52281','27497','76684','19143','65148',
                          '41844','80928','54011','42792','47824',
                          '73746','36791','72483','32233','58265',
                          '51317','26267','72139','64528','54061',
                          '57740','16750','27754','47687','27517',
                          '19227','88011','18690','21485','20943',
                          '18378','64005','45085','46039','12426',
                          '11702','47910','66126','79259','64042',
                          '51306','21260','98677','47534','37245',
                          '76196','72138','67707','12764','38031',
                          '10447','91905','44145','60839')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
