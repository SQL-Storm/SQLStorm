
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '26642','45154','15344','12798','51125','65649',
                          '76575','96292','30331','75576','41238',
                          '46055','73169','95699','65513','85186',
                          '89384','48985','22605','19605','45671',
                          '78089','26249','86032','65853','71050',
                          '39079','79921','41006','21404','70875',
                          '44515','85888','77006','79014','53991',
                          '46136','30398','39059','19834','34475',
                          '35496','95404','75032','13124','14703',
                          '42608','10310','63863','18550','50661',
                          '10065','84749','44776','18333','54774',
                          '88535','14858','86373','41379','76175',
                          '17052','83368','96761','36963','27853',
                          '86648','51702','53221','93253','58444',
                          '69872','68915','26911','20045','22150',
                          '77221','34444','38940','98895','90477',
                          '49413','62939','18930','59909','95410',
                          '60898','15108','96956','70974','56925',
                          '52327','86673','66197','81959','24629',
                          '80463','29149','21958','67377','17377',
                          '56496','69904','51278','21064','26697',
                          '71662','50917','63326','45624','50546',
                          '77584','22373','44985','39520','34866',
                          '76084','17747','49389','87177','71774',
                          '63441','74881','94454','36659','73402',
                          '47303','45540','71701','48069','12995',
                          '15550','20465','43072','84153','59352',
                          '28828','55543','40616','29799','38156',
                          '71389','93139','22550','59206','15151',
                          '31836','80949','50943','10054','52196',
                          '16275','13252','98903','57334','49901',
                          '59585','83608','38232','25811','36011',
                          '13291','27412','26543','40791','96529',
                          '46075','68469','34171','18748','94718',
                          '78972','56678','24792','73109','29244',
                          '38967','53509','20312','18148','35751',
                          '61227','24376','13701','82596','58446',
                          '67415','24989','70099','39021','95222',
                          '12158','63385','59518','13953','18527',
                          '93392','40113','71884','88814','56541',
                          '92948','61815','44381','84555','92544',
                          '20006','25716','38170','32222','56729',
                          '37687','94623','16397','44016','52211',
                          '58683','40054','16769','69341','57976',
                          '61450','66737','18915','96549','35471',
                          '54516','31206','72105','68504','89194',
                          '61164','48756','88685','32859','63570',
                          '70613','16189','87784','64778','79719',
                          '58493','91128','54643','39180','50915',
                          '71048','66912','58196','51794','98590',
                          '61504','63221','53911','78592','45495',
                          '55819','40573','42759','68811','46801',
                          '66390','53200','72772','81376','80369',
                          '87605','84917','85454','41837','43279',
                          '69511','67796','78722','37621','27623',
                          '57493','52210','81840','87640','84914',
                          '20129','27943','48564','13893','36946',
                          '46874','90874','29241','74796','11197',
                          '28158','98290','13165','95917','67787',
                          '23874','62724','61215','60199','30343',
                          '34657','91904','53250','13090','61402',
                          '43332','76058','90589','44030','19494',
                          '19732','62873','60962','70970','11132',
                          '13649','34957','14633','61422','68311',
                          '75759','26001','15773','81465','51812',
                          '27600','79460','45342','21899','66756',
                          '54200','98099','64656','10909','53314',
                          '40378','70122','19504','44046','95249',
                          '28680','68901','72090','82965','54107',
                          '76775','59657','20521','17024','33729',
                          '14107','26787','30334','71988','73079',
                          '11997','84454','74320','81510','32661',
                          '73082','97375','29517','47937','21757',
                          '28876','63567','89614','94480','58732',
                          '13362','91124','18418','60927','70430',
                          '67575','44351','69647','29724','61224',
                          '72653','37727','90156','35774','37260',
                          '22927','28882','44518','61393','19672',
                          '44368','44526','19455','72556','23162',
                          '15768','89041','40861','24928')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
