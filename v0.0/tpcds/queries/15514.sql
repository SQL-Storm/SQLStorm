
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '47959','64210','13638','53655','29236','82672',
                          '82518','63525','46200','16205','91100',
                          '50725','30978','13737','18609','35452',
                          '78253','20101','24856','20005','18189',
                          '46911','79399','10998','37914','36861',
                          '11420','83159','50142','28997','19254',
                          '77006','21592','65783','20542','81556',
                          '52480','95017','58696','80958','39231',
                          '64331','26061','10994','46970','53137',
                          '45046','30091','95857','23073','70849',
                          '37384','62419','34686','19715','25477',
                          '47638','20505','73152','99096','69490',
                          '78551','96385','20908','92904','73712',
                          '77418','78032','34961','81929','21372',
                          '53807','64168','44058','97633','35961',
                          '19548','45168','14191','53187','12949',
                          '74563','76506','57032','84262','11887',
                          '47314','11455','14333','97067','51216',
                          '37551','97806','27503','16747','83658',
                          '95385','82226','17885','96597','60542',
                          '42381','35966','54604','58582','44408',
                          '77218','41016','27119','35992','34165',
                          '17008','60851','11608','56577','63503',
                          '93911','33102','55613','41452','15919',
                          '95103','49534','71674','13453','51575',
                          '66188','95672','79566','24401','58056',
                          '31258','24240','53800','35964','15827',
                          '77132','12151','32739','73593','68135',
                          '20871','57262','94231','40102','24674',
                          '42672','34004','13811','23866','13586',
                          '15950','27682','17730','10013','17527',
                          '22916','21824','12606','68397','17663',
                          '20737','73290','45181','36525','44261',
                          '36562','37846','47721','34163','71249',
                          '78471','30158','63716','24341','11238',
                          '73938','48423','88627','47365','61304',
                          '93390','31661','46680','32513','24101',
                          '27135','65737','57586','67653','62126',
                          '21967','43995','91663','27666','10320',
                          '97733','36866','97902','22994','12029',
                          '39523','37865','38043','20148','79429',
                          '57346','39202','13202','31445','27206',
                          '10659','99919','12221','32652','52870',
                          '26377','42579','94206','92379','87086',
                          '67067','29297','62732','30676','71576',
                          '27272','97065','62057','41036','62404',
                          '52784','20266','46604','65677','65652',
                          '43323','95703','74747','90368','25400',
                          '17833','25720','87533','15478','75928',
                          '65982','71173','39625','89044','49870',
                          '19308','56422','60556','41617','16260',
                          '41059','87175','25936','38870','94623',
                          '17444','10345','65407','17345','13678',
                          '68070','98384','30231','81964','96105',
                          '10259','59676','81173','50039','73939',
                          '98497','34800','58536','76680','74899',
                          '28387','21406','76495','16835','41632',
                          '91085','49133','27954','70371','56685',
                          '16798','12846','80160','12561','67340',
                          '19047','16899','29419','66106','22318',
                          '43311','79193','25325','82816','60945',
                          '32137','49929','82487','49466','90267',
                          '93240','23709','44136','29671','89612',
                          '78319','93336','67040','93643','36433',
                          '54087','34101','64228','45355','39975',
                          '85024','95424','39081','37025','66870',
                          '85003','55798','85863','78674','38491',
                          '29948','45330','15963','17413','59314',
                          '59036','13609','88146','64161','58940',
                          '37899','78981','53024','88598','36778',
                          '15191','96464','20967','28644','84537',
                          '49003','66752','95563','45053','25812',
                          '96255','36682','40124','89607','67080',
                          '92546','66222','21453','65024','21438',
                          '59873','22771','49992','17714','60121',
                          '84519','65923','68706','45787','10413',
                          '92658','83117','45816','99651','37605',
                          '27139','70454','93740','61427','66172',
                          '98575','44329','68554','77211','41774',
                          '46248','20910','40413','57407')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
