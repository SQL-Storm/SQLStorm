
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '25509','62778','87830','46294','10766','47289',
                          '41316','52022','31286','54426','60305',
                          '32434','90495','85674','14453','25813',
                          '35420','13803','34697','15294','18297',
                          '19710','22863','73762','52530','10289',
                          '36598','60602','84278','63948','47660',
                          '60291','72358','88622','16911','23005',
                          '10214','20324','56723','51567','86410',
                          '37287','58755','12757','12154','72836',
                          '92861','36444','62433','96697','75855',
                          '14180','94926','25744','49514','78465',
                          '52234','60765','72996','37978','21835',
                          '72196','96603','80727','43188','38446',
                          '30025','52021','10640','84431','10877',
                          '42537','22627','45567','60006','50415',
                          '62670','35652','86540','76553','73967',
                          '63743','96174','80717','21983','51403',
                          '51537','38052','54524','70950','30886',
                          '58427','65485','19694','89803','94044',
                          '49139','50217','20273','91816','11707',
                          '29949','23487','35117','46048','49101',
                          '64351','71778','77012','84451','70628',
                          '61669','54887','34823','67279','81199',
                          '61148','42322','38634','32889','43254',
                          '95315','54870','56489','61773','20506',
                          '82444','72712','10062','88349','18282',
                          '36001','71635','82135','39027','71473',
                          '23437','72766','11796','68966','25248',
                          '86170','93772','64208','22928','72359',
                          '43428','20562','26262','31683','10695',
                          '65260','91114','50719','51334','13063',
                          '37167','32430','22514','65610','90877',
                          '69867','27720','48729','65078','31102',
                          '79376','33715','33712','82816','43106',
                          '17952','37196','55768','31386','35140',
                          '55391','12004','67611','36355','67847',
                          '30435','50164','37263','49545','47462',
                          '94017','23564','11310','17811','13252',
                          '85177','97772','77147','61911','97601',
                          '21776','15101','63435','56588','50825',
                          '82187','80628','22346','56678','29323',
                          '28689','33628','77575','31515','43551',
                          '12839','17961','17794','67296','57536',
                          '62310','32777','44207','63093','10618',
                          '32283','75218','25021','56310','49706',
                          '60853','50555','41533','48087','10291',
                          '93391','79720','80360','64133','41458',
                          '13036','49646','29731','74723','29999',
                          '41057','72112','25315','23224','36738',
                          '72717','88713','10071','45503','56325',
                          '72663','37139','19602','80078','22786',
                          '51206','64877','61623','61964','19942',
                          '15033','22384','71175','27511','11027',
                          '12696','65745','90769','39964','95536',
                          '69025','63359','10775','30306','12993',
                          '98233','49253','91753','51582','13476',
                          '32639','52488','41426','95476','11992',
                          '75408','65642','21493','21010','89001',
                          '36363','91601','20711','22585','81707',
                          '39173','76013','55526','14554','65000',
                          '52429','78058','34330','10093','55220',
                          '49014','60567','29920','12331','55570',
                          '69839','10988','23173','99000','23527',
                          '82852','63943','35214','57176','51212',
                          '75740','39667','59838','51848','51884',
                          '15169','56980','24192','10012','53777',
                          '41363','39990','50942','65582','49555',
                          '62818','90253','74852','15451','53109',
                          '36447','31876','16714','24184','79772',
                          '84866','14393','78729','23899','88983',
                          '63806','33615','40746','37354','79109',
                          '52322','15078','60188','48957','48708',
                          '95614','23084','47030','62759','53237',
                          '15641','64614','47248','51095','57907',
                          '13377','44361','15057','51944','39038',
                          '69814','30763','55070','89152','34283',
                          '50951','51225','35566','56820','10727',
                          '27863','62843','65295','45925','65231',
                          '28074','45779','12950','24815','42443',
                          '48580','78935','11231','73293')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
