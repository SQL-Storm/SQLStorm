
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '95991','35835','84016','73077','35054','76126',
                          '45090','13627','99431','70688','61328',
                          '42441','41664','11693','41333','35829',
                          '22066','47043','61821','68554','98358',
                          '17989','14430','41902','23855','58926',
                          '98857','14612','10408','49948','56411',
                          '27529','34278','22424','97212','12537',
                          '39367','24124','94907','67903','32045',
                          '39888','33766','50777','48724','83681',
                          '91828','24915','26384','70667','64532',
                          '10933','47985','14213','62848','52485',
                          '52138','24878','90731','33699','80290',
                          '22319','48608','30731','84687','13416',
                          '50296','92858','78015','17116','37921',
                          '76974','81466','30914','41069','18656',
                          '58051','75080','18197','41652','94326',
                          '58455','81073','98986','45668','26676',
                          '43189','13572','26479','52324','48464',
                          '41462','11173','67477','59315','62640',
                          '33864','28384','47453','87503','83231',
                          '45782','26602','89529','42272','40699',
                          '49304','39883','73319','62702','33093',
                          '14562','61520','55806','50986','27427',
                          '38396','48591','80639','20822','70079',
                          '84541','39837','86444','49165','78312',
                          '42780','43672','44177','42229','63824',
                          '71982','39239','89365','13208','51956',
                          '57717','14869','17402','61929','48424',
                          '21924','14413','67218','12279','24942',
                          '41246','12722','39564','27493','56466',
                          '53038','93003','93450','76710','59321',
                          '78143','11426','44671','22981','90895',
                          '14915','65161','59828','32826','47935',
                          '31005','56647','25108','86434','49145',
                          '26918','21102','31666','32755','38717',
                          '29582','77251','40905','30049','83852',
                          '99857','35959','29426','32492','42973',
                          '91709','91436','31713','10915','16275',
                          '24930','31638','69043','78594','13485',
                          '41574','42911','30711','82193','26804',
                          '51492','43781','44357','44473','45563',
                          '16448','74206','84440','87059','29257',
                          '77896','38484','97674','85270','41968',
                          '90123','12937','56200','31153','76425',
                          '16054','23462','29512','54138','47322',
                          '98068','41627','97931','82304','53542',
                          '24078','24916','12507','24648','39169',
                          '40981','29781','18574','15736','27835',
                          '47017','84646','50725','11942','31886',
                          '67266','23877','39841','69585','37776',
                          '71359','54929','47487','17885','81406',
                          '46390','71814','68150','12005','30094',
                          '13771','52022','67608','58904','32712',
                          '90265','96072','78757','82654','57251',
                          '41541','40039','10946','55173','24087',
                          '56444','72252','90692','76036','52902',
                          '54040','51339','39973','52135','10565',
                          '34834','70515','37881','84381','12341',
                          '50252','82702','76850','10188','24802',
                          '43608','45875','62403','69903','73096',
                          '27346','67737','37592','48208','65489',
                          '29833','49889','80308','34675','44415',
                          '64024','55370','38127','13707','91486',
                          '95184','31391','10919','74987','49711',
                          '25816','64965','83489','16129','26506',
                          '51818','79963','45966','82526','21162',
                          '17188','16937','12233','27333','38214',
                          '23145','13084','10934','81786','98682',
                          '59195','61318','32897','80404','67642',
                          '31501','77068','95102','39081','27714',
                          '56140','43894','24128','68832','13674',
                          '24041','58220','20122','59594','28435',
                          '58950','26516','80784','83192','11303',
                          '32627','13076','45538','74601','39460',
                          '40656','67771','59144','18458','88720',
                          '37281','97160','21522','67547','54747',
                          '94297','83207','79927','14551','60361',
                          '34390','35335','35777','39327','76457',
                          '21376','31413','74775','35474','29595',
                          '19885','17370','30516','19962')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
