
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '10235','87752','16349','48433','91922','17481',
                          '48348','37479','38686','55717','21035',
                          '79655','15443','90092','73119','99558',
                          '70211','27260','49532','14507','72665',
                          '84502','26674','43880','44897','95903',
                          '46763','38006','68201','55517','20072',
                          '15778','85820','47725','19537','60021',
                          '60375','40709','88939','48965','90234',
                          '83236','45164','19166','90677','62659',
                          '94361','44878','18054','14096','33247',
                          '11524','69247','22005','96089','17323',
                          '95049','33563','38508','33202','86221',
                          '69377','13468','49242','42411','95131',
                          '40972','13565','38519','60776','83764',
                          '21783','56860','99750','23430','22931',
                          '33394','65278','80252','77399','71303',
                          '89985','92854','65001','19551','70007',
                          '10682','70099','51714','87162','59502',
                          '96494','45565','73838','36671','47997',
                          '50492','34129','86346','94848','21560',
                          '33164','79653','40829','17068','56617',
                          '25112','39409','19789','55510','29458',
                          '40058','18587','59221','28993','21495',
                          '13635','90631','61574','22411','18840',
                          '55195','88440','64756','61671','90838',
                          '72915','59169','57557','41237','26791',
                          '53364','48452','14673','77718','35648',
                          '65184','70548','23623','64393','49161',
                          '16515','46471','31349','78928','32075',
                          '61689','22407','71560','70106','28706',
                          '39179','99800','85430','86473','71384',
                          '79381','85872','84238','48312','18545',
                          '96909','66116','47089','13703','95694',
                          '22620','61297','29656','29895','12066',
                          '53662','86137','57025','44720','40540',
                          '33800','20646','20999','10633','26187',
                          '17913','86305','71733','72388','27500',
                          '19650','17874','33940','64652','22245',
                          '62282','24664','39383','12360','31317',
                          '45727','29570','90860','62515','46996',
                          '43245','46337','19894','27193','70970',
                          '19243','52537','34114','19600','30750',
                          '24278','97292','23064','94904','42757',
                          '30368','23214','35930','80429','88521',
                          '11074','83589','19864','52377','20720',
                          '91974','57008','57987','59291','20224',
                          '41956','23924','27511','66942','36146',
                          '10264','28981','11552','95994','21363',
                          '64497','62604','62220','89844','37211',
                          '28621','60296','10490','47326','77933',
                          '48142','29378','75464','43835','92955',
                          '43314','85767','55937','28012','44267',
                          '15794','36520','81301','41386','32433',
                          '81963','62548','46032','82794','12955',
                          '72251','21195','19398','46465','67192',
                          '95814','92294','44826','86539','20890',
                          '70658','26670','28734','62245','28438',
                          '20093','10755','61034','19330','91858',
                          '15214','49199','12968','43235','13027',
                          '28639','35379','38852','52706','42267',
                          '57714','45843','44658','45218','77123',
                          '29281','86597','38349','13912','83627',
                          '69653','44928','19313','20624','79379',
                          '36844','24625','16962','14789','37607',
                          '38683','85305','86710','37458','30320',
                          '46351','29191','25699','14826','85351',
                          '75040','14235','90924','27046','23359',
                          '30006','76043','62206','31206','40233',
                          '47700','39131','19450','53517','60660',
                          '76605','12387','12468','25899','42943',
                          '22433','45435','94229','98243','19750',
                          '11149','28617','55035','85781','57153',
                          '78010','51607','72357','10359','79863',
                          '90862','64783','33429','80160','23968',
                          '46811','39852','80766','23402','68819',
                          '53484','66322','65048','54512','31810',
                          '30427','51336','96204','68253','12053',
                          '43437','49953','18816','74844','13516',
                          '98535','55609','21459','75652','56337',
                          '45268','94201','62222','75333')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
