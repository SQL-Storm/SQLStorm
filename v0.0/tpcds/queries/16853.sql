
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '31736','55541','76036','36512','12354','63718',
                          '57546','25052','60312','20025','13359',
                          '21804','93754','95385','24422','67032',
                          '73746','11125','82395','73879','52881',
                          '46713','96639','62297','98040','74975',
                          '53367','51451','13430','21322','74574',
                          '46510','60385','89111','81412','68036',
                          '31584','92714','94667','16301','67171',
                          '65923','82645','55866','35203','16346',
                          '18977','87782','47240','77359','18703',
                          '81121','40487','82517','11674','89301',
                          '75798','15328','35531','44050','38772',
                          '38127','48069','93379','21481','44106',
                          '29390','59274','47200','19487','71796',
                          '59661','87584','46270','76456','80664',
                          '26270','17616','83513','57753','63057',
                          '93393','73186','11583','50440','17652',
                          '15054','81867','50437','14087','35499',
                          '22605','54889','23475','18609','42518',
                          '92898','62926','34795','60914','92780',
                          '54427','88249','20986','42737','47535',
                          '94452','80842','51943','39081','18195',
                          '38026','49610','79813','33158','24077',
                          '63696','29189','38757','45933','73262',
                          '27434','51726','48448','84017','27053',
                          '63199','27156','71816','33063','67284',
                          '77762','35998','52956','84521','11263',
                          '11199','88571','55873','41490','38163',
                          '22426','52491','25086','22200','14085',
                          '58598','75386','73518','49856','37639',
                          '35550','74944','62046','61191','77228',
                          '75428','25715','27670','77112','90264',
                          '23362','65925','72223','18067','59272',
                          '19644','37340','65692','76841','93337',
                          '78640','14096','25111','35398','60776',
                          '26311','25487','37041','72361','48408',
                          '39743','88269','28646','41919','26394',
                          '31269','94346','39536','22417','35099',
                          '65218','18223','55077','90770','33618',
                          '64904','35189','26403','85960','34361',
                          '49632','84038','19384','87566','62444',
                          '36697','40572','50643','24528','56448',
                          '80173','27655','42864','34546','75742',
                          '14357','34563','88916','90657','15895',
                          '21059','91652','16285','11048','89913',
                          '80167','29576','37455','60614','70961',
                          '30733','53223','54150','57827','22356',
                          '42265','77936','74438','73065','35809',
                          '46936','66493','43258','88271','32090',
                          '41874','93025','37355','84893','12990',
                          '50365','85354','11612','30001','24109',
                          '21460','33107','56891','96506','40011',
                          '52275','47490','98363','51796','80408',
                          '24215','26357','10490','49098','87038',
                          '12097','43239','87371','77130','55280',
                          '75959','26172','62420','10075','91404',
                          '93923','53484','75351','39091','25318',
                          '18146','14869','66725','73076','15845',
                          '14101','47563','69862','25617','23367',
                          '43309','72713','64399','72441','48276',
                          '23004','87814','46082','49461','44115',
                          '43405','72632','80299','91671','13860',
                          '93871','60839','94873','58926','64345',
                          '29581','79285','60651','90092','80913',
                          '72699','65384','94802','91044','10889',
                          '56985','11673','92110','10947','14894',
                          '26790','27299','23256','63224','78830',
                          '33804','29006','51091','35982','89665',
                          '61716','98389','65840','83200','26160',
                          '24252','22618','14949','93968','75253',
                          '48265','18651','60532','46508','97750',
                          '78779','27785','15176','30391','53777',
                          '14315','78201','53701','88136','11326',
                          '16758','80662','16805','88307','27871',
                          '51117','19088','59911','43640','13777',
                          '54072','96563','47068','25951','47894',
                          '75188','35368','50504','30426','85804',
                          '30019','95126','51910','35463','84687',
                          '88095','46002','32635','62494','76876',
                          '48278','62981','33361','92430')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
