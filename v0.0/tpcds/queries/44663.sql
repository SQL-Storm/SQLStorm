
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '29415','18813','55594','64550','84851','33433',
                          '51444','12700','98792','71660','48612',
                          '85044','64178','61413','13909','79860',
                          '27794','57555','93774','48370','53129',
                          '70452','47512','34051','39377','70741',
                          '26597','76867','19302','94534','88856',
                          '40469','85977','30951','85971','76616',
                          '73139','74491','65653','10017','88542',
                          '34373','96603','47402','86454','72399',
                          '65250','17492','11417','11353','42096',
                          '96599','22533','18116','87384','45808',
                          '72676','59075','18637','14478','48964',
                          '27306','62927','24367','35315','94542',
                          '65505','99386','47543','56551','69180',
                          '70304','29804','19591','22934','12811',
                          '76135','81968','21959','97438','25542',
                          '56639','16021','75343','13060','31736',
                          '23897','24470','72086','75195','18327',
                          '81477','73757','26656','71588','47540',
                          '18535','25857','45724','19596','54620',
                          '91836','24302','48188','13382','32808',
                          '81114','44293','63925','45162','16628',
                          '98243','88080','28323','26987','55640',
                          '38804','71271','77537','39064','75712',
                          '80824','53413','50239','68032','13193',
                          '95839','44771','74706','84083','46051',
                          '32412','54755','96347','16040','21049',
                          '65230','95785','82866','16606','77395',
                          '75899','34799','83474','36254','13874',
                          '94128','10246','11791','68583','85362',
                          '18868','56521','49057','28314','42983',
                          '62141','25716','16294','81995','32163',
                          '19295','26686','67913','24810','14095',
                          '57964','52069','40885','17969','23150',
                          '89191','13260','30709','18724','86038',
                          '29431','76691','22287','37818','70458',
                          '61473','57769','74785','16603','33485',
                          '69838','14291','91782','85198','44885',
                          '14932','53242','51167','89438','18401',
                          '24008','32995','95588','95422','56058',
                          '86452','29416','25983','17119','20310',
                          '29656','50172','19006','20944','40217',
                          '28877','35105','26395','47542','66349',
                          '85909','23231','76040','36005','81012',
                          '82553','67813','26302','30373','68554',
                          '36111','19582','35517','36296','95345',
                          '68687','52513','14988','89938','17762',
                          '82992','75290','58410','25094','50371',
                          '53078','44719','64853','46238','27321',
                          '16976','62671','81483','21130','23660',
                          '41708','77859','29931','78874','87028',
                          '38290','19791','61210','61561','83026',
                          '40717','21361','97542','17620','40624',
                          '46064','11461','29982','40222','31840',
                          '38891','59843','45890','37884','97466',
                          '87324','32130','49959','95417','12755',
                          '57081','25335','61534','17502','80088',
                          '73600','92272','62457','92490','42623',
                          '73776','84331','85071','12193','42899',
                          '23608','28614','21468','19948','50898',
                          '60021','12136','28899','27509','94814',
                          '82877','78674','60774','46723','11755',
                          '22012','32842','55945','61050','98470',
                          '89110','21782','29203','45664','87654',
                          '19223','21765','27181','98361','62660',
                          '25239','41826','36665','78179','59078',
                          '54447','91236','48527','71993','32682',
                          '41551','21306','48634','40476','27965',
                          '17861','68240','17853','92405','78696',
                          '52942','70020','25123','53690','41187',
                          '20318','43118','27993','48317','32942',
                          '29134','26407','55724','72082','42381',
                          '40812','54159','46003','27767','85758',
                          '47837','52391','27209','38039','32634',
                          '15315','53853','88479','87003','16501',
                          '62406','43230','26685','73967','36616',
                          '29964','21354','69030','39457','75864',
                          '12317','10986','91776','58465','50316',
                          '33295','36562','33751','91584','13345',
                          '91194','49328','57609','55566')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
