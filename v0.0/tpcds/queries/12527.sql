
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '46284','26005','57319','89328','26543','52162',
                          '16756','39396','30013','11100','19189',
                          '24170','10363','31669','34348','18798',
                          '15943','18100','39933','11303','20695',
                          '12235','94652','23523','97141','11573',
                          '32412','40655','85850','81390','80021',
                          '67525','74004','17691','15521','67736',
                          '33179','38915','85164','25474','61514',
                          '18526','11922','67737','53585','52792',
                          '17094','63073','85108','16830','43100',
                          '97357','23185','59076','34485','68476',
                          '55548','54354','63274','38045','22086',
                          '56043','93688','89756','18677','94026',
                          '10732','38583','96075','39613','68577',
                          '26850','60257','77423','25348','69140',
                          '55277','20947','10754','62168','24058',
                          '18681','51389','87536','58044','48621',
                          '93399','61425','65180','82709','88297',
                          '63643','75503','21184','16660','32734',
                          '46037','18251','16428','44212','35093',
                          '53987','14180','13328','12744','24013',
                          '96985','80346','39833','34561','63697',
                          '21384','19671','20789','12719','19964',
                          '78907','68978','13054','28177','38028',
                          '25972','40797','54034','35126','64472',
                          '20274','27639','80970','78107','47733',
                          '90740','97121','89425','44383','60966',
                          '50159','30585','81727','94437','10295',
                          '12155','17535','21019','86876','85881',
                          '64293','92444','43543','17850','11246',
                          '25641','54356','26274','25864','90042',
                          '32251','12242','37206','13551','51684',
                          '21294','14816','13111','81169','42496',
                          '42735','26725','44539','60711','66048',
                          '11788','80324','90052','58563','79284',
                          '94696','34369','10667','14192','33820',
                          '50597','93238','89588','50544','69207',
                          '53752','26251','95503','86636','67203',
                          '24281','76166','27325','73840','29806',
                          '60775','74971','29203','41147','68483',
                          '48988','65066','78630','10162','16056',
                          '57201','32340','70273','58500','53114',
                          '30544','79870','99691','19291','15874',
                          '57922','39776','86649','93753','23737',
                          '58620','95998','20525','26921','43882',
                          '30228','31512','14947','83362','32614',
                          '41513','17362','85482','79268','44379',
                          '82822','86537','91117','43255','44808',
                          '43150','19720','93707','50716','53538',
                          '60904','12103','93911','84463','30829',
                          '31950','34393','35389','87283','38802',
                          '43569','37207','56478','23555','25908',
                          '88874','16380','50033','68283','50213',
                          '97576','63462','14268','32418','23342',
                          '32884','12823','32288','22139','49753',
                          '39744','58585','49383','86905','42772',
                          '11065','39985','12838','46864','80663',
                          '98486','11900','32023','28581','25941',
                          '96736','62064','82526','23039','75895',
                          '54238','80208','39234','25508','41937',
                          '17343','11213','29810','25612','96330',
                          '82191','50111','17507','31859','82011',
                          '68131','54967','98994','89052','15812',
                          '87551','59046','28855','26114','59474',
                          '58927','32817','51721','22469','11927',
                          '81288','74018','68276','95511','65330',
                          '87659','76112','24710','25060','82160',
                          '53886','70535','57926','52572','70578',
                          '90303','35776','72595','20474','37530',
                          '23143','54173','51107','11205','15572',
                          '68805','30611','27572','26643','18282',
                          '64135','30015','87307','14729','12145',
                          '43886','41178','53608','26447','12713',
                          '91340','95399','93806','50550','61371',
                          '13291','21508','81980','70569','76433',
                          '42566','45871','89697','12541','33829',
                          '71415','22407','61959','45490','35367',
                          '61822','67132','72038','51278','79449',
                          '21697','46629','42284','80714','51660',
                          '33418','33696','85897','30323')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
