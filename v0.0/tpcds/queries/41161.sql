
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '51569','34687','26339','21266','21108','40876',
                          '23460','30958','81238','93832','94659',
                          '51314','42773','45457','34277','41547',
                          '47435','42686','75447','12336','15026',
                          '93293','90500','15027','61241','67327',
                          '82451','96585','89778','25401','29488',
                          '66197','57170','29027','46222','80712',
                          '18503','39294','47634','15623','31136',
                          '46062','68218','68565','99445','51890',
                          '35378','36484','54287','31963','14775',
                          '14092','53677','10787','11919','39680',
                          '86170','79602','22143','48356','78028',
                          '60879','10758','29310','17858','67816',
                          '56131','55998','69851','17087','43748',
                          '41562','65971','47775','70724','22041',
                          '62749','16798','52102','40103','28475',
                          '40852','36361','61163','82555','78246',
                          '70172','92506','62399','84228','10717',
                          '37313','86545','87510','43417','41151',
                          '52229','74234','16591','39475','12051',
                          '78989','20977','42864','76991','24351',
                          '89210','13794','18296','30970','71321',
                          '99118','21571','88604','40068','96462',
                          '20219','79243','41271','89771','83025',
                          '59408','86625','98955','77679','27905',
                          '42711','75361','21762','50648','20340',
                          '43938','30194','21532','16298','59843',
                          '12768','73335','40587','65933','12762',
                          '97534','30959','54912','19029','55889',
                          '13186','96522','81723','99278','36193',
                          '69490','78786','12115','56873','33443',
                          '84375','40023','90749','58817','55696',
                          '32372','29580','42414','45467','18504',
                          '21784','18936','45264','78415','69186',
                          '93198','45695','98608','10369','68443',
                          '55609','79898','17421','10746','10781',
                          '77438','26917','83974','11253','65552',
                          '90374','10690','33233','11534','11571',
                          '13095','91111','87262','16831','57872',
                          '88911','18045','48484','15036','98345',
                          '95339','37747','29587','37694','31260',
                          '16317','81738','46619','93460','54308',
                          '27957','52946','38503','72606','91979',
                          '33605','11546','60378','27431','88903',
                          '13716','42911','38292','61932','58615',
                          '93591','18971','57050','90673','19317',
                          '84039','96557','18553','91526','15915',
                          '39125','35415','19675','71712','22025',
                          '61843','17422','34339','49311','93641',
                          '64661','48367','72185','72594','34155',
                          '44201','29852','47426','99544','17240',
                          '76572','31406','88949','96047','25374',
                          '11845','43217','68556','19382','10851',
                          '67240','65776','17378','20884','68722',
                          '61461','96766','20225','61740','26538',
                          '48277','74159','51726','31840','16808',
                          '20846','48928','92049','30601','15172',
                          '37213','78896','37743','20646','11593',
                          '49261','53762','57392','41328','39287',
                          '28537','42277','64623','42884','49846',
                          '67079','41275','39972','11564','80526',
                          '74369','36972','16877','80306','73893',
                          '69245','19200','28366','19527','16475',
                          '31155','62929','55053','69370','64039',
                          '48033','15112','27439','60483','37527',
                          '31374','96408','68922','87137','26382',
                          '20064','53032','32930','87182','56584',
                          '42332','38997','80956','27016','93420',
                          '47688','46531','15189','18736','49075',
                          '59501','18967','93427','15941','30932',
                          '63846','73082','21548','57077','78108',
                          '91440','83494','60751','37186','58587',
                          '25111','73047','20153','49485','98515',
                          '59382','94442','21592','60410','40564',
                          '10953','16018','43243','36041','73483',
                          '44355','77511','23063','57509','96764',
                          '37007','28903','29121','56203','14609',
                          '47067','63717','47531','16944','61822',
                          '70865','20174','47023','12624','49791',
                          '11056','74604','67325','32466')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
