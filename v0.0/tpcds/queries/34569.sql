
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '71359','89757','44859','23422','66672','57536',
                          '68010','19720','60970','43699','93142',
                          '52558','79713','69729','20825','73000',
                          '88023','66050','53725','43432','93167',
                          '83971','24171','18953','10675','22203',
                          '35128','25428','79809','41666','37680',
                          '37913','61990','47712','22843','58090',
                          '78608','89452','48496','58871','88004',
                          '17971','54168','88680','29809','97144',
                          '49676','44645','42808','82487','26590',
                          '34059','72378','10935','59257','36968',
                          '82579','92891','31197','30689','80074',
                          '36480','33995','22119','37151','71695',
                          '48014','15365','10580','27659','48132',
                          '43204','63317','46457','72656','57993',
                          '27666','54294','67129','10152','79791',
                          '69582','40337','45083','76521','57785',
                          '73365','50901','17966','62891','42042',
                          '40718','22411','64002','67421','59455',
                          '21102','25365','92086','63642','88503',
                          '29548','47537','73451','70574','29255',
                          '39986','56100','73739','91580','85651',
                          '40431','94261','94257','83578','62054',
                          '84477','91539','46009','45184','82946',
                          '41599','49957','97688','45245','17078',
                          '23331','23643','83765','85944','31938',
                          '92530','81296','72783','15008','53393',
                          '63970','61561','70454','90227','38578',
                          '16200','91727','52418','33001','32893',
                          '13591','81305','34516','37389','75255',
                          '59216','57612','53100','21418','33257',
                          '22440','61373','20187','93910','38011',
                          '48482','12451','16070','15749','54209',
                          '47882','44231','11661','68483','42100',
                          '21270','72448','55885','22238','16208',
                          '50387','24363','93276','52773','92055',
                          '36404','76388','64764','18295','14245',
                          '38433','47146','51749','98921','46329',
                          '11814','12520','70494','10866','38466',
                          '34071','95255','12630','33518','50018',
                          '54036','79222','29545','76209','84253',
                          '91975','50483','30160','79271','36673',
                          '94755','19702','23103','74152','30459',
                          '95417','67310','72775','10118','24008',
                          '77502','32774','31561','58810','17715',
                          '97799','18039','94616','16904','49569',
                          '79515','66558','33943','32465','77615',
                          '14084','45411','91608','83370','77772',
                          '81127','15940','85366','62850','53216',
                          '30842','67899','16345','76631','61269',
                          '90174','89697','74517','52563','38724',
                          '36035','80664','26011','51282','26472',
                          '73554','13938','73527','18188','98056',
                          '10881','42452','29207','99403','99949',
                          '40086','12934','34434','43170','35158',
                          '43974','32393','30650','24591','37056',
                          '49356','71820','48774','12905','24345',
                          '18349','21144','26459','76457','64733',
                          '14475','93052','17848','97297','18700',
                          '13846','20345','47902','43659','20111',
                          '45618','57384','46043','57132','18880',
                          '30767','65750','18108','94243','85311',
                          '43247','63554','60157','31017','89365',
                          '21028','51877','36067','83038','60710',
                          '23573','98829','50871','27256','85344',
                          '63912','46706','70640','50261','77623',
                          '85190','22450','39147','16925','14127',
                          '23764','63507','41015','32103','41377',
                          '23789','60905','94672','61809','75752',
                          '80381','36644','35487','35320','96189',
                          '28604','15974','51084','10173','74769',
                          '49859','68493','74852','37707','23033',
                          '28787','35086','30233','73132','38652',
                          '59577','64176','92625','42057','16599',
                          '57186','70176','34687','68301','51056',
                          '11481','42831','58286','15983','70769',
                          '51447','17839','18642','52319','92473',
                          '49838','25510','38268','94827','73507',
                          '86835','69263','92020','66500','18140',
                          '10048','38950','75582','99343')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
