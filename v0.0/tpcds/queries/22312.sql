
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '74458','38965','26927','34099','92426','25811',
                          '27546','46330','34968','82654','71130',
                          '63178','33913','49965','81315','65897',
                          '15721','32964','25954','61205','88542',
                          '35110','50347','79960','17091','17762',
                          '79683','56787','15732','94091','97907',
                          '14840','47989','65450','92986','85132',
                          '29804','18557','78024','34836','10402',
                          '67187','93125','14138','58535','30301',
                          '99456','48666','17893','28147','27998',
                          '21846','73792','95780','72444','81950',
                          '99733','94723','29666','12598','75712',
                          '29652','31523','10329','45203','79114',
                          '37753','20995','14443','82866','34590',
                          '15903','65300','56700','29185','66158',
                          '41735','13046','62141','16294','15356',
                          '86255','33343','74434','64879','23150',
                          '35663','14059','26137','61110','21920',
                          '45126','77518','79318','93673','80946',
                          '86110','62929','51753','21406','24444',
                          '96657','25771','25918','82474','41980',
                          '42381','47542','79275','93412','19432',
                          '18633','90713','23409','42166','74644',
                          '33427','49406','58690','22803','28910',
                          '51633','11475','76034','35840','35854',
                          '26735','45881','78786','47042','82426',
                          '21361','32378','73011','72801','60525',
                          '59843','28561','87148','45393','86004',
                          '87950','95241','28418','30145','71512',
                          '48888','59681','79714','51292','65072',
                          '62905','27509','81971','66493','40499',
                          '25428','31208','59858','67691','52065',
                          '76668','15167','22864','59229','36677',
                          '91236','61821','78007','89188','40121',
                          '17698','76025','97559','11186','75259',
                          '30398','60264','11606','55724','82053',
                          '28656','78885','38390','30909','40650',
                          '67103','24718','10530','26685','36616',
                          '48237','33687','75584','79040','60888',
                          '73941','42627','13063','34886','93496',
                          '46243','30522','32063','38882','70581',
                          '25161','24478','23850','72922','85780',
                          '80232','22553','10219','19055','62244',
                          '92955','12225','38530','30165','29605',
                          '46277','18227','30851','37263','72469',
                          '26358','77342','16318','88195','40458',
                          '84344','26353','30085','79875','67573',
                          '60044','41824','76029','98064','41462',
                          '70625','82801','82427','36859','18661',
                          '46907','15461','20267','79665','24796',
                          '57751','31889','28670','20939','68960',
                          '20969','28368','32429','24363','15417',
                          '25359','14338','50595','10634','79098',
                          '19459','69267','65569','22254','62744',
                          '27106','28843','24769','75827','22167',
                          '70956','17455','17849','98585','36447',
                          '45924','53014','45970','69186','38447',
                          '13921','88759','51196','75520','71270',
                          '83712','23844','69029','95798','71450',
                          '94005','61131','89589','76290','67576',
                          '35011','24085','23375','51698','20167',
                          '16290','94932','87025','56215','10878',
                          '63160','32555','34364','75640','17487',
                          '97768','12715','61814','24656','45651',
                          '39236','50523','18591','15294','23854',
                          '23579','67737','68333','87519','62357',
                          '32224','11072','25554','86863','54558',
                          '71434','55245','18847','67062','30661',
                          '13931','29646','74612','14025','52949',
                          '75072','36163','62562','94961','10096',
                          '75420','19526','51308','63841','60549',
                          '83507','46918','33531','17574','71191',
                          '25367','34470','67566','17831','33172',
                          '20563','36201','16090','42321','46446',
                          '71753','29262','55488','45797','12482',
                          '82331','68439','31413','26841','55330',
                          '16911','47663','36557','24443','58197',
                          '60061','52056','31570','47638','24392',
                          '61520','97765','21960','47616','42485',
                          '12583','23734','10951','23789')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
