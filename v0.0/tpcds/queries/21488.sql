
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '44676','31601','37733','72856','99673','32826',
                          '45552','73664','73039','56824','43323',
                          '12038','20877','17551','45850','54170',
                          '43972','52344','42468','85651','52532',
                          '77279','32177','31817','39309','58276',
                          '71449','57714','44064','89481','31952',
                          '42961','43597','45488','69018','14753',
                          '68526','69197','89761','38493','12944',
                          '84079','29488','10275','45863','31504',
                          '16809','15421','41939','17022','88960',
                          '95422','86377','93291','56410','42185',
                          '32711','30464','83614','56102','74298',
                          '37338','53437','19980','31515','68038',
                          '67748','52270','61863','13318','48212',
                          '43357','44910','66955','26771','30008',
                          '99548','99963','85382','27890','46381',
                          '41471','39377','66257','94711','41588',
                          '57063','44669','86286','38048','60701',
                          '77600','37781','95329','37247','55649',
                          '76137','72494','84209','56575','67954',
                          '19169','53802','71129','42362','20093',
                          '49260','25632','98044','77763','59326',
                          '94342','53211','18655','77157','65736',
                          '21641','19988','62202','57186','39411',
                          '34494','11605','91521','28079','15777',
                          '50760','53795','80530','67412','16451',
                          '92294','80095','75643','15153','54954',
                          '45082','88950','16061','36520','28136',
                          '11514','94692','12652','23226','59618',
                          '29070','94840','33576','18169','63404',
                          '11339','15050','24920','95961','78161',
                          '61410','53201','47443','44645','94283',
                          '90568','59360','25674','28450','14892',
                          '69862','32133','26883','68692','41146',
                          '29782','37082','63771','93228','16943',
                          '96225','68958','61525','37894','77862',
                          '95879','20989','95880','22018','56576',
                          '31533','37750','29822','29704','60855',
                          '89549','19104','41543','19957','34964',
                          '13955','50656','13395','61187','32368',
                          '41956','56013','25125','58073','90021',
                          '14416','89728','57265','46778','52684',
                          '52397','28153','17024','53335','66867',
                          '25796','21002','21441','58550','58089',
                          '34166','18236','32990','77341','12119',
                          '20757','48171','52817','43841','15848',
                          '12943','65381','43696','60241','70985',
                          '35668','54014','39649','78526','68409',
                          '72986','30602','67630','13414','10847',
                          '56983','15220','13367','46796','23137',
                          '41794','66654','99104','95609','66839',
                          '61971','30042','21401','12219','19436',
                          '75603','13942','60065','14318','43314',
                          '93833','49639','20444','35402','59146',
                          '89249','20841','80918','28487','23310',
                          '77904','12126','75234','11836','24893',
                          '53247','94080','39365','53363','51976',
                          '13985','66044','48637','95213','42097',
                          '31275','11172','51674','17401','87010',
                          '80759','90069','89931','51544','48713',
                          '95247','64620','53856','22363','57190',
                          '81682','12134','43963','60103','10426',
                          '58677','19687','22177','74518','24946',
                          '67775','63085','77920','85791','32172',
                          '64377','56369','23979','33874','89718',
                          '34446','39869','77044','75887','80650',
                          '31527','17306','84787','30115','19279',
                          '38016','90320','29075','50981','41895',
                          '28393','71817','29916','14141','44653',
                          '18805','91288','94409','69581','21602',
                          '29666','81937','50133','71947','38218',
                          '43948','46922','12790','70886','34760',
                          '20993','25364','56194','42280','49018',
                          '59825','11342','10046','19929','20395',
                          '57114','83601','48435','93061','31045',
                          '21167','66969','92860','49095','22111',
                          '54003','59451','90461','47271','15209',
                          '68131','47599','88669','35894','79749',
                          '71120','47670','37545','69460','85655',
                          '39339','16606','18374','31583')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
