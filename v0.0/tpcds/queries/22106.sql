
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '90059','43606','40076','77598','44473','38467',
                          '45428','27723','45452','32332','61192',
                          '40177','88428','46790','21415','26038',
                          '32385','19622','24609','73779','42652',
                          '13246','26481','17663','48913','96790',
                          '87604','43384','27232','34712','50707',
                          '19577','10419','14126','19871','34628',
                          '76637','61368','20998','47474','14214',
                          '26410','96625','67270','94653','18237',
                          '15947','38490','52696','10777','98742',
                          '46857','98043','96746','28916','60660',
                          '62234','52567','25544','60387','45564',
                          '13089','37418','58712','10725','84137',
                          '62987','46084','28889','60098','28177',
                          '38948','18073','81857','44373','36602',
                          '55056','97672','22502','44602','73170',
                          '14829','99175','96305','34803','51003',
                          '22100','29943','75097','44107','76671',
                          '42967','17949','63575','76390','69636',
                          '20393','97216','44721','41090','61559',
                          '59089','48362','79848','72195','88182',
                          '62038','82044','15379','95749','37534',
                          '56419','34061','41544','16802','41172',
                          '16402','68778','86566','62278','30923',
                          '85356','29273','52248','88735','63518',
                          '20001','84542','42734','77063','81495',
                          '50961','45068','53443','30626','12544',
                          '76050','93216','74141','74164','42431',
                          '19022','21416','18510','26130','46231',
                          '43134','52826','19023','85755','82218',
                          '24519','10446','49446','32060','27553',
                          '37677','28418','10671','98127','21937',
                          '63038','14037','20519','63018','30937',
                          '96820','39948','22488','66695','65027',
                          '31465','22721','80565','60420','55948',
                          '29311','40415','56351','27609','26052',
                          '35542','86911','33310','25471','82581',
                          '25670','18975','89323','59403','34897',
                          '35920','20757','31915','33809','44645',
                          '35274','90446','15394','84712','78498',
                          '29209','21103','52703','46469','88629',
                          '66033','62552','77010','54153','48870',
                          '71685','64073','30570','65189','39670',
                          '47618','68059','80693','68856','18433',
                          '29042','32151','29481','18657','19070',
                          '19063','71128','22668','64687','28261',
                          '11312','12744','51259','30584','96810',
                          '88173','36740','89434','18577','64027',
                          '13455','51108','63788','28396','24676',
                          '58968','82883','60121','16605','72497',
                          '83707','49956','61448','88598','66728',
                          '65662','67565','55048','95811','17711',
                          '22623','51558','68338','85035','88776',
                          '56340','22739','84947','19289','90240',
                          '19972','25584','14718','43846','14748',
                          '56767','93610','95995','96071','76952',
                          '24041','84454','11540','77522','53807',
                          '37373','64106','77159','56355','52580',
                          '97512','65274','73770','20567','62212',
                          '87517','51579','60775','50614','52124',
                          '95070','98131','39486','39328','86485',
                          '84523','57430','32213','22565','80016',
                          '61760','13431','17814','27183','23350',
                          '72453','39599','67447','86528','13992',
                          '22566','11877','70499','64642','41551',
                          '58839','57178','43813','13079','34023',
                          '96637','15345','57386','77823','16829',
                          '29886','28863','43904','41826','58772',
                          '67197','50897','95652','24037','86401',
                          '26214','37030','35355','74407','20926',
                          '73823','62968','69198','71666','17913',
                          '78789','18264','38223','50885','15495',
                          '25402','33822','25112','69733','34738',
                          '73030','69864','69964','58188','41787',
                          '42989','43015','16877','46215','63423',
                          '87232','55336','25863','37634','36347',
                          '18850','30127','31948','52013','92450',
                          '47646','58036','31417','25192','70381',
                          '43992','95096','46705','81427','96605',
                          '46228','28452','54798','64658')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
