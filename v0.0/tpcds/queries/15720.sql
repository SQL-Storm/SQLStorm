
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '58758','93877','56569','19913','49767','36118',
                          '19139','50329','27433','38874','12021',
                          '58630','77206','55625','47593','45570',
                          '52070','36574','57002','35218','90718',
                          '52520','24664','66609','10310','54186',
                          '63911','69447','46506','27152','30489',
                          '90258','73173','55314','65826','36828',
                          '86684','11152','11328','14664','37091',
                          '47735','47113','85723','95152','36128',
                          '48143','11610','73942','36732','63765',
                          '67635','13197','69515','42668','30094',
                          '50527','38479','55815','95785','70313',
                          '10383','33534','75257','86990','61558',
                          '78979','57541','63318','51699','35199',
                          '83866','94886','74436','38013','72616',
                          '58085','29034','88149','73450','27385',
                          '27729','94321','48399','37519','38552',
                          '50904','27876','14515','65209','22553',
                          '16869','41334','77572','27677','31337',
                          '87901','58119','15222','34823','11988',
                          '42451','76163','52457','99180','34418',
                          '17046','13607','55376','90452','30637',
                          '11820','26432','86763','77200','37417',
                          '31773','43694','14560','82181','20888',
                          '65027','37545','16836','47150','12738',
                          '65656','14636','39570','41405','94134',
                          '41126','83877','57721','23205','17206',
                          '37272','17583','49980','31278','34701',
                          '62839','35701','86988','81921','12040',
                          '91277','64600','96022','58419','44262',
                          '25267','63905','63721','18242','14979',
                          '63195','80617','62863','44738','22752',
                          '62420','92442','17305','24885','92925',
                          '15548','20923','81812','88415','36218',
                          '15525','23689','25050','40362','40929',
                          '59494','88746','20604','64827','32383',
                          '19314','91129','25861','16326','93876',
                          '15475','27376','80519','18511','20145',
                          '14443','83180','60550','14157','19364',
                          '43398','81447','15176','34493','50351',
                          '30739','95245','98549','67769','75031',
                          '11470','71183','10794','34027','52474',
                          '12140','50878','79696','54917','89751',
                          '45137','25921','37260','54683','37559',
                          '80730','78951','41515','51441','42781',
                          '38092','72596','57369','15867','55548',
                          '85473','18927','68137','43056','32388',
                          '77974','71223','61342','10245','81660',
                          '12799','33552','18570','28044','65208',
                          '68816','22852','86214','88354','73041',
                          '40606','33409','97091','67450','59369',
                          '22898','86059','97701','79758','65402',
                          '25060','80674','54017','46887','11560',
                          '88422','17373','95710','18014','31117',
                          '83830','81826','44771','50409','12082',
                          '16197','51340','47785','27659','47813',
                          '58828','46052','25404','75386','30081',
                          '75344','17182','77073','40358','30241',
                          '49080','61176','21725','45734','37977',
                          '65331','48764','81818','14778','32028',
                          '78626','47305','25335','17528','55509',
                          '85086','48058','58449','10211','88291',
                          '63924','38934','66155','98429','67705',
                          '36730','53909','49424','25991','68092',
                          '76049','26296','25692','78078','91540',
                          '15924','80159','35315','53055','27012',
                          '11723','22235','37047','74525','44070',
                          '17619','94145','68906','48774','57451',
                          '93504','93725','85745','19908','36421',
                          '56570','93922','72750','96153','35795',
                          '19136','62920','10145','61411','19512',
                          '83920','39456','74170','80739','56395',
                          '35607','65101','97822','17400','83633',
                          '53691','31019','55795','61704','10840',
                          '33413','75619','58642','51514','99779',
                          '43672','27405','66636','46852','32601',
                          '65403','22997','12962','63165','67052',
                          '18432','70827','21529','43107','43400',
                          '43697','50973','69934','94250','71850',
                          '94955','97847','35606','99434')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
