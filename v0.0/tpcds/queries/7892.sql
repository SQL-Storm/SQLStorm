
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '79052','21319','96708','86642','54861','32116',
                          '69406','94366','81240','64237','22062',
                          '45255','29484','23916','76805','89057',
                          '69193','53022','97752','52082','46907',
                          '26982','30327','86267','57853','61413',
                          '68680','20503','52006','71809','89934',
                          '57589','37350','94991','97341','94941',
                          '70182','21655','10318','13437','67593',
                          '44025','75360','19122','52300','92074',
                          '79182','24845','52460','80631','66327',
                          '74699','85898','36340','94808','25592',
                          '95981','21332','16248','84980','66892',
                          '73313','91152','49651','47124','45593',
                          '63431','38846','65098','87616','91732',
                          '97860','37327','48397','17384','91824',
                          '76771','27608','52747','87173','60646',
                          '84237','75068','67277','82678','38981',
                          '26609','40314','78397','22330','22940',
                          '85755','43405','10381','52955','23441',
                          '34854','70542','85135','25648','17866',
                          '60756','33952','49463','37499','15781',
                          '88299','39901','93788','21874','32168',
                          '96276','17646','27014','75002','38755',
                          '15075','23878','88622','81404','42479',
                          '97398','90209','43618','29168','92711',
                          '70565','40610','89975','90149','46014',
                          '76208','60260','59245','30968','89769',
                          '83849','69623','10097','10709','78930',
                          '43079','42551','36724','58678','51995',
                          '82123','74081','39422','81630','11125',
                          '21395','18047','21695','68353','11950',
                          '80908','83762','52556','55004','62259',
                          '34278','31132','38122','88061','10757',
                          '75021','37490','24988','93593','47181',
                          '19913','78241','26878','26715','18112',
                          '28654','10835','73451','36527','46805',
                          '33309','58901','73316','96012','39306',
                          '58403','74956','70110','76164','78167',
                          '46541','30554','24084','69829','20201',
                          '59013','32781','26552','28970','78873',
                          '38130','10722','82266','95727','28215',
                          '23713','22823','97731','96128','56878',
                          '25410','37305','70908','38079','30582',
                          '90089','81308','76804','80607','97952',
                          '75746','84812','14282','63851','18420',
                          '47134','14771','27510','84008','46951',
                          '62118','63745','33436','81122','10402',
                          '35579','56992','30732','76457','56865',
                          '39605','13166','79044','35568','23483',
                          '81776','32577','59239','14011','79395',
                          '19140','58746','21296','54253','85664',
                          '95798','46025','86817','54501','76817',
                          '18274','71483','16117','48459','32751',
                          '73710','12317','22319','62173','30424',
                          '99704','85983','60310','64922','14150',
                          '91860','39595','66965','78247','58179',
                          '59426','63704','91212','81885','61117',
                          '37149','65593','43267','20011','65118',
                          '20416','52364','89666','18465','31764',
                          '16788','94575','52378','95079','22928',
                          '29858','94505','40703','10377','30124',
                          '56493','92003','50175','23130','12773',
                          '18544','16825','42790','22784','95699',
                          '42153','97002','84215','56871','17941',
                          '87092','23140','70340','12305','36593',
                          '23023','41585','24893','81860','70915',
                          '95166','60148','85097','91680','42543',
                          '69166','34521','75456','55182','32040',
                          '37145','76615','15506','21891','94817',
                          '60354','10019','50238','40090','91274',
                          '27071','76332','37336','63460','21905',
                          '98966','31416','10326','34708','34002',
                          '21816','15753','84586','53711','58258',
                          '13578','67815','62443','53040','19573',
                          '25107','45253','34359','54921','63467',
                          '39370','23701','62206','50876','53564',
                          '11522','13136','25768','59980','13313',
                          '36780','31946','24629','84464','60775',
                          '27278','29273','99672','13177','83473',
                          '60432','24291','75302','53762')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
