
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '60795','56532','41663','99307','56203','93032',
                          '40913','69149','43574','19061','27592',
                          '27308','86228','36240','35001','64751',
                          '54143','87865','86180','30601','56400',
                          '63464','17737','77913','66946','86561',
                          '56985','46013','26487','22116','65263',
                          '25858','20023','98418','59382','51393',
                          '70734','40270','22084','72281','81574',
                          '81939','56684','94536','79834','70546',
                          '27274','91722','41021','22549','34483',
                          '57114','34454','21053','19725','80061',
                          '83330','13674','33507','92499','57475',
                          '75233','85493','14372','22591','24729',
                          '85781','68836','29194','59409','18254',
                          '21033','79436','40644','29113','84547',
                          '30558','90577','67490','39462','58552',
                          '79534','30243','79647','54913','26590',
                          '44130','12157','77885','65228','77075',
                          '81946','92634','34063','42111','26803',
                          '67543','98411','16051','24326','29218',
                          '77015','70081','93474','94514','72226',
                          '19298','15688','13653','52179','44204',
                          '54501','65788','10420','18782','25999',
                          '92863','62839','57512','12944','61584',
                          '29463','46191','49215','20459','32591',
                          '34168','74148','58751','29858','63806',
                          '10846','52717','80607','27752','66560',
                          '21615','49318','24531','25550','85526',
                          '49148','56657','89234','26857','22916',
                          '88999','32926','84776','36471','87092',
                          '63752','77114','25614','15831','91393',
                          '24656','25519','25996','31175','68246',
                          '32977','67763','72154','38952','46954',
                          '35562','24790','32202','85016','33084',
                          '26577','14440','75144','18653','22652',
                          '62735','83871','40242','85039','23959',
                          '37775','83513','36928','92846','86846',
                          '86878','86223','32870','65886','28173',
                          '68814','64034','15684','74213','98927',
                          '14003','29011','23818','48077','89653',
                          '96958','64111','11267','71870','42573',
                          '42967','92639','83221','63232','31252',
                          '90144','79381','88776','48474','98477',
                          '56275','14904','34535','46026','44859',
                          '89606','26688','68526','38490','80453',
                          '94906','66385','32145','47889','31178',
                          '25781','29480','35477','12537','84274',
                          '81618','16266','44336','12813','65443',
                          '91112','77402','56874','13199','56129',
                          '49081','48515','12461','89573','36111',
                          '12346','14614','31578','38252','16432',
                          '44185','58461','12670','78403','47985',
                          '17573','42492','86242','82512','52877',
                          '32767','75498','52944','28888','66536',
                          '77392','35563','69960','77100','38150',
                          '18668','60397','69509','22264','20812',
                          '29368','80964','51913','62021','11940',
                          '50468','16650','17168','33988','14138',
                          '94103','53288','70765','72414','12056',
                          '21229','86501','47832','96058','58745',
                          '30308','37501','97031','25172','27852',
                          '16874','31633','14318','93757','56883',
                          '82193','62539','57469','61482','21526',
                          '35730','56514','81286','97636','59610',
                          '81573','27186','51272','52927','21792',
                          '67465','31204','45805','19340','54995',
                          '40849','18998','86081','60643','10200',
                          '75744','28471','62443','53696','24149',
                          '69716','22970','82215','82797','14731',
                          '18023','12359','61255','61614','11290',
                          '14090','23178','70163','30514','16716',
                          '83070','31445','77177','90054','29514',
                          '41573','39883','73794','61463','91338',
                          '73097','75382','19764','96163','31816',
                          '13322','26219','14445','62738','73005',
                          '52173','49906','42992','22288','85776',
                          '11954','45661','31531','41036','20297',
                          '86671','74520','56749','13881','76625',
                          '57857','65202','60381','82027','89966',
                          '54504','23011','36172','44807')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
