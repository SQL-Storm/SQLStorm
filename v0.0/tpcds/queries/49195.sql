
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '85982','39258','18050','30691','84016','62329',
                          '38933','65811','35054','20612','32863',
                          '22910','30921','11268','41544','37912',
                          '92127','38210','45510','71346','10840',
                          '12195','10804','95618','89594','21261',
                          '19225','19223','95641','19584','60439',
                          '14633','80388','25389','64693','15073',
                          '38877','14522','56959','50259','80479',
                          '32224','22562','73080','22820','67361',
                          '83655','48551','28195','53800','29063',
                          '18218','80575','24778','72467','77380',
                          '18019','99625','49948','36896','14830',
                          '51578','87215','45776','32850','13153',
                          '96944','12486','28419','53783','26791',
                          '52401','13574','36444','86706','20088',
                          '49349','31510','78552','78099','68132',
                          '81746','69194','30442','27242','40700',
                          '24332','66338','19405','74594','42625',
                          '37984','14134','58975','24009','87244',
                          '37307','61212','58949','75005','98468',
                          '81809','26671','20857','21527','30843',
                          '83654','29943','87741','68152','19149',
                          '14530','17686','10500','24878','51206',
                          '10922','93534','27754','26213','52441',
                          '11736','22319','55336','88329','51160',
                          '30731','73950','48702','15695','85333',
                          '43963','55945','35693','65976','32629',
                          '78015','26090','47147','30266','44423',
                          '58245','76974','37195','28716','46366',
                          '27554','60516','30650','79635','17764',
                          '22871','12229','20596','64446','18560',
                          '52292','57027','41652','40235','94326',
                          '10176','73702','37999','55651','44632',
                          '58362','13293','94562','67551','70325',
                          '16875','32203','82848','46998','67433',
                          '59620','80247','78162','41572','32617',
                          '10012','20839','84938','30153','41757',
                          '21982','56461','53425','92790','96717',
                          '80943','20501','76445','85054','33453',
                          '16845','54989','91281','21411','49960',
                          '31235','18921','67458','48238','44668',
                          '29248','65492','24415','10944','68819',
                          '55791','53430','28262','39716','36822',
                          '86598','11803','18752','44562','12990',
                          '26578','14562','39640','19632','36429',
                          '73944','16209','77307','68023','17112',
                          '67194','79570','69928','46316','74690',
                          '80639','12218','51378','21471','97434',
                          '90098','60999','61140','34900','33807',
                          '26508','44106','53414','90593','15728',
                          '31026','16210','33845','52872','31048',
                          '89132','43627','39004','66448','65330',
                          '16091','42135','87388','13271','24284',
                          '94307','77261','55435','23210','39885',
                          '28428','76430','12971','65942','88231',
                          '82672','50856','81383','88949','32573',
                          '87139','30522','49490','53989','17482',
                          '13975','21968','30908','93610','78139',
                          '90503','41246','51863','10188','64303',
                          '83568','88102','58786','39805','25890',
                          '70315','77819','89540','57849','30977',
                          '98871','89777','14795','62189','26498',
                          '85737','79200','26746','24896','42768',
                          '57481','62270','58395','10781','94249',
                          '54902','36282','36447','65161','49364',
                          '18855','97979','22025','84262','17681',
                          '27772','60829','26034','17537','43820',
                          '55313','49345','48204','69924','17003',
                          '36126','92828','44671','60807','12425',
                          '53464','20178','19294','74514','51780',
                          '38900','76560','29813','77251','67154',
                          '72042','20969','56531','72828','83852',
                          '75947','55334','38235','71886','56769',
                          '61606','19580','10494','12510','68919',
                          '90314','35541','93171','53037','62383',
                          '28967','10672','33043','12622','16275',
                          '17343','66413','37950','31638','51620',
                          '61550','26081','16547','68653','59266',
                          '26420','59178','51481','27455','29364',
                          '74744','34693','12230','16054')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
