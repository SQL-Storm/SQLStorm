
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '93483','59138','39904','32077','18995','57864',
                          '64675','41874','13682','37119','59246',
                          '72937','44414','16484','98118','11800',
                          '28001','74013','52496','46103','75456',
                          '92377','15458','68941','89811','61446',
                          '38594','38813','61316','20727','44027',
                          '14139','97627','29651','81415','43675',
                          '31783','42039','68593','58449','30170',
                          '15294','33446','46035','67676','91555',
                          '37069','54023','12738','47214','72498',
                          '77627','98515','59522','67369','27787',
                          '96329','60782','37642','16316','66619',
                          '56188','55259','42403','79804','99090',
                          '40411','51927','86892','10406','26246',
                          '38965','26591','22014','63961','60606',
                          '46023','28340','15453','62102','60769',
                          '81211','81907','25252','84099','60356',
                          '54082','14166','38483','27415','16512',
                          '37442','80260','32754','51582','13757',
                          '17495','42851','22297','81219','83432',
                          '43988','22702','90983','97051','95596',
                          '73936','36277','18411','95759','11359',
                          '98027','44853','85358','16012','31126',
                          '86509','14898','20180','32289','19777',
                          '16281','12863','16239','80016','95888',
                          '20629','20017','30942','45475','49838',
                          '62385','49097','94578','47641','27626',
                          '62652','17470','75237','11067','81940',
                          '19160','25355','74152','81248','76551',
                          '13619','22483','37190','53420','89076',
                          '49267','74078','36799','65862','24181',
                          '29580','21951','79043','18438','26148',
                          '83140','64404','58538','16389','56962',
                          '44534','98908','82017','34430','85956',
                          '35487','52596','75021','79138','34125',
                          '78132','30392','53917','50967','13410',
                          '26157','24261','41315','88189','24014',
                          '85249','86505','91918','42892','21360',
                          '15853','77072','69329','68090','18817',
                          '71569','95219','90937','48358','36317',
                          '36126','12864','57539','16518','73065',
                          '98626','13054','17534','19227','14594',
                          '41791','46927','74651','29535','54478',
                          '14197','17051','18398','13715','22719',
                          '22665','99874','15840','17189','23487',
                          '64523','35718','21655','69644','57470',
                          '99812','51012','23171','66399','63536',
                          '64334','25603','57233','23123','68882',
                          '28647','78108','43798','19035','35776',
                          '14453','35234','53501','11372','92648',
                          '40754','98996','40152','82051','85765',
                          '86088','85756','56775','11939','13299',
                          '44788','79343','92016','73956','76010',
                          '97451','69536','15016','82022','88090',
                          '28368','90078','44076','11793','83587',
                          '83557','73607','71121','80429','25449',
                          '35537','78404','22332','56280','47406',
                          '64758','26100','45536','63272','17954',
                          '96839','97088','20969','96244','48037',
                          '78278','49574','65040','99759','82742',
                          '16947','45253','57795','48980','99841',
                          '39428','96409','65122','40675','99036',
                          '64273','90452','71973','13062','17321',
                          '70582','10483','14732','14420','70637',
                          '38984','10897','42238','79007','99315',
                          '80864','87268','96421','35077','17770',
                          '21731','33918','55192','42869','87737',
                          '16566','59526','72124','58009','30953',
                          '16150','13176','57179','41129','62163',
                          '46267','35237','45570','64932','62037',
                          '30165','13478','66483','95597','61719',
                          '81345','28765','17641','24826','42477',
                          '61317','81740','64032','34599','31802',
                          '88295','85405','85445','27021','41986',
                          '23569','37346','65704','30485','87282',
                          '69460','28135','30046','86755','24955',
                          '10584','88031','57579','77365','16258',
                          '85623','47215','72652','63880','43058',
                          '43304','80039','14277','73502','53987',
                          '47419','97295','50384','79038')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
