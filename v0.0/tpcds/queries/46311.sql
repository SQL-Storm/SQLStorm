
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '92366','14648','70257','26472','35134','68851',
                          '71256','68181','13471','52210','98756',
                          '36356','22673','21283','58611','55028',
                          '25486','74742','72814','89060','69883',
                          '30978','70570','31688','91639','67770',
                          '93944','38962','37496','67857','90836',
                          '38306','70365','47420','78898','29748',
                          '25580','45338','76267','38499','13814',
                          '83392','21492','75820','41767','34952',
                          '52714','93662','56538','45631','20283',
                          '70638','15506','59021','86219','14458',
                          '30328','10566','13883','45871','55410',
                          '99256','23834','17678','10287','78242',
                          '35937','44173','96741','29184','45584',
                          '22213','77732','46284','65989','81857',
                          '10992','16592','13017','74025','52446',
                          '48938','44617','83573','70927','15306',
                          '52832','90104','10756','83645','28475',
                          '27080','75600','17889','60235','32621',
                          '85119','98741','58514','73182','73333',
                          '12497','12825','21545','50732','28048',
                          '16848','73171','43096','28304','44329',
                          '80369','66385','21289','65645','98402',
                          '69694','34174','22426','91437','80903',
                          '44545','99608','42934','32771','36053',
                          '95737','19097','66668','46428','15701',
                          '58094','52529','65591','34357','70642',
                          '13781','11436','49175','15404','93818',
                          '43358','45465','45202','65460','80194',
                          '29962','91151','49740','67820','76231',
                          '42382','46077','44046','87733','12848',
                          '37175','22864','81519','73440','48748',
                          '91532','83888','10832','14543','71919',
                          '76205','32097','83297','14154','26697',
                          '84564','37738','55889','86029','22676',
                          '43019','65341','21525','82408','98214',
                          '52302','76508','10500','89542','84540',
                          '42147','91976','64872','24636','52678',
                          '48071','31911','80924','52215','43507',
                          '35666','71901','71209','19418','41953',
                          '64859','65744','53728','39841','48828',
                          '27775','11161','56751','11860','68714',
                          '73348','17002','99370','49709','45065',
                          '57934','54049','36311','53258','52439',
                          '44618','12802','34981','68597','68050',
                          '38128','44924','69992','61614','89126',
                          '60506','20159','93264','27857','74583',
                          '34407','85180','41170','84990','66050',
                          '72189','53374','12592','33313','38484',
                          '22683','32251','57458','70146','24336',
                          '93476','97451','40848','41146','50379',
                          '46286','97611','93801','97141','39402',
                          '36728','29947','54008','18024','43004',
                          '66522','17292','68769','19862','69190',
                          '47056','93507','29945','10831','61617',
                          '22488','50009','74547','47023','10519',
                          '11316','78349','23555','21926','23501',
                          '32984','83846','51204','73897','25421',
                          '19686','53541','81356','66407','16533',
                          '55002','60738','61420','13086','54535',
                          '34106','12040','46482','82018','24556',
                          '63296','22100','78371','28356','61998',
                          '14077','31894','65790','47170','22526',
                          '47187','88028','55617','54879','29082',
                          '86791','47427','19417','79195','20056',
                          '75552','44144','19243','22240','44151',
                          '55866','20058','40980','10476','60902',
                          '61459','63781','26296','61577','44635',
                          '50239','58833','20088','36022','29871',
                          '27958','85760','45076','98610','68994',
                          '51827','89571','43109','78688','75331',
                          '10752','53820','13290','11029','18890',
                          '15923','19424','88734','36859','71246',
                          '42965','22823','11565','75769','22679',
                          '94244','84543','83736','11163','87586',
                          '88080','38995','34254','42984','55738',
                          '70942','66604','50786','21743','52895',
                          '61362','20160','72209','33268','85500',
                          '94118','14662','90904','97266','26101',
                          '35888','14924','85713','21534')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
