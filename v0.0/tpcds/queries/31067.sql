
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '26352','50326','17275','25097','30135','17847',
                          '29827','37119','48295','27108','26290',
                          '61047','76997','71900','33570','52154',
                          '13276','56501','16205','30009','30467',
                          '28413','50725','69256','43608','63721',
                          '20082','53306','60285','62090','67228',
                          '20839','17702','47009','95839','27551',
                          '91556','28416','29064','50956','71805',
                          '73174','67369','31282','42034','14440',
                          '80091','33763','17846','42498','29286',
                          '63194','33704','54812','83159','46894',
                          '93136','24898','12109','90732','15820',
                          '72536','26578','75397','19128','25789',
                          '35407','18850','95595','12555','81556',
                          '13966','54730','29003','55345','68274',
                          '89047','86688','86179','86507','69145',
                          '31578','60249','44337','39942','13773',
                          '47947','31477','75084','49141','36243',
                          '90236','11964','62365','23493','57626',
                          '16414','24032','95263','33801','10885',
                          '82285','95000','26522','34550','16829',
                          '24590','23181','50590','61983','93727',
                          '96228','15452','99729','82853','22291',
                          '62405','34871','76254','33806','32930',
                          '14150','48189','21452','33330','64135',
                          '54764','83340','53137','19247','55587',
                          '43405','71681','39661','42864','92187',
                          '42339','28517','55477','80513','11084',
                          '32423','77741','26125','70203','18195',
                          '12956','31204','21391','31943','62720',
                          '93864','69197','44590','12227','98246',
                          '28144','42017','35131','13123','28443',
                          '71745','46579','10618','99581','79452',
                          '67447','81367','84165','15023','63505',
                          '40992','55498','60973','56412','12475',
                          '82918','24140','28309','24905','17914',
                          '64401','14662','27983','61378','79752',
                          '54808','31473','56331','61280','60404',
                          '99273','84342','58608','12590','87285',
                          '14539','45146','12156','41102','18191',
                          '85918','82821','13913','36648','34978',
                          '36227','61069','34982','60683','56682',
                          '10355','70130','29434','31269','78019',
                          '96548','63868','67904','91110','13226',
                          '47266','33635','28867','27863','96052',
                          '13235','51915','61318','72071','53427',
                          '67260','10350','33077','33102','86509',
                          '82998','85423','49493','61559','20662',
                          '15830','66881','75065','19662','77651',
                          '86992','42345','13453','66706','20524',
                          '19622','32621','37408','79586','94765',
                          '17405','40350','22763','22411','58820',
                          '13892','84053','17327','61854','16964',
                          '37846','79041','59749','18709','67661',
                          '72068','25704','63348','81620','14901',
                          '86047','59599','17071','53359','16811',
                          '89683','70826','52989','26004','36526',
                          '82169','47938','52260','32385','13369',
                          '23488','15809','60319','34004','82841',
                          '24038','16798','55190','85315','94656',
                          '13286','91440','69885','81180','28242',
                          '55862','24830','64973','18346','33836',
                          '86479','11372','41622','46336','89303',
                          '56637','16188','14156','19670','10413',
                          '98173','41931','10499','55531','69949',
                          '76400','25856','36525','13368','42349',
                          '70005','57073','71725','26015','56371',
                          '17675','22355','65561','42132','44391',
                          '53066','98976','77728','30158','60006',
                          '65797','14018','24341','87571','99408',
                          '88186','10747','15861','73456','42876',
                          '88627','78092','45651','58223','57785',
                          '79044','63363','39848','32737','61278',
                          '23864','69257','32905','65434','24101',
                          '41849','20374','74403','58122','79267',
                          '75390','66977','22171','87926','10529',
                          '95330','67508','59691','12780','12233',
                          '91663','47260','65551','88704','22771',
                          '25103','72405','95878','60774','18387',
                          '25224','62132','21611','81817')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
