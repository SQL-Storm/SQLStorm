
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '72760','86045','35372','49321','12168','72117',
                          '87020','37167','87223','80234','46852',
                          '99678','10158','56566','69854','28975',
                          '72134','80453','12105','77206','99466',
                          '18056','99083','11480','63832','30295',
                          '38436','13113','38210','51852','32840',
                          '58892','28456','59772','76890','32250',
                          '98440','35012','35381','75760','22964',
                          '55671','94290','31468','18729','25670',
                          '88688','14014','11775','21059','81465',
                          '22849','66152','59276','34612','30794',
                          '96271','77866','64487','64045','91321',
                          '16539','83492','18494','25192','13881',
                          '34154','79239','86028','54294','13827',
                          '15068','13124','98713','12579','47793',
                          '63096','97070','45597','37298','23823',
                          '21322','67219','25909','60381','59698',
                          '29236','92309','24292','13076','63115',
                          '59736','77946','17414','28382','36721',
                          '64065','15886','52572','66991','11766',
                          '14017','96588','79904','70522','70112',
                          '43798','45656','52898','35263','21580',
                          '77440','21034','33478','36585','43258',
                          '39959','41881','83443','27664','47157',
                          '19338','40885','38750','43109','43946',
                          '21469','37713','58765','59733','41683',
                          '66080','49743','27020','74128','31797',
                          '80239','73836','96961','34524','23658',
                          '16057','37653','15047','26199','34676',
                          '26727','95325','35795','11032','77580',
                          '48252','92040','33009','48575','32431',
                          '82512','78975','54484','49896','17161',
                          '27509','30975','73743','12739','93358',
                          '50042','54670','77376','28526','27881',
                          '36959','98260','72081','19595','17241',
                          '58949','33217','68246','70608','66235',
                          '77635','93212','19561','91887','70404',
                          '82625','29485','73599','90214','15362',
                          '42809','81869','82934','12022','71801',
                          '85770','68710','11803','16680','10557',
                          '43844','77242','96636','13572','16217',
                          '17382','92144','28066','36308','80111',
                          '64884','70970','90660','84705','34219',
                          '99452','23837','25780','95127','11847',
                          '35849','29368','35727','54858','69867',
                          '98376','38280','79929','85696','10280',
                          '27976','95866','16043','57375','12961',
                          '71325','31987','45333','26042','30840',
                          '37303','12031','10591','85824','10437',
                          '33088','19619','67522','39896','27751',
                          '85823','29763','16436','16447','20957',
                          '59741','62344','75084','75021','85646',
                          '25601','49310','94056','79082','41536',
                          '33996','78356','70070','83699','25741',
                          '59700','75837','19799','51793','20091',
                          '10393','37583','31764','51206','58377',
                          '18761','34107','56711','69972','16092',
                          '37925','44498','86177','43032','16610',
                          '78527','76694','23230','23873','48355',
                          '45640','99343','10096','74806','10998',
                          '95001','91169','38572','79614','17803',
                          '97706','76719','64475','78904','78087',
                          '44451','12734','48351','65252','15383',
                          '54689','33596','94270','99264','65463',
                          '49524','88920','52611','71239','70171',
                          '99708','41079','42543','35391','31953',
                          '33889','18827','43392','75568','15100',
                          '41305','77441','14040','53836','51335',
                          '61230','30279','33104','53590','87437',
                          '20650','28125','90383','29296','86705',
                          '52447','71140','84912','41158','95868',
                          '46301','68304','45345','26556','93683',
                          '63511','39017','73206','28967','21722',
                          '71761','46687','83339','92291','14058',
                          '57947','22421','15717','76863','66508',
                          '32354','16946','85098','38659','57035',
                          '56763','52699','41861','75420','28493',
                          '77336','20391','38904','84039','71777',
                          '24421','58901','40589','37152','87861',
                          '50413','54014','29118','83119')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
