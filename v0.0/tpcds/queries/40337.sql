
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '27328','97816','17087','41457','79486','14473',
                          '65569','73199','14230','96433','30940',
                          '28762','45910','16254','22629','71666',
                          '15183','72215','19732','95230','40436',
                          '68252','78683','14863','22596','59816',
                          '69120','42654','60362','35120','13988',
                          '24139','99596','42983','21977','71399',
                          '50805','80800','41980','74128','33678',
                          '97115','41466','77710','50228','71962',
                          '58413','10031','57458','11202','15228',
                          '76622','33787','80080','57940','56373',
                          '97445','27838','57879','35836','86095',
                          '58714','41382','80601','55452','36911',
                          '38772','56728','62355','16928','29749',
                          '58570','75482','39814','79542','58854',
                          '13327','56509','90780','11853','59627',
                          '91899','69233','17212','26346','68834',
                          '36808','89881','33504','32952','49498',
                          '10184','89567','87425','68109','28480',
                          '55118','35805','74708','30139','60822',
                          '91501','97628','70224','43804','77631',
                          '71807','76162','59145','32396','10377',
                          '34136','92985','37535','71658','30081',
                          '14622','82284','69128','99648','26390',
                          '82448','44834','10479','29695','51434',
                          '48460','43612','49185','79817','39818',
                          '17754','18182','46507','21726','49913',
                          '11315','15627','57214','40750','30377',
                          '71981','93766','36464','16522','44898',
                          '61288','43465','35585','48785','39141',
                          '86152','40814','51342','21505','17142',
                          '32288','16122','20090','35893','99762',
                          '20684','19299','34865','68189','52930',
                          '42905','20953','36630','31550','41240',
                          '46067','10356','89297','96062','37445',
                          '16009','55187','28641','37442','13613',
                          '55773','82250','83151','41721','97329',
                          '25012','39095','62495','19760','67488',
                          '52059','43430','76917','20612','12155',
                          '99361','19926','59127','64329','42865',
                          '62593','29323','41745','85126','57585',
                          '24270','50635','16882','34150','36883',
                          '86388','25079','23169','14414','40490',
                          '61223','20038','15834','23903','88992',
                          '29291','11730','66836','24943','33105',
                          '52348','83614','69183','34072','32657',
                          '50336','30712','48698','83844','88884',
                          '40556','36982','69915','33779','38553',
                          '19722','50563','19729','46689','92180',
                          '85553','46795','10071','86460','38606',
                          '90331','95417','97853','18892','29570',
                          '35647','45324','87196','32774','60694',
                          '72754','80669','22497','97729','34640',
                          '15681','53215','21290','27756','97582',
                          '28947','28168','27525','88404','98292',
                          '20024','29324','16258','21786','27624',
                          '54527','23182','76241','28389','21356',
                          '90374','14761','17139','66471','88855',
                          '87312','53651','32746','68964','10444',
                          '70440','95730','23129','58738','36796',
                          '67613','36326','79390','98025','81245',
                          '72879','48218','71087','84194','23918',
                          '93567','90656','26689','22624','35362',
                          '43160','28276','50342','56802','41329',
                          '74923','35326','25877','13362','53960',
                          '28956','32207','17771','35554','14988',
                          '61178','67330','93240','68316','25628',
                          '15974','54167','63273','36912','92181',
                          '29977','79342','83428','23326','72524',
                          '62111','35252','88151','81651','17077',
                          '66830','64475','82727','26475','73255',
                          '57187','87675','61461','15960','93589',
                          '82719','27937','66946','21949','10613',
                          '95206','51038','14074','90282','36934',
                          '36067','12396','40833','61608','15721',
                          '53155','77694','22654','57842','53190',
                          '69074','58934','57457','62100','28412',
                          '25721','55503','37133','58495','35828',
                          '41847','17960','72722','53117','32247',
                          '43329','61318','16150','21784')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
