
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '19343','23776','59319','27444','72427','44413',
                          '42152','77439','45210','12775','78519',
                          '10255','21117','87442','17356','24839',
                          '17685','18724','93455','75005','21392',
                          '68762','22029','77106','24352','26115',
                          '63792','25955','65785','10394','13234',
                          '78170','17995','15716','66122','17477',
                          '12808','68068','92428','22965','12307',
                          '38078','77099','64734','56444','64739',
                          '21544','57903','97346','38124','89193',
                          '14586','70805','34552','87922','14379',
                          '58820','37382','99282','79133','33117',
                          '17368','96924','52922','14005','25090',
                          '26010','28964','61666','16127','30063',
                          '27960','14422','37749','99359','97510',
                          '94026','45181','94771','12964','12406',
                          '33751','15602','27716','65208','80726',
                          '21215','69505','20187','84624','57018',
                          '41357','49798','21764','56413','78670',
                          '26141','67178','64809','15168','16763',
                          '37042','66271','67438','78878','72362',
                          '47262','44581','52182','15573','35938',
                          '29265','40684','16728','63243','84205',
                          '53164','62268','11988','58193','83211',
                          '87646','31479','69574','15821','85425',
                          '36245','22188','39177','80099','71098',
                          '19125','37123','29733','38699','54646',
                          '56342','17491','84268','35570','23704',
                          '30464','45840','47743','47034','43905',
                          '85157','98083','11224','21679','46970',
                          '39354','18413','38090','61726','13258',
                          '48959','12975','36656','88215','67950',
                          '18510','61934','57143','28802','81566',
                          '31351','54411','31973','83942','34766',
                          '65070','66540','45671','41512','69695',
                          '85577','20427','63958','38411','50233',
                          '46069','81415','19221','81966','25182',
                          '44668','33482','34786','78926','80231',
                          '33725','17416','27284','51157','88122',
                          '75123','93531','65221','87121','15765',
                          '38926','22573','30300','17664','47326',
                          '21377','26513','11494','85045','17195',
                          '76852','39689','31068','42215','51116',
                          '67251','57233','45590','21767','23159',
                          '19394','26069','32684','17022','20649',
                          '76868','20652','25150','31396','43674',
                          '75904','81959','16380','79381','65803',
                          '46067','77174','91396','65933','11318',
                          '10073','84415','84089','18706','36997',
                          '83842','85646','27802','32748','83318',
                          '40663','46438','16765','13290','20325',
                          '88930','48669','11555','79117','14762',
                          '69782','28551','40640','38014','61731',
                          '36399','40634','11379','65578','41073',
                          '18502','13521','66822','85359','67775',
                          '55604','33075','74631','73413','54600',
                          '34732','83801','82624','69081','59286',
                          '43974','95750','35604','41571','78298',
                          '81719','40498','38260','97136','11850',
                          '94849','39661','61641','58449','37631',
                          '31569','75527','61438','69305','64553',
                          '86814','65256','54063','67988','24357',
                          '47436','87839','43587','46461','84262',
                          '90337','92010','94985','14932','18931',
                          '20667','34740','82584','52144','39270',
                          '29657','67648','57739','80704','12825',
                          '48706','75132','68498','52200','19624',
                          '58093','85434','15983','17886','90609',
                          '60982','46732','31841','18897','73070',
                          '16484','95230','22164','97796','10080',
                          '40900','61121','38877','54088','52211',
                          '41694','14488','84579','87229','43615',
                          '64544','67137','74582','56887','82705',
                          '53086','95625','41607','58580','83294',
                          '43146','33779','24428','49600','55943',
                          '95946','72873','21873','12257','49715',
                          '78065','49073','33862','76551','54048',
                          '17438','22034','50735','10311','53460',
                          '59308','53788','50406','79985','79103',
                          '50798','46208','67757','30295')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
