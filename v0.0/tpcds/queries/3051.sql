
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '84627','93639','99579','26562','23060','37429',
                          '58670','49422','63732','79671','63918',
                          '20070','37784','31599','90001','27100',
                          '17335','65720','67030','86001','76163',
                          '58923','46109','84383','43666','81813',
                          '31056','21258','39166','92543','40972',
                          '20057','60021','90567','84933','36719',
                          '74431','98635','82097','25827','57915',
                          '36765','63875','20883','33154','30582',
                          '16059','56971','62305','41195','40156',
                          '79239','97559','20923','49808','14758',
                          '36028','53824','17344','28849','97331',
                          '19769','53571','41638','82782','85656',
                          '76196','50589','54072','46623','63832',
                          '84581','99434','50881','28407','18210',
                          '45814','52955','68985','73347','53463',
                          '83511','41723','35094','19009','26237',
                          '25178','19315','24827','24891','49337',
                          '96875','62857','36952','25716','65166',
                          '72713','46418','24682','10111','84529',
                          '69228','72801','28401','83779','14658',
                          '38131','42535','87135','54610','91366',
                          '20073','47355','89768','41056','15974',
                          '16912','67950','35508','74583','24168',
                          '15474','63632','10453','47519','61532',
                          '36353','83646','14414','90191','54585',
                          '82564','41826','85196','74660','41272',
                          '44378','67979','87817','79183','73784',
                          '96697','53610','59594','33231','14046',
                          '45570','86701','99636','42282','40132',
                          '63195','10242','70936','45735','97191',
                          '59421','52435','88110','75147','25725',
                          '22245','92049','46974','33281','56925',
                          '61144','21219','86740','10009','47935',
                          '39793','18753','25395','81775','83572',
                          '97806','15936','25639','33843','71781',
                          '29697','46880','84787','39689','53582',
                          '73745','22021','35497','28437','41152',
                          '37286','32985','89569','56314','95033',
                          '41956','36010','85658','66817','94437',
                          '41117','15629','87298','46533','70274',
                          '12763','16687','37116','69560','35374',
                          '35500','40547','98675','17874','73114',
                          '14321','20230','38033','75551','46289',
                          '34073','73223','29964','85509','94585',
                          '71238','60143','63812','88819','60462',
                          '18571','86137','57998','46053','67733',
                          '48503','71330','72573','54044','19716',
                          '51028','64134','89976','24673','29774',
                          '37924','12140','11463','80160','52811',
                          '53456','87831','93932','58065','36289',
                          '84420','13724','49775','26831','41251',
                          '22969','10665','56748','52716','24072',
                          '42922','87640','62516','95576','93162',
                          '30934','98721','58060','98311','20453',
                          '58904','19063','70838','42173','12693',
                          '61282','18928','75634','31700','29264',
                          '43886','96665','72315','73461','99202',
                          '48277','76786','68331','43131','59805',
                          '37174','27994','71998','42223','43223',
                          '92763','83365','86386','85964','32572',
                          '49554','69092','62915','57748','31352',
                          '43059','89335','88215','18762','53263',
                          '14707','64881','30157','13686','53945',
                          '11902','24754','43329','52763','39311',
                          '43526','59116','37816','49526','30633',
                          '55703','91033','40945','49003','92177',
                          '63761','63351','96852','31908','25675',
                          '60187','77211','71930','80329','29558',
                          '64537','83702','33961','65217','48697',
                          '78194','93931','12776','96886','64905',
                          '27558','18531','88306','58231','17999',
                          '34037','69996','91704','32559','62286',
                          '17976','41208','27395','22577','49169',
                          '39499','58272','28432','46321','12611',
                          '22782','78428','16115','92094','27599',
                          '99364','70757','48804','36972','51431',
                          '54578','48419','41607','27315','90356',
                          '30355','63809','55801','58803','97833',
                          '16036','89281','15119','40548')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
