
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15491','25939','86934','83534','37413','80350',
                          '91786','90878','66280','58392','15436',
                          '69897','85356','59164','25178','69973',
                          '62839','68005','37750','98812','24441',
                          '60970','63554','76217','43999','84151',
                          '23321','86676','19807','72199','32756',
                          '72068','37180','33347','88981','94647',
                          '41148','11566','83682','24375','71143',
                          '61521','30670','36454','51565','76641',
                          '13091','69595','51305','12381','13208',
                          '26946','52456','58964','62698','85346',
                          '65713','74202','70775','24524','83692',
                          '45491','24585','38673','68253','94337',
                          '46703','49011','29610','65436','56846',
                          '71122','39223','94626','13434','98682',
                          '13644','35388','36594','63763','15881',
                          '20805','90207','96000','36140','82158',
                          '41136','27662','14214','80343','96089',
                          '33149','35039','46942','71082','70024',
                          '53839','44786','27524','62962','86221',
                          '60317','10323','47371','33205','87095',
                          '97154','24655','14158','19769','56914',
                          '31620','95076','63038','13677','89344',
                          '93305','74787','68347','90674','83659',
                          '79639','56666','12132','34000','56847',
                          '18987','50722','41702','77086','11729',
                          '57077','44086','62385','11113','75609',
                          '41185','57806','77013','12772','64638',
                          '78740','52927','17332','30644','14079',
                          '51776','23342','27138','58813','50169',
                          '11549','30939','31569','42050','45754',
                          '12191','81137','47829','36174','60594',
                          '22544','20798','20285','86104','68993',
                          '76112','94249','95964','63457','17678',
                          '60473','12659','73498','26098','87322',
                          '26309','55625','34669','84110','79011',
                          '27720','95369','17616','26097','45519',
                          '30318','42342','37622','71086','41041',
                          '98049','86410','22599','20830','62004',
                          '78015','72616','84766','97797','23544',
                          '66434','52038','65255','28246','56472',
                          '80128','31043','22307','51764','82949',
                          '41345','11839','23423','68264','12956',
                          '84545','12606','89169','79482','73789',
                          '25499','29043','29022','34550','54198',
                          '53575','35954','20904','34964','54523',
                          '18628','87336','13507','16485','43455',
                          '10790','31337','16231','80570','63244',
                          '65388','39940','67109','52241','15704',
                          '36799','30417','70389','54447','44392',
                          '17160','23767','81015','46546','18522',
                          '69758','74637','23754','93834','82531',
                          '66110','32670','96159','98406','84857',
                          '14173','11134','81454','21848','20602',
                          '44876','97118','43582','28715','85475',
                          '30905','41466','30207','40065','57317',
                          '29902','49921','38042','16866','42847',
                          '69374','68810','66142','95826','25459',
                          '20807','28253','68054','19989','25845',
                          '13138','20180','10336','44055','11090',
                          '18942','24520','54285','55933','32334',
                          '64369','40077','87004','50516','54694',
                          '85774','58867','13035','53850','15745',
                          '91086','16897','41694','86442','22672',
                          '40558','53491','43614','42310','95921',
                          '49651','19936','53383','66259','28373',
                          '21285','44940','50771','43938','88086',
                          '47733','12304','22301','16015','79499',
                          '84837','34904','35401','49085','54855',
                          '41769','72350','50799','32377','49415',
                          '42315','25998','90381','49363','78145',
                          '64123','11174','27308','48927','16500',
                          '32957','21462','35728','64009','52630',
                          '64551','24584','93708','87513','22748',
                          '75947','86784','15561','28193','49565',
                          '56708','75987','60190','21067','77145',
                          '35700','84578','42134','81101','68108',
                          '27532','42830','22073','80079','15991',
                          '72181','11934','57617','58768','66728',
                          '66751','15278','50399','45837')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
