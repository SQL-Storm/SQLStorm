
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '91459','78824','42114','89008','62003','26286',
                          '33687','47294','16118','69635','57642',
                          '84572','66481','64530','14021','78120',
                          '60413','44009','84963','71505','38481',
                          '37944','21581','45233','42531','47325',
                          '69396','20712','68865','55555','93798',
                          '13228','36972','55407','98047','79983',
                          '17155','74665','86583','50189','48185',
                          '95725','34661','21063','69143','73943',
                          '52101','42516','93030','83544','66238',
                          '98799','43165','83152','66969','84105',
                          '26463','40864','13979','88747','84275',
                          '77042','45078','15967','29212','63322',
                          '55166','98012','91489','47368','70810',
                          '61732','54257','32316','33935','92472',
                          '14409','51523','32422','75352','20550',
                          '29435','26129','15137','37289','19308',
                          '96632','81760','24768','34655','14559',
                          '48418','98610','19240','68885','64586',
                          '87775','20876','72560','97502','24801',
                          '40404','61233','71787','47148','27423',
                          '75561','55447','14644','11357','12661',
                          '57513','86828','38763','18340','90812',
                          '44108','85539','38820','26008','84940',
                          '52480','42259','74915','34422','11664',
                          '34237','16355','45565','79976','31199',
                          '61752','27838','52782','59403','23783',
                          '47401','30138','96907','82177','16428',
                          '32902','87099','33596','23648','22957',
                          '52235','93199','35688','49077','32731',
                          '50605','21123','59313','76122','87193',
                          '73994','36888','26485','59581','16088',
                          '15224','55678','94112','90752','41038',
                          '91672','72379','80430','93121','31756',
                          '31375','78406','71431','43499','12676',
                          '74356','42383','12602','85922','54769',
                          '58300','37877','63929','75004','54066',
                          '15595','40532','98819','11238','34374',
                          '40730','71809','36254','31119','13674',
                          '29129','49452','48154','48798','76019',
                          '11387','11696','10459','36173','72946',
                          '19394','70627','46898','62357','90973',
                          '40315','96005','22374','30419','28848',
                          '16406','17898','83780','49440','44670',
                          '75869','33449','94759','90040','16279',
                          '71781','73888','41629','66986','11780',
                          '29332','76966','70400','74046','15115',
                          '74023','25913','43727','96183','16956',
                          '63171','52793','49537','93328','72612',
                          '92401','13289','24756','28523','69866',
                          '78900','72447','34323','13905','73696',
                          '44597','32830','11112','98832','73238',
                          '98841','15686','42000','46398','78885',
                          '15997','41592','84822','14136','68045',
                          '31643','74353','84236','51518','23879',
                          '79881','85888','78641','90699','89982',
                          '15482','32361','39157','15995','81516',
                          '43719','15803','44563','58873','59114',
                          '55979','68390','75312','88545','35863',
                          '52142','10241','54970','38993','37807',
                          '42557','44337','30224','99981','28713',
                          '67880','92031','20091','80326','45634',
                          '37189','43807','78604','37731','32352',
                          '16944','12056','67203','46943','83882',
                          '80615','58298','44251','81008','85122',
                          '70752','63444','80923','14422','74800',
                          '13001','27087','13934','75419','73290',
                          '37758','28932','38028','56543','99447',
                          '65850','12356','80667','42919','21321',
                          '55097','17442','18970','11093','34126',
                          '11944','63293','16499','83135','91749',
                          '25289','72039','85947','74322','20807',
                          '28424','26070','16032','28666','54350',
                          '44319','60561','77651','92385','48724',
                          '68117','37849','70456','23545','17572',
                          '60590','46867','32455','37423','82881',
                          '57811','65652','80679','14939','73393',
                          '22871','10484','78323','13509','49052',
                          '10722','14930','57309','42961','78379',
                          '58938','54448','12238','50850')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
