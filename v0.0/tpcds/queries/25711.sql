
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '90091','53829','12021','24321','46729','19762',
                          '76457','63138','76230','14365','95074',
                          '21781','11451','69114','22668','88095',
                          '88059','78931','99035','53386','30867',
                          '36764','83607','90304','38179','11389',
                          '75086','75210','54296','63555','56127',
                          '37050','58011','98842','52367','82163',
                          '83063','27515','47154','13753','88328',
                          '49125','17058','27273','18924','25020',
                          '81661','15837','91868','41278','28475',
                          '30076','34122','21606','55240','39253',
                          '31536','25556','88862','31389','36640',
                          '86675','99680','17887','77726','69115',
                          '90741','26705','89231','33627','31887',
                          '43447','43394','22969','12128','73462',
                          '38841','80966','76884','46004','43689',
                          '43258','53585','87054','86083','74360',
                          '49723','92385','37985','57187','52272',
                          '15026','41322','13380','42136','93749',
                          '10717','79426','46104','62278','41656',
                          '27442','79382','28158','25707','25138',
                          '28139','19830','60353','18496','70826',
                          '31039','46596','62883','52087','29577',
                          '26289','40439','18937','34435','23801',
                          '26281','68628','50086','34201','31435',
                          '39854','23126','62824','18251','94611',
                          '51337','45106','80235','12658','24603',
                          '54348','92210','27529','50885','72319',
                          '38621','64104','92532','57467','67181',
                          '81487','51232','46548','20005','95873',
                          '54461','55374','32420','39296','91408',
                          '67897','38029','17466','85511','90747',
                          '89668','79282','58345','34364','88562',
                          '34515','27154','19104','19747','63204',
                          '49955','31937','49456','35807','56267',
                          '72256','35487','28747','62567','37743',
                          '26699','80883','21690','30107','24670',
                          '59350','61366','25764','39804','22866',
                          '47273','72986','52812','21534','25775',
                          '65665','37770','23389','16259','28040',
                          '32305','50137','65654','52052','66822',
                          '42141','13124','58887','54025','88384',
                          '20321','37885','84167','88418','51421',
                          '23708','48675','64378','20704','61460',
                          '42900','22263','99132','58708','29627',
                          '86333','12874','85504','83759','60265',
                          '68896','91409','19138','86137','15689',
                          '23995','72473','38023','12438','25800',
                          '38199','81345','34874','13658','58505',
                          '10892','13610','26366','49324','25864',
                          '25463','90702','57844','18583','29152',
                          '76616','30212','86909','99118','30065',
                          '15844','19511','37756','17948','40710',
                          '48578','42297','71112','17597','24834',
                          '27737','40027','90110','39954','18192',
                          '21911','79251','49225','71817','58877',
                          '97908','35793','27531','22451','11596',
                          '35082','41026','21402','62408','12096',
                          '18632','63670','92003','19800','63520',
                          '34347','10015','98380','72753','79693',
                          '30861','59230','28896','48999','37204',
                          '11727','60185','67372','49971','38783',
                          '77602','47118','98156','37121','57459',
                          '19522','65581','32563','45033','11613',
                          '81351','72811','27256','16712','89940',
                          '22565','88940','31606','13211','82396',
                          '48275','87230','21520','16849','21352',
                          '47177','13452','77642','36745','63141',
                          '35439','71140','41141','73632','16353',
                          '44057','22885','30193','49446','17785',
                          '61732','28819','54501','84631','14924',
                          '23915','48274','44240','17320','97057',
                          '28222','54166','36046','70346','70533',
                          '25601','72419','10828','19416','36276',
                          '46821','31283','30259','21802','81839',
                          '29884','24697','55796','32657','20022',
                          '32820','54940','38260','92444','68493',
                          '87829','55667','37824','23392','34097',
                          '54066','69188','10177','52197','23360',
                          '20269','66749','20872','75948')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
