
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '17301','43288','97654','18200','68418','41438',
                          '43485','83847','82513','25253','60292',
                          '63705','46189','78423','33982','45141',
                          '67202','80914','27289','84162','68810',
                          '13441','99894','82898','29017','99065',
                          '72123','28030','23240','15059','31215',
                          '30664','35975','53433','55988','20098',
                          '71802','37278','77945','57881','22874',
                          '21384','45802','24415','70108','32435',
                          '23572','34788','67624','91533','35440',
                          '35986','92236','93008','15754','56132',
                          '70160','24352','98872','82180','42224',
                          '17237','77009','48124','17720','65753',
                          '19024','46038','50347','50080','20678',
                          '73373','43990','79238','81208','85246',
                          '80402','79859','81211','32626','26709',
                          '40615','71786','91469','72290','13741',
                          '53641','13400','67741','81473','49176',
                          '83625','13306','60009','70950','53084',
                          '17611','74243','62095','56592','18386',
                          '43935','65717','52603','69784','40869',
                          '34174','57361','32681','34742','50868',
                          '33614','33620','88429','66299','52453',
                          '18147','45236','14193','34759','27278',
                          '21191','14148','98887','51773','42298',
                          '94414','19430','59706','24530','28758',
                          '41130','35658','69538','60449','90491',
                          '24450','64324','51460','79350','51913',
                          '15282','76948','48864','96871','16878',
                          '47321','68678','74287','18807','55862',
                          '70283','61008','11893','50747','98726',
                          '79482','57572','86297','37745','88834',
                          '30890','13622','46851','80774','54743',
                          '44485','66207','39880','37690','46280',
                          '11282','27205','76188','14432','63341',
                          '11978','44275','13620','75684','66345',
                          '96748','24808','23766','42821','61985',
                          '23241','27488','69132','95055','53349',
                          '65812','98125','50609','27454','46379',
                          '47806','74591','60387','53201','26700',
                          '23853','90292','35679','77439','60372',
                          '25641','42512','11236','19325','11694',
                          '12172','44803','52261','22100','19035',
                          '94477','99692','23576','40710','88299',
                          '28689','68081','68591','64919','76086',
                          '27017','31565','17359','65695','47225',
                          '11563','11591','24373','30805','44277',
                          '23769','17155','23073','46080','23632',
                          '21340','26383','94299','89315','34217',
                          '72656','41396','82659','51775','36890',
                          '79007','55394','77681','94962','98748',
                          '77754','47481','91962','19749','16646',
                          '75602','82408','69612','22802','95154',
                          '39072','20472','30875','91488','18971',
                          '14358','62553','16256','96858','37756',
                          '56069','61045','63920','35074','26752',
                          '44809','26118','38555','53599','13632',
                          '15880','16590','18022','31821','32429',
                          '64892','12647','76764','34890','39590',
                          '63363','88311','17297','61559','38215',
                          '18199','60671','31199','23446','45756',
                          '26034','42642','27734','23024','80944',
                          '40927','76431','43964','27472','90332',
                          '73567','11898','31707','48435','46670',
                          '26749','86309','19856','33350','56702',
                          '83891','18087','19144','57425','79215',
                          '20586','25174','55193','75317','16580',
                          '40009','38564','43329','46650','53348',
                          '97760','46807','54702','48349','68785',
                          '24549','70766','61948','39541','14612',
                          '46956','53723','15497','41612','61835',
                          '20972','11641','39774','40259','73684',
                          '32021','33009','24278','41158','99762',
                          '75635','75780','17424','60527','56187',
                          '59294','65473','59258','50201','29047',
                          '70530','98588','89500','80102','42256',
                          '57863','64200','69305','72691','30034',
                          '76577','58081','23243','54585','34261',
                          '81087','75991','83997','26240','47319',
                          '21112','20616','46346','73480')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
