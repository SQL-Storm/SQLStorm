
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '60795','39120','70704','76427','32138','19328',
                          '43460','77086','18568','23970','47104',
                          '26475','46829','61628','16107','79874',
                          '11931','19249','21774','99801','71548',
                          '83099','14503','78036','19881','49250',
                          '44709','40502','85683','97314','53624',
                          '38078','52766','20451','99355','67027',
                          '31874','86213','67256','59501','35486',
                          '35336','41813','92230','28403','60474',
                          '28147','34494','63808','57307','59592',
                          '48923','54461','13621','17010','20884',
                          '91658','14114','44641','25674','16689',
                          '13653','52600','89480','34959','77685',
                          '29494','65256','87993','67331','52397',
                          '14857','22711','49478','36470','89919',
                          '35524','94639','26832','32145','28526',
                          '61309','90041','87117','35700','32278',
                          '54470','40675','16911','95581','32929',
                          '94448','16668','33849','42811','45644',
                          '63876','12121','63787','16506','57297',
                          '43902','31437','14089','80183','48406',
                          '97223','56662','65414','42329','22412',
                          '77708','26423','96902','88823','62810',
                          '74003','36013','86805','70107','78567',
                          '76143','27453','88845','62692','58356',
                          '89627','55394','37256','33248','41200',
                          '59513','76787','10011','34385','63361',
                          '67631','95643','92109','48601','97868',
                          '74219','33861','44812','93416','14388',
                          '46544','30645','49254','42619','13963',
                          '23013','55434','22571','58401','45904',
                          '30769','83301','85178','23474','16850',
                          '79411','87990','92169','22586','96402',
                          '74350','94003','52303','24654','63559',
                          '92095','83108','20383','77889','25695',
                          '32195','58703','43910','22572','68980',
                          '58794','59435','81330','31866','10808',
                          '48418','34627','75193','41587','24977',
                          '17590','18937','75495','59565','62443',
                          '46749','98448','25400','70693','30734',
                          '21942','23749','21061','98725','42046',
                          '16236','22972','33846','10500','57395',
                          '35941','10147','58920','99330','26506',
                          '78617','29959','20465','82129','63141',
                          '22776','90919','10520','37663','33920',
                          '42001','69847','80249','68735','16772',
                          '27495','28487','69323','65451','35111',
                          '56672','46700','15427','57357','81395',
                          '49889','47672','86521','89619','78800',
                          '77748','26570','18699','32263','45035',
                          '54259','48180','45182','50306','70691',
                          '39389','24599','41166','14706','68626',
                          '12849','14275','21027','87095','23401',
                          '27995','21981','31189','58420','62650',
                          '92164','43394','68211','41066','67820',
                          '69022','18706','21653','44831','13778',
                          '90162','31096','93418','28858','76635',
                          '11537','16550','21471','15367','61517',
                          '82894','73734','97068','51015','27814',
                          '77811','42538','59680','86619','31415',
                          '28748','28096','61736','13103','90103',
                          '41514','27745','93437','45841','12890',
                          '42298','32441','19516','14147','53940',
                          '45157','34303','96940','17968','79494',
                          '65837','66444','74053','30075','12743',
                          '64936','59027','58329','63706','37211',
                          '37982','26572','36365','52155','38906',
                          '52493','34780','16001','13386','19342',
                          '14104','86066','62040','27860','31335',
                          '74439','45515','83982','55108','65425',
                          '25693','50102','11508','74775','76002',
                          '65208','54810','14923','70053','83241',
                          '85956','74522','65860','84631','65795',
                          '21930','49453','21794','35934','52146',
                          '65029','33197','37293','72289','62966',
                          '85954','82862','14991','23764','17940',
                          '86822','54269','70818','28353','54050',
                          '54504','12944','84322','48558','42208',
                          '15371','26657','57980','46656','40697',
                          '87909','58225','90009','34726')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
