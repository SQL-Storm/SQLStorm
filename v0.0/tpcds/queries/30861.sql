
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '38215','25324','21537','43965','52830','64422',
                          '71586','77860','41803','48266','99171',
                          '86128','12080','22527','44472','43246',
                          '18753','93620','93158','62707','51758',
                          '45341','23787','39447','90074','46396',
                          '41293','32815','72903','16454','15394',
                          '99819','91966','56439','11349','38946',
                          '20387','12494','30060','63594','57773',
                          '59491','36490','64632','71049','20509',
                          '24167','95775','37512','92274','77905',
                          '63775','42758','63338','54182','38953',
                          '44742','18790','89784','39339','93457',
                          '55797','15283','37453','17535','96774',
                          '98026','68587','62039','16793','41438',
                          '80260','55155','89073','36059','98601',
                          '22383','30378','59272','94265','47777',
                          '95959','42934','36416','27221','14212',
                          '38555','96210','46123','64083','23471',
                          '24783','48769','90242','12563','71668',
                          '12105','38854','91151','20392','18533',
                          '27978','78957','64678','55618','14863',
                          '30635','26165','32410','43493','71919',
                          '61044','92082','34217','60318','50841',
                          '88629','91277','14130','59547','26433',
                          '22733','39739','22346','83283','10188',
                          '12099','74083','30399','13287','83043',
                          '64175','36127','17061','37374','50559',
                          '49194','72599','13601','43603','29512',
                          '32239','19654','87696','12784','40200',
                          '53258','30251','18845','80684','14118',
                          '51982','63178','98410','45155','55230',
                          '75783','14104','44852','91663','58161',
                          '18812','90597','14010','19008','43981',
                          '84137','82614','18176','76896','42927',
                          '75940','90101','69817','30768','70182',
                          '24261','62202','40295','22892','34236',
                          '18247','22688','38216','55940','27576',
                          '65408','93614','21336','93522','64217',
                          '34628','43650','10580','65172','25101',
                          '13214','32009','42618','76279','26406',
                          '28858','40124','25431','33633','20649',
                          '17239','42892','66123','42874','78500',
                          '84991','30075','22773','98673','46889',
                          '79195','48208','11587','81927','38293',
                          '42974','19880','29631','60068','49846',
                          '25339','28732','85523','31632','72859',
                          '34814','73302','13818','21711','32331',
                          '50735','31155','47115','57995','18047',
                          '13605','10371','92578','58315','27731',
                          '64596','80599','24105','36034','21132',
                          '35651','68301','19986','86407','93420',
                          '95138','37663','58671','14577','29785',
                          '11384','42213','54909','82315','16994',
                          '70342','25554','33269','49980','19355',
                          '98904','93554','83155','33011','98616',
                          '58219','20155','20383','36678','26595',
                          '98760','21331','39562','24129','63271',
                          '97910','55182','93141','13220','21219',
                          '70205','66910','22401','78301','64394',
                          '23903','60921','46614','38514','21299',
                          '53727','16497','14675','73528','11727',
                          '53375','13441','82658','46335','35420',
                          '60756','67175','20961','60545','53479',
                          '82960','94697','64859','32117','92884',
                          '31110','31373','42043','93866','72469',
                          '46552','14309','54785','20160','83567',
                          '13802','51217','36894','63122','68239',
                          '78328','47972','41611','38864','16819',
                          '39208','21527','66029','82464','63031',
                          '43613','60507','18292','36956','12588',
                          '39769','67312','22142','30568','10787',
                          '21261','13922','44307','33913','93800',
                          '13422','37128','34420','46415','11910',
                          '41991','47632','31660','62030','35471',
                          '16139','11298','88062','67682','18364',
                          '32590','77938','18593','83601','73485',
                          '28923','66585','52735','26865','48442',
                          '91326','31580','39238','54626','67988',
                          '16865','47842','38328','43735','88218',
                          '76704','25470','22151','15572')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
