
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '17188','63391','21776','50373','14230','13813',
                          '92119','37144','84973','19732','30664',
                          '74973','63887','26791','64083','52664',
                          '51483','15969','38585','41980','14961',
                          '66940','89342','57432','55548','48945',
                          '21590','12121','97459','52980','79015',
                          '32262','51622','39361','33551','29749',
                          '75403','26307','76840','90780','18663',
                          '69233','63317','29017','33504','37805',
                          '15486','68109','90176','16717','31526',
                          '97628','41571','86864','12762','68361',
                          '99131','71658','11027','19742','99937',
                          '78366','19626','48460','94176','39818',
                          '56633','16834','85723','44989','30377',
                          '58840','12914','66731','41595','83081',
                          '44778','43868','29434','22493','99762',
                          '43092','42697','90070','14997','36241',
                          '20228','33135','59591','58781','25273',
                          '51229','32813','22603','62495','88741',
                          '16568','87454','84178','47531','10765',
                          '80447','93471','29659','88747','93056',
                          '85806','97382','53666','42238','62976',
                          '11730','87035','55692','14547','85061',
                          '38827','83844','40556','93325','20191',
                          '81828','38691','78412','19848','26045',
                          '16737','22783','57397','87196','98413',
                          '67010','58425','95932','51177','63173',
                          '10658','67134','46111','75086','28847',
                          '40991','90510','81797','83455','35933',
                          '53651','25841','70243','90108','58752',
                          '19500','27990','78448','17010','49913',
                          '97664','89660','52384','17742','15000',
                          '27534','42239','36790','17798','28289',
                          '96383','57844','20139','36469','71635',
                          '79342','11380','27006','62507','32388',
                          '64475','69180','69115','46390','56807',
                          '54345','34511','46576','91968','31034',
                          '48172','38767','32578','81293','98763',
                          '58934','11118','17623','15108','19601',
                          '66186','43708','79564','85545','46278',
                          '97810','66296','63782','42487','36197',
                          '22792','44173','55265','36779','19557',
                          '21055','26107','18835','92638','89651',
                          '83917','99072','66598','31115','96518',
                          '78015','83381','18506','71786','24805',
                          '87066','88631','97594','16061','95200',
                          '66578','95823','16904','56519','27571',
                          '19329','67434','39958','21890','11365',
                          '37550','30488','12196','61819','47914',
                          '82292','28398','79759','29091','66127',
                          '57309','58608','53927','34586','65885',
                          '46018','75760','96323','49826','31408',
                          '83201','15999','66955','98865','98612',
                          '96171','30193','35975','84856','80580',
                          '64231','47863','22416','20332','50970',
                          '26345','46470','51454','59261','68306',
                          '96353','88125','56485','69082','65323',
                          '91116','95694','98892','63817','15636',
                          '40862','77858','51703','67148','52046',
                          '61554','66382','23191','23417','65222',
                          '18845','18923','72301','22292','53362',
                          '12338','70933','57166','10900','24925',
                          '52827','92152','84331','15091','64505',
                          '31168','39811','26995','44084','93984',
                          '82845','22729','37238','46558','60746',
                          '89107','12180','27142','46946','70963',
                          '77413','89877','23033','35982','78108',
                          '64635','32084','92416','20280','67917',
                          '64989','60997','43784','53946','67879',
                          '34189','19450','47965','84622','78964',
                          '80239','36837','53819','96476','13110',
                          '22575','52634','28591','85104','63761',
                          '28210','10003','76048','10210','24067',
                          '57790','77233','52816','91965','87735',
                          '85197','21940','66791','13988','30072',
                          '50663','10016','59697','32814','31846',
                          '19622','59895','98071','85481','14071',
                          '62861','11832','16862','10572','56752',
                          '68762','86394','52908','84177','77484',
                          '71665','25021','24644','27200')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
