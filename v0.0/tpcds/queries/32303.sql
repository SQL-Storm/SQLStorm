
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '21060','14257','83751','84994','39706','30795',
                          '47812','13457','42698','39580','46592',
                          '99719','46617','18001','89923','24252',
                          '18700','61170','36540','78409','51607',
                          '38608','21883','70523','67886','71318',
                          '26024','27343','42421','53070','42674',
                          '16452','83822','46806','52040','40685',
                          '85662','21100','34737','36788','10044',
                          '22268','44400','62887','71136','34744',
                          '12293','20006','79850','27956','38165',
                          '37098','55508','86826','27381','20130',
                          '88088','85079','23464','26795','43917',
                          '16057','86975','43564','33957','95666',
                          '24292','34440','54155','72641','31554',
                          '64069','20161','23532','20251','79018',
                          '26727','70954','51466','35798','57942',
                          '14873','52409','81574','12467','21538',
                          '98504','12103','20912','69021','30893',
                          '41803','22289','15126','11779','27389',
                          '38057','82504','61161','24092','37719',
                          '17346','66047','51882','29065','42833',
                          '74612','33384','97118','25883','82047',
                          '13335','84307','61860','26573','19547',
                          '27943','67993','82645','43413','34873',
                          '89461','21595','42541','97960','32018',
                          '71840','70733','63705','99831','97630',
                          '97219','23595','68138','25989','58285',
                          '48403','92405','68931','54588','90252',
                          '36195','57114','58677','43495','31487',
                          '65490','46783','83211','97501','30369',
                          '23369','68280','81810','91012','41504',
                          '40839','19808','61269','56771','65841',
                          '40962','66766','20814','36666','42951',
                          '27039','73212','55737','13129','19800',
                          '27045','94335','39679','13116','97174',
                          '15571','71816','68831','30630','13195',
                          '61282','89421','15568','18786','50012',
                          '62149','14163','71917','89413','45697',
                          '20210','47729','61493','53384','15304',
                          '21209','29343','62960','94052','19247',
                          '43790','28531','88669','97157','11400',
                          '34604','66881','70566','61771','56479',
                          '75112','41101','30476','86617','28462',
                          '62276','11224','43902','60488','22283',
                          '55476','81086','26100','84752','82067',
                          '79861','62727','51141','17410','12390',
                          '34101','44793','13701','50112','55566',
                          '26735','52707','59063','23625','63059',
                          '74127','92570','17821','40277','62748',
                          '24388','44703','22990','82381','79886',
                          '13448','76900','41844','65564','22487',
                          '10614','25858','82114','43723','72006',
                          '86828','42156','39714','55612','48805',
                          '77233','21828','91291','61756','96839',
                          '77900','13345','69871','84202','36599',
                          '46300','84857','87279','87415','25106',
                          '23182','30270','26062','32332','12524',
                          '33763','44538','45888','41976','91975',
                          '82398','25428','82415','16107','44732',
                          '50260','29494','16628','60458','81933',
                          '27339','83653','95787','41060','36345',
                          '42987','53349','78214','96161','22047',
                          '17358','16326','98515','11167','55459',
                          '84025','76633','14803','79411','38201',
                          '82204','47808','65823','42308','22728',
                          '25387','96307','85286','62061','39736',
                          '91981','43971','48829','47961','65122',
                          '18839','11156','33936','17436','62599',
                          '22583','82259','16077','29656','35771',
                          '73681','10054','13652','51838','33730',
                          '61964','72923','17151','70574','18015',
                          '89214','80112','60068','40103','86740',
                          '94218','15361','19965','34287','24038',
                          '18333','11233','65692','72498','21778',
                          '29864','27351','45024','50386','27517',
                          '98448','21935','68177','78043','46017',
                          '33590','91582','11433','75777','42943',
                          '67427','66578','54230','50430','72823',
                          '39674','48587','24198','79361','98251',
                          '63638','72733','56872','12335')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
