
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '46926','34203','27228','63278','90674','75279',
                          '70454','51214','91383','85608','46168',
                          '19754','84623','94019','76087','40871',
                          '18743','70330','67869','60080','50127',
                          '61279','51930','89456','55869','93995',
                          '99804','65124','43279','61554','14558',
                          '31362','60188','19730','58356','63504',
                          '73638','58163','37034','60438','16520',
                          '38916','61260','86896','75374','88686',
                          '58835','34475','26956','70112','29411',
                          '56081','33494','10884','16837','21930',
                          '12509','31957','11085','83208','99883',
                          '28254','42775','11198','49606','77342',
                          '86370','30433','91758','72577','70962',
                          '76477','85281','77911','23503','21603',
                          '49081','14193','25078','40506','45217',
                          '41044','83567','10395','78948','14247',
                          '18453','13876','36318','26311','98641',
                          '44496','53128','72723','23108','40580',
                          '85408','20827','77673','81596','30988',
                          '78104','20985','91044','97573','24294',
                          '92371','28518','29547','17674','45452',
                          '53677','29004','47462','16481','29769',
                          '25737','39040','48460','46333','97252',
                          '10503','24709','84524','12491','14911',
                          '55476','53581','18827','50396','39987',
                          '52626','17910','21201','28196','95533',
                          '77225','58454','45119','18272','78081',
                          '31552','32058','86575','56090','26734',
                          '41075','90641','58701','38918','60132',
                          '27247','57145','42191','19994','12106',
                          '85029','57978','56893','99683','16484',
                          '39772','57675','31293','85355','63183',
                          '20659','17405','64841','19526','31794',
                          '89446','70098','83062','24613','19013',
                          '73243','10224','27484','14884','44638',
                          '19050','70439','49779','32126','72208',
                          '65970','10401','46377','64261','97968',
                          '34071','94991','70497','21150','54989',
                          '60768','99463','55606','70091','16611',
                          '28616','38521','54151','12946','52261',
                          '14121','15479','37563','61151','90008',
                          '67191','31138','24815','72052','53238',
                          '35917','84822','60164','15684','13282',
                          '69856','85106','17363','18782','21947',
                          '80739','18736','10816','24118','18992',
                          '44922','18669','14528','44692','68965',
                          '75989','82030','29376','35163','59692',
                          '21617','65465','90381','12056','77570',
                          '61817','61805','35236','99866','30493',
                          '78783','91498','38740','28871','90645',
                          '74678','71026','60823','19752','58553',
                          '23554','16774','13170','32910','18023',
                          '21611','47365','83555','33907','42456',
                          '49093','27564','61889','24268','39446',
                          '53481','65868','21390','75836','11619',
                          '20544','23522','41277','93684','81047',
                          '77699','95075','17062','10164','71700',
                          '10773','43684','62564','65920','19367',
                          '86376','34994','42920','11641','57410',
                          '32991','53123','79981','94354','24201',
                          '40583','18451','82628','98990','76474',
                          '71198','90282','99919','79363','36917',
                          '24887','19103','81739','11523','16728',
                          '74581','61292','39071','51012','37749',
                          '40111','26394','29837','29729','17863',
                          '33031','17690','16051','50723','93132',
                          '38968','12063','45876','19568','80716',
                          '88724','70727','26747','38624','12227',
                          '90997','36026','96419','54019','15782',
                          '47339','94100','90814','10799','47121',
                          '63636','93928','67623','12821','79669',
                          '17181','34675','90357','26619','72129',
                          '11656','89031','99663','35731','93493',
                          '63381','94947','94589','80867','25119',
                          '55220','42365','15035','16895','74929',
                          '45082','69199','37371','57669','34684',
                          '16716','40887','23795','65885','37775',
                          '28312','17663','78673','30962','52759',
                          '64475','45151','17657','80301')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
