
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '49414','98834','65267','25101','50306','35502',
                          '20917','73041','60652','61233','48298',
                          '27490','30497','39266','45413','27991',
                          '16719','96692','35277','91554','79913',
                          '15589','58374','45139','67660','13283',
                          '27248','22682','24597','37281','47219',
                          '22468','85936','14552','18803','32842',
                          '88888','71264','82808','18431','25017',
                          '98086','28914','92505','16035','68834',
                          '11349','74387','96092','20992','79637',
                          '33614','43478','85341','58987','20243',
                          '54051','88869','29538','10049','84278',
                          '52561','77557','35560','34938','71858',
                          '67822','35895','38720','41475','11817',
                          '61769','72980','25222','45069','86533',
                          '52172','73451','97655','80309','38048',
                          '97262','30916','10020','31018','94166',
                          '64627','16202','54759','45353','73461',
                          '88814','30949','48879','35409','51421',
                          '59973','78394','16670','14268','21371',
                          '76610','15334','65116','10881','19109',
                          '97560','41665','95093','33875','80389',
                          '69362','42178','89283','13855','64614',
                          '65460','62172','51498','34218','15533',
                          '53157','32736','63250','66613','36858',
                          '50842','55462','85530','93179','21061',
                          '43803','36593','10310','30088','78114',
                          '55430','56900','76127','24145','39646',
                          '46484','45400','30402','94701','48217',
                          '97484','87525','41142','48116','37885',
                          '68640','89686','40504','77580','23285',
                          '49580','77633','54230','24251','80997',
                          '33623','93387','35728','80261','86898',
                          '29269','16726','26677','34319','44389',
                          '68027','66593','37239','17659','85502',
                          '22607','38933','27216','14725','34096',
                          '63928','80994','54930','93802','50137',
                          '67658','20723','87343','27556','87302',
                          '41145','33026','10757','95474','10704',
                          '44763','81544','84345','11815','15093',
                          '80597','88167','37666','70392','39193',
                          '17517','63704','57950','10924','65084',
                          '80387','55701','77856','78078','78149',
                          '12043','57788','72337','56141','84422',
                          '79010','15615','46503','13653','28728',
                          '78888','11917','12528','14125','29627',
                          '11253','96209','85459','81016','54950',
                          '31794','91362','40631','30856','53455',
                          '49639','20813','94510','20689','35006',
                          '38912','12324','32434','54285','44426',
                          '95634','60547','19597','61602','53147',
                          '17587','44519','97141','11235','54378',
                          '45249','52221','47634','23197','60789',
                          '85470','97904','11662','52372','11084',
                          '67574','62418','36497','40709','11443',
                          '23994','14947','68507','52426','99001',
                          '14823','21155','34022','41918','21471',
                          '82441','26053','17428','76044','28751',
                          '54025','22774','82489','14118','16044',
                          '82912','81235','36872','91401','80772',
                          '69102','64723','72711','82753','18017',
                          '91959','21236','39431','28037','29880',
                          '69690','97825','46619','16562','22202',
                          '77725','54529','65268','51907','52054',
                          '55246','13683','69700','78961','54110',
                          '55103','87926','52066','17000','15912',
                          '93335','38203','39300','53058','14193',
                          '75515','42183','36231','38039','14719',
                          '44193','90380','13238','10828','22790',
                          '58642','14614','39150','63666','46358',
                          '11841','74715','28101','50184','16603',
                          '41727','63198','51346','34792','11021',
                          '63033','17173','32108','69849','34521',
                          '45676','42184','52317','69315','66143',
                          '80172','46629','55584','66233','46984',
                          '63830','67427','54976','39790','77674',
                          '17380','16371','24893','98486','27384',
                          '38302','12908','10957','16523','62617',
                          '30261','73486','28624','82629','11442',
                          '94438','19957','17099','17431')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
