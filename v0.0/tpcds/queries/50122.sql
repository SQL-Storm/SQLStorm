
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '21271','55833','19078','51752','73919','87284',
                          '32923','83581','12614','77987','22736',
                          '15911','10690','25749','35786','89513',
                          '97618','82470','45102','21350','82090',
                          '13884','22135','30261','19459','96047',
                          '49675','79673','32817','82745','31378',
                          '12047','73581','71578','97066','10426',
                          '58735','69907','48336','22373','88765',
                          '88421','26121','40819','53840','90900',
                          '95743','14174','23182','91830','37146',
                          '27499','24028','28715','30334','40856',
                          '93813','91444','44502','38821','65225',
                          '25993','45849','41241','97099','96114',
                          '41626','45319','44969','80566','78375',
                          '24370','21339','14463','77155','35119',
                          '46414','11542','27591','19466','19639',
                          '31156','16842','41635','20642','28801',
                          '20756','89369','77152','98423','48619',
                          '38741','46509','36852','11641','75616',
                          '35274','63479','24908','28850','52854',
                          '74688','62209','36930','59735','22184',
                          '17203','62690','98587','10628','37514',
                          '71918','17313','15304','95080','30824',
                          '63004','57367','96727','73416','32257',
                          '30540','69051','85853','13502','23215',
                          '79518','81471','86859','98935','86346',
                          '26187','40536','53784','23465','49486',
                          '53288','53754','21923','92436','71769',
                          '56513','11884','58723','63102','47292',
                          '62448','98918','18194','68782','32127',
                          '17926','33965','12003','51270','31417',
                          '22540','22735','70877','25064','28570',
                          '59038','10087','11185','17430','15041',
                          '56076','57619','42989','98388','18134',
                          '60806','96558','19600','69593','86559',
                          '22247','32163','31950','60225','41755',
                          '22020','97129','40980','12462','85737',
                          '66632','71916','75233','15667','51427',
                          '47780','27358','14380','83315','76271',
                          '20737','32120','51025','58997','56367',
                          '80506','53856','23555','23070','78931',
                          '16543','50008','22901','99782','53878',
                          '19575','77896','31676','76173','61664',
                          '23623','11383','25493','45835','14774',
                          '15612','99670','60820','27216','65012',
                          '94116','25019','14829','39357','29149',
                          '51241','24084','19814','66901','11280',
                          '26858','56359','14674','12707','68664',
                          '11041','70749','99464','33722','16618',
                          '34995','70209','57475','68613','51397',
                          '30794','66559','64517','14361','14299',
                          '43700','82033','15580','22647','92705',
                          '40512','11903','18855','72044','36745',
                          '58454','47188','29434','46834','15377',
                          '24644','22046','20006','19914','10021',
                          '92790','39161','20378','62510','28039',
                          '41118','82655','77384','69083','43203',
                          '15660','13600','58357','86676','83519',
                          '71057','15296','75201','52258','82392',
                          '55058','93426','66446','90554','77771',
                          '21281','31873','48505','52571','99926',
                          '60128','34869','30177','86465','42778',
                          '60299','72783','76863','55462','23026',
                          '95699','43256','78812','60115','48907',
                          '66794','62049','21553','75464','25318',
                          '48935','97890','78142','12331','49206',
                          '25345','43347','31362','98320','80594',
                          '75132','45050','41290','53462','85586',
                          '49902','49604','54498','57314','40534',
                          '58179','61032','11886','98604','41017',
                          '52913','98553','57422','28258','82774',
                          '48651','39428','91375','72759','14515',
                          '92218','84123','33567','85721','73347',
                          '24429','35600','14077','43328','36825',
                          '89013','71526','84481','23300','30900',
                          '22390','15106','28113','45405','44441',
                          '17779','27929','60810','64219','44159',
                          '51042','13572','42578','59940','41549',
                          '59165','44474','12773','83059','40626',
                          '82316','79151','39824','14709')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
