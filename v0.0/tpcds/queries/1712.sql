
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '11837','59600','13032','10844','98106','96843',
                          '25916','13776','57425','67695','29445',
                          '70922','62527','29842','90452','56742',
                          '85084','64921','53857','53950','32383',
                          '11104','96921','19829','37763','90229',
                          '85991','67955','10130','56942','38458',
                          '51705','21228','92147','38552','91600',
                          '17325','39834','30175','38550','93011',
                          '72960','51259','43428','34521','46127',
                          '45811','69105','30884','63341','45380',
                          '78086','66340','84697','76135','79446',
                          '23232','16919','91562','34020','81572',
                          '17233','21915','43800','24320','10596',
                          '48074','70342','72726','13024','67717',
                          '63267','32541','50284','88968','46057',
                          '62155','67392','56156','49592','99109',
                          '89036','51646','10738','14882','20472',
                          '28469','44307','33902','92175','25140',
                          '25117','22018','10386','31965','92325',
                          '77479','76744','95236','50067','30188',
                          '99699','22470','96310','30385','73049',
                          '25153','68284','15911','90392','66079',
                          '30844','84928','66675','23540','82369',
                          '66773','82016','41746','38021','39943',
                          '72894','48943','98031','55720','40576',
                          '95479','95984','43168','83818','14738',
                          '26832','44680','35018','27194','29251',
                          '15345','21852','79666','74483','16640',
                          '53954','86688','18897','95484','35667',
                          '49622','14348','43020','93477','11076',
                          '84619','38073','73472','30780','66998',
                          '80545','91351','93051','47218','40006',
                          '21590','47201','45629','11310','78740',
                          '88979','68391','55543','69778','43935',
                          '29284','79646','62875','95709','23128',
                          '96852','17725','96081','68935','15983',
                          '74933','64074','27069','30283','35791',
                          '70105','39577','40488','68338','15865',
                          '60587','38132','92794','88128','12414',
                          '57051','13995','55238','20118','71222',
                          '34904','33944','49365','26605','59050',
                          '14414','61656','95915','41915','17853',
                          '28121','39225','13728','26922','78518',
                          '81449','16845','99260','26645','19023',
                          '59031','29036','25889','98121','88779',
                          '43280','67378','72966','82454','53650',
                          '18587','53180','84185','20061','16073',
                          '14763','11342','72882','61091','20751',
                          '31379','26213','51780','17204','60488',
                          '22029','83549','35775','45304','11783',
                          '68535','17197','84629','38313','11773',
                          '41528','63999','34542','26340','95059',
                          '81454','76734','22774','20307','83767',
                          '40872','69667','47807','83364','61698',
                          '15340','22239','85905','53134','45465',
                          '20015','73764','13614','55583','26323',
                          '26594','77325','95778','42288','60467',
                          '32033','86673','83924','46997','29330',
                          '75692','44261','52424','89141','88835',
                          '17417','80789','92241','65361','38146',
                          '25188','24708','69413','42529','35812',
                          '35443','66970','83216','55172','25892',
                          '36075','31804','22005','84405','17129',
                          '79020','56448','93568','47880','58701',
                          '45386','21522','49416','21918','36388',
                          '63152','13461','30742','83390','10685',
                          '34480','88248','77359','90478','12579',
                          '57152','69308','77907','88662','12327',
                          '30377','11067','99662','66755','32081',
                          '74173','13943','56388','14525','15584',
                          '23076','43058','68247','43177','23699',
                          '21172','72930','29548','72449','60442',
                          '55673','63057','74979','43342','37284',
                          '33962','19122','43750','94334','65485',
                          '78367','76913','40763','40730','17791',
                          '13261','71650','13063','27332','85554',
                          '10519','80864','20330','47282','24321',
                          '37626','75939','45064','40663','27101',
                          '37414','50122','63318','43948','28668',
                          '24764','31852','34918','96879')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
