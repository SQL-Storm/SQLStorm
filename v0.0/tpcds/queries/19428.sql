
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '11559','49958','77461','32716','14101','57190',
                          '40494','44683','21224','75273','57231',
                          '24418','17302','46970','49355','62710',
                          '81723','35601','62331','36154','71904',
                          '66563','38105','87312','16355','70624',
                          '59530','11188','38306','52237','19457',
                          '73578','55730','14193','63139','79388',
                          '84563','43499','34747','44474','83959',
                          '35045','17368','42015','38018','98791',
                          '77496','84454','80740','20397','96097',
                          '21124','81652','83892','38645','18089',
                          '42485','15951','42530','36184','10455',
                          '95241','46131','31310','26067','72895',
                          '23618','97019','13215','22147','10207',
                          '46810','71888','99195','70265','51576',
                          '13414','33113','68242','25604','58914',
                          '18705','51822','47593','71447','37074',
                          '41183','37376','52304','70725','37109',
                          '15718','27453','67476','56586','13977',
                          '46039','19047','28322','58566','25737',
                          '95449','87034','94837','30838','81786',
                          '65686','37189','45437','97844','29260',
                          '78537','91995','51770','17915','31840',
                          '95306','97774','88954','21891','72201',
                          '12043','47763','60299','58384','23510',
                          '61066','11414','16045','74198','75745',
                          '41600','59696','59304','41827','49096',
                          '27916','86067','22897','43387','31865',
                          '63634','15123','95305','19762','53021',
                          '74747','18052','87721','22747','18823',
                          '19269','78846','32036','73188','77004',
                          '51613','55348','51135','34684','86292',
                          '73046','75834','56790','65359','30881',
                          '22344','95820','68445','50010','48428',
                          '32249','55927','52421','17683','27628',
                          '29075','15032','43154','88863','47228',
                          '79980','15115','12900','13841','85653',
                          '79298','43409','37028','46466','67970',
                          '61303','23001','18392','30659','38824',
                          '96540','67036','29546','33345','91842',
                          '10982','35081','79693','16234','80753',
                          '15537','23329','93619','47647','57893',
                          '56239','36456','44188','14238','13279',
                          '22923','40252','29008','49071','99592',
                          '90612','19768','18870','81521','11129',
                          '42932','12163','63594','53162','32258',
                          '12110','28238','66798','23742','26739',
                          '26332','18003','45328','16636','84185',
                          '81377','11898','83021','35272','87665',
                          '75447','77523','39060','12268','72611',
                          '22084','93498','84250','49183','49915',
                          '25171','76313','84783','35959','70288',
                          '10364','23698','70967','40913','96259',
                          '14177','21786','39081','51231','20280',
                          '12785','10993','88265','63085','65253',
                          '69402','39906','19968','61020','39315',
                          '92718','32333','67936','92833','30259',
                          '25841','18403','80493','73098','14251',
                          '61422','15023','81534','64730','67884',
                          '29281','33767','85290','30633','52766',
                          '95252','63091','40496','95011','55660',
                          '20508','65051','37046','20751','76092',
                          '16708','60484','55949','84419','23987',
                          '80064','29714','56220','74392','44072',
                          '74622','16403','63331','11448','43977',
                          '80098','53661','30481','43229','49181',
                          '56301','92180','45653','91739','17732',
                          '87198','20518','55008','55645','74676',
                          '47392','24906','74169','22268','75417',
                          '70560','70768','93556','52765','38730',
                          '32237','57359','97114','29221','97607',
                          '10754','33693','98362','29307','24011',
                          '78485','98911','91330','29114','69926',
                          '24377','53659','16498','39052','57235',
                          '20032','36029','84805','11938','93623',
                          '80623','96762','18301','35927','34964',
                          '53896','45506','90766','81342','94092',
                          '13742','97658','78907','37499','18443',
                          '41176','55380','69291','66364','30479',
                          '90526','89874','19057','30733')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
