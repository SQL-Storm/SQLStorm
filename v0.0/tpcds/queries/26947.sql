
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '55791','39576','85100','81944','16896','93003',
                          '97920','97146','44993','97935','13723',
                          '22141','78219','38291','69453','39815',
                          '34338','54999','76778','65074','32801',
                          '23656','59509','22832','27798','18986',
                          '13338','23555','96672','68622','21070',
                          '26001','29468','23326','48666','78654',
                          '90368','68337','34910','46422','84515',
                          '17434','90289','41897','19001','87192',
                          '69896','50795','18951','42117','92365',
                          '39004','55512','19037','90252','36015',
                          '84132','50126','52529','22389','35225',
                          '18579','46397','66890','37586','90011',
                          '62714','28752','70264','73352','43306',
                          '12246','28979','79373','78803','96696',
                          '97018','95357','10800','13216','88338',
                          '45725','89534','38488','28719','82125',
                          '41164','15437','46884','28696','61637',
                          '19928','10533','78825','18930','82739',
                          '48061','61804','41575','33252','22786',
                          '63040','26159','59871','15531','33913',
                          '51067','95567','30968','59179','41830',
                          '69231','78002','58661','26490','12794',
                          '65180','60692','10127','74676','84058',
                          '84362','21071','43668','92007','79074',
                          '90434','80422','75227','17432','64405',
                          '47480','17211','36105','54474','89744',
                          '14332','94860','56741','81495','76799',
                          '16949','62841','15984','25736','50242',
                          '86892','13462','24771','51934','37425',
                          '38071','36536','71771','48466','36284',
                          '19847','38438','45598','39159','40367',
                          '46664','91527','21567','55148','68416',
                          '17707','21211','89859','52436','34154',
                          '89118','50506','96288','15708','31638',
                          '42927','93654','24968','65183','36148',
                          '41770','14241','64748','81794','45291',
                          '56428','23114','50974','18910','80971',
                          '97300','36004','27234','56907','23806',
                          '64444','91170','40126','89147','91503',
                          '77048','22257','38331','31008','46780',
                          '19700','47049','35721','55595','24888',
                          '31657','59266','16209','79041','76959',
                          '54435','39701','50673','80279','28555',
                          '57225','44266','87921','84230','46137',
                          '76876','13022','45011','22745','26737',
                          '32807','93378','41899','43182','66165',
                          '17248','16822','26083','44283','51514',
                          '93080','28873','97090','52002','68285',
                          '46968','50749','72647','70000','13425',
                          '85675','93099','20066','10914','18378',
                          '86116','59024','92090','58166','96565',
                          '43136','62833','52143','94469','28678',
                          '31417','85366','38397','30254','55662',
                          '23590','59739','55034','44604','60682',
                          '34657','69431','97075','20639','11364',
                          '31621','53390','48341','14944','32388',
                          '19545','15916','27057','29149','96515',
                          '79602','16723','63048','55660','43915',
                          '33537','84695','41272','63905','35534',
                          '89092','13419','95348','60325','35078',
                          '67903','13098','42915','44139','73349',
                          '76637','23581','43369','15732','77305',
                          '81215','33663','11820','29737','27920',
                          '97756','10469','11139','50349','68467',
                          '73550','38853','42515','31238','12630',
                          '32594','96027','91467','50388','71060',
                          '23987','11807','23653','64452','27700',
                          '91459','64486','12527','17443','72992',
                          '51472','30519','43406','77977','14409',
                          '41993','74015','17260','96586','43764',
                          '27473','81423','32792','85944','52174',
                          '97351','64899','75107','28899','19447',
                          '98325','16849','32658','71621','25598',
                          '13757','95517','44437','45193','20424',
                          '51194','18145','87609','26634','46999',
                          '28057','56477','14981','58348','42975',
                          '69451','67522','88343','14260','66239',
                          '22861','53830','57477','31800','17473',
                          '42445','36526','49677','29383')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
