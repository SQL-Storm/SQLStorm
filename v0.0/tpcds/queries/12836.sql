
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '37586','33353','56136','65212','88943','14588',
                          '57569','86838','39939','57507','30867',
                          '23137','91779','75086','54296','72010',
                          '94030','20221','14309','45903','79704',
                          '17058','57431','46976','72067','21911',
                          '60142','90132','76095','13757','11782',
                          '19437','91564','18002','89231','59032',
                          '11152','13472','14718','76143','59960',
                          '60223','90829','63637','43119','55873',
                          '20290','26835','92758','77821','17912',
                          '12722','88572','57627','30415','77829',
                          '46596','18516','11041','84259','29512',
                          '31848','24559','83506','21551','86357',
                          '45106','39044','51263','50331','48853',
                          '48452','48911','36511','25382','42186',
                          '39323','11702','26014','46119','89031',
                          '59758','76793','11773','89239','36442',
                          '63722','15112','23993','54581','72960',
                          '32591','77870','98514','25764','48975',
                          '16579','98660','65665','38415','67652',
                          '63069','27256','36082','10830','57103',
                          '19070','90217','51331','31522','37237',
                          '26203','32146','47548','42531','53498',
                          '63145','18683','93692','58328','75367',
                          '16773','73833','41577','31326','35505',
                          '66751','50831','76616','57038','59117',
                          '54877','75756','58397','36523','44106',
                          '58911','60233','23596','49225','86160',
                          '34220','54792','97554','33734','41830',
                          '90744','49480','34716','60003','39966',
                          '60758','17009','16620','21472','14469',
                          '57556','27731','22548','92756','56979',
                          '93346','86465','34173','24299','82396',
                          '33391','39727','95041','10137','95437',
                          '41483','35051','35089','67904','79547',
                          '15627','19134','30144','44240','98006',
                          '98315','36199','12669','20054','96118',
                          '15858','18176','56106','82454','25091',
                          '74440','46166','35975','53183','21255',
                          '18317','91286','20269','81558','21053',
                          '64627','16453','63427','29508','18198',
                          '99997','38898','65102','14303','46016',
                          '48713','15598','29153','22653','21701',
                          '49354','87773','34013','74100','21825',
                          '64765','16132','39493','56510','53611',
                          '25368','79265','43162','91880','27320',
                          '96886','14575','35638','54890','28317',
                          '19520','41237','40137','88084','56629',
                          '80841','37108','44126','98653','44212',
                          '87028','10704','55963','29599','46209',
                          '85012','57926','46727','59292','33184',
                          '36139','50043','13315','16849','90694',
                          '27156','20671','71595','25792','64150',
                          '71113','62438','30158','27512','42564',
                          '27561','98903','97119','87681','27610',
                          '70999','86879','50768','69407','39072',
                          '15424','35495','18766','75137','57119',
                          '19365','67337','57525','49038','86503',
                          '44527','35881','50028','56724','95126',
                          '12617','91624','75044','25590','20509',
                          '20431','46050','61272','25429','65426',
                          '55864','62096','69489','84064','13361',
                          '87788','61552','30597','55928','46636',
                          '85930','39455','64541','62767','60023',
                          '31413','41406','31292','81284','58745',
                          '44132','32206','62627','68333','86439',
                          '93153','67006','54943','87802','76813',
                          '72423','54234','40645','43383','93093',
                          '16584','12114','25571','19530','92903',
                          '78614','18586','20097','49363','40447',
                          '55121','18953','27702','45615','99286',
                          '58203','74370','66262','67136','48132',
                          '42914','11257','10211','16948','98093',
                          '38191','41210','26223','80079','84131',
                          '37343','37683','61387','12725','11857',
                          '61766','28261','41961','23259','69038',
                          '41444','73110','10097','57993','39247',
                          '81127','26429','62281','79011','69332',
                          '72517','76685','82952','12883','67050',
                          '16194','76532','15216','40734')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
