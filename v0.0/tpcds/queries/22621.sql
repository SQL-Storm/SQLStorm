
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '85804','59285','26628','96932','64826','29894',
                          '94948','15542','71881','35352','28585',
                          '90697','16382','19062','26315','31473',
                          '48025','41370','28692','83546','25402',
                          '10706','47499','91185','30756','46926',
                          '16675','89799','46312','66192','65246',
                          '82347','97991','87330','14276','91982',
                          '54653','54133','14714','60879','78304',
                          '80176','52301','76618','45886','74811',
                          '75603','49918','39564','99996','68182',
                          '25824','56593','14145','31769','75486',
                          '86866','19058','32685','70008','47512',
                          '48225','22382','19511','76282','18682',
                          '51326','18001','83103','44669','83211',
                          '34136','76650','92246','62232','59092',
                          '31283','41057','35707','16583','18079',
                          '93568','18892','71546','40546','51771',
                          '58839','58938','18914','29967','90304',
                          '55995','20876','42987','20068','83191',
                          '48974','20854','73193','64375','57128',
                          '54372','86967','99758','50200','36825',
                          '48113','26636','29619','13783','70727',
                          '25980','55497','21422','97243','32249',
                          '15913','46074','83510','46159','23067',
                          '24686','98780','46486','15133','53307',
                          '27517','40445','38593','95109','96367',
                          '59244','67515','64188','23226','26801',
                          '38808','27879','16481','19617','61700',
                          '27650','18774','29944','34237','11900',
                          '26151','17676','58501','41421','31411',
                          '34469','67421','96603','14211','31118',
                          '95328','39038','46683','24289','49475',
                          '78953','84140','25856','86912','51640',
                          '95638','98827','13342','84264','14932',
                          '10001','65359','64876','41435','75522',
                          '44215','75762','32082','14633','29917',
                          '94158','14921','56438','69496','46441',
                          '89174','81037','64968','80450','15507',
                          '32196','91363','61575','42475','68293',
                          '30732','44334','43821','39432','16134',
                          '89767','87626','15532','30738','27736',
                          '30848','27274','85463','82318','74680',
                          '65677','99636','19336','27082','91779',
                          '51809','66224','83561','38179','24133',
                          '19992','31259','44314','11815','27738',
                          '57573','81933','56653','88588','62205',
                          '85640','30258','32421','79209','14316',
                          '84941','76322','16832','58395','29852',
                          '15101','91082','63876','14263','16928',
                          '66971','39467','32748','65453','21010',
                          '81883','29549','33613','10800','32230',
                          '38670','12117','83141','68078','89102',
                          '29494','68819','78510','72073','37001',
                          '61823','67209','36876','11627','37595',
                          '99488','13325','66844','70922','28414',
                          '76741','89197','70229','51312','71266',
                          '33080','74224','51898','54805','63324',
                          '75834','12103','95842','40074','20287',
                          '64425','90346','27212','13126','23898',
                          '17404','72547','12134','79798','67522',
                          '45503','55710','21285','97682','92302',
                          '16193','48747','29824','84299','25846',
                          '29578','87624','60337','16793','59508',
                          '41376','13382','40847','28201','48174',
                          '67799','26219','66556','83502','20904',
                          '42615','88576','23047','90786','16926',
                          '83693','39379','41299','86227','74390',
                          '68412','63193','74438','91094','85843',
                          '13778','44655','52016','80380','95127',
                          '73226','27166','27120','27913','62966',
                          '13823','92414','76493','87746','85825',
                          '22805','33256','80547','68703','10318',
                          '65517','36285','72730','29434','18248',
                          '37262','30750','22037','52885','81843',
                          '49610','63043','14486','20640','46675',
                          '25024','39917','36175','30383','39403',
                          '76183','80803','14232','15719','54994',
                          '17002','36673','82955','11666','20378',
                          '26972','29064','26456','31351','40771',
                          '76475','27070','36528','85108')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
