
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '43441','40308','27688','38278','32521','40719',
                          '16507','45423','68716','92137','56897',
                          '13894','74375','34875','70825','31876',
                          '87801','75271','87308','66763','40250',
                          '72076','16193','72196','27845','82252',
                          '51573','48357','68361','68327','17303',
                          '82408','37052','42976','63204','37387',
                          '29965','42453','11942','11223','14307',
                          '29080','43269','92004','36051','77000',
                          '42580','61788','99175','95112','85016',
                          '22983','30971','63214','46298','16388',
                          '24550','17443','68074','38821','45202',
                          '71119','21827','39409','37018','19449',
                          '30500','64069','53703','13534','52935',
                          '48453','25269','85617','15770','51577',
                          '43800','49712','14663','77949','18155',
                          '28550','76286','25339','22502','42480',
                          '87086','22856','23679','94630','66911',
                          '91913','52156','22514','62060','92662',
                          '62177','46148','19463','43841','14126',
                          '22677','19209','59276','44938','58909',
                          '28115','31843','26180','54937','83957',
                          '41731','67378','56388','16291','21457',
                          '67703','37598','58753','32523','72810',
                          '62635','68627','32500','12256','62801',
                          '91027','94340','92929','48769','37524',
                          '25087','99306','38520','57330','31122',
                          '14643','93065','18992','93059','36742',
                          '18810','87104','79586','96293','57411',
                          '90510','96879','30738','74455','63960',
                          '82786','76091','22259','83942','21049',
                          '43034','95859','14160','47558','25986',
                          '29803','55930','60253','26160','24061',
                          '42507','16345','25893','83540','94021',
                          '12093','99454','60322','51215','55331',
                          '45621','45652','80258','17252','80767',
                          '33910','81005','71913','75182','45910',
                          '69676','73523','84575','21160','11141',
                          '58741','16556','27517','28649','71370',
                          '37224','86388','14298','13252','89247',
                          '95441','12152','95503','24860','47672',
                          '24678','30451','68815','31450','45682',
                          '94344','41684','59292','21496','31255',
                          '93663','54298','48483','37614','96078',
                          '69889','10554','25689','99821','65976',
                          '76689','33002','33823','45890','34059',
                          '13741','89320','86421','63012','54345',
                          '82566','47399','11178','90004','41759',
                          '46929','43309','16620','46742','25013',
                          '68567','19090','54532','77724','42774',
                          '10955','38996','33013','44894','42896',
                          '64532','17908','52086','63545','89660',
                          '19702','45686','46414','80881','85111',
                          '79320','69352','33150','74564','81535',
                          '17130','24958','95462','20907','15541',
                          '11089','47604','33937','31097','40888',
                          '80994','68814','66591','11919','61348',
                          '80126','42049','84608','67362','53339',
                          '11161','11766','27138','51453','54201',
                          '24945','61088','71308','15941','90887',
                          '45264','14014','35244','43154','48049',
                          '46429','38899','25629','28284','12720',
                          '49038','46370','19491','93792','27827',
                          '69535','35486','81977','66661','12787',
                          '48782','33454','12398','21382','57518',
                          '52765','48206','32367','74416','10498',
                          '90198','19976','18114','73612','82768',
                          '69715','61280','77026','45404','82777',
                          '69377','94525','54322','54924','39273',
                          '60492','35197','89008','69010','72798',
                          '12910','28268','75919','89181','82467',
                          '25606','46425','82916','74999','95454',
                          '14782','33634','64422','46948','77566',
                          '93314','97573','35412','56159','45415',
                          '28679','72020','66458','81292','32375',
                          '16038','13059','14292','96100','98659',
                          '80023','66014','25320','19154','74684',
                          '18837','10011','51744','21659','42205',
                          '46848','35130','40107','52664','62334',
                          '50360','33820','63441','24696')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
