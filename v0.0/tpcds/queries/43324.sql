
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '52791','85606','31995','75793','71745','94869',
                          '67369','90170','45399','12447','64848',
                          '53968','31743','75678','98206','49411',
                          '53027','85145','87732','47355','81455',
                          '97151','57858','76340','30152','36980',
                          '35237','11983','65174','36808','35178',
                          '63967','47184','87025','81951','41497',
                          '80016','94296','83913','14436','62593',
                          '66545','79986','87786','59245','53457',
                          '73878','38545','86558','31788','95753',
                          '10615','31019','91485','38645','14468',
                          '91024','15089','57240','82677','39191',
                          '15457','10005','48614','44158','22520',
                          '29257','57360','10883','55453','67363',
                          '97662','42566','66761','44111','24955',
                          '93548','13594','12558','87939','40568',
                          '65737','45282','34147','95012','35240',
                          '39165','70010','16391','11049','29220',
                          '26401','60838','47295','93594','16933',
                          '71416','22721','93673','25235','50978',
                          '79895','57009','26097','16350','56922',
                          '23785','90221','25674','72598','52755',
                          '11086','72987','48620','93164','22418',
                          '20697','56172','63573','71650','16687',
                          '63619','86671','58060','51480','71268',
                          '54102','88212','26073','31623','63834',
                          '15744','36644','54076','19131','85055',
                          '31935','65120','23289','70469','25745',
                          '27447','45110','25980','17290','97022',
                          '73262','40362','85897','23828','41680',
                          '19267','99259','29289','25545','42247',
                          '85992','62559','98430','29054','20388',
                          '92491','47989','13565','84195','96984',
                          '22002','49833','42582','37631','71877',
                          '97757','87680','69314','83729','52183',
                          '68589','29770','92649','90149','90929',
                          '68037','71291','95002','28695','15694',
                          '14761','88343','56837','46787','15083',
                          '24275','11259','57515','79619','76468',
                          '78499','12869','29469','61063','74802',
                          '89209','58416','44507','75582','44171',
                          '45912','75898','55533','38052','20886',
                          '59437','45193','25699','32568','33470',
                          '63037','30915','19639','58372','32449',
                          '51355','43351','71496','88589','74085',
                          '97953','59167','76790','49457','83793',
                          '97091','42856','74755','99337','58058',
                          '30516','42937','19217','65801','30137',
                          '39782','60743','55801','19154','89616',
                          '14585','83905','34002','76029','78405',
                          '59073','57333','49704','34653','36798',
                          '80830','74565','82896','59490','68634',
                          '57635','71131','52862','41353','59828',
                          '90216','25367','21315','92963','69263',
                          '34340','60862','57096','33686','32478',
                          '63005','44307','10121','62166','67248',
                          '23897','15073','64643','54709','85759',
                          '86102','53894','55133','68968','92860',
                          '79666','94688','37320','71384','78282',
                          '96040','31122','54597','48042','73760',
                          '43483','61278','51879','33930','77217',
                          '90990','92704','31547','86247','88050',
                          '37115','42474','55589','25231','34070',
                          '37888','43127','20195','75126','18385',
                          '70231','13163','32629','93421','36283',
                          '32692','36227','48438','78449','41162',
                          '58522','37572','47702','77324','52401',
                          '45364','12286','13740','69075','61820',
                          '76002','91647','81693','50099','32814',
                          '61639','59858','50961','47220','92142',
                          '90142','20891','25373','83898','60153',
                          '20503','36143','93325','26228','36418',
                          '13908','93814','41846','53088','89529',
                          '71884','61830','23278','20075','43078',
                          '45420','47618','32443','31820','81504',
                          '83362','18943','30413','98538','53109',
                          '23569','52848','76640','14966','45492',
                          '25811','75275','96030','32425','65243',
                          '65495','18798','76022','11620','35534',
                          '36457','77348','49142','15363')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
