
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '71457','66672','40807','20149','18806','52260',
                          '45937','22794','54989','37749','88004',
                          '86552','65039','10685','48962','35488',
                          '88348','67425','24569','39930','23984',
                          '85832','30571','79570','87513','44121',
                          '49188','73739','49953','32659','14311',
                          '84728','59460','55640','63970','38578',
                          '96042','24736','95783','71087','66957',
                          '15749','27067','69906','82453','22863',
                          '23496','68276','58617','34071','59516',
                          '13578','29247','39312','95417','58004',
                          '46679','94616','37119','50932','13589',
                          '34356','64647','77354','13612','67248',
                          '86263','90209','89531','12337','85954',
                          '16293','41217','47171','35273','16079',
                          '19896','28569','41321','72744','42479',
                          '87561','62585','33885','24868','15283',
                          '93342','30050','24302','29468','50477',
                          '20976','59912','21271','24118','71542',
                          '76964','74122','28934','28924','14489',
                          '14027','78628','13874','98811','55552',
                          '43684','88232','21515','17252','25737',
                          '96666','14360','30003','36829','67353',
                          '23752','14846','86503','81560','74116',
                          '44082','26976','49658','66517','51283',
                          '77657','82033','50942','27711','36602',
                          '74045','37538','25934','14858','92810',
                          '98011','69560','43033','55996','41977',
                          '37703','22196','66485','15751','36784',
                          '61352','55361','12967','61848','63924',
                          '27678','55145','96972','16600','74133',
                          '32237','48967','89316','39224','43236',
                          '60940','38363','91502','96890','23170',
                          '95388','56295','46907','77542','57592',
                          '27200','57589','10142','35325','62894',
                          '39882','82237','12618','80882','27338',
                          '77067','85656','54686','36754','86922',
                          '96632','20166','72013','86998','42844',
                          '54548','86937','38482','51300','73090',
                          '97051','39111','24120','51092','18250',
                          '69505','21797','34140','37394','20548',
                          '98067','82994','64341','24951','16669',
                          '37854','78118','44208','69316','48702',
                          '40097','90180','47742','23389','30529',
                          '37992','57878','38680','15489','24347',
                          '52214','53834','39164','52321','24974',
                          '51820','81723','46515','49889','37630',
                          '22318','22665','53301','93333','96874',
                          '69606','23770','18187','56682','60283',
                          '48060','41129','10071','22858','95618',
                          '97766','29925','80255','96202','31417',
                          '33696','21696','10827','35781','31854',
                          '43127','24044','19361','29783','32624',
                          '33809','48613','25826','54403','58346',
                          '48866','11858','40378','39205','25888',
                          '82674','38859','36075','43062','18003',
                          '17746','65691','15044','78227','96181',
                          '34714','67903','13748','13053','77512',
                          '66576','23741','74673','54325','20487',
                          '71790','98446','12641','64710','31852',
                          '28201','95288','48039','64085','99141',
                          '46092','22350','21112','33765','37010',
                          '67834','66217','95212','57841','46217',
                          '75493','24297','94427','26746','73690',
                          '39966','26049','60571','47131','19373',
                          '28112','45876','18065','58896','45458',
                          '73833','56525','81611','31682','50275',
                          '43550','39734','59507','10776','40907',
                          '69416','11094','52337','25121','47663',
                          '12272','24185','59462','55530','14720',
                          '90624','82052','38007','72193','32005',
                          '39289','97903','18423','13751','81232',
                          '42197','46693','88024','55207','79567',
                          '54340','63780','53157','85515','54285',
                          '94564','89223','38306','40835','13422',
                          '26660','37757','42984','13979','39204',
                          '75525','92602','33073','74146','22653',
                          '13088','31919','47039','50531','67701',
                          '13445','21532','18041','50110','15699',
                          '16284','84898','92308','44215')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
