
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '13835','99411','18822','16311','55203','66250',
                          '11982','14549','82703','10076','61770',
                          '17748','77937','54010','25425','28446',
                          '49103','68429','66590','79056','22648',
                          '66772','85438','80201','33012','40910',
                          '28554','71329','85064','10039','81715',
                          '59729','28833','16409','32578','72326',
                          '24023','34984','41346','24913','71170',
                          '22406','17463','82219','45297','31582',
                          '36352','98284','17017','64486','56301',
                          '85865','91757','42033','10925','37953',
                          '13071','90269','20401','24364','48170',
                          '97264','10498','36065','83151','35853',
                          '15392','84000','23160','13363','11916',
                          '26574','46145','35380','37896','20588',
                          '71486','78483','95040','29419','25327',
                          '99996','71612','50189','99920','84664',
                          '15441','41027','53628','29947','11415',
                          '58782','71442','47355','48368','47902',
                          '69213','22879','63654','45652','16708',
                          '72735','41811','42682','61947','36557',
                          '90707','37358','14627','66908','25989',
                          '73939','15579','60387','43680','65755',
                          '57171','22961','73068','37567','66262',
                          '43090','53580','17214','34201','16892',
                          '37077','53890','61471','38228','31907',
                          '25005','32026','50761','35483','23392',
                          '75424','45773','26437','21194','96354',
                          '30835','63391','84137','26268','84470',
                          '82822','22516','45187','53955','24452',
                          '87274','62556','63851','67361','70936',
                          '33898','91485','61468','11294','53009',
                          '81328','67606','32878','24135','23491',
                          '97850','56528','40685','43625','40523',
                          '41374','44959','41170','32653','79908',
                          '16778','96089','19737','63709','61454',
                          '24028','35482','71236','24598','33376',
                          '53661','38559','61335','56984','37588',
                          '53007','35094','61764','67196','60527',
                          '26031','97678','66955','67722','37693',
                          '23724','39287','78938','13465','42064',
                          '36398','26445','47703','29582','26509',
                          '38894','52413','10752','49294','96416',
                          '20280','30645','24187','74159','19334',
                          '89294','32801','46676','34610','98238',
                          '23733','37656','26556','15212','42395',
                          '78716','19709','82187','28542','71890',
                          '83518','97553','66424','20175','61826',
                          '90280','17327','14511','85944','70166',
                          '18460','61079','20860','93683','44177',
                          '10249','74098','52498','34915','19363',
                          '15228','39313','62227','39583','19695',
                          '15444','94465','40835','37861','83463',
                          '18949','64537','10695','31546','49940',
                          '26907','22114','45095','84523','73253',
                          '63672','18857','26131','39132','28124',
                          '46741','17605','47061','35069','50298',
                          '47695','39830','89721','22559','64394',
                          '32730','42625','75419','64891','10396',
                          '98143','47487','69768','44347','64534',
                          '84545','49975','17242','67150','45293',
                          '47946','84424','75894','47346','62106',
                          '68985','46744','87470','92528','71085',
                          '25730','98710','84988','13199','92842',
                          '78077','31055','14409','34817','37581',
                          '55866','68573','58136','99486','58541',
                          '64511','35536','16302','22424','25210',
                          '42640','98609','29854','62914','20340',
                          '42965','65872','95908','74461','50543',
                          '49657','14059','11424','98472','17036',
                          '76115','74820','55299','68955','74349',
                          '59719','67829','81051','54635','70317',
                          '93481','95529','14269','38000','32226',
                          '74192','30074','23120','73299','21216',
                          '12859','29758','11400','12153','12107',
                          '56190','50778','86912','24485','20224',
                          '16692','27932','98618','36735','74765',
                          '96601','25371','22146','60848','69873',
                          '10513','61735','91298','77039','88875',
                          '46329','66125','53458','39984')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
