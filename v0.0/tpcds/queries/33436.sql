
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '83372','53711','12562','93489','75062','60340',
                          '14238','22054','47040','14330','53156',
                          '87806','26971','88865','65047','95697',
                          '15703','26673','73771','80104','81525',
                          '22330','30192','31547','77550','75355',
                          '32887','87327','54038','96849','34937',
                          '48447','58548','18802','40618','37204',
                          '18076','45539','70098','88112','34233',
                          '79591','42695','95574','46582','56610',
                          '17362','79364','55334','46640','65299',
                          '84912','32889','83919','55454','75601',
                          '71082','52289','73039','35618','90267',
                          '19110','24372','45582','82384','18858',
                          '54761','22912','37274','24859','73268',
                          '93314','21420','15694','31662','22984',
                          '83257','23200','53678','27497','44395',
                          '54737','61472','23639','80637','98427',
                          '52807','28440','22910','93612','48993',
                          '21666','20616','17755','84600','75144',
                          '31473','78229','53985','76961','43024',
                          '57713','38669','80511','37664','64278',
                          '42155','96727','28423','58460','21526',
                          '52119','35488','36235','94254','49880',
                          '23446','22991','91941','43110','86208',
                          '31420','95706','71264','77372','69548',
                          '97702','10482','31643','96868','23671',
                          '72475','33740','37033','34062','75380',
                          '33558','18508','35027','81498','11285',
                          '95151','42429','63109','98841','68338',
                          '78474','35348','19956','17818','24171',
                          '20152','60194','23184','38470','26004',
                          '85853','15316','79446','85025','10710',
                          '41404','17581','70307','17003','34710',
                          '52815','62228','21261','45799','72687',
                          '54770','70050','79654','20441','14664',
                          '15756','44380','31386','96333','83167',
                          '22487','44657','69097','51409','82070',
                          '77493','29152','41369','43806','31235',
                          '30184','68580','56020','64428','97606',
                          '29325','14267','32203','44865','82167',
                          '42503','23677','84182','40178','34719',
                          '21426','94427','62601','83797','52469',
                          '47299','38479','14183','50750','72431',
                          '55731','47667','64597','64362','23533',
                          '85087','96671','14100','51437','60932',
                          '35299','41765','34993','41601','98893',
                          '44255','59524','11407','96908','91510',
                          '97652','53944','25347','87075','25323',
                          '26872','91207','83589','34083','24030',
                          '81576','20708','53161','28424','72342',
                          '18465','14779','76069','17240','66197',
                          '20148','57569','18139','70422','62600',
                          '51125','31364','39781','68044','12586',
                          '42346','48502','61996','74729','78587',
                          '71957','94605','34250','32675','73094',
                          '18693','60565','29807','47671','13571',
                          '35862','15042','14790','75675','59120',
                          '25384','44180','37527','63253','33354',
                          '71900','57937','40552','14375','18015',
                          '68384','18702','18141','69661','97840',
                          '81272','69278','24065','76201','89223',
                          '18061','91448','84555','28959','70132',
                          '70247','20936','57363','76429','26899',
                          '46687','10511','20670','23427','74659',
                          '60308','55654','80982','33097','45324',
                          '30309','83838','50264','95174','98959',
                          '56361','48182','33252','91637','21065',
                          '78687','19548','73856','16403','88083',
                          '15273','23053','68483','38059','42995',
                          '49790','18657','19845','94567','86103',
                          '17910','44735','38657','86373','20848',
                          '23385','45377','61673','28160','65362',
                          '90195','92418','30815','31273','24951',
                          '95380','51174','38802','15454','45942',
                          '42952','44274','73607','24707','77661',
                          '27110','31647','10630','53175','13393',
                          '17864','54650','40322','24246','73123',
                          '67448','55255','19929','87474','25867',
                          '12634','72686','13109','92060','33050',
                          '99555','22371','68976','74448')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
