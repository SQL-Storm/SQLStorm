
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '72101','98752','59288','69402','32938','30177',
                          '76161','33638','18897','47939','61581',
                          '56378','97000','95892','13220','92480',
                          '41114','41501','42032','55111','62925',
                          '54133','91186','74438','65244','10793',
                          '61323','48722','17917','15998','85432',
                          '23423','18722','80039','57368','57334',
                          '67899','63414','10087','57963','66323',
                          '25370','26044','15644','38254','83225',
                          '18303','56793','12799','18572','48207',
                          '36394','69290','22219','35053','54179',
                          '85981','19464','88050','75312','14836',
                          '21744','69994','63653','71112','13973',
                          '63692','25024','16283','94659','34869',
                          '14036','97918','51474','10552','95867',
                          '27342','92622','57297','26875','90857',
                          '65293','99984','27413','78186','18639',
                          '18163','26530','70771','62951','47261',
                          '34522','26951','19482','38049','41882',
                          '16210','17266','54300','51845','33002',
                          '83854','69863','12287','98809','45954',
                          '11707','85420','22410','78101','98904',
                          '27368','13302','40858','39082','21544',
                          '24287','10450','42697','44998','58996',
                          '74077','57140','89660','88523','41004',
                          '42454','58063','45490','40784','19115',
                          '54151','17948','21238','63745','42215',
                          '75308','47968','64021','57767','21351',
                          '46331','28143','39277','57567','64755',
                          '25918','36719','11698','76740','17348',
                          '22670','83220','54128','81469','93886',
                          '90619','90734','81812','32356','16410',
                          '57468','15138','79645','14159','32846',
                          '25890','67021','25099','98957','53786',
                          '20986','81458','98724','26439','24278',
                          '57455','60152','21209','81899','57253',
                          '52563','48985','76615','36466','15509',
                          '97994','26293','17817','10463','27534',
                          '65654','81793','53855','96753','86289',
                          '56215','79038','38985','42395','10527',
                          '75454','73164','70781','69880','28647',
                          '33439','40173','75822','17345','17625',
                          '53478','50615','24307','67972','19745',
                          '42210','56435','95385','45931','51269',
                          '82004','71306','86216','84400','71195',
                          '42547','94294','47131','86820','18715',
                          '38398','55056','69709','64143','16563',
                          '22708','40012','70947','27446','67649',
                          '35515','39574','83242','35735','97350',
                          '55452','13414','69139','37517','56950',
                          '52428','15081','80626','71831','28680',
                          '55271','99127','67194','48539','74430',
                          '51431','96243','79435','18383','54619',
                          '81314','69229','47816','39342','88333',
                          '18837','58854','68223','32867','33361',
                          '91982','15432','32191','73195','88086',
                          '15862','17253','36978','23578','11852',
                          '27441','26324','18686','19064','61704',
                          '14396','52926','90562','34964','20294',
                          '72960','24790','35224','77295','79765',
                          '35626','11575','72825','65426','32803',
                          '70840','18838','56892','23936','40218',
                          '27109','56826','13049','78945','85776',
                          '19662','30289','37088','84404','38659',
                          '15189','35039','59536','16049','30658',
                          '15119','15265','11696','49602','44230',
                          '47016','46766','63153','79760','46649',
                          '13931','71498','58722','35008','41888',
                          '31246','41707','27696','59063','84463',
                          '51905','37774','38466','59755','96084',
                          '21408','25367','43077','41819','49449',
                          '72903','23116','12713','15649','53267',
                          '93233','39754','28933','72626','64171',
                          '28938','40773','51506','67551','71541',
                          '51089','84419','72270','62122','60728',
                          '25347','21983','34809','97011','34385',
                          '41812','65294','40683','89846','83291',
                          '62594','13838','50496','35561','44704',
                          '65139','54043','38280','71180','66600',
                          '41225','33031','39549','89617')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
