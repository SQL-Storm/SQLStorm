
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '69636','26420','34163','84219','71579','30462',
                          '17218','96703','22453','33934','31274',
                          '71748','29860','78826','32217','10628',
                          '49951','75112','51568','37856','32307',
                          '66258','29880','76284','39789','13257',
                          '14052','42746','80871','80014','68318',
                          '86050','46784','62931','63597','26464',
                          '82668','58093','11029','36191','79556',
                          '18512','40399','65330','45364','93753',
                          '49534','34202','85382','77938','41219',
                          '33354','49694','57239','12984','59390',
                          '99662','37641','23088','85456','55947',
                          '39009','70419','13494','32354','64156',
                          '55057','43579','31736','45322','57818',
                          '14437','16080','20137','19709','66505',
                          '38848','97152','22536','21048','15170',
                          '41254','69554','95902','27428','63889',
                          '45852','79693','14084','61259','40711',
                          '95602','43722','27782','20172','24373',
                          '88657','25948','57469','39589','92847',
                          '54178','32042','50622','55711','65267',
                          '49744','55188','24869','66199','74864',
                          '66274','75717','81596','11012','14767',
                          '53164','61579','37197','54604','53096',
                          '23330','40378','18283','73583','23830',
                          '92429','54980','17378','79798','49404',
                          '26644','40415','72104','73969','30872',
                          '85334','38651','66645','34168','76751',
                          '63641','77417','59950','82421','56364',
                          '23977','50397','75637','36827','17904',
                          '57706','18330','26153','29697','56077',
                          '37194','18960','79203','41941','58157',
                          '27005','26254','30641','27736','62693',
                          '26849','18394','34289','55532','78753',
                          '35680','90943','37362','38605','73973',
                          '47536','31996','99029','93633','82860',
                          '31291','91854','52897','99825','73890',
                          '14667','84827','42939','37793','62403',
                          '83250','45402','53666','59325','97505',
                          '75936','27902','25239','60288','84159',
                          '40388','86606','97391','28719','66300',
                          '93740','37064','73982','81930','40438',
                          '68848','12887','20032','48101','82797',
                          '27787','21919','94476','94060','25903',
                          '35898','73896','78294','68938','18443',
                          '58521','75367','13639','24519','16616',
                          '43662','91736','31813','93494','13344',
                          '30466','18973','58789','91845','16477',
                          '76448','27726','19617','28954','27936',
                          '46166','60827','90457','11327','99541',
                          '29446','90787','89930','80271','53689',
                          '35318','72340','11569','30723','11987',
                          '83541','23291','30416','72839','69780',
                          '98742','61562','57114','58475','15536',
                          '58122','76295','11780','70465','99755',
                          '70650','80768','87922','21224','75921',
                          '32644','28983','77586','59999','57653',
                          '75704','48001','31126','68899','49767',
                          '49463','12941','68959','77624','78318',
                          '92327','82581','76013','78979','42099',
                          '18903','89627','67317','18836','18810',
                          '68443','52259','30862','79784','33105',
                          '35980','25315','12432','71973','58285',
                          '89992','89331','12627','14675','51223',
                          '47918','47787','94474','94795','53465',
                          '28809','43796','50911','41309','62500',
                          '38608','21855','51436','86443','56422',
                          '90026','58167','11097','99615','15671',
                          '54385','27228','35127','44774','25118',
                          '30470','10797','82515','74940','49323',
                          '65731','29143','13869','97257','25313',
                          '91795','59787','77584','61823','47700',
                          '38629','83719','31311','15303','36846',
                          '31647','78136','25968','28392','58620',
                          '19804','88251','98124','43881','94243',
                          '45526','21535','52015','69305','35981',
                          '11790','75718','69850','16761','47820',
                          '67555','23275','53396','68650','68765',
                          '20773','87446','43377','16634','20734',
                          '83560','46894','84763','88185')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
