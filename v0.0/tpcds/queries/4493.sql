
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '23412','31215','80212','31976','56966','34591',
                          '45089','39682','11230','79974','78001',
                          '66868','28523','17104','18839','99213',
                          '23640','15925','27244','29937','87864',
                          '51285','52230','36315','86987','89386',
                          '74764','28017','86340','18698','44805',
                          '41605','27599','54807','25619','38458',
                          '93096','13411','26754','58596','79667',
                          '78036','41476','91779','17347','56730',
                          '16258','61080','14643','18786','73218',
                          '63306','39268','21768','41156','37330',
                          '56684','43655','11370','89322','40539',
                          '38381','51214','11903','48956','32087',
                          '24069','43045','68610','90605','48332',
                          '59164','64440','42076','62804','76039',
                          '62362','13640','44205','17084','49983',
                          '79339','55398','58310','37766','36355',
                          '93902','94651','90065','29453','76235',
                          '67886','31657','76319','38748','19398',
                          '60959','82901','65246','89101','50344',
                          '69832','94343','40870','19597','15611',
                          '12541','40495','12664','59249','52486',
                          '93683','72804','74795','79692','64396',
                          '88366','14648','74208','83333','74543',
                          '42560','54019','30246','23945','70121',
                          '91996','67648','56932','87321','12982',
                          '23686','26814','46391','84427','61204',
                          '19171','30306','44156','20267','20952',
                          '12573','22231','84008','66307','28838',
                          '49231','63840','52887','10304','82789',
                          '84438','77673','58929','35533','48278',
                          '53970','99402','84255','84279','87661',
                          '60757','41178','63734','40842','10553',
                          '94046','61225','65875','59583','74217',
                          '92798','25728','49740','98510','47205',
                          '22570','53519','14333','54936','13953',
                          '51312','78017','45104','55408','52461',
                          '20939','11538','26657','63584','35092',
                          '16698','56776','62145','17611','14922',
                          '67103','16344','43743','86469','14283',
                          '65876','14271','22629','41758','16834',
                          '99593','83511','74011','21712','83624',
                          '48196','22878','11868','33266','45955',
                          '94337','82220','12345','22384','96987',
                          '83974','39755','91007','50104','25562',
                          '91090','68139','63374','85010','84359',
                          '56491','64101','25987','50026','94245',
                          '36213','13140','31484','15868','21806',
                          '49182','10902','21920','58478','33919',
                          '96970','12561','18133','64651','71952',
                          '10849','44034','73161','19137','80616',
                          '80232','17124','69000','23715','75952',
                          '76825','72663','92661','18800','66178',
                          '41448','17979','69376','39305','24394',
                          '96028','43883','27585','11584','59176',
                          '95349','28727','26829','95207','25633',
                          '17898','67850','25966','34491','37395',
                          '23699','66412','30736','17647','45517',
                          '58982','63396','28902','67798','67131',
                          '89207','51019','63720','34107','74993',
                          '32350','21453','48537','32145','79044',
                          '50292','87209','84695','74797','77075',
                          '51639','54287','52950','80760','47881',
                          '24480','59458','45732','93490','35122',
                          '65095','35032','83927','22160','26223',
                          '48712','15313','55267','52453','66893',
                          '19275','78463','86990','55253','25851',
                          '93423','95735','10368','77472','15991',
                          '28266','57293','71382','39490','96702',
                          '40646','70129','82607','55741','22703',
                          '69980','70896','50140','28552','27300',
                          '89638','30876','58974','58968','98136',
                          '62465','56408','57323','48617','15446',
                          '34129','17806','59859','32766','11905',
                          '30797','64932','98340','80317','56215',
                          '36449','67443','73866','59528','66741',
                          '11843','46578','75204','67982','26596',
                          '52325','16661','94103','25000','34991',
                          '18106','48543','71496','25363','36937',
                          '63295','17970','26450','54830')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
