
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '14351','14443','64746','47061','39108','28929',
                          '81617','79310','85041','22842','13440',
                          '12123','28543','12131','77884','81189',
                          '35035','47708','28110','59503','28854',
                          '56600','98118','65290','27820','28377',
                          '74474','54466','37787','85394','80203',
                          '73109','14154','12648','48674','16525',
                          '35392','72652','67063','61931','54570',
                          '89152','10014','34278','82705','56671',
                          '82643','16260','29929','61124','33139',
                          '84049','41872','38189','60433','96315',
                          '41255','15053','21475','94791','15285',
                          '86819','12176','63881','39604','75453',
                          '21140','12503','58599','31754','14156',
                          '60586','31426','42823','84519','74084',
                          '56283','11003','62184','49017','63557',
                          '93036','27883','15839','43490','25064',
                          '44381','61742','59589','16793','22416',
                          '34964','13125','71095','72389','11621',
                          '53850','73676','34644','79726','43461',
                          '30473','58773','78696','20286','98425',
                          '28123','98362','76622','12512','88203',
                          '25976','76310','42262','88377','34854',
                          '38709','20209','48315','44158','77653',
                          '77282','72213','61827','25510','21709',
                          '60336','82672','86883','26188','71108',
                          '63939','52627','99784','25021','52120',
                          '69629','25509','46044','43824','93390',
                          '82030','21988','42685','23255','11696',
                          '20047','41804','70014','33867','48543',
                          '37322','69189','15960','44646','58865',
                          '63883','12501','52818','55058','48000',
                          '51270','51798','61192','22035','97808',
                          '40675','63458','75094','54403','90873',
                          '97571','12224','81380','45171','58343',
                          '47291','73577','43916','33243','59207',
                          '47255','27943','11254','97248','80853',
                          '62844','52296','13317','55674','83319',
                          '53237','28758','23266','50927','88026',
                          '65011','70904','88666','33546','82021',
                          '73002','68997','82994','19718','31357',
                          '17060','18440','43487','69455','39968',
                          '60643','94228','59799','32355','71455',
                          '65548','73019','77213','57863','63509',
                          '60137','91690','38368','21269','16569',
                          '12366','52377','20032','49272','89801',
                          '33304','69605','62811','63058','29604',
                          '12872','10272','17292','82463','23304',
                          '36343','78180','55831','99376','36019',
                          '20565','71878','34355','74913','14026',
                          '60316','18548','47686','84841','92917',
                          '53714','28228','11844','41410','49246',
                          '53912','31566','48844','47386','19707',
                          '74869','52250','88177','49072','38559',
                          '99903','48193','29068','74244','66145',
                          '50138','36322','66575','58213','12166',
                          '48483','59973','36320','31155','59474',
                          '97934','72330','36777','90094','39678',
                          '57033','10993','51392','96246','51064',
                          '14799','93342','41510','33744','97281',
                          '40712','86954','55805','16831','57619',
                          '89126','70888','58335','95035','33804',
                          '69059','33941','39152','63138','14285',
                          '43443','68580','41996','75016','37528',
                          '55496','45309','57381','35669','83196',
                          '62556','95231','16714','20140','13118',
                          '73572','37083','79044','60360','34024',
                          '71659','73947','41802','39309','32988',
                          '80708','60531','50524','23386','46302',
                          '95045','72352','73603','14198','14795',
                          '68577','52488','79197','57685','74657',
                          '29405','76988','87610','42657','35766',
                          '24591','51239','71120','63915','45755',
                          '70905','37535','66900','39902','69013',
                          '60086','28699','89548','30214','46359',
                          '66894','52450','98937','73727','57870',
                          '24735','51278','36979','85381','88844',
                          '61050','12607','83185','71524','66970',
                          '40474','19750','83826','97346','26277',
                          '70680','75933','27238','33663')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
