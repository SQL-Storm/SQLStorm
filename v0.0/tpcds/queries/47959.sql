
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '39271','66770','17835','62256','77251','14858',
                          '65106','34751','41258','86908','52547',
                          '85366','34794','70290','70863','94279',
                          '18464','75706','13031','38078','15557',
                          '83338','67020','34912','29860','20017',
                          '71291','65914','33538','69405','36635',
                          '20617','45845','45415','37631','42927',
                          '68021','55253','44936','42796','96988',
                          '44099','66258','37012','80727','71375',
                          '34644','16658','77116','33471','14687',
                          '12649','14052','17868','26848','96451',
                          '91366','30225','61991','26168','24829',
                          '23840','86050','62776','32078','95779',
                          '10113','90440','63597','79603','14290',
                          '69979','27916','53735','78073','62473',
                          '20216','94303','64761','49302','17332',
                          '10772','18512','91803','75015','70952',
                          '69009','16044','18167','29759','67573',
                          '19958','97246','16244','10190','75813',
                          '83666','73244','41572','60459','30116',
                          '29001','33354','53697','12629','57744',
                          '60726','79526','12984','34708','18290',
                          '21841','26894','49480','56688','38340',
                          '23088','10698','32809','17176','17012',
                          '11209','96267','85529','32481','70076',
                          '88486','11330','13625','57166','64156',
                          '30276','70829','87464','37960','65272',
                          '55461','23440','24364','34513','59854',
                          '37199','16582','19899','64841','50644',
                          '71711','19752','42481','37709','32160',
                          '66851','12598','37488','75661','11882',
                          '48122','44035','98559','80234','10433',
                          '62909','61457','24452','36335','90070',
                          '59760','38123','20509','56596','48539',
                          '67712','59793','51501','63262','66381',
                          '77042','53991','61259','60433','69845',
                          '30605','18097','12146','27720','21825',
                          '98933','47355','67729','25777','32188',
                          '38272','80803','13684','34078','59729',
                          '21351','68549','39589','24135','55648',
                          '43266','73211','79638','37234','27633',
                          '26950','25450','54316','70212','65267',
                          '10862','26197','30063','92554','13485',
                          '24869','53178','30237','28826','88522',
                          '47350','47791','62940','35263','17288',
                          '48500','57578','17117','57164','23231',
                          '19245','80106','34389','61579','75664',
                          '42659','75693','23930','37036','68796',
                          '53146','21950','37172','12856','52224',
                          '34394','41748','27138','19006','23830',
                          '26606','28583','39816','88404','12415',
                          '91168','44679','78290','74151','88830',
                          '92138','47210','50831','45677','45912',
                          '11304','68133','13264','33614','77483',
                          '90171','24861','30561','28644','99509',
                          '27113','61535','89346','32319','35400',
                          '55551','63641','85285','82747','15502',
                          '49932','86001','58604','74973','95886',
                          '10536','21894','36533','50129','70275',
                          '57346','53529','56493','29928','74197',
                          '89077','85606','99306','58442','86475',
                          '58459','23068','77467','21049','56077',
                          '21930','40800','23212','36708','22922',
                          '26097','78661','54835','83830','63149',
                          '33652','85573','95300','26254','70837',
                          '18189','20484','91821','45794','21599',
                          '50932','81922','19218','91320','23906',
                          '16431','32507','55532','55522','78753',
                          '14781','50808','15836','67692','43801',
                          '75516','18350','71705','47177','17371',
                          '70868','27130','27950','69982','88364',
                          '36644','45201','88004','50506','91041',
                          '73610','13336','11487','16364','63691',
                          '53293','95920','48288','12888','30332',
                          '96550','88769','78993','49439','19361',
                          '35814','34760','59898','51329','11892',
                          '75934','39873','59850','12533','91596',
                          '57649','42902','58995','68381','24424',
                          '24224','73297','41481','84974','93497',
                          '33423','21777','69525','85879')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
