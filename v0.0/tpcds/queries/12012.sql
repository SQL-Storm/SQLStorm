
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '22310','18573','10908','10371','17396','47221',
                          '38845','14576','40627','60108','33289',
                          '57634','32138','63419','37707','71107',
                          '70686','23392','58026','74217','13179',
                          '16607','44220','29669','64383','59038',
                          '74645','18175','15619','13201','89531',
                          '34907','76432','76651','45810','18199',
                          '12334','75158','21930','14163','70947',
                          '46455','91750','19622','42506','14257',
                          '31084','99505','56727','45021','25080',
                          '75806','47049','21156','16199','12588',
                          '66930','65202','30274','71791','71548',
                          '45659','33305','36957','12878','39406',
                          '32838','90493','63977','87604','77742',
                          '30922','40276','29870','40992','54839',
                          '38747','75625','76163','21546','58666',
                          '61911','25138','40504','21490','80945',
                          '58810','18376','10366','22453','10845',
                          '38298','86681','48105','62819','39636',
                          '83266','83375','49892','29721','61472',
                          '28057','22401','16114','92363','14230',
                          '30644','52230','87441','23338','59940',
                          '15480','90997','15337','67256','77117',
                          '24537','73261','25196','75412','35699',
                          '41133','33680','56145','90780','77772',
                          '68879','20610','10779','23828','48582',
                          '46596','42712','42735','45430','44888',
                          '10246','86927','48979','42154','99955',
                          '28913','27505','66142','77304','26453',
                          '12777','78287','36107','81467','66244',
                          '92360','56300','92729','37694','26016',
                          '63103','88931','84914','59422','41809',
                          '40619','14710','65890','20854','20884',
                          '26020','43083','22753','85110','70218',
                          '79655','54251','11258','53593','59413',
                          '66004','17603','26391','73232','32742',
                          '87933','27028','11846','59558','32601',
                          '28646','29590','20973','48989','63937',
                          '39121','38110','34824','45821','77327',
                          '36598','77635','76421','29560','43584',
                          '84977','71762','69984','76940','29069',
                          '64199','24966','67507','58897','52397',
                          '28944','48670','99912','39020','17800',
                          '12660','81669','69552','52738','62689',
                          '21421','85461','52492','67692','26188',
                          '22354','83155','35524','96203','17395',
                          '51549','17555','20673','26832','32003',
                          '46093','42532','55268','21313','56889',
                          '15858','89085','68087','70555','42751',
                          '33242','71034','17442','78945','38081',
                          '59128','54107','66099','30759','32278',
                          '70788','16978','59135','22175','43908',
                          '24898','96230','96156','85168','16861',
                          '55487','62699','68692','88385','85881',
                          '60313','93230','24042','17658','93011',
                          '10991','45421','44957','33849','13778',
                          '77059','21355','86605','19595','63324',
                          '54875','70061','49173','68110','95321',
                          '61386','30639','98035','21550','42910',
                          '89371','70691','16979','66208','57297',
                          '97053','70666','33220','20637','17792',
                          '20893','44277','49586','41552','51492',
                          '28386','13192','76361','28722','40496',
                          '29063','89027','30869','33902','35318',
                          '87509','42149','36833','27399','24580',
                          '28858','73432','73399','38867','43111',
                          '11481','66067','50677','37357','19970',
                          '98085','10126','92470','32605','54127',
                          '25785','71931','47079','64606','90026',
                          '92394','26543','70332','20782','86273',
                          '19024','30761','41842','37029','89040',
                          '28711','18382','49978','82562','17098',
                          '99153','14217','77726','82899','99928',
                          '41288','44710','78565','87226','95387',
                          '51323','57704','86842','46721','14293',
                          '19363','15041','32434','96234','94340',
                          '73170','25208','25158','44988','94262',
                          '66216','37643','54891','35672','41200',
                          '52374','46858','14974','92142','77187',
                          '27564','11072','42794','68736')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
