
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '98222','35865','63032','20142','35420','41726',
                          '45748','42779','92156','80141','20817',
                          '11860','50897','45717','86430','45463',
                          '22653','87600','16926','66703','16968',
                          '26388','97500','46853','49139','55073',
                          '91931','17978','16812','36015','40076',
                          '72409','93839','28068','38172','25248',
                          '12108','66932','79013','37167','18363',
                          '64758','29649','78190','25954','68849',
                          '54890','61521','47062','14110','25029',
                          '45445','27867','36412','76514','48288',
                          '18971','41533','66340','15693','29250',
                          '21650','28475','92006','12611','71248',
                          '36457','49910','48887','98233','77985',
                          '50828','33905','28335','39173','40118',
                          '66580','50960','69371','95080','62249',
                          '33438','83597','51538','32320','78410',
                          '24445','13728','16367','10704','65852',
                          '45148','65568','99156','73749','23267',
                          '75096','21026','41892','25690','49036',
                          '92429','55742','93223','81748','87276',
                          '83961','22714','24525','47937','40592',
                          '68506','40283','15427','87024','22000',
                          '11034','18512','87320','94923','81687',
                          '17699','16543','57271','54840','57958',
                          '19405','54598','35404','42800','20175',
                          '20937','91813','35613','58173','23229',
                          '55845','46604','95685','15138','32383',
                          '72455','96810','45800','32229','27499',
                          '39865','46867','14811','47424','30748',
                          '33662','55311','17004','30256','53167',
                          '53809','18630','90788','73518','53405',
                          '54361','41290','75696','38432','27533',
                          '90080','77739','45137','68440','99304',
                          '13573','96158','82103','75747','19821',
                          '88016','47873','96279','75245','13650',
                          '55552','17677','24844','87387','35943',
                          '79103','68798','78341','75315','30345',
                          '92750','47710','31978','11218','19984',
                          '51224','42225','26701','35435','59031',
                          '71748','82747','51489','62729','11725',
                          '14673','25375','27176','52246','56382',
                          '59547','42651','49164','64560','85140',
                          '14054','91158','20527','68274','40153',
                          '32237','92217','73164','22397','34153',
                          '43695','20649','85431','71034','56412',
                          '25249','88922','45326','59474','25726',
                          '83656','11639','14119','90505','86334',
                          '72392','45141','83480','38342','41528',
                          '59230','74208','37866','10947','80380',
                          '21709','67600','46351','17722','19265',
                          '18714','83913','19448','78332','76783',
                          '18565','37151','22118','48250','15206',
                          '46583','86722','64915','26331','97075',
                          '75325','48029','19619','14020','49627',
                          '98489','42578','78222','18808','91509',
                          '28447','28807','49269','66531','26313',
                          '53722','87426','65336','93612','54159',
                          '95372','82786','15356','53558','14801',
                          '89506','49004','10350','95451','35376',
                          '20608','10462','81995','52139','73309',
                          '26899','64466','10381','20138','37402',
                          '39757','37633','35794','70896','68807',
                          '81252','42810','23022','60741','25723',
                          '25779','17875','32131','14987','84596',
                          '77694','19703','73925','44416','91820',
                          '82165','38410','69625','83897','50949',
                          '89117','30616','27105','58746','65938',
                          '70084','50797','45746','50158','62860',
                          '97845','12104','75710','20208','45380',
                          '12028','12382','52789','97397','27278',
                          '23610','31445','51322','93490','72794',
                          '61884','34099','43101','32791','22029',
                          '73987','86473','84021','66685','63801',
                          '84697','11289','70682','25785','92077',
                          '93206','26910','51788','32746','46523',
                          '68618','50101','15231','81609','43591',
                          '29729','93128','33398','25595','22923',
                          '27008','60769','26131','59691','97407',
                          '36418','86498','34724','19912')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
