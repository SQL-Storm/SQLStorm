
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '45940','25917','47134','56343','61015','21539',
                          '28524','40462','14340','89168','16798',
                          '29671','57827','38246','60028','12848',
                          '32870','15879','25886','11558','78087',
                          '25116','27838','55817','89996','68219',
                          '93356','74862','51412','70497','41793',
                          '85610','10493','41386','94341','24710',
                          '28995','58128','18374','14113','92120',
                          '37700','44974','17887','15369','74890',
                          '40723','53244','29303','48921','48194',
                          '75969','88463','20727','16407','66040',
                          '71356','93141','54699','62770','54669',
                          '31071','79238','57429','34194','42616',
                          '51826','40222','63950','10773','39444',
                          '84855','88444','25849','67327','28846',
                          '18484','27446','67259','97591','61612',
                          '71824','97421','74506','19736','21904',
                          '96479','49961','15828','48772','24676',
                          '28913','68797','84925','30650','15211',
                          '41219','50415','74740','13413','46150',
                          '13193','63530','61206','77969','87639',
                          '18399','54608','54827','54456','37019',
                          '87544','94184','82013','14518','61300',
                          '62337','45750','24125','28663','30174',
                          '39880','54182','49430','72000','70408',
                          '23065','32434','28765','97802','98630',
                          '38886','52686','26365','65008','74207',
                          '73721','97955','84378','17989','76191',
                          '40304','26735','52088','46694','80871',
                          '26377','34767','76493','61981','39018',
                          '27220','62288','83198','33693','87171',
                          '86129','29338','14920','11092','35974',
                          '75257','55345','74850','60751','22019',
                          '16731','93539','51455','11765','20624',
                          '17563','24540','12220','56231','28602',
                          '27867','18620','36370','11956','71879',
                          '28347','80148','13386','66014','19842',
                          '53896','92614','84825','33731','62966',
                          '81958','88475','33393','49608','98832',
                          '81244','69369','88599','15289','83946',
                          '76746','63314','14772','54042','33871',
                          '24780','92905','84840','11371','15328',
                          '37729','43942','25600','63253','10701',
                          '59260','62489','77273','54872','77860',
                          '84787','34501','30380','55993','42725',
                          '43795','98981','45316','31417','84275',
                          '54036','80290','98863','52675','24168',
                          '23503','93417','81729','18504','57679',
                          '63824','72622','99999','43049','20114',
                          '39722','36252','59212','50749','65351',
                          '85672','62470','69450','65534','95529',
                          '36674','30996','17878','25718','10845',
                          '95371','71844','27545','62642','32507',
                          '72118','19805','99257','74647','41741',
                          '50431','24471','43358','11889','50714',
                          '20924','46099','57738','29105','50923',
                          '40774','75546','15287','43036','42488',
                          '79878','76708','24691','50598','24503',
                          '62889','62566','33780','21366','97019',
                          '48107','81935','64226','10526','10985',
                          '18765','26375','24965','49533','30337',
                          '73066','45646','41700','61482','62011',
                          '34103','29279','24629','13415','41668',
                          '92940','41014','19939','52102','54133',
                          '50133','96363','83380','69727','12346',
                          '40126','13256','76811','57722','95705',
                          '78337','95445','36995','23583','42032',
                          '97521','73184','25310','46168','74794',
                          '46314','56421','97206','51960','12708',
                          '92893','84969','76542','56052','50111',
                          '45586','41748','81014','79186','33528',
                          '89132','47781','54988','76197','37047',
                          '13359','18719','14288','67924','16609',
                          '16189','49709','20209','13264','34993',
                          '31432','70372','87785','14607','39256',
                          '59687','75154','23312','37130','40370',
                          '49352','47068','47215','44504','25631',
                          '96084','64279','51842','32122','38329',
                          '91834','29959','26282','15769','65764',
                          '31206','96104','24479','26854')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
