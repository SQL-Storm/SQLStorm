
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '53821','96586','56400','10807','73955','61073',
                          '28686','29594','44396','10155','63341',
                          '50844','26372','21450','29381','91801',
                          '43040','78470','77401','70657','60338',
                          '66091','82796','20656','26288','32619',
                          '64404','74960','45885','27945','24747',
                          '93308','22815','82893','13482','44796',
                          '15428','88327','59404','58391','54614',
                          '93055','18003','22015','35792','17738',
                          '54712','29590','28578','83684','38560',
                          '64692','76953','71521','62343','80948',
                          '13566','99220','61523','59973','10534',
                          '16941','51104','69560','12328','28969',
                          '43831','65781','37873','65746','26665',
                          '45189','16811','54766','76526','65045',
                          '24780','76262','38816','51812','75245',
                          '82382','46423','15276','17417','38523',
                          '31646','23726','36961','91477','87098',
                          '13100','42426','60744','89568','14119',
                          '64573','36798','87355','85560','95049',
                          '54349','19439','50067','41626','43448',
                          '49427','83826','32615','54172','80284',
                          '79686','70152','94345','13160','15863',
                          '73725','75621','66633','76763','20823',
                          '27858','43276','46474','12057','17703',
                          '63262','44700','61883','29434','66353',
                          '89422','72714','34223','10595','74107',
                          '51071','81903','42866','96059','25907',
                          '90624','21192','24321','36978','77552',
                          '93027','41155','15797','81457','80234',
                          '45037','80053','75403','17700','37180',
                          '46576','20934','60780','27562','26070',
                          '27635','34488','24526','38413','47179',
                          '84475','70345','49103','39764','81061',
                          '86054','73518','24749','22930','37967',
                          '68633','95994','42239','70348','23430',
                          '29645','10983','25343','99454','79392',
                          '41869','39694','18424','28399','44887',
                          '34335','57277','25655','39720','75428',
                          '72268','73212','22182','19501','41579',
                          '48004','21012','84460','24841','12198',
                          '17162','13831','88215','83424','95756',
                          '38105','91235','88732','88936','20035',
                          '77056','13715','88954','75121','72121',
                          '38602','33734','79260','75546','10004',
                          '44930','74721','62969','85783','56953',
                          '51465','13443','32536','13262','75188',
                          '53854','12416','20372','44469','41834',
                          '72088','26363','15454','83998','40082',
                          '33303','38169','23531','37968','60691',
                          '15466','16283','13393','92650','16244',
                          '50593','40270','79510','21889','59555',
                          '26061','39799','35056','26191','34323',
                          '63363','30382','80106','75384','73719',
                          '17519','24691','40602','49760','62740',
                          '25123','68194','59379','28648','32784',
                          '49864','37671','29023','91646','13473',
                          '91333','67636','10526','27071','15028',
                          '73163','88993','50555','35798','60756',
                          '36821','54271','23501','24541','81033',
                          '15210','88053','11371','82995','64671',
                          '44370','40334','63343','96508','58859',
                          '84326','11311','35115','48838','71441',
                          '52660','29297','66213','68684','78734',
                          '22261','38328','19463','38274','13409',
                          '39240','23048','23894','31748','43895',
                          '56066','96020','24428','16684','78081',
                          '53980','29150','14220','32222','76659',
                          '31335','17357','24335','81171','11013',
                          '35861','11566','58628','40713','36441',
                          '45080','57553','66751','12531','71792',
                          '22228','40740','35218','40427','25051',
                          '16262','19914','36243','35520','46693',
                          '34979','82209','76743','39077','13139',
                          '28049','48356','20875','76829','63340',
                          '15818','83460','52964','88744','37647',
                          '64835','53291','62476','89995','71037',
                          '18350','95270','95340','77680','10265',
                          '20235','95788','98230','18614','68123',
                          '78590','38984','48862','32394')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
