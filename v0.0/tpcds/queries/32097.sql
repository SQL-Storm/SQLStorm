
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '73116','17424','35445','18073','61956','33355',
                          '33280','91042','19006','40918','62926',
                          '15628','96742','68261','94472','23649',
                          '37343','47828','24268','21107','37795',
                          '61138','96042','36130','20603','53993',
                          '17584','60553','38947','39916','84787',
                          '29718','21974','47148','36399','33703',
                          '30390','31320','11423','98237','13482',
                          '27800','35864','59399','52337','10701',
                          '84228','59251','67651','11208','60800',
                          '58635','12578','59355','58878','11777',
                          '39694','52148','39365','46165','95119',
                          '22481','23647','49766','49884','22505',
                          '76900','21201','78038','23640','38526',
                          '67908','40634','89355','47568','99394',
                          '40048','13523','65846','48721','92833',
                          '84955','64792','54545','75466','46807',
                          '39712','98025','10583','41078','39754',
                          '34520','94894','46042','29218','63263',
                          '54450','50554','50289','76067','30657',
                          '53810','28886','12026','75928','53594',
                          '16058','51241','35070','84743','31648',
                          '20382','71755','79995','90466','57149',
                          '31722','11645','20521','77047','31235',
                          '41771','23698','57162','19647','56216',
                          '29715','14950','72830','15977','32800',
                          '78615','48265','69014','43503','39440',
                          '99491','74413','30832','67860','11996',
                          '73745','73786','75895','51636','73399',
                          '52221','30385','37706','32710','37817',
                          '53713','10477','64626','21559','63100',
                          '66677','72852','25888','90261','46093',
                          '69037','99611','10483','80564','75179',
                          '48053','67340','12691','62898','68254',
                          '39297','49960','40658','76444','64881',
                          '61267','25301','79318','50940','18278',
                          '38741','65012','87627','11274','42995',
                          '30678','39715','45659','95395','83149',
                          '35824','65866','53574','39773','65067',
                          '46691','46811','19772','64276','29649',
                          '89469','81306','84191','44858','86361',
                          '20969','61532','24661','63156','80751',
                          '46273','55236','28498','22240','97365',
                          '37988','80369','22231','65008','11742',
                          '95860','71816','12210','62739','45581',
                          '88893','80843','38476','42579','57306',
                          '81525','71895','63430','73185','24022',
                          '87666','71711','49673','51128','22573',
                          '10443','45180','35440','95772','33099',
                          '11977','89310','55921','88280','51511',
                          '82853','45433','26769','22421','67285',
                          '99011','71591','98380','25171','49857',
                          '78923','27350','37339','63057','90412',
                          '54003','64086','78628','48338','90641',
                          '20011','37022','24912','44556','17813',
                          '57581','21058','25923','15147','83445',
                          '83236','72396','79102','96269','35078',
                          '93464','30494','13663','63220','98599',
                          '85337','93956','30423','84633','53398',
                          '15690','13748','84744','12004','68506',
                          '52966','22727','63786','28582','71815',
                          '49491','81949','27620','52133','98341',
                          '18925','14275','96961','11806','60622',
                          '36696','78306','15825','59645','47513',
                          '96689','72082','13720','10846','33560',
                          '37599','28187','63064','88576','42753',
                          '12413','39385','97645','91421','64373',
                          '39015','81532','90723','10071','27781',
                          '66590','51075','74613','83296','44956',
                          '44998','36819','56417','36834','22180',
                          '25542','72966','38366','43730','10789',
                          '24939','14193','39388','38746','65779',
                          '25837','25325','11079','33584','55030',
                          '50701','81029','27051','29398','78187',
                          '45962','37016','14127','19978','18821',
                          '38213','75677','83210','35749','45115',
                          '36014','70041','44952','17185','73944',
                          '64483','26447','26433','28053','26650',
                          '40045','22572','49027','18995','21066',
                          '68530','64797','16217','88647')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
