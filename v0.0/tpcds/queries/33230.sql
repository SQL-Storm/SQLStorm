
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '29557','22909','25198','50055','19049','22462',
                          '54663','10785','12329','11661','13025',
                          '64476','37145','16331','23224','42551',
                          '84411','95268','77696','79067','27580',
                          '48959','52072','10801','40486','35932',
                          '27147','37697','47773','46797','63168',
                          '18609','23733','78515','36177','22971',
                          '68325','24861','66581','46569','91117',
                          '41884','86740','32713','31176','13834',
                          '80414','15428','18135','58873','25758',
                          '30269','61427','22529','17954','60895',
                          '10449','50385','15896','26237','50492',
                          '87278','41998','22311','24545','77016',
                          '10457','88128','31902','69372','56238',
                          '42709','54717','16175','50170','63946',
                          '18912','72638','12352','42476','50230',
                          '74292','43657','93887','75361','35264',
                          '36530','27447','77650','14464','30926',
                          '92712','71030','44324','23908','36746',
                          '27376','37666','98408','31801','39947',
                          '10809','20651','61598','58937','15228',
                          '66143','75496','30132','33861','50472',
                          '96490','31732','26119','74996','50336',
                          '64823','59013','52142','92381','23759',
                          '39965','26117','53714','45449','14291',
                          '81831','11376','85118','77533','29063',
                          '85482','12432','38169','56352','27399',
                          '79783','58831','83545','21734','54969',
                          '38998','33407','65385','74817','37819',
                          '24843','25465','47504','29920','55425',
                          '22348','93713','31183','77836','56164',
                          '90337','28877','79598','10008','73391',
                          '56045','98449','60501','29715','65955',
                          '59326','12941','21495','16425','17336',
                          '82167','75043','26804','28350','91610',
                          '69492','79064','49875','87865','39764',
                          '89231','52683','96872','98889','29894',
                          '40390','52725','93725','56141','27518',
                          '19726','91317','26598','40650','81885',
                          '56033','48135','86492','66685','25661',
                          '84988','97693','97636','67252','98426',
                          '17614','62563','66572','27714','80865',
                          '43908','38660','32841','78073','14673',
                          '84659','68641','88284','62234','77655',
                          '42414','36999','31910','83340','83086',
                          '17597','15070','90706','31061','54744',
                          '57303','12991','40677','40049','14249',
                          '64047','42372','85564','56680','34555',
                          '67831','14257','85874','38326','87255',
                          '35186','40761','84322','68584','87354',
                          '62907','81206','54560','19577','78494',
                          '78575','89862','26118','75854','62695',
                          '46050','76438','27159','51809','66805',
                          '65827','88997','71168','32297','49969',
                          '33263','78808','13090','30386','20318',
                          '76685','48454','26766','27593','38754',
                          '12745','20673','50680','68737','20547',
                          '14052','44770','38068','44088','35253',
                          '38676','60053','54592','77555','18409',
                          '21750','50673','67581','85607','42973',
                          '76031','46625','17265','88009','23806',
                          '70760','62238','62986','29999','88337',
                          '45843','96023','45905','14546','20777',
                          '73010','65928','83771','24122','52757',
                          '46139','56031','14125','80778','24430',
                          '22095','96218','92538','28993','21350',
                          '40782','36608','35056','45097','20316',
                          '27142','46009','51661','91424','82872',
                          '22534','33789','47667','55471','14634',
                          '20802','70201','19593','27644','27006',
                          '42125','84320','48464','48463','16267',
                          '28486','30772','21116','45572','56834',
                          '21117','30907','41216','82122','20054',
                          '90818','16790','58042','24093','33946',
                          '99689','33016','82720','55779','33411',
                          '42630','28232','30816','94719','51937',
                          '20680','70585','26252','59295','17376',
                          '89664','53865','48257','79857','50510',
                          '69149','33932','50719','20023','14799',
                          '94202','14866','22317','39625')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
