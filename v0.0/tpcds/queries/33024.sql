
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '95790','12209','74264','76933','22152','18062',
                          '61691','40544','31264','70252','63007',
                          '52672','24687','25390','19472','79405',
                          '17428','75573','16027','31057','35037',
                          '42414','59108','97632','43032','83188',
                          '49256','54001','20736','46818','40769',
                          '72418','81980','14789','99734','31046',
                          '76554','87281','65078','61557','16078',
                          '68359','43694','76076','80274','83677',
                          '62249','46442','47485','33216','96025',
                          '97846','82131','15664','90247','52542',
                          '35554','26294','63477','50514','12545',
                          '54925','46672','35923','41451','45174',
                          '29139','73611','59927','43398','14241',
                          '60421','47664','34009','81581','39250',
                          '85986','79883','73495','47108','62418',
                          '43956','36289','12520','71475','15188',
                          '80302','40757','10384','49867','95885',
                          '19573','48227','45937','62740','43555',
                          '16926','35227','50453','23013','96239',
                          '17648','27079','16293','72332','26689',
                          '22323','29285','59749','23539','65089',
                          '36382','74286','33091','28748','18538',
                          '42600','64538','30079','34003','11457',
                          '72030','12523','19703','63494','35313',
                          '27321','49777','66712','37223','28132',
                          '71613','49148','35714','57982','75771',
                          '29655','15507','46691','48994','81095',
                          '22170','24385','72455','12430','17663',
                          '97162','46876','95037','44813','23201',
                          '91636','58713','54241','20764','16993',
                          '48775','88586','18551','11960','33324',
                          '20408','46114','44342','83299','75747',
                          '31657','91876','74330','22699','11413',
                          '89581','19317','20427','17529','77055',
                          '79687','19091','12571','88697','54812',
                          '57411','63685','64019','87708','67718',
                          '57343','52321','58387','72564','99816',
                          '33943','20145','37307','23860','34601',
                          '22022','31047','22978','15280','49275',
                          '14532','15723','13614','18271','43747',
                          '27612','37052','56824','97098','65810',
                          '24125','83611','96851','32007','30746',
                          '97373','89615','82016','39643','92041',
                          '42779','89512','62197','57838','61754',
                          '73007','68785','11347','16142','75332',
                          '71924','18457','13163','35970','54015',
                          '26326','90406','98969','79804','70905',
                          '19140','18440','86139','19762','88478',
                          '91468','17525','27058','96219','96109',
                          '45661','95782','97973','18535','48531',
                          '96181','88517','96124','57302','48653',
                          '20946','19446','38549','61305','25377',
                          '36244','69233','37206','72947','69812',
                          '42655','63822','32590','32018','68579',
                          '13320','12732','20454','57385','33655',
                          '11632','15930','65287','69783','14176',
                          '39598','67424','85302','26725','21478',
                          '82917','20273','35382','44382','81332',
                          '35393','32231','10185','56400','10865',
                          '23351','10785','26488','45047','12761',
                          '42110','48992','83491','46749','49577',
                          '44804','36248','91233','33049','65486',
                          '99333','54369','22068','68320','48830',
                          '48535','14202','30142','29113','26950',
                          '22584','22821','42407','59165','27143',
                          '43708','91628','43007','28645','19567',
                          '31037','75029','39413','32743','56557',
                          '48921','79747','23841','23827','73685',
                          '98113','86553','54080','29325','70602',
                          '88708','27552','65898','10553','89180',
                          '75979','23874','12174','32685','39805',
                          '29241','10405','62938','42971','57715',
                          '97283','55307','55206','10225','55774',
                          '39759','68267','87354','45334','10809',
                          '56363','11794','13011','13887','32283',
                          '22804','15960','65459','92046','51629',
                          '56775','60862','30879','89934','16746',
                          '76258','81006','58249','56124','88368',
                          '78329','67832','73023','94802')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
