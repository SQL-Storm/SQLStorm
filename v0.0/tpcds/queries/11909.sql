
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12421','60340','13074','10624','40820','34865',
                          '70472','36896','59100','48357','68785',
                          '48436','31459','40916','38285','45175',
                          '79018','31343','27922','21181','55786',
                          '53208','16701','85090','83836','16192',
                          '77967','25348','49046','98650','72435',
                          '92019','64000','43761','13048','76746',
                          '13177','52302','39864','36173','50436',
                          '21711','15829','85836','76726','32334',
                          '78743','56974','74979','52909','73039',
                          '70093','54347','72779','98532','16840',
                          '32062','36030','36870','84731','19617',
                          '49868','42557','89943','81668','81188',
                          '16020','75354','67760','57719','80077',
                          '26357','38911','62894','85990','62957',
                          '99226','72703','46904','64388','35047',
                          '45511','82836','29174','18444','76592',
                          '37295','88549','39625','31521','28971',
                          '67305','43345','32094','38723','66361',
                          '27393','37007','73155','61088','90887',
                          '40871','35416','84600','31200','10933',
                          '49842','75164','27844','52862','18572',
                          '67013','54771','36973','25228','43937',
                          '75800','24073','84134','96871','38435',
                          '55428','68102','21766','99800','60308',
                          '65594','33916','97289','26069','42205',
                          '42073','68230','43035','21458','24074',
                          '23205','65265','42709','36103','76797',
                          '75044','33350','87655','34514','28825',
                          '42681','57895','43178','14025','33931',
                          '38450','56671','14087','10527','21371',
                          '69014','20104','69905','39049','29326',
                          '44484','13275','54634','93495','44306',
                          '76601','11341','53384','94514','61353',
                          '85198','67701','84657','13064','43701',
                          '41723','59537','94741','59673','61472',
                          '45853','56766','27016','27877','11995',
                          '81990','66475','16729','24103','65896',
                          '54130','61317','24478','26092','11818',
                          '29207','31228','95702','64952','95769',
                          '48356','13754','11769','27871','60165',
                          '79704','11285','74605','40667','38585',
                          '94903','99554','41787','10204','33944',
                          '75058','72180','18904','44970','63376',
                          '27846','49223','27707','99941','39662',
                          '90996','84646','35107','34345','37779',
                          '18513','34323','15254','53436','53991',
                          '78690','16256','13893','21016','71348',
                          '37313','78986','15668','20959','85186',
                          '59523','70913','97472','58340','91859',
                          '27987','45227','81052','33698','13718',
                          '27782','74685','29391','11066','34646',
                          '62291','51896','90556','77582','45201',
                          '58046','98864','54645','79521','31310',
                          '98142','49374','38816','66663','27236',
                          '60881','48300','34733','94581','65791',
                          '49587','20277','84629','76358','21028',
                          '67890','78566','87343','61688','13728',
                          '27070','19386','79918','27088','74766',
                          '41127','66341','93826','41981','30193',
                          '17188','28962','51859','26302','13556',
                          '51391','44042','66922','78809','76959',
                          '36703','50857','50632','75424','21594',
                          '78913','48496','94547','64838','38812',
                          '52434','30459','33076','12217','25840',
                          '74874','21737','12367','83321','12270',
                          '76671','54321','21628','40872','86266',
                          '74381','29229','71887','64920','84129',
                          '91335','64461','13737','20740','36359',
                          '43774','85098','34219','32207','56698',
                          '76226','53013','68239','57938','29921',
                          '73085','40063','72385','61667','34250',
                          '39477','49276','50601','88994','17132',
                          '82953','37074','48403','46795','53636',
                          '39070','60674','12226','31647','75084',
                          '94166','85419','58967','29301','35014',
                          '38621','98740','76857','20689','61562',
                          '43776','78588','14258','43887','69301',
                          '11682','50200','46218','48064','65174',
                          '53454','13647','25955','16287')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
