
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '76112','44968','43951','48376','50332','43127',
                          '92446','16270','38732','58209','87679',
                          '65846','39879','93436','80617','57761',
                          '40852','59713','10915','80257','91688',
                          '11487','11701','69716','75769','82820',
                          '73713','81328','39909','69732','35733',
                          '22967','73960','72124','58566','42705',
                          '73943','53818','10900','46732','59352',
                          '21642','65057','27429','92044','43717',
                          '25681','88448','21995','56730','85894',
                          '51372','55254','68918','23922','28474',
                          '32586','74912','56658','21992','38270',
                          '72610','32770','28962','99911','66092',
                          '12672','74611','27951','38884','25449',
                          '81902','41129','27059','44607','17095',
                          '40127','87882','26550','78479','22119',
                          '84871','89821','79776','36001','64242',
                          '78268','44917','56544','58602','16788',
                          '92228','90812','10925','36567','63586',
                          '52979','96454','15543','56292','75841',
                          '17075','22891','15689','19280','22491',
                          '48841','50712','88434','61274','46361',
                          '74647','58420','86185','11477','30593',
                          '78755','71819','83531','91552','13411',
                          '59941','65809','68322','69872','12602',
                          '43578','81410','26171','76829','60739',
                          '28310','12449','78449','30252','59353',
                          '14778','27863','84715','84616','66412',
                          '27875','73155','64274','90846','88862',
                          '18239','54268','54424','96927','27193',
                          '64296','97490','75326','83439','16639',
                          '32660','60474','44873','81706','85600',
                          '80274','14702','51224','95143','39325',
                          '67448','78855','69214','65798','35046',
                          '81392','26539','77145','61574','28535',
                          '61485','72756','24967','48476','51298',
                          '92669','14104','63209','45526','90651',
                          '62609','45735','82326','22261','25222',
                          '31870','94650','14152','99576','59470',
                          '40473','62181','60440','32485','69866',
                          '81472','73384','25255','14726','14452',
                          '11826','83127','45595','30074','91508',
                          '23252','45819','81788','75253','47833',
                          '32432','32996','12483','17105','61255',
                          '22165','26783','25655','79501','31039',
                          '29023','41840','36574','73589','43299',
                          '21053','81573','62351','61237','23080',
                          '86275','75409','41858','93460','87565',
                          '11549','44577','80171','63174','32955',
                          '86463','17412','77586','20693','24813',
                          '40754','45749','15164','16954','15535',
                          '78705','18383','13431','54331','99232',
                          '48656','13049','51978','14579','21603',
                          '46909','49420','88884','85309','14670',
                          '14580','41507','25771','73647','71259',
                          '29138','56293','89307','76674','39357',
                          '18173','98892','58882','69727','34109',
                          '15889','59377','56628','34297','91762',
                          '27382','16200','43577','33562','87860',
                          '85103','69565','55097','87222','64962',
                          '88343','16875','15132','99985','69819',
                          '35156','54751','52532','18128','69922',
                          '69022','17351','12154','89687','13855',
                          '88826','83645','66992','13762','39214',
                          '62879','36003','44362','34116','88439',
                          '62347','22788','45262','19003','41299',
                          '99296','14006','16158','46227','31834',
                          '14762','75335','25576','46750','26664',
                          '27636','13776','62191','41981','19057',
                          '68006','80379','45690','56335','25399',
                          '17236','23208','33420','23347','16317',
                          '44653','78902','91299','93646','39585',
                          '32730','51598','31016','73246','65898',
                          '16338','49672','35753','17854','39151',
                          '42711','47868','84372','36295','89893',
                          '92760','94302','51844','62651','53484',
                          '12731','67893','13814','46447','44887',
                          '90900','44185','63388','34523','26598',
                          '45463','72025','18569','90369','59621',
                          '22364','26288','71888','44092')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
