
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '56493','38346','84880','37161','46990','22057',
                          '24450','30747','91261','76891','64958',
                          '40392','35747','18496','45370','51533',
                          '56720','87944','17144','32463','89748',
                          '15179','88367','36996','30089','81789',
                          '66061','87403','23289','38349','41427',
                          '68515','51592','22782','96536','66312',
                          '43217','21702','75821','63399','83480',
                          '18586','12338','27358','94274','31460',
                          '57730','42529','58307','86987','88151',
                          '25257','90032','19957','26046','95145',
                          '91432','42674','72932','72787','10463',
                          '57548','71558','22550','56507','94885',
                          '62933','90636','86516','10832','46456',
                          '92827','67533','25724','48647','91289',
                          '59126','71875','93882','26355','20405',
                          '57951','63159','26461','12675','69726',
                          '36002','13347','48912','54565','28115',
                          '20953','97334','14983','25365','52604',
                          '23671','71201','47869','29511','41074',
                          '25852','13706','60765','58749','63394',
                          '31357','39551','47122','43584','67159',
                          '47997','20651','46194','87244','92334',
                          '33596','10212','97632','23574','89694',
                          '86208','22373','86016','61773','39824',
                          '23565','21509','74777','17537','38332',
                          '37510','26075','38467','17700','82725',
                          '70397','28223','58552','46804','19945',
                          '56519','69170','14394','71228','63352',
                          '43826','49365','56531','62544','92725',
                          '39706','30872','70354','20728','40886',
                          '79784','41462','90282','25162','66481',
                          '47936','44772','60461','13111','42095',
                          '40130','53704','86703','11243','71946',
                          '39612','26259','92903','11224','99354',
                          '27784','70948','93096','35856','80427',
                          '96163','70711','30936','93665','15758',
                          '53224','90587','88555','68877','17044',
                          '51712','91108','56165','40643','94243',
                          '45936','17835','44890','25055','87219',
                          '50462','31929','48669','42306','86602',
                          '96239','35018','13912','69325','25140',
                          '58828','26885','23654','81329','13917',
                          '38609','28064','22148','52056','39732',
                          '38825','79029','38156','82848','23081',
                          '29336','42027','22741','83224','92135',
                          '78945','46248','69861','32652','55011',
                          '62293','87380','91692','90792','79902',
                          '30827','57437','58028','41273','37512',
                          '68684','64879','71983','33559','63138',
                          '23537','25639','12511','96542','22915',
                          '27641','37850','27156','17723','99452',
                          '30012','25830','80535','14392','15289',
                          '66152','42919','20152','59281','30868',
                          '13750','33438','34405','64286','26708',
                          '66863','39406','20539','61520','25294',
                          '67518','45586','45373','62897','65279',
                          '19919','48670','47895','99619','56911',
                          '36824','26762','96806','29723','66826',
                          '19397','33925','19326','90677','26947',
                          '32704','23897','51596','83596','61418',
                          '53532','98712','29864','71743','54447',
                          '10096','71471','80929','85430','34245',
                          '97068','68094','42727','75455','65522',
                          '74860','84323','71767','76802','12327',
                          '38732','56719','39018','28073','51882',
                          '53317','28899','19886','49105','96378',
                          '40832','42561','84745','14396','75197',
                          '91352','86590','52401','27575','21199',
                          '89561','96833','43554','24680','17719',
                          '41975','73300','66356','44796','50985',
                          '11502','28241','60980','29747','19573',
                          '61398','96231','17858','62503','41410',
                          '32118','66942','11397','45406','41846',
                          '44081','68998','23120','47664','16289',
                          '78526','91531','53122','13682','19822',
                          '56744','46539','63894','91923','90269',
                          '11738','72137','60867','29720','60877',
                          '68039','63254','24619','31684','40702',
                          '48203','62674','61272','65287')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
