
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '38790','81082','44890','98281','36193','71158',
                          '67685','15171','71758','89671','84160',
                          '58493','52422','67562','14130','62504',
                          '41116','36025','21388','89988','15012',
                          '67688','66466','28859','82660','34344',
                          '49131','20708','34507','20806','81442',
                          '57724','58262','56535','31597','50192',
                          '65710','39595','71055','31865','52408',
                          '60235','12252','90744','28563','20636',
                          '10565','99868','52783','20762','33562',
                          '20918','28461','98219','73209','79607',
                          '23424','59839','23558','79198','82087',
                          '59383','38899','59477','83699','17863',
                          '68452','18832','34770','88709','64096',
                          '57128','28814','58777','55544','29905',
                          '55391','89554','22108','85422','22246',
                          '27488','32624','77921','29355','20589',
                          '23212','78587','26346','39560','50554',
                          '13593','94698','85260','18733','62412',
                          '89364','96647','17526','39322','63544',
                          '31642','47381','11148','29896','21845',
                          '22728','36539','88375','24137','29339',
                          '19213','16657','45008','59292','32813',
                          '55406','10919','17141','55369','82653',
                          '82097','22617','38121','74207','86762',
                          '78454','92474','77000','83444','88208',
                          '12867','67703','52950','68035','96863',
                          '69799','56792','20239','33341','35274',
                          '31794','57729','88714','86317','88720',
                          '27466','65832','79910','60756','67281',
                          '19628','36914','18818','75414','51119',
                          '83796','67516','68868','60785','21087',
                          '43578','14359','43503','28405','64944',
                          '63124','15529','84670','16068','21897',
                          '45978','39455','21079','59659','87336',
                          '26091','35898','61462','76000','68193',
                          '14272','28616','21149','86234','93736',
                          '34105','30961','37749','56593','68990',
                          '45590','25657','46871','39601','38685',
                          '35616','24479','31701','84996','67212',
                          '99196','66181','16751','17640','35931',
                          '29705','98172','28891','90280','19618',
                          '54277','50628','15664','35956','49400',
                          '95962','82007','31144','96970','80115',
                          '11449','74839','71264','50065','44425',
                          '58846','47555','65155','30178','34047',
                          '15110','58665','94787','37559','48056',
                          '99329','13752','39544','46042','89155',
                          '80179','95123','58085','13410','20525',
                          '42885','78690','28843','28146','24100',
                          '38058','45222','78249','76249','12424',
                          '46592','29605','14742','28903','29107',
                          '22355','19401','11691','67713','43091',
                          '40353','44329','65415','95344','95293',
                          '86099','34126','83294','87903','34124',
                          '76581','27993','85267','13658','19875',
                          '55977','57468','10503','64937','26945',
                          '44174','50161','52650','28653','38904',
                          '38008','74550','27727','71994','16609',
                          '61681','10714','97717','29912','54324',
                          '92666','54804','35742','46313','25560',
                          '62597','58738','41745','84521','63730',
                          '86368','25027','75744','93420','93209',
                          '36700','55101','18928','62195','86230',
                          '32092','32876','24285','31813','20278',
                          '29569','69919','58607','97842','91133',
                          '61326','72211','74419','17753','37444',
                          '46498','15503','53468','13170','53176',
                          '10445','46486','33399','96760','17509',
                          '64231','42326','36839','40335','44490',
                          '70553','42593','58054','45224','94968',
                          '65983','23173','25484','59425','63571',
                          '70453','68626','79811','92688','60237',
                          '21627','47054','31485','85121','48365',
                          '37023','90543','15034','62556','75965',
                          '82167','11601','18256','24188','30313',
                          '82089','69369','78749','90474','52470',
                          '20758','44917','58148','76947','63722',
                          '18156','34036','39014','27137','26571',
                          '34571','51482','13790','18053')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
