
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '56574','72408','70975','25871','42334','15886',
                          '69314','86840','20605','32802','90637',
                          '35109','32230','54206','17789','23739',
                          '87082','84976','14834','26509','38584',
                          '24381','41230','86878','75876','74480',
                          '98699','65144','24261','90010','48307',
                          '22095','79489','21438','77494','69645',
                          '85789','57082','56619','98834','84279',
                          '13048','20979','54247','50282','30906',
                          '84815','79339','35277','19520','45229',
                          '36780','12228','67131','25844','13666',
                          '10177','16668','68723','20775','17868',
                          '23274','21782','53518','37420','32269',
                          '82661','33936','94569','25007','50548',
                          '85338','56155','45640','14003','18803',
                          '48795','58508','56031','91982','89422',
                          '39050','67892','25212','89566','20021',
                          '35957','26537','16534','56979','27110',
                          '76522','54428','61535','46058','93406',
                          '13779','68340','50017','26633','73862',
                          '18958','41323','41450','28332','12658',
                          '34189','17068','32669','85853','19379',
                          '56261','36010','92984','98150','71079',
                          '68084','75574','95805','31851','97459',
                          '10622','52805','46721','28779','40520',
                          '40319','23603','72000','39002','14170',
                          '99964','33619','34077','48691','93202',
                          '16845','10876','19043','62154','12060',
                          '80397','10163','69492','23845','50043',
                          '22121','35328','50908','21641','66515',
                          '68605','36605','33460','77713','87893',
                          '54219','70353','54800','45010','50081',
                          '24253','54431','80724','55048','92000',
                          '62378','90301','86588','32872','14136',
                          '69963','77266','69516','57634','24733',
                          '18442','98067','64290','27460','72302',
                          '61920','47198','59296','23589','89176',
                          '46252','72779','36329','35285','40499',
                          '23090','85978','11930','81898','21955',
                          '23288','19189','31629','44734','28412',
                          '62949','77405','95200','66745','73101',
                          '77097','71164','77218','68126','25041',
                          '36361','52456','26726','55695','20837',
                          '17256','93037','11054','35893','26763',
                          '70708','23074','11363','38170','35180',
                          '36668','51585','73829','17604','68058',
                          '41222','21015','69596','50952','74871',
                          '53099','61935','15172','50438','30821',
                          '94173','74004','11126','92416','19839',
                          '13294','15349','40912','59990','15317',
                          '84809','26418','44061','18023','25787',
                          '38350','66226','28139','61131','30080',
                          '35306','19763','24631','81179','91972',
                          '40695','17115','34255','23482','30598',
                          '36416','14806','62059','25017','95289',
                          '45961','69888','24311','23413','77391',
                          '89521','15923','40173','83976','77509',
                          '12973','73469','24945','42009','61048',
                          '86517','41023','13464','49619','22792',
                          '26548','18003','92096','13221','46606',
                          '83930','30360','33724','92430','25492',
                          '62276','76314','47210','35235','23946',
                          '42285','27631','19518','70033','75813',
                          '34953','89937','73459','46674','44636',
                          '11884','94169','21494','49624','12729',
                          '57486','64130','67096','70412','18402',
                          '12879','14523','88576','20385','44339',
                          '30013','55114','15397','17936','70906',
                          '49187','58940','62084','47303','55361',
                          '28181','69956','76010','40389','89659',
                          '82453','38023','24920','55866','66077',
                          '38839','76625','56506','82060','24897',
                          '12008','82170','71027','52389','25976',
                          '31731','97940','20335','60347','19275',
                          '54790','98043','18704','10624','35308',
                          '84615','52323','66439','15305','48933',
                          '87298','61223','58703','51028','31918',
                          '16935','65099','90601','27608','23832',
                          '98263','58004','16875','22439','49465',
                          '73518','65929','32536','69640')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
