
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12275','10960','55254','44182','55037','30911',
                          '23267','14926','58589','44028','11346',
                          '58038','57242','50805','57707','91005',
                          '30946','97314','36693','72451','44462',
                          '90350','40547','40336','46824','63432',
                          '16434','58651','19458','49094','57896',
                          '19674','66428','23378','30436','57293',
                          '60668','83708','11949','95200','23919',
                          '20477','56912','62192','48988','21714',
                          '62127','93024','23405','75134','81809',
                          '34147','27552','62612','45514','29302',
                          '24454','59407','11202','89280','21100',
                          '40029','78746','40597','22239','27527',
                          '52366','42752','85266','88294','73291',
                          '90826','23615','51076','76163','64383',
                          '93698','79853','72489','64963','39046',
                          '56697','71731','91631','10903','47873',
                          '93773','29788','19210','35009','78052',
                          '38693','65811','44716','70988','20266',
                          '74485','73226','11784','45483','98902',
                          '86182','67996','69366','80406','30159',
                          '73850','67221','18258','43233','43768',
                          '48538','59694','76095','17704','38239',
                          '33831','37366','22189','29871','18716',
                          '98681','91977','16358','16002','48016',
                          '70475','33237','89589','26953','41804',
                          '10465','73707','93772','78347','27475',
                          '76220','78383','28645','48859','60753',
                          '46902','60722','21754','90658','35563',
                          '60120','86920','80560','79719','61104',
                          '29487','77980','14555','44111','23957',
                          '74610','55195','85386','67508','32269',
                          '18483','28937','31480','80443','12796',
                          '23722','42776','11653','65231','56553',
                          '99948','77007','36220','89448','12497',
                          '90069','17598','72413','67193','11349',
                          '33143','61098','35317','48476','39148',
                          '86111','19526','47437','39058','30166',
                          '58234','62884','47212','92855','30164',
                          '18709','28837','72728','33620','65226',
                          '63295','31357','39528','90014','37395',
                          '48230','76393','80754','64976','71958',
                          '31712','35334','73650','50037','84484',
                          '50184','29636','17130','57813','32349',
                          '56347','33041','34777','29740','55217',
                          '71341','58572','92058','20690','44249',
                          '27328','16671','30361','68861','71354',
                          '47039','19891','37886','46219','25416',
                          '78895','47027','19558','19451','33714',
                          '41606','37180','23008','59085','75208',
                          '39653','13535','41732','79890','19162',
                          '17988','77035','34606','62872','63451',
                          '94668','39386','80384','28276','20926',
                          '30645','42216','56120','54426','79512',
                          '27447','47450','11882','60157','29061',
                          '40907','38279','38534','13296','92944',
                          '37684','82646','18456','48766','10874',
                          '51046','26449','43722','16952','24824',
                          '55834','17929','34389','61911','47939',
                          '43384','66563','80498','17851','17926',
                          '37455','71383','97645','17483','20882',
                          '17866','43979','35812','68271','17066',
                          '77045','63940','66352','76127','30493',
                          '18158','73158','56093','33165','11314',
                          '24617','11783','13389','27584','59227',
                          '55137','39256','95547','62398','25554',
                          '39632','48318','91242','44550','42570',
                          '79821','97181','37465','56882','61311',
                          '25854','30529','13984','24102','15714',
                          '51555','83387','90698','24840','13032',
                          '78194','24642','73177','94274','17032',
                          '37661','90735','45946','72437','23633',
                          '60745','92695','32690','39293','53427',
                          '82055','76188','32163','17366','51054',
                          '96152','66078','75724','33571','30958',
                          '81383','13691','33021','66112','86352',
                          '71288','39425','46426','88688','14380',
                          '98383','49230','79501','33280','98197',
                          '38213','35011','10922','71019','12356',
                          '51312','90929','68928','28153')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
