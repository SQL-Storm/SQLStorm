
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '74582','26441','56590','76640','17612','18925',
                          '64995','59761','41910','46930','17781',
                          '99247','13949','53796','49356','44335',
                          '18371','65017','45257','20661','21397',
                          '46394','74854','86119','22580','45702',
                          '71668','30887','10014','34677','69484',
                          '12768','61608','87484','81258','17508',
                          '35208','63449','32217','49293','45175',
                          '41806','30619','63255','12895','40763',
                          '15163','15143','38402','83989','69994',
                          '38935','27521','16333','58765','54772',
                          '15391','99071','98894','17399','47449',
                          '45123','99141','76908','44084','75390',
                          '58374','15235','26545','77364','65120',
                          '38608','20143','83115','24899','57449',
                          '21742','42357','66604','54958','16048',
                          '14412','52051','82124','85176','27417',
                          '19834','68660','32131','43260','38034',
                          '66950','13747','69816','42439','22354',
                          '42891','15626','39111','35689','75170',
                          '12706','16158','65805','12219','49114',
                          '39427','50658','73518','20047','92529',
                          '22420','73765','24127','99920','76844',
                          '96318','75232','20439','73847','12307',
                          '20867','95554','93766','93856','15079',
                          '25202','14303','21356','52773','77976',
                          '25948','51025','86336','74541','34768',
                          '75138','96216','21915','23161','43353',
                          '77679','40291','10591','67111','91952',
                          '84500','24770','55872','52251','46704',
                          '95123','37315','72867','27331','92080',
                          '84728','75415','21912','53858','61582',
                          '12051','16970','46476','12608','10864',
                          '60747','52888','75057','80509','42618',
                          '22715','97231','12087','88524','90636',
                          '59995','52228','62364','35256','46560',
                          '34971','80137','35548','39534','22689',
                          '29753','18209','31130','47429','25796',
                          '58009','19744','49604','29607','25001',
                          '79484','25485','19510','65924','46015',
                          '54217','79184','44849','51499','35365',
                          '17619','36158','24851','73558','61681',
                          '96182','52708','14972','87338','20984',
                          '26554','25844','64159','73399','99387',
                          '53467','37855','40531','82487','49682',
                          '18432','30273','80879','15361','60316',
                          '65993','29716','66434','78472','71419',
                          '60090','53583','24605','32686','90739',
                          '85384','26531','44410','95646','77167',
                          '11888','31228','48590','24594','72571',
                          '44287','34279','32334','26279','97177',
                          '98053','69275','40241','97477','35587',
                          '93600','97658','32954','34115','46497',
                          '64402','13954','52823','12777','18572',
                          '10875','94652','12757','18419','22411',
                          '32416','13442','30830','51796','86673',
                          '18321','40072','40272','12450','43778',
                          '82193','48056','84295','58467','27544',
                          '97248','47022','18491','25225','32642',
                          '51967','71281','54184','48807','33396',
                          '42603','33063','85366','54029','30722',
                          '89668','27806','48435','37980','90183',
                          '27008','86132','34276','58007','32951',
                          '97031','66907','63598','38206','11586',
                          '15796','66481','24746','41030','32237',
                          '21337','90752','79424','96832','55458',
                          '38955','99426','27365','16900','49236',
                          '51483','64382','75985','63498','79267',
                          '26047','28127','13799','52265','39283',
                          '35413','78190','19421','26555','83104',
                          '71504','76381','51930','57426','30568',
                          '24405','47932','13811','35990','33360',
                          '69954','85833','44997','89077','54727',
                          '78291','16423','24537','16000','40082',
                          '66664','42065','79595','18897','86017',
                          '20839','17747','56745','26021','18731',
                          '87480','87425','69803','50332','70216',
                          '97630','31329','28901','71669','27608',
                          '76004','33159','55389','30738','85234',
                          '44845','38916','15868','74839')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
