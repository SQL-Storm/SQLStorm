
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '94254','14832','85585','27403','70310','34652',
                          '32760','55054','70556','16950','92910',
                          '62479','96887','38874','49253','18122',
                          '80248','53652','79953','49362','42324',
                          '38434','33953','19048','14389','41399',
                          '79934','37219','73039','23702','53487',
                          '17920','99703','61043','45352','99547',
                          '16353','64206','53919','20796','93078',
                          '36386','36302','37763','50966','42944',
                          '25425','69119','29134','24715','67772',
                          '60404','40388','99810','20886','34572',
                          '33520','78279','69476','22579','14229',
                          '15534','78680','93477','30959','59942',
                          '78669','99939','60147','53280','13300',
                          '43668','43675','19720','17301','87357',
                          '10430','64980','11630','45564','32460',
                          '55849','46167','86885','10543','11715',
                          '15258','54026','68590','18700','40276',
                          '24657','58352','63533','35808','70695',
                          '77051','81786','17873','53686','18225',
                          '41677','31647','50428','18623','48705',
                          '20683','98883','45980','84728','97448',
                          '49489','39110','43589','83836','26599',
                          '56068','54022','53260','19015','72359',
                          '71530','41627','40005','49646','99791',
                          '84838','83843','91584','97936','26332',
                          '20224','21753','71338','19511','91423',
                          '80525','45598','21029','58837','93900',
                          '20721','48721','17105','42578','27795',
                          '89232','80724','26788','67837','23587',
                          '92948','29551','79601','25338','51902',
                          '63554','11757','28327','88852','52569',
                          '59044','84448','43719','72029','41593',
                          '72858','90487','58007','56104','90430',
                          '64005','62841','11863','44407','40704',
                          '35547','16464','23958','11995','84416',
                          '85814','91529','24879','57368','36813',
                          '25776','20745','16663','51083','35743',
                          '57843','58508','28395','60833','86349',
                          '39130','39259','54898','17644','98387',
                          '95085','30128','43710','76289','78843',
                          '29350','34876','72736','80809','17822',
                          '56959','50437','40699','75840','80567',
                          '11627','25520','86148','95887','50258',
                          '10807','51169','13291','44538','90128',
                          '23918','28978','25606','54061','52222',
                          '25546','37967','23368','33706','15810',
                          '16556','43285','20404','57454','44718',
                          '34411','67907','51261','22315','95909',
                          '39246','86919','61158','66501','11104',
                          '58555','81614','37181','57984','65320',
                          '73245','75217','45741','71434','69754',
                          '80878','32424','90136','90131','89853',
                          '64389','83311','64521','74531','10204',
                          '68082','31275','75298','41458','56526',
                          '58676','51150','31487','84127','41737',
                          '76448','20030','32873','23963','13810',
                          '84220','41230','56061','62868','72998',
                          '56559','29705','94139','55727','17779',
                          '24869','56979','81401','52495','99642',
                          '62118','37310','17478','36422','13781',
                          '59554','41761','78252','33686','81976',
                          '33333','10297','20533','73205','59870',
                          '55982','19484','21159','24754','53616',
                          '90681','13314','18120','67245','20679',
                          '31744','37962','34341','17692','54541',
                          '24881','71270','75875','88278','98304',
                          '24963','14092','49077','10074','17931',
                          '37270','80025','96420','58678','70971',
                          '11026','89702','98617','22081','62412',
                          '62182','48554','94508','47424','50169',
                          '45568','25920','25657','68488','68247',
                          '49639','68277','83559','20173','11053',
                          '16902','70260','22641','29641','20897',
                          '89977','89422','15642','20572','90673',
                          '14963','41686','41165','75939','89139',
                          '99001','82636','61115','96256','33042',
                          '57309','43597','23625','43606','57960',
                          '72163','43820','90484','59216','46061',
                          '61593','55389','44425','19298')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
