
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '40575','44062','85524','49849','99441','90436',
                          '60582','53631','39444','34552','38648',
                          '66618','66634','81553','85916','96152',
                          '35425','95317','55072','22564','67378',
                          '77141','41088','78994','73992','66526',
                          '85355','20883','42028','28240','43332',
                          '85708','73466','95081','48534','87810',
                          '21014','62438','30038','28019','15885',
                          '25927','31244','21261','89284','79261',
                          '48237','53402','43689','12483','78201',
                          '36504','77478','36041','11591','86958',
                          '25337','50889','11077','18923','91939',
                          '70970','30281','11534','64830','24771',
                          '13859','61654','23748','72922','10987',
                          '34565','85558','45342','15643','11570',
                          '13799','48131','24321','45311','25074',
                          '66295','44465','51724','46189','97541',
                          '39111','49308','55285','32589','24808',
                          '45627','12881','80450','25558','34336',
                          '84543','25195','95261','88646','64673',
                          '42057','30766','22406','14091','32738',
                          '86639','47820','58694','45185','48717',
                          '31241','47672','84194','75875','67042',
                          '44052','31134','51627','54825','46937',
                          '33449','12818','61607','94136','62260',
                          '92552','18114','34706','28775','73066',
                          '45761','77676','44505','36253','20658',
                          '33184','98786','78793','81147','13454',
                          '98107','14152','48039','88689','18902',
                          '45758','49275','22229','33412','20896',
                          '41380','39950','31417','35278','81711',
                          '66536','37954','81193','54857','11189',
                          '93835','28650','10231','55369','54886',
                          '15936','10406','35008','63531','88440',
                          '61616','28171','11172','67744','18750',
                          '83711','10096','81674','59083','92460',
                          '95639','20399','57442','42479','47837',
                          '63238','53641','41060','73234','31367',
                          '76894','42207','26364','39371','41783',
                          '30154','80768','20405','13794','87836',
                          '15142','71417','12770','61885','49882',
                          '24421','33080','46580','53254','90753',
                          '83910','22589','56927','71597','52599',
                          '44485','71283','65770','97866','88112',
                          '25365','81325','22464','25529','15672',
                          '47585','26578','42419','67955','54169',
                          '25919','60434','23835','84404','43167',
                          '62546','45707','14435','76394','34146',
                          '53739','94242','29306','84969','31228',
                          '40284','45529','18980','38628','13330',
                          '99650','12161','50359','31763','98256',
                          '77610','98663','24775','36521','19428',
                          '58439','58043','77058','31457','30035',
                          '62913','21010','18512','14811','29587',
                          '86282','76019','65992','11213','22835',
                          '48044','30818','75053','48943','63874',
                          '69728','93179','87999','65513','74386',
                          '15571','38818','39056','54806','14387',
                          '83399','43633','12858','61119','65196',
                          '12613','59145','45420','59710','69031',
                          '49876','96473','44315','70414','11456',
                          '62974','21363','67332','10485','60615',
                          '69542','23189','68187','13306','40850',
                          '27023','49000','29392','18273','67325',
                          '81735','61127','47726','31081','62045',
                          '38476','73776','15960','65166','53758',
                          '27537','96414','50545','25913','67307',
                          '98868','39450','22090','75415','70397',
                          '35746','62693','20486','15930','61247',
                          '21427','19448','96023','64920','50573',
                          '40328','18014','45833','43934','49764',
                          '32578','37728','56353','62792','63773',
                          '80917','56870','55264','34275','78300',
                          '89800','37259','98138','20761','14915',
                          '70214','15776','85440','65452','10632',
                          '60261','33658','33027','29985','33250',
                          '85973','85778','59569','45684','44240',
                          '29343','44278','40296','31958','11619',
                          '54040','75274','27350','42015','71907',
                          '12888','79125','16472','69890')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
