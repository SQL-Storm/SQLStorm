
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '31015','20367','66138','22686','20237','33992',
                          '17781','70469','27859','67186','15611',
                          '10386','25874','21797','77707','67872',
                          '87023','51295','22387','33956','51568',
                          '57015','97732','33860','45439','28889',
                          '48223','43344','37441','10375','86899',
                          '64740','56198','49696','24470','44641',
                          '14796','50799','82337','67035','15604',
                          '78146','52185','22147','35212','48962',
                          '81192','44873','11850','26728','25311',
                          '22279','17744','43165','27923','81454',
                          '72029','61697','13006','13492','51387',
                          '15896','61113','12369','16103','68548',
                          '41066','97521','25065','95337','22923',
                          '43274','22519','30787','93481','30063',
                          '30452','29712','37433','34434','54237',
                          '84451','53231','27673','19106','34290',
                          '45089','62274','41279','69827','61696',
                          '28546','28978','79439','57335','83130',
                          '33977','22605','10069','27955','52202',
                          '64562','51881','80754','62283','89209',
                          '19480','36409','49358','35705','97171',
                          '45253','69842','35527','77848','28494',
                          '14338','19829','21671','82429','91733',
                          '52781','43598','35365','96314','14489',
                          '72071','13629','59589','65666','44619',
                          '62507','34993','37361','20837','46061',
                          '18464','42987','68298','35105','65275',
                          '71149','99694','13106','49985','21606',
                          '55971','97900','18253','16395','46516',
                          '25460','54738','46450','74399','76073',
                          '14372','12767','74265','15774','21679',
                          '93352','16698','65289','50146','75789',
                          '57178','38104','11764','43398','20883',
                          '71824','85725','30825','77076','97080',
                          '16448','98747','56134','10583','52584',
                          '36403','85946','58788','71520','32201',
                          '17630','36097','62611','62416','58286',
                          '74153','92717','29951','79360','32237',
                          '46157','46912','46624','27379','57870',
                          '35260','39110','79944','79267','17190',
                          '43727','65203','39279','78688','68353',
                          '91081','22358','76583','83985','95674',
                          '76474','99860','68699','62228','98362',
                          '18722','57631','57212','88327','55104',
                          '31811','17191','19069','91778','49124',
                          '20230','19254','55834','45018','84998',
                          '97662','93331','23062','46137','21700',
                          '58187','81448','61751','30511','35721',
                          '53069','88075','18193','29305','93351',
                          '30382','57406','46318','69956','96989',
                          '42291','71208','55635','86627','21277',
                          '68085','37619','90429','15938','29397',
                          '20000','14914','48852','11103','72888',
                          '47796','21817','53205','69006','52859',
                          '71860','23513','52769','26566','53463',
                          '40704','60290','94747','55972','27726',
                          '86775','18055','28973','58069','51211',
                          '55762','20083','19442','93356','21511',
                          '69502','61320','10335','89247','21776',
                          '81021','55173','35361','27097','14276',
                          '55260','52596','53683','54174','43345',
                          '58006','95548','43410','33462','77771',
                          '88392','63140','28710','97941','75507',
                          '13478','22298','14217','52589','56554',
                          '34738','47829','87581','50208','13165',
                          '28644','45656','57690','15411','40323',
                          '22929','21711','98509','50678','14036',
                          '89086','28357','55596','69452','82674',
                          '59342','50231','36392','73059','13697',
                          '22368','43594','14182','92275','38727',
                          '46611','43191','41914','62865','43572',
                          '31991','86120','18527','82193','61175',
                          '32975','11313','18946','56217','21829',
                          '38805','56342','58159','14068','50269',
                          '28280','58011','75318','86342','73991',
                          '94322','56065','94056','61663','53699',
                          '32864','83904','10468','18840','82126',
                          '63791','47355','26398','19902','26640',
                          '34300','99849','19448','71749')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
