
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '13117','96268','58878','55667','77461','75522',
                          '19480','18336','32447','18926','88200',
                          '94010','99677','13532','67178','25419',
                          '45091','82903','42821','72210','70548',
                          '34135','24418','42725','62864','41247',
                          '19059','42577','50356','17433','41237',
                          '22522','48371','32200','10788','56696',
                          '69125','46705','59493','49944','41303',
                          '47337','57761','57966','66035','83424',
                          '81942','97768','57401','98281','35820',
                          '37985','69656','74136','34800','59904',
                          '65717','32601','75417','63403','16637',
                          '72081','88614','33743','42133','16648',
                          '14193','14657','63139','11165','14957',
                          '89972','80575','71141','40529','78437',
                          '81162','29828','73647','47560','42237',
                          '46915','21629','85185','38825','80973',
                          '71512','21519','49700','74502','22600',
                          '77232','64130','10519','93091','13220',
                          '44902','31257','14729','69553','88654',
                          '90897','71752','21493','51675','10750',
                          '42940','70730','87226','98456','54241',
                          '29570','39567','11866','78039','53679',
                          '29597','29960','84260','26442','19888',
                          '89438','74286','13461','68159','39859',
                          '12159','69757','99764','48395','51489',
                          '22289','26998','88189','19630','13817',
                          '17194','19198','26686','37156','31599',
                          '55530','17865','71743','39041','12394',
                          '15729','79121','13194','60136','40956',
                          '89634','13414','44272','52728','23807',
                          '68242','52698','17416','21678','58914',
                          '81147','23982','65459','50531','55560',
                          '29837','18198','71447','48427','37074',
                          '81100','69801','80944','48961','27050',
                          '32545','24715','13695','67739','24891',
                          '59959','57058','15799','27453','44322',
                          '67476','10127','22451','74384','25674',
                          '53176','70900','21186','49155','92801',
                          '83509','25170','58566','91436','60461',
                          '36557','60161','65738','87034','67858',
                          '41102','82867','93590','68185','40007',
                          '21153','37554','20868','22801','67649',
                          '35845','30762','17461','83923','99183',
                          '50730','32175','30076','91995','33247',
                          '53309','29453','89161','41061','54515',
                          '63935','44867','25994','22602','40972',
                          '42663','77753','19439','45733','22861',
                          '28316','98113','33486','15845','81682',
                          '96490','82691','44690','34692','23510',
                          '24338','28653','56144','28898','60565',
                          '50173','84864','40867','81561','36412',
                          '20259','45904','51914','82327','98870',
                          '59304','84229','74514','43183','46383',
                          '63608','17663','53521','12772','34332',
                          '23697','12258','69746','26952','74982',
                          '85435','14997','71371','92018','52302',
                          '44801','70972','70643','92537','18501',
                          '10835','92520','17657','93061','57508',
                          '36185','94362','34587','69356','34213',
                          '60324','19269','34966','70990','22012',
                          '32036','31863','33793','46465','40356',
                          '62563','35704','90424','55348','53919',
                          '60127','44238','26884','18889','63084',
                          '50683','29158','56365','58918','17278',
                          '37367','47125','72093','59175','89087',
                          '97657','18294','81305','26353','57325',
                          '28504','86689','90614','35724','28281',
                          '11510','57962','41155','34535','80286',
                          '18317','25362','93042','16445','67459',
                          '34296','27027','20787','50164','81700',
                          '44843','92698','55053','22262','95441',
                          '99731','14174','89012','62116','31994',
                          '65956','49242','24203','19946','15649',
                          '16920','56190','69609','30312','64506',
                          '17202','38157','35363','10064','55635',
                          '98918','95602','99958','69036','94536',
                          '23208','71701','78264','25092','93924',
                          '72351','10759','41752','15166','65902',
                          '62748','78701','11296','46136')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
