
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '50809','91782','10014','95844','41413','55827',
                          '93991','32912','21178','49678','47348',
                          '66763','36156','92595','86315','43645',
                          '41614','14855','79093','68205','47304',
                          '23168','77293','21371','46389','57157',
                          '94595','52312','13076','53586','53988',
                          '78232','67979','95925','24317','26773',
                          '17833','78704','70718','13210','99469',
                          '23942','66188','53697','17818','38682',
                          '19731','44038','36558','99446','10596',
                          '11642','11135','35101','59175','60377',
                          '49438','30356','22839','57985','50702',
                          '50796','65100','17712','15624','67574',
                          '15095','31223','75537','37946','62945',
                          '52664','17407','39035','40325','36623',
                          '14328','89955','14481','35103','62929',
                          '76237','16568','71949','75719','43300',
                          '36867','93439','92389','52541','29523',
                          '93237','50210','15247','82639','44197',
                          '16027','29791','65106','94094','81870',
                          '29016','88031','16718','84232','62883',
                          '42890','24344','63908','54973','67819',
                          '17720','21985','91657','62676','39980',
                          '50725','10196','73679','53209','37174',
                          '86058','21489','74093','79833','10266',
                          '52622','65809','24468','34613','78620',
                          '94457','67879','38945','10898','76550',
                          '54831','98828','52297','37504','65089',
                          '52584','22494','90445','88924','95375',
                          '72573','40527','65215','55716','97314',
                          '15370','28690','49091','90509','52478',
                          '54548','82688','27242','14162','25590',
                          '14165','17596','62294','75433','58215',
                          '98411','16010','20028','28943','30171',
                          '86009','26649','26018','59000','80297',
                          '79069','23967','81402','28862','21604',
                          '49485','14001','17535','16065','70647',
                          '56022','42800','27184','93226','99610',
                          '20177','38388','22213','37425','42863',
                          '20907','32799','59966','21127','43875',
                          '37762','27708','84946','22460','34559',
                          '21597','29557','88491','94588','99246',
                          '60555','33405','12087','10638','36573',
                          '62686','38921','97612','71370','25642',
                          '87493','97296','30523','58292','44263',
                          '34161','27930','22551','45109','27083',
                          '78388','72509','39848','24180','33444',
                          '36318','88228','50089','29428','44850',
                          '11026','76457','43304','33929','50598',
                          '74769','91468','88419','66064','76459',
                          '11072','92174','56776','66198','16498',
                          '49147','26325','14938','57841','12768',
                          '28841','55529','59676','82883','50390',
                          '36220','72518','14918','47679','41723',
                          '81703','81378','44105','13362','12344',
                          '80171','88811','75728','81362','10592',
                          '61556','87124','28019','58149','59907',
                          '56714','20399','82429','10374','10858',
                          '91269','32275','84068','91975','46548',
                          '65765','46008','56014','42810','59176',
                          '38630','64214','29313','70430','91902',
                          '17973','68563','32028','86005','61022',
                          '78067','36796','65440','55801','18512',
                          '26872','39294','11849','25990','88415',
                          '75515','40421','61037','20453','98946',
                          '66292','34594','83872','18397','82314',
                          '44639','11939','36996','91955','80508',
                          '53975','78754','44972','97932','21724',
                          '48099','16405','35346','86571','52191',
                          '53422','64614','60334','53287','42056',
                          '52418','37113','85164','13716','37095',
                          '22178','28665','62098','57160','77530',
                          '92713','22203','18889','25503','58223',
                          '56760','37954','66033','59695','31520',
                          '52212','57882','81071','32008','34897',
                          '69978','60427','22082','83292','95498',
                          '90770','73390','88626','53321','93271',
                          '30694','43984','76909','58190','79176',
                          '49217','71770','88976','67987','15934',
                          '90872','49470','92039','78538')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
