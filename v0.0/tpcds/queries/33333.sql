
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '14856','39321','95980','43175','89165','40206',
                          '10593','66384','52332','52258','42452',
                          '29732','11698','21973','54472','38463',
                          '16071','53188','19844','73646','99474',
                          '10408','71944','52645','21839','61590',
                          '17516','71787','23651','63262','64410',
                          '10194','41982','87102','32897','64577',
                          '77401','83006','70657','79232','61638',
                          '41467','11634','83981','16736','76980',
                          '29783','41471','57173','18594','11890',
                          '68822','96075','49394','40203','36252',
                          '37784','98439','78929','73335','11615',
                          '98194','60505','27702','91694','84229',
                          '96821','66328','35835','84974','98357',
                          '40382','93480','58682','88504','86784',
                          '59404','65416','58391','46499','24039',
                          '38446','84652','86394','38399','40308',
                          '59644','95501','38211','13859','46338',
                          '60665','88663','21487','42202','40093',
                          '31541','62254','74709','49096','61857',
                          '69206','40783','46276','76953','58372',
                          '10705','74004','33125','87984','26257',
                          '40214','38008','20737','71160','21725',
                          '51534','28581','46578','70922','46506',
                          '99072','16941','48880','48581','49195',
                          '27049','32446','30118','30053','46162',
                          '14678','45427','15149','10565','16744',
                          '98494','24391','75771','60766','78127',
                          '18898','19658','38641','70884','26784',
                          '97764','78543','78431','99158','60467',
                          '17337','49022','57158','50521','70712',
                          '38816','40100','19861','59807','73626',
                          '41529','31440','10019','27745','57743',
                          '26234','97656','63300','74014','38523',
                          '67383','69370','12900','23726','37387',
                          '55827','75903','65681','12310','26516',
                          '95343','62581','87376','62961','22900',
                          '80090','29063','15593','25233','25366',
                          '45193','69492','41309','49788','34212',
                          '73799','97769','71577','52273','42391',
                          '86007','60937','45620','19439','91476',
                          '66175','32321','96321','66847','48905',
                          '91202','97362','17637','61359','10449',
                          '93716','13154','52174','15719','23684',
                          '10428','67533','29926','70152','20131',
                          '37333','21962','14414','38853','89450',
                          '10437','36167','53319','63993','23413',
                          '19387','30085','12072','57032','44089',
                          '30650','15790','46951','96565','68325',
                          '56710','96331','74234','20598','31812',
                          '88668','22565','76174','88956','42740',
                          '47679','33605','29434','74932','15016',
                          '16143','13165','77511','37446','39588',
                          '16415','92961','27634','28913','82681',
                          '20110','59792','69860','35347','21337',
                          '27444','72494','25110','90527','83094',
                          '71936','90624','37300','54587','95250',
                          '63995','62282','70929','40072','17975',
                          '78279','84338','66593','10667','50840',
                          '93473','69073','36987','17765','58030',
                          '45972','82458','21783','65989','74378',
                          '72669','49499','17700','46301','24070',
                          '68651','46316','67459','57474','62163',
                          '60780','34584','11835','81564','63820',
                          '43006','22791','69044','54789','14762',
                          '53932','28112','10300','13240','77789',
                          '18701','67352','68396','77245','62514',
                          '97959','54652','15869','14847','11116',
                          '52669','31066','45022','16860','41583',
                          '39296','11122','33799','31474','62881',
                          '76263','42006','31532','25182','75559',
                          '75004','53878','66788','84062','23736',
                          '44050','22220','45311','59874','89738',
                          '31517','53892','27224','15872','97489',
                          '52923','22986','31749','60987','12832',
                          '22486','35912','12280','25866','44887',
                          '31279','12934','51830','89947','71346',
                          '35692','96892','12409','75532','75428',
                          '31913','72268','68276','99020','57593',
                          '22182','37727','94076','23658')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
