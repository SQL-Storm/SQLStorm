
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '74585','32380','11085','28507','74568','12481',
                          '64915','24608','89981','42036','16879',
                          '11469','74318','75723','75374','53658',
                          '88347','55466','70630','31778','47707',
                          '12485','87822','72168','28543','53106',
                          '67251','28566','12744','70787','66758',
                          '23427','40624','68965','14739','96996',
                          '77006','71576','77320','22370','82778',
                          '68793','60225','64425','39425','25523',
                          '43630','35484','11615','25449','56277',
                          '74450','24796','57827','54466','89190',
                          '72509','32219','16457','71917','31594',
                          '49287','20704','31406','84875','57258',
                          '71195','17669','17197','28010','63958',
                          '33805','95368','31000','75390','21802',
                          '92162','57831','79766','86699','56015',
                          '86071','52118','68725','45993','40127',
                          '11883','42674','19177','80919','75018',
                          '46644','82643','59565','16260','14126',
                          '10696','53704','77088','58378','57581',
                          '24034','49028','43042','33049','48200',
                          '22262','34827','12505','30338','74617',
                          '59234','47962','80876','13816','64508',
                          '45736','40783','86629','69799','79750',
                          '84648','31111','86069','33197','31906',
                          '20671','13507','30027','40859','36593',
                          '89144','27830','18000','40041','10592',
                          '52725','69581','94951','84000','97637',
                          '52110','26592','78821','31426','42690',
                          '51984','39757','72462','86978','24618',
                          '97129','16381','76079','26870','54858',
                          '87008','38183','11988','79679','64672',
                          '35408','23119','59059','40422','11968',
                          '63521','42686','13914','98805','88098',
                          '67847','33656','62759','79421','23038',
                          '47446','49116','84184','22784','22416',
                          '29718','89031','18860','58191','32212',
                          '62685','80411','22986','37304','61701',
                          '59394','39321','40362','33423','92206',
                          '21026','16407','84956','41419','39211',
                          '10305','44346','20717','58773','93053',
                          '14413','82820','89436','46807','73013',
                          '43089','88455','22661','37590','42652',
                          '90884','52440','39990','81868','27017',
                          '20273','42282','73088','27543','29490',
                          '68931','42977','30952','34392','36629',
                          '56607','39209','75005','87182','41245',
                          '82996','42753','60229','81164','29559',
                          '69038','17123','65156','82832','72492',
                          '11505','26342','20386','36358','21868',
                          '76536','18053','48994','64047','92186',
                          '91157','13180','70361','69883','53440',
                          '87069','79704','80992','90022','10980',
                          '89443','72209','54145','50852','93054',
                          '16158','69629','26533','48487','10524',
                          '96628','77146','33149','35981','41757',
                          '52913','56255','21496','54258','18947',
                          '42685','60309','79348','68603','10416',
                          '18692','59549','79220','70456','37419',
                          '29777','13529','55438','11435','48543',
                          '15323','67123','71682','73897','30514',
                          '65026','25447','44646','52623','46033',
                          '44470','43358','89910','89761','23521',
                          '63060','11838','43904','56384','39088',
                          '63267','35684','81037','67690','66391',
                          '20292','61479','29780','86486','27301',
                          '94819','14681','44741','20719','69867',
                          '49670','30211','74878','89965','74622',
                          '67363','99712','21281','91630','16620',
                          '96442','45482','45171','55739','20001',
                          '88133','94975','34855','99483','43814',
                          '30707','53975','81572','47249','42277',
                          '84978','47255','12665','34182','23087',
                          '13317','41712','16193','27928','60691',
                          '32585','62844','93312','75608','45400',
                          '39696','11993','92389','19992','14143',
                          '17298','53237','21666','85489','53929',
                          '22099','65578','89097','46878','40292',
                          '32946','74038','45169','11044','57086',
                          '18193','74272','92978','42494')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
