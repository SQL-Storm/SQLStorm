
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '96344','51362','12865','59247','30307','51813',
                          '36095','26457','12143','17024','87864',
                          '46487','20140','55376','29403','79147',
                          '93385','24832','14451','83237','30680',
                          '98630','27939','27259','70411','91517',
                          '39206','24222','94659','46312','96564',
                          '12266','42071','21833','82171','14723',
                          '71929','58848','59418','38277','26168',
                          '85842','38729','52631','11190','52482',
                          '19564','42270','83159','41223','27579',
                          '15629','84022','63717','44366','55473',
                          '41511','77189','99736','73284','47872',
                          '44741','15792','16998','93182','19322',
                          '26526','40787','13888','33676','98942',
                          '40942','13653','67862','54501','29720',
                          '81588','65836','72103','10764','74992',
                          '28474','90804','75979','52978','74217',
                          '29858','13556','55257','13327','88118',
                          '53729','55246','26798','67263','53320',
                          '80480','91451','79447','13848','71996',
                          '81740','24830','67259','67912','48451',
                          '22878','33266','44012','15276','27254',
                          '45693','32202','42398','42657','52784',
                          '64101','77344','77560','29489','42272',
                          '47525','32010','21993','16973','85061',
                          '23861','24305','80232','31523','13889',
                          '14362','10596','94914','26147','33679',
                          '54232','29264','23902','43202','29057',
                          '11478','34491','43828','83154','53496',
                          '63396','27402','59851','49143','91395',
                          '49543','32145','22569','14146','29536',
                          '28451','91731','57646','45732','48831',
                          '92265','36506','74808','66767','14150',
                          '36220','35613','86888','59411','73746',
                          '93241','77328','49221','80062','54421',
                          '80617','57130','62161','41268','67899',
                          '74409','89009','71823','36809','80467',
                          '70791','88698','29262','15140','23434',
                          '53567','30212','70982','94103','34991',
                          '63857','25363','97440','14819','28442',
                          '76982','97031','96176','69357','89598',
                          '99797','84006','87006','17606','24302',
                          '18400','38013','97758','33476','27978',
                          '37805','32124','26357','83229','17970',
                          '30529','52552','26383','40976','31963',
                          '43080','55313','21366','49433','47180',
                          '50775','52987','46064','26837','54585',
                          '59405','23427','50163','60165','65808',
                          '44465','73794','68299','76063','21960',
                          '36938','65677','21871','47903','31173',
                          '75759','68841','69298','32748','50535',
                          '90815','40190','38240','27720','75118',
                          '66258','59531','57289','21704','38585',
                          '37397','30169','36512','47893','21880',
                          '46103','34422','17856','52616','84288',
                          '97675','36048','11687','54685','66750',
                          '34349','75887','53473','67643','23698',
                          '11618','33879','62192','28110','72759',
                          '60188','28935','16275','79492','28693',
                          '23566','65020','82095','22054','18394',
                          '58288','81861','85015','38485','19972',
                          '36161','24336','92445','48712','43538',
                          '30808','77144','10459','79036','96380',
                          '55531','93604','68430','65188','14215',
                          '82548','19340','68546','93132','46869',
                          '28985','79901','94112','76227','32686',
                          '46589','88830','61723','97353','73919',
                          '26657','63069','72593','44073','30917',
                          '13945','42326','38975','14687','72695',
                          '40446','99317','44930','22340','57121',
                          '87017','15688','48781','16194','79830',
                          '41299','89686','11944','85182','79291',
                          '60919','74115','13916','46581','27411',
                          '73703','69693','84557','37529','18010',
                          '39056','37950','28558','44706','79886',
                          '16779','45860','80903','75425','60465',
                          '59099','26707','23441','80815','43060',
                          '11519','59633','48214','73376','98928',
                          '29636','59540','78182','97396','15421',
                          '48309','48695','37256','20307')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
