
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '40556','31517','39263','81562','45133','41651',
                          '90766','84776','86270','95258','14735',
                          '22096','34866','38668','20352','19939',
                          '17455','82799','40285','86911','60328',
                          '45240','70019','98305','41292','51523',
                          '50531','50664','77511','95999','55078',
                          '98260','27158','12580','63616','29005',
                          '10647','71297','59360','45099','83349',
                          '73230','99532','59122','30427','91220',
                          '16834','86909','18669','67669','61609',
                          '98868','37095','78557','16842','84956',
                          '59068','31746','66988','52195','46487',
                          '50498','69838','79070','50011','31059',
                          '38428','17457','22891','79795','78367',
                          '62048','45770','73817','11289','83171',
                          '60873','17318','33441','59442','17861',
                          '40353','63262','67919','38008','11921',
                          '82962','26410','45874','30917','27462',
                          '99187','21179','32334','41201','69448',
                          '70490','36481','12335','48637','91744',
                          '34897','61671','49824','29226','75886',
                          '19955','33260','74665','59512','19838',
                          '42581','93628','50916','93435','28813',
                          '10443','90850','31616','18105','36326',
                          '44444','18778','81404','17189','38287',
                          '11095','36466','10394','34666','32523',
                          '56232','91370','84303','30173','24180',
                          '79603','88907','59053','79477','21525',
                          '34948','69955','48077','62591','53607',
                          '25530','84141','45818','72855','48835',
                          '72346','30663','59201','76872','31397',
                          '29076','29966','97634','33078','85996',
                          '65687','15413','21451','29067','60270',
                          '53329','67002','71573','65818','84595',
                          '87181','28859','68985','46726','13488',
                          '20846','19207','11793','99072','80902',
                          '12891','15504','58034','18109','70292',
                          '19910','66574','20218','41365','11359',
                          '70434','59671','22872','30587','34243',
                          '81945','83711','75038','27435','75600',
                          '47852','75753','14950','76916','97291',
                          '21475','84021','83623','92072','59033',
                          '43653','76092','38447','33239','15787',
                          '42413','34908','78867','77255','27473',
                          '78280','45687','28277','24993','49885',
                          '65953','96900','51720','39234','81954',
                          '73244','62849','99080','37534','44714',
                          '58649','95435','46940','42745','67731',
                          '54064','27068','24662','10448','85589',
                          '54035','41628','48269','84225','11156',
                          '72305','49931','13164','20365','14350',
                          '19889','10783','71197','25432','60624',
                          '34802','27497','59037','31706','19389',
                          '75054','42275','34238','71186','34659',
                          '61604','28406','77989','10130','88455',
                          '22317','41279','44042','11686','11019',
                          '28234','14633','56481','33083','19125',
                          '44025','94042','85654','34514','91534',
                          '17162','37896','29193','24548','81725',
                          '85557','14640','26617','79858','44289',
                          '83423','43762','24914','26049','67906',
                          '39219','14508','62201','81896','74883',
                          '73094','89976','33469','69398','39820',
                          '91128','84339','20310','67159','36402',
                          '88359','70610','45508','90794','15103',
                          '61404','52058','83757','56920','39023',
                          '49610','35398','31952','92910','58823',
                          '17333','64266','45884','87492','97379',
                          '47998','15582','66350','10108','96139',
                          '32859','27902','88004','18692','23249',
                          '23058','91853','33297','56800','15166',
                          '89510','23909','83003','56503','97815',
                          '18951','60291','63630','12547','35327',
                          '40874','86139','95132','41232','90933',
                          '85302','44591','86932','65456','37648',
                          '12802','87090','62565','24157','34737',
                          '58033','34093','10414','95291','26030',
                          '40862','10225','70111','23325','53071',
                          '16546','31204','31123','73158','38047',
                          '24867','16991','54549','14963')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
