
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '85369','84656','18984','63616','98857','61334',
                          '24516','71782','30697','50959','85900',
                          '22037','36369','16960','72217','13046',
                          '72393','98072','28906','49292','51069',
                          '68234','14432','10887','21191','25266',
                          '14224','58691','97077','89010','88695',
                          '92630','16957','52394','27517','42054',
                          '24053','48559','44854','98389','44062',
                          '26569','83476','11209','32291','79557',
                          '58638','44589','29731','92480','69844',
                          '51765','38790','10201','93538','15009',
                          '57116','67112','41118','15323','79236',
                          '59141','25049','50212','72646','74132',
                          '30708','50572','48050','12205','87073',
                          '68629','30495','38346','35404','16879',
                          '62513','92362','13714','68778','20242',
                          '36314','75326','64053','45810','90036',
                          '96552','78644','34023','87635','40745',
                          '41131','61653','52416','31886','53554',
                          '45547','36829','95233','13614','83577',
                          '45401','42922','26324','21994','20439',
                          '53234','59184','73067','85899','27572',
                          '41517','15115','19809','16272','60061',
                          '32446','20471','17126','14261','12292',
                          '84453','12601','28862','15852','51417',
                          '37318','99934','13086','29348','84288',
                          '64284','55299','14971','24278','19844',
                          '26492','87114','35868','42107','10620',
                          '10667','23285','63170','86192','22725',
                          '24925','11896','51430','66013','15806',
                          '31346','47419','14955','19155','18891',
                          '27172','84450','19066','38345','35922',
                          '88254','50771','19922','40375','67333',
                          '85478','93542','47898','19623','39171',
                          '48335','28686','74465','62853','19874',
                          '96072','82332','86425','14345','20408',
                          '22144','45260','98906','29872','78920',
                          '67306','98019','85855','99789','52144',
                          '16570','22547','86533','86476','45643',
                          '92210','12730','64435','17262','85413',
                          '14712','38875','34714','63513','73707',
                          '22524','45633','13883','19354','30645',
                          '76753','29513','15480','29493','16646',
                          '63382','59799','42600','38230','88111',
                          '94923','96814','18850','92621','31684',
                          '47610','16703','84892','79180','56497',
                          '51920','57613','62159','98887','62771',
                          '24845','93374','23892','56648','86332',
                          '87798','59334','38019','76681','10705',
                          '31783','20055','30830','49081','19394',
                          '13991','44231','82046','87940','53057',
                          '29694','41085','14167','49633','32383',
                          '36728','49929','20901','79613','12890',
                          '42685','13777','59450','79450','35978',
                          '17710','58807','39492','14976','35841',
                          '47844','91447','27480','28172','25606',
                          '13143','67918','44565','32249','70119',
                          '40890','92973','66660','23850','23390',
                          '54238','24631','91171','52862','22872',
                          '41932','99686','37972','93565','22667',
                          '32523','97414','10908','46236','24884',
                          '19163','63352','62805','40604','16487',
                          '51653','42499','34833','69848','43459',
                          '77131','28821','41499','87265','57077',
                          '25554','97078','12347','47774','68245',
                          '63144','54168','54690','89784','55166',
                          '24327','28727','61891','76416','26588',
                          '31082','76412','14043','60809','74405',
                          '81046','87389','77409','44383','25806',
                          '79385','40695','43462','39899','86188',
                          '51318','40566','34463','48426','54944',
                          '26048','28206','36219','22830','64756',
                          '29811','11494','94949','90833','91756',
                          '23334','35512','23161','75553','62117',
                          '59113','95269','22057','35714','64558',
                          '77931','32815','34826','40548','22703',
                          '68197','25117','54278','79617','79691',
                          '32796','16627','40084','78478','30311',
                          '73154','34825','98115','88047','11823',
                          '12056','13623','11103','22209')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
