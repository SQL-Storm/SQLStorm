
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '81323','70253','90531','71120','15157','96975',
                          '68988','14343','51230','23294','10686',
                          '27654','38772','37730','14791','40819',
                          '26383','15333','54560','74449','68920',
                          '26211','12756','37432','40170','65737',
                          '28697','35010','60648','12059','24026',
                          '32368','66649','51934','36802','14556',
                          '79834','36788','13771','45061','13342',
                          '45510','82839','76354','45127','33689',
                          '97636','37642','46974','10111','38977',
                          '92535','96554','37039','31749','28133',
                          '66241','67429','90835','77761','39728',
                          '68399','14422','38003','57231','20845',
                          '78048','50727','20360','66900','96162',
                          '12147','15043','18195','25316','29469',
                          '67762','44504','42982','59242','74286',
                          '70857','14415','19611','86890','25690',
                          '65841','44359','71810','39124','28309',
                          '23542','81325','46794','98889','46678',
                          '50475','96363','58695','35455','32968',
                          '66103','97385','21151','86201','87560',
                          '23334','25295','59291','16728','87477',
                          '87072','42708','69214','11140','53398',
                          '42126','26191','64390','33624','17744',
                          '48775','41311','40636','75004','63428',
                          '92335','70069','34618','35528','29120',
                          '19191','55350','43391','39029','28468',
                          '12215','57368','10902','30709','33686',
                          '19111','13125','76157','54980','72839',
                          '53587','43115','64216','48078','68956',
                          '37907','71263','67372','55899','60921',
                          '39894','45704','19663','80163','49312',
                          '20407','75193','36271','78500','80964',
                          '39277','77681','53710','28235','89865',
                          '37305','87126','55172','92041','13975',
                          '12132','40173','37268','77200','81881',
                          '56785','56703','77029','66380','61431',
                          '42889','32901','42581','96690','11698',
                          '29279','83937','19929','16953','63368',
                          '89281','25644','12925','42937','26652',
                          '10656','20646','22123','26462','59373',
                          '47161','10075','74673','38839','11176',
                          '32400','32076','30505','89441','10778',
                          '89430','35940','92396','80183','49152',
                          '77114','42600','52443','19548','45629',
                          '19300','64019','52498','27301','13178',
                          '61755','86845','25875','13685','17926',
                          '68854','11337','95165','42863','30154',
                          '29171','26024','90428','86300','62432',
                          '57341','65379','34599','63563','27484',
                          '18586','17529','15800','65873','82015',
                          '25995','97085','95107','62797','83643',
                          '29129','62712','56629','25665','44639',
                          '62308','99066','34137','60717','61261',
                          '46178','63604','12770','26079','89672',
                          '84998','16150','47630','19796','83853',
                          '72110','32342','34866','27386','10751',
                          '46465','16360','95715','75501','15381',
                          '36794','12898','10624','58397','44269',
                          '43965','23072','66383','28041','42327',
                          '68223','42783','41289','21981','74841',
                          '37575','22772','56402','21417','45292',
                          '88215','56286','74075','83482','92200',
                          '49033','95009','39005','20484','42767',
                          '72355','76607','81351','37441','96143',
                          '13136','89691','82014','85522','93965',
                          '23132','40207','35716','13832','65969',
                          '90931','52799','36162','41859','91639',
                          '23817','12001','70231','47518','12058',
                          '35545','28916','61426','15992','97234',
                          '45125','76742','68101','26964','88868',
                          '10868','29048','57154','69686','74684',
                          '96997','81220','49690','64805','60173',
                          '49542','71456','83102','97598','31730',
                          '61259','29147','75354','46934','97554',
                          '83240','48915','19428','81147','76892',
                          '61138','88964','20560','82348','42076',
                          '56397','18282','46342','83892','94742',
                          '36013','88989','11573','28072','68004',
                          '16410','61686','58152','62691')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
