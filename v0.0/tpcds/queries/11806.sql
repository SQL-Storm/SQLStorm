
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '85991','16713','11173','52217','48655','29929',
                          '53388','40269','12225','49876','35624',
                          '13408','53345','22033','48609','63602',
                          '19617','33016','38968','20699','85116',
                          '42750','48703','45886','12417','20423',
                          '44826','66738','32582','52657','36394',
                          '37473','24797','73693','86885','20126',
                          '67347','14638','76369','87492','13021',
                          '32533','92905','87892','91166','76895',
                          '86694','97781','17441','54705','78225',
                          '65910','51388','56104','26493','63756',
                          '18536','77976','71784','25850','67382',
                          '41762','40898','65555','79574','45888',
                          '58451','17706','20113','65255','13472',
                          '63529','68710','46826','71734','29449',
                          '26938','47674','69026','42113','47192',
                          '92122','20919','57838','56074','78592',
                          '96229','47012','73935','82049','45952',
                          '56229','24177','51711','37641','91238',
                          '99446','82937','39587','52959','38112',
                          '53685','25654','27379','20286','88588',
                          '85728','76656','11833','76188','57841',
                          '73226','10713','33472','89876','48756',
                          '38002','20472','15039','84843','90038',
                          '69723','18877','78827','11860','12418',
                          '99506','63488','10881','45581','61010',
                          '67712','24251','44069','16681','86907',
                          '43294','20717','19734','54194','57442',
                          '56502','11430','14765','34900','16572',
                          '69195','21164','28289','65024','26812',
                          '43045','77521','37798','96112','56220',
                          '76200','80547','29967','63889','42669',
                          '48349','30202','49731','50961','19175',
                          '42108','28854','46330','39029','20383',
                          '28401','12817','37699','18129','72345',
                          '23563','85292','91546','33142','12829',
                          '26793','32924','73728','13653','21591',
                          '58559','84500','99953','38759','70472',
                          '40240','35311','15935','57200','19200',
                          '44253','75081','29667','58384','50790',
                          '75632','33811','88479','66420','14194',
                          '21623','43768','26346','23717','69362',
                          '89812','23115','46714','12949','62052',
                          '66542','12643','98956','10375','52475',
                          '13381','72957','25467','53680','33955',
                          '24383','33018','60044','31372','23732',
                          '36147','49705','53328','20521','51572',
                          '12330','21889','90637','23362','85807',
                          '57412','40511','74532','93287','37621',
                          '85804','19411','58133','70045','18483',
                          '75037','49114','48904','35633','54305',
                          '25081','31057','42140','68855','95695',
                          '16037','68905','51251','24477','14938',
                          '60013','36619','17191','86314','77774',
                          '44805','53293','48877','52855','17773',
                          '18542','24437','30126','37113','44618',
                          '46279','16774','82653','33603','49164',
                          '98070','87696','94636','55282','97220',
                          '41622','78422','31811','27284','66031',
                          '68551','18473','57354','17754','19264',
                          '50726','70905','20695','76053','53792',
                          '58269','15680','31531','25295','32259',
                          '63922','39537','26928','77614','13329',
                          '45280','33730','24996','30617','64806',
                          '11994','66423','11068','77926','27100',
                          '78757','27942','97512','98407','97140',
                          '42319','12790','77257','87604','57473',
                          '39469','59213','26564','96978','55516',
                          '92969','73517','46620','57566','67373',
                          '94644','57994','15035','19947','21610',
                          '36347','69629','31956','95472','45019',
                          '27459','25022','84280','15295','51402',
                          '69801','56623','21216','62032','18211',
                          '34010','29438','86856','90316','48130',
                          '47273','10550','76962','14760','72630',
                          '30377','37960','27963','32471','30433',
                          '44836','52463','18414','49795','40039',
                          '19056','44233','70308','45749','48911',
                          '85733','91718','98159','21450','75444',
                          '95368','43356','89575','33913')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
