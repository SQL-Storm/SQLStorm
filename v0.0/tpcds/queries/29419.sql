
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '36203','23776','44405','55637','50814','62825',
                          '93926','68029','48818','43262','20986',
                          '14202','61190','50420','24341','39262',
                          '79739','13353','47988','17369','41882',
                          '63339','60342','26454','94390','73134',
                          '15902','82105','53028','14737','84996',
                          '20370','29577','27407','34911','37207',
                          '50604','53509','42677','68413','40330',
                          '50405','94847','57238','79529','28607',
                          '40013','81544','26221','87652','17757',
                          '80181','24602','20433','55091','18345',
                          '97749','72102','91658','98916','38748',
                          '81504','36094','28717','35450','67822',
                          '37531','10421','44060','93699','93065',
                          '62553','83796','20184','72813','33575',
                          '72397','21822','92490','19920','92250',
                          '69136','14236','95833','65003','15883',
                          '68606','11885','51079','65498','20275',
                          '95642','10121','28213','96994','33148',
                          '86861','85204','24903','15916','82172',
                          '16138','50501','20591','63099','31471',
                          '19629','46321','29458','26132','17419',
                          '44977','43050','87288','83441','94477',
                          '36997','94519','10535','23424','17642',
                          '59578','28969','18075','17747','46260',
                          '50294','91942','28659','35709','15016',
                          '68501','30442','83128','81487','93751',
                          '14243','13578','86950','18774','10914',
                          '28271','46500','63282','73696','42281',
                          '91349','52873','41705','68847','19888',
                          '68087','21647','37856','25286','16036',
                          '20843','42153','58724','71839','90203',
                          '65037','32370','53795','42554','91767',
                          '70427','60984','31902','68637','59701',
                          '71091','37580','60500','69516','22069',
                          '17371','40991','18064','21777','16133',
                          '69673','38576','24534','36338','28697',
                          '32245','74607','77011','37022','86424',
                          '16799','28295','56854','73619','23685',
                          '24310','29338','26944','82120','17593',
                          '17511','33090','88384','52637','99233',
                          '77511','32265','12181','19742','15914',
                          '31515','42476','18960','49294','95467',
                          '82244','10502','27113','25640','75354',
                          '99911','99400','60228','64855','27616',
                          '13163','11448','19161','56337','32460',
                          '10275','60584','32742','18275','98524',
                          '32948','65767','66733','78885','52950',
                          '70631','16903','20840','81399','76774',
                          '59336','32848','54415','44312','14994',
                          '12269','22098','62054','85576','41414',
                          '75504','25091','19721','17345','43704',
                          '63913','11118','11772','33328','37293',
                          '73895','90936','32726','15002','16732',
                          '22422','72850','79293','88982','78671',
                          '76116','79775','11802','32756','80131',
                          '12672','59167','21373','95726','28270',
                          '28097','92463','75618','89869','34914',
                          '13398','99626','16570','52988','27811',
                          '11758','67780','31578','83043','77276',
                          '53678','33102','47974','30827','44357',
                          '75920','37236','21172','26122','41618',
                          '62001','72860','77979','41237','11230',
                          '80325','16053','67984','42661','22758',
                          '91092','14938','18263','14917','85485',
                          '75050','30869','51793','13832','57917',
                          '40153','58463','18606','44446','67342',
                          '74983','24840','95675','22401','19611',
                          '89426','85966','16444','93673','40736',
                          '28100','27321','27037','19618','26249',
                          '78025','68054','47197','15246','17248',
                          '42913','37482','34899','83202','26764',
                          '82159','36586','40779','32486','97275',
                          '24951','82610','19189','48011','61609',
                          '46775','67351','79146','47160','48598',
                          '73345','42433','42239','19846','30387',
                          '53810','15183','97352','14029','28603',
                          '33705','16547','17257','31223','46876',
                          '67977','85384','55131','54523','91808',
                          '27516','32619','90699','36131')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
