
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '92988','77647','36525','83335','32968','81130',
                          '47534','71815','43268','77374','73747',
                          '11130','71919','35983','86276','82036',
                          '88162','56892','32652','96741','25555',
                          '69505','84083','65761','15598','44031',
                          '47079','47955','35261','57515','41829',
                          '16379','30785','88601','63584','73756',
                          '37119','46352','32849','55441','82755',
                          '36981','72546','87268','39704','34781',
                          '46307','21676','48507','53118','13069',
                          '29564','17060','78812','41312','74484',
                          '25500','34748','39218','18951','43663',
                          '27455','69725','68668','97142','25416',
                          '17480','61269','31116','33615','41631',
                          '89837','25947','58053','38657','69800',
                          '78909','40471','17972','73406','98429',
                          '62196','79257','37572','22335','23667',
                          '19093','39367','72775','38148','16082',
                          '30198','40096','71963','12298','69227',
                          '68159','82480','32072','65582','35423',
                          '75377','34108','70282','51090','73812',
                          '89064','37811','66090','89386','62948',
                          '20225','41763','87485','80942','59319',
                          '18315','42295','57025','37275','44027',
                          '13600','90110','81519','13228','51173',
                          '67035','39862','93871','27801','13970',
                          '65595','76024','83320','97001','53235',
                          '81415','35886','55556','39574','42163',
                          '37293','38138','11641','51045','25260',
                          '32433','66282','47816','25293','28766',
                          '49612','21522','39899','16800','13207',
                          '45426','20044','16169','57254','61559',
                          '51616','10073','34288','10594','84915',
                          '67719','56273','34518','80609','73501',
                          '39914','90340','72034','29255','20711',
                          '37288','29623','71441','43004','63683',
                          '48003','97057','14116','32755','68187',
                          '32325','30301','54023','64271','25970',
                          '88057','81180','84588','49499','15825',
                          '88979','87226','86709','10299','36624',
                          '44316','40512','65015','96352','79315',
                          '55589','63721','98515','39002','38677',
                          '70516','39975','61046','94490','16293',
                          '85209','80003','43589','96542','36589',
                          '60657','36424','28889','23305','53368',
                          '32864','13581','66798','53785','57217',
                          '57893','49745','47761','14999','69635',
                          '47333','70403','37988','13609','66619',
                          '43793','60754','21836','46137','58002',
                          '61199','18304','90735','13227','90724',
                          '43013','18687','27483','13616','62223',
                          '64630','59493','22821','47261','47713',
                          '78208','11530','10799','51804','95700',
                          '37566','13509','66130','35633','52357',
                          '15186','22290','53809','27260','53404',
                          '84708','30649','36461','90869','17376',
                          '38818','17981','58687','93129','16208',
                          '21702','21811','35224','55791','14713',
                          '76571','29007','40989','99504','11496',
                          '30697','12772','56510','61570','50024',
                          '75382','99790','21177','94641','26687',
                          '31094','40601','52910','49050','41812',
                          '28572','82098','32309','41304','52331',
                          '26766','93249','17866','60542','68649',
                          '10627','27885','81839','21605','68911',
                          '16325','21903','99520','20305','63895',
                          '20674','11909','42577','77322','30004',
                          '69846','63530','30787','45696','50764',
                          '34597','32468','37772','57219','15269',
                          '77771','20003','18108','44977','57204',
                          '44140','94606','72998','67459','90022',
                          '50370','72686','80228','88333','16512',
                          '39725','89533','57716','85031','28222',
                          '61954','65631','54483','84795','11585',
                          '64273','32754','91732','82903','43059',
                          '40158','88890','25606','11512','26636',
                          '59488','22932','60873','15810','44635',
                          '58586','65856','42851','48166','85089',
                          '42399','20153','69998','32117','51838',
                          '69673','27353','67488','28855')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
