
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '95498','19163','44295','59355','98238','52548',
                          '23578','62401','97699','98027','15119',
                          '35596','35187','29473','50869','22881',
                          '46399','43632','34689','33779','50294',
                          '19135','57746','35221','57001','51525',
                          '15927','83823','60805','74939','70666',
                          '24349','55583','59758','84619','69444',
                          '38735','26707','56036','49423','85151',
                          '12891','40974','11969','94037','46234',
                          '41906','42634','42703','48447','37490',
                          '81850','98908','40586','78945','92422',
                          '47525','93654','79382','12626','80521',
                          '10929','51670','15368','53314','71586',
                          '67600','13560','36134','22772','16291',
                          '75227','37454','86952','17502','80338',
                          '57840','12199','45020','98656','37124',
                          '57814','70603','49194','54365','36541',
                          '54177','73115','61114','74606','17288',
                          '55683','22962','64737','13641','42585',
                          '75489','39979','64011','30204','71195',
                          '53372','18664','58622','65956','63945',
                          '39810','16011','44609','45980','86235',
                          '19634','25522','65360','71204','70189',
                          '27120','16923','32434','70301','85367',
                          '20957','35767','45396','19814','26603',
                          '38524','12106','50786','85603','43279',
                          '70394','75362','94249','27293','45031',
                          '82229','46851','75929','79698','85403',
                          '82268','86659','60059','70225','99859',
                          '43592','96764','86994','15796','15651',
                          '37562','90533','90503','43451','58413',
                          '78161','89036','61335','65002','66659',
                          '70138','14237','52726','43317','35620',
                          '50574','36675','34628','13009','59723',
                          '13116','64805','43935','15422','91649',
                          '86288','40364','32964','64394','55183',
                          '48770','87332','93960','45456','50044',
                          '85122','73524','32143','31096','14314',
                          '29463','25753','42720','10824','20001',
                          '21512','66960','71262','24225','22674',
                          '23546','53276','27438','91767','11767',
                          '20920','45423','57800','89535','46015',
                          '28372','92998','17789','16705','27608',
                          '16659','68110','16672','59544','22508',
                          '67714','78358','37934','84507','19532',
                          '46869','86300','56830','91265','49980',
                          '65628','92808','16249','41711','39134',
                          '71329','50413','42832','56706','15664',
                          '26842','17750','58081','84428','49724',
                          '50935','84452','31549','38182','88103',
                          '33127','96564','20689','27772','18842',
                          '73832','16773','38609','94145','37391',
                          '24798','11760','11727','46407','22219',
                          '68006','49462','21315','13683','45046',
                          '88537','95474','23032','81337','47008',
                          '49154','90131','95961','13447','15026',
                          '70640','31971','18748','88582','29277',
                          '55244','39478','89670','60596','35292',
                          '16003','67673','29541','99556','79688',
                          '75217','77999','33361','45545','42853',
                          '26684','74292','25568','22546','35268',
                          '11531','18929','19946','70041','49306',
                          '65775','96211','28949','13734','58748',
                          '30448','44591','75706','63559','50894',
                          '22983','49184','69372','54723','13355',
                          '96341','89582','19120','48793','23909',
                          '91348','21264','22960','89480','52276',
                          '10116','15225','18176','70903','85300',
                          '18347','42280','82147','28074','20896',
                          '61143','40522','28818','51722','96443',
                          '17788','26220','94178','89406','34166',
                          '39026','71332','59545','31492','94944',
                          '53871','37865','32134','30047','83957',
                          '43711','33305','59254','22403','95791',
                          '90455','31034','15124','19878','42781',
                          '91884','19237','32945','20720','60733',
                          '40220','56476','61542','39871','31037',
                          '83435','48563','41912','29652','65666',
                          '36718','23193','44508','36769','72071',
                          '64475','13708','58423','33054')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
