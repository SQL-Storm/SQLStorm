
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '64906','85875','74195','17457','81899','53896',
                          '84237','47557','43740','23033','26518',
                          '90914','73363','13583','29383','71398',
                          '80436','29261','81388','35573','58575',
                          '70721','84379','30590','37473','14194',
                          '19161','58751','32417','16475','10127',
                          '87172','89368','76134','17128','98283',
                          '42169','65597','38772','28395','58107',
                          '17985','67261','43230','59770','82034',
                          '75030','15900','72815','30704','67173',
                          '92287','89546','21324','56395','11662',
                          '51447','30493','39681','87593','23444',
                          '87809','57415','47056','12124','68243',
                          '90887','13904','34644','24889','49968',
                          '37432','31984','78815','63723','53808',
                          '40584','36230','16095','63292','29583',
                          '29811','50340','27511','61977','34191',
                          '33419','84641','15718','85643','22567',
                          '12470','69087','54149','46799','70459',
                          '47209','14148','76707','54937','71560',
                          '63737','78526','26072','82008','32637',
                          '71461','94659','11065','32523','29668',
                          '31453','62916','18659','89458','30060',
                          '79406','92506','62756','60815','13398',
                          '59425','83904','51285','95442','74315',
                          '15011','76755','27412','27779','19028',
                          '29257','18831','54679','46538','40403',
                          '55664','57080','16505','18967','35313',
                          '58888','21908','13852','13177','94820',
                          '57412','71303','70316','89578','61225',
                          '10852','37255','41616','49743','77844',
                          '42090','62276','71752','90651','93056',
                          '44278','45434','93372','96470','31457',
                          '21342','21985','47764','88917','34947',
                          '31667','88234','90255','10780','44973',
                          '44838','96991','30926','48552','37841',
                          '14443','89452','16622','89768','52129',
                          '62852','35482','35709','86884','57021',
                          '17541','32199','20568','53889','17914',
                          '10012','20721','76751','53434','12542',
                          '88944','33330','24071','59084','55701',
                          '97352','51396','30812','47274','15838',
                          '43748','69988','15339','37324','29138',
                          '46849','74541','47442','26592','75401',
                          '87181','52846','41823','57065','26504',
                          '12734','54315','11793','21547','44818',
                          '26207','50014','83402','85547','89685',
                          '11668','15061','31403','92769','16248',
                          '41741','34723','30149','96694','12747',
                          '65186','84608','33405','25126','52091',
                          '32656','47590','16208','19550','36034',
                          '97949','67600','19285','79204','44486',
                          '59348','43108','74432','25212','53647',
                          '37867','83968','91380','88596','26053',
                          '48304','74398','57679','69755','20685',
                          '26653','81108','31188','86420','50643',
                          '14376','71261','64385','99544','77733',
                          '59202','76961','49039','72844','16720',
                          '92876','92831','34991','15544','15942',
                          '92180','28595','64183','95420','15187',
                          '23200','43284','21249','11792','77050',
                          '52115','50588','71462','48463','75114',
                          '45946','46118','42335','69959','32582',
                          '50913','80993','71841','42575','16073',
                          '41952','27150','12026','97742','67873',
                          '76689','54760','48018','52408','84555',
                          '33105','70084','38446','18917','60321',
                          '34193','97497','22949','22984','76548',
                          '86795','87646','18461','37109','57798',
                          '83392','92096','46599','71290','81996',
                          '98063','97637','32904','58542','52779',
                          '16427','15956','69576','36550','32106',
                          '88613','46126','19687','12554','15328',
                          '87873','39389','76061','49887','83065',
                          '94120','95254','39799','48458','18745',
                          '38311','11020','17981','16729','27032',
                          '59209','70822','27409','25193','21866',
                          '49709','84101','50781','94963','93785',
                          '37124','19423','30506','17236','48240',
                          '13431','45281','66818','90962')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
