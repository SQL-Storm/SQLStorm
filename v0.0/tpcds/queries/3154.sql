
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '48215','87082','45204','74099','24308','83957',
                          '35700','82345','11673','67079','46445',
                          '26857','20677','80116','45903','68764',
                          '99003','24022','39622','99609','33771',
                          '72367','31382','71519','50048','16469',
                          '66976','49374','55350','30210','59196',
                          '67420','78806','45603','43940','89199',
                          '44672','53168','11453','61826','45589',
                          '31567','11668','13868','63195','84065',
                          '98108','96937','71444','12091','24313',
                          '18557','53861','20440','86772','43204',
                          '60225','10333','80377','30581','58228',
                          '96845','85047','85424','70483','21674',
                          '94438','67314','20706','53222','55144',
                          '80974','92321','81099','88597','44285',
                          '89723','71727','84610','92028','26144',
                          '37100','83211','33954','11750','95572',
                          '82771','48828','92404','32924','15175',
                          '49960','87160','62427','31181','78405',
                          '63446','34340','26710','34784','37822',
                          '56414','80854','25132','56203','26519',
                          '26279','45476','84183','21019','76402',
                          '11269','92289','46912','68505','25279',
                          '12440','43704','66570','51651','25923',
                          '18737','83153','10198','38499','87047',
                          '23495','36058','33821','10325','14902',
                          '95875','17934','15233','97044','76059',
                          '46768','44330','26274','60312','21663',
                          '42313','49055','63153','21058','21571',
                          '51405','49530','44058','13177','35120',
                          '36505','82223','10283','72943','83840',
                          '76294','35341','28751','14015','64716',
                          '34175','37623','33934','66647','93748',
                          '85757','58989','13315','59276','53087',
                          '49672','19433','25833','74456','97853',
                          '91330','64378','61075','21776','57958',
                          '33976','91539','83291','87408','22874',
                          '27255','11304','39338','71868','21386',
                          '36535','78439','41454','51070','54432',
                          '97420','20568','13881','52405','89847',
                          '87613','56789','30765','49746','65170',
                          '85258','34080','67510','42038','93008',
                          '31489','10524','30606','84807','63900',
                          '25358','83551','28007','19714','16633',
                          '39990','31801','40300','12988','67828',
                          '16188','84396','62332','84951','25221',
                          '83092','29638','54358','11237','73548',
                          '61643','18446','83586','70940','20976',
                          '20204','45989','31931','59821','92007',
                          '11643','11052','20818','45264','72277',
                          '28375','29190','52365','28307','47192',
                          '97030','90754','35289','23019','60226',
                          '73758','49192','13985','83604','22115',
                          '20385','71638','13987','86096','19925',
                          '68967','58443','42987','46694','76004',
                          '11440','11681','15842','91013','35599',
                          '71221','57254','33401','69736','30343',
                          '66881','71392','29576','34500','16037',
                          '58195','30508','32847','39241','41771',
                          '80094','13995','67915','66450','14347',
                          '40969','55821','29461','15616','93013',
                          '49862','12584','86883','49729','69910',
                          '82839','82732','48548','53562','46542',
                          '60286','21746','41905','84348','74074',
                          '60227','64833','79700','26967','29176',
                          '85463','34625','26922','43159','79073',
                          '20124','14145','75867','20287','95391',
                          '13381','77173','87756','89850','24382',
                          '19618','58013','28940','32450','97731',
                          '66590','91307','25829','27014','23926',
                          '25062','53280','93950','21667','81866',
                          '88171','38052','12861','13074','56374',
                          '20049','41290','20421','22312','41970',
                          '10900','16125','59936','96736','27157',
                          '31402','31860','42304','58742','33347',
                          '13499','43156','41555','13946','27009',
                          '46041','38945','45779','49539','31750',
                          '15783','17575','71512','95219','34257',
                          '24483','40575','17358','40204','71924',
                          '39927','75906','16312','25261')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
