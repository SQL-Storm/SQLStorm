
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '59850','90234','36870','69772','12940','38224',
                          '80992','96281','83533','55818','37222',
                          '69033','76725','11722','18413','32044',
                          '82143','55650','23830','52503','47653',
                          '43800','53901','34014','56692','77964',
                          '50887','68946','93786','31746','33820',
                          '58659','10401','69130','68136','25500',
                          '40563','44924','82885','62834','29491',
                          '68675','63609','14084','52458','20707',
                          '45557','12862','73647','40972','83773',
                          '73971','47004','95811','75345','28596',
                          '96092','46079','35824','23844','30186',
                          '54577','50825','23822','29024','11974',
                          '36235','22482','72795','18194','39810',
                          '34957','94692','83712','10075','31798',
                          '14428','54199','34409','64457','14692',
                          '50428','28726','63456','14994','33182',
                          '15316','14621','27301','75403','65354',
                          '30800','20731','29150','37844','24571',
                          '22478','49654','93040','62546','11567',
                          '10185','66489','85538','58414','27210',
                          '68501','38681','29266','33692','98057',
                          '23969','57142','11770','85848','88660',
                          '21411','32138','46189','20409','76579',
                          '16188','88103','79648','26776','51070',
                          '14159','35787','72155','18319','58512',
                          '68000','72192','31419','99174','29742',
                          '65820','33153','32635','21903','84071',
                          '54630','75139','66031','34870','44306',
                          '87157','10623','57912','97300','22023',
                          '61562','30496','95577','44652','30018',
                          '58799','45309','53110','70509','84527',
                          '69744','22530','45534','14001','14990',
                          '30288','59230','26640','93954','87454',
                          '24051','60151','88646','39631','53305',
                          '83245','29421','81299','82638','29727',
                          '46970','41620','42575','48940','42897',
                          '92072','18137','46152','17846','28411',
                          '25892','22486','18123','31177','33759',
                          '16596','44561','40324','61954','74175',
                          '60430','71811','47117','53172','39151',
                          '57930','89215','17514','49770','96017',
                          '17183','75317','15668','48825','21933',
                          '55779','51038','63391','57758','36653',
                          '59551','62710','20457','40722','19133',
                          '61253','77236','88758','34939','67152',
                          '75700','62673','56208','13817','54715',
                          '50324','73235','24564','18547','63561',
                          '18360','89851','88601','58474','42285',
                          '33133','20473','86811','30875','76931',
                          '33275','87520','26463','36731','94938',
                          '13250','12226','12084','43059','82782',
                          '53291','31129','28868','50322','18982',
                          '42844','67970','15405','50036','48108',
                          '68546','78215','68559','81287','32724',
                          '32766','61715','73500','53000','53031',
                          '13045','28607','65960','70001','88603',
                          '38058','91440','91394','48608','57024',
                          '43966','64991','17631','56840','81691',
                          '74397','69546','82918','51995','24000',
                          '99043','87321','78210','55442','34532',
                          '63039','59788','93608','25318','21830',
                          '85588','80734','79409','94872','15245',
                          '45049','96285','46769','16686','37426',
                          '34408','77565','22831','98627','74936',
                          '97531','60553','90048','30088','73374',
                          '34880','19185','25483','23469','75112',
                          '55339','95795','96291','96744','24423',
                          '17658','12358','93263','23973','79801',
                          '83666','65242','75831','20232','20754',
                          '25301','95625','46261','98486','86458',
                          '36626','33271','84089','25576','60364',
                          '65409','43970','13409','10436','90242',
                          '44931','63809','90958','97117','38339',
                          '99177','92868','49904','87430','28794',
                          '80826','45898','34520','62330','45298',
                          '69556','85589','62193','47894','42319',
                          '12335','74135','48809','52075','74420',
                          '94563','12694','81774','17411','50139',
                          '79323','34102','64380','36210')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
