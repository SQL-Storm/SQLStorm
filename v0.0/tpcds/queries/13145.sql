
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '35241','46087','52174','35933','51111','66681',
                          '80503','15691','56218','40693','48977',
                          '29243','19768','68295','48158','10001',
                          '69034','64479','10612','97105','88350',
                          '37116','17328','16473','76477','30328',
                          '22402','27825','48826','20647','23818',
                          '55507','43544','49294','75942','20125',
                          '60470','36552','37119','42502','92985',
                          '99660','87769','87990','58425','52325',
                          '15686','35139','62150','31882','76371',
                          '50350','64509','62531','41243','43409',
                          '45370','72678','21731','50339','91097',
                          '26542','88935','58036','28149','86519',
                          '21789','69552','10525','43633','84880',
                          '16294','47182','65137','50557','48492',
                          '20699','18656','41180','86344','70676',
                          '13478','65357','24052','24731','84357',
                          '43064','72367','34830','27316','61992',
                          '60162','10529','48892','20060','34375',
                          '30089','47796','32977','17276','29229',
                          '67103','82409','24171','22633','11947',
                          '53502','58730','21494','39515','88252',
                          '24669','58261','27742','97113','52059',
                          '40759','27176','52131','98097','55011',
                          '92289','21215','81377','42543','25302',
                          '19980','56033','48236','11819','79271',
                          '30944','11307','12580','53503','70422',
                          '13054','74268','85445','72401','15221',
                          '93349','47409','63786','72057','89290',
                          '18648','42537','22618','80074','95363',
                          '34939','18671','95908','71587','76789',
                          '44228','33616','67478','32294','62274',
                          '81751','65438','25282','86200','18123',
                          '46870','17519','46809','79610','42557',
                          '61098','16142','38311','91800','74937',
                          '82958','23255','27960','57343','50184',
                          '42803','11042','85554','73211','60549',
                          '99246','22894','63788','28464','12112',
                          '68827','29154','35735','13980','83322',
                          '70094','28714','69298','18415','59811',
                          '70949','60555','64197','67925','31947',
                          '62169','28178','20944','42092','45271',
                          '49832','10626','63801','20622','49076',
                          '69369','11312','77730','53790','59793',
                          '49189','19913','29928','18355','79899',
                          '32733','60811','64969','50950','86401',
                          '24688','19535','75794','11122','36418',
                          '22316','49517','19954','53677','19605',
                          '16626','41505','65304','18397','98505',
                          '47261','79624','51754','16979','71873',
                          '46280','65291','25895','58744','64098',
                          '49292','94780','46255','17419','77120',
                          '20023','21187','93157','39338','23103',
                          '57817','56649','78771','46180','33608',
                          '20327','80775','62441','88559','58536',
                          '12254','37621','50819','48783','26106',
                          '95477','62341','24694','31769','42586',
                          '88930','26332','83027','80325','36700',
                          '32484','21421','93574','13307','64653',
                          '91604','83339','63963','69058','91289',
                          '21453','93291','99087','59126','54728',
                          '30280','68742','71875','96028','30997',
                          '68412','13031','30066','41717','12396',
                          '88269','73373','13709','66312','48641',
                          '30606','37233','96124','26169','12180',
                          '41278','47115','30920','11348','16677',
                          '98647','97130','47568','81033','84407',
                          '51767','77604','96236','11953','52432',
                          '12399','98872','12307','13855','47311',
                          '23194','87329','22351','38534','19543',
                          '18380','68639','34576','20195','96643',
                          '55185','21966','12370','98959','85720',
                          '48295','20272','31839','53900','32799',
                          '92320','70471','17023','18280','54602',
                          '62674','54635','17858','57215','15407',
                          '44846','42188','23202','50721','84501',
                          '36032','11450','81276','86748','45486',
                          '44534','62713','73239','60719','71908',
                          '68061','15182','36798','82835','73757',
                          '77403','45704','91740','51145')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
