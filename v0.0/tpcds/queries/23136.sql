
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '48007','58979','63397','85889','35468','43052',
                          '52924','58611','17513','71612','69883',
                          '70570','36223','22572','56766','23291',
                          '70365','56591','24421','76267','45780',
                          '68988','94944','96032','43610','80709',
                          '21203','66778','11927','35434','56317',
                          '73751','89210','75614','96741','10798',
                          '14614','61371','16930','66046','38302',
                          '43942','77873','84734','17817','45886',
                          '29495','33682','65991','88689','56843',
                          '36553','91856','16848','50555','46573',
                          '15145','63091','23250','64593','74529',
                          '53203','95265','76663','16293','47816',
                          '76611','50764','74706','18561','24616',
                          '30116','63751','31476','40552','80213',
                          '46278','68089','85499','16248','14469',
                          '83888','27309','20328','83663','33168',
                          '73240','46876','19449','89670','98214',
                          '70364','80472','83283','53746','36126',
                          '65916','12546','25992','70077','86667',
                          '12253','11413','70707','56751','63867',
                          '10217','31611','14762','15959','97567',
                          '18845','12004','28163','40149','22729',
                          '91472','19632','15639','21412','90452',
                          '23358','28151','15553','66386','65072',
                          '46504','57607','63672','46833','39402',
                          '65235','27188','81009','12075','69190',
                          '20125','52542','74588','24761','90546',
                          '23503','17615','20163','82575','63938',
                          '84609','52506','57839','61420','76163',
                          '12040','82018','32481','73446','93731',
                          '21180','10443','82082','14159','32906',
                          '38040','77280','11794','15168','37128',
                          '14291','44326','55073','49278','44635',
                          '41296','56053','19325','25497','20664',
                          '26854','37671','49214','80996','13699',
                          '29074','35770','42965','12451','42262',
                          '23669','61504','88080','21819','73163',
                          '48734','81368','19625','36409','70788',
                          '50073','40951','35888','11533','48206',
                          '17861','58564','16116','65316','76171',
                          '57485','55581','29506','74448','81181',
                          '24420','12071','80095','68919','74643',
                          '59784','22720','19026','11289','76220',
                          '56469','53225','91992','60903','45279',
                          '21736','64184','69819','28842','20637',
                          '20601','15080','97230','20207','32464',
                          '57325','20398','51504','30962','48207',
                          '95880','83688','22676','56372','20122',
                          '16659','57218','69974','98614','13992',
                          '24176','79744','95778','26228','30190',
                          '95933','42795','55001','21358','15916',
                          '88976','45560','82622','89913','73965',
                          '38325','64193','72452','16611','45641',
                          '15550','39678','64973','49163','72086',
                          '43095','30005','82111','64899','98571',
                          '97482','89175','61778','57787','82732',
                          '62302','24954','27356','83277','86181',
                          '70470','31771','17364','61994','13613',
                          '17251','32193','33730','78019','60631',
                          '78992','46540','70877','78558','86460',
                          '33472','40320','21082','51464','28975',
                          '62665','96771','52096','84035','42622',
                          '17395','23977','46970','59874','43763',
                          '69325','48530','47657','95635','56852',
                          '20038','23505','61379','10886','69045',
                          '74757','63413','19851','92431','54191',
                          '87171','14940','14972','15719','35370',
                          '60709','41970','92027','85260','81566',
                          '33080','21784','96775','68075','11782',
                          '90653','51396','71555','67383','25392',
                          '15846','75677','38907','16445','57756',
                          '59152','48184','31054','79135','96668',
                          '68956','35828','55608','90033','72772',
                          '90263','64923','43692','66524','29948',
                          '20196','20736','88180','32433','69235',
                          '81532','94114','72217','15872','14373',
                          '32505','17108','86105','26219','68958',
                          '46034','53032','94090','33782','63051',
                          '58440','20842','48354','12591')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
