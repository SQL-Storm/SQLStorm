
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '79052','30209','67540','16617','45578','16131',
                          '66209','83096','29980','51770','20250',
                          '86145','14245','38963','36766','29964',
                          '48013','55417','93254','97542','20902',
                          '36948','56468','11993','91787','94847',
                          '17007','19599','41928','28131','50035',
                          '69118','99214','15354','98374','86871',
                          '23250','84347','10952','44165','99130',
                          '26932','21336','53296','74244','99228',
                          '71941','61107','71991','37146','44446',
                          '76451','70398','11724','64099','29572',
                          '57621','52082','41448','14826','76998',
                          '43076','53607','78180','17722','59695',
                          '73790','53719','23888','86267','75194',
                          '89293','30306','47895','40530','42134',
                          '63900','63458','62742','35916','78289',
                          '24419','87107','14535','54385','61536',
                          '71232','13187','54561','41183','48818',
                          '64625','23044','17494','16736','58472',
                          '81957','29826','12696','82556','86659',
                          '90908','95973','10189','36854','16885',
                          '71248','58172','51194','73808','35559',
                          '54355','63165','69007','67166','41561',
                          '62741','15371','48349','21512','17435',
                          '16835','83331','20852','94308','90837',
                          '62627','93473','32802','78464','54606',
                          '34975','12863','87350','25758','87540',
                          '39832','15220','79182','24831','36788',
                          '23039','56531','40242','27790','59208',
                          '39135','30642','83426','91660','79871',
                          '81195','29792','66195','76163','29482',
                          '51566','19883','89729','81784','11450',
                          '35859','12115','47241','64252','68689',
                          '47275','21633','54962','93483','16994',
                          '49447','86797','22300','39235','46252',
                          '46267','12503','59427','25629','61006',
                          '54825','16350','34956','46545','35608',
                          '24307','55540','23034','16150','74212',
                          '46518','47124','47706','99485','39313',
                          '54327','88231','14653','80584','49323',
                          '14112','65360','25886','66769','19115',
                          '22852','54820','37142','38302','73338',
                          '44488','68034','15041','94235','92348',
                          '29366','49798','94854','96640','20565',
                          '27236','66852','23021','30829','71957',
                          '77223','10170','82680','18863','37204',
                          '30461','81766','87542','70309','29385',
                          '80667','26505','36266','61450','24915',
                          '69356','19496','37130','85829','29159',
                          '45326','24507','52694','25079','51681',
                          '27099','42292','20023','22857','87956',
                          '10652','98280','66802','71983','78038',
                          '57642','20800','68393','73931','78251',
                          '27481','39839','70866','19849','83976',
                          '57150','60498','45409','67812','14489',
                          '86196','18303','84881','21670','27834',
                          '68276','21531','85196','23874','73349',
                          '91445','72614','64427','37453','84088',
                          '39093','45325','75349','86892','39274',
                          '30362','37267','85560','85099','81209',
                          '92781','48772','10579','55550','92612',
                          '68804','23049','20176','88058','50316',
                          '36433','43179','20395','41723','94331',
                          '22810','91004','81922','30862','99970',
                          '61274','65708','34543','63649','97497',
                          '70028','74775','23992','88198','26608',
                          '62209','77027','81458','39903','30333',
                          '25343','83561','36154','15436','55786',
                          '66517','44638','97029','47001','72959',
                          '90428','32860','45084','22974','17372',
                          '56479','28994','69874','71047','97341',
                          '96896','47019','10326','68490','25005',
                          '43350','39271','66462','95369','87744',
                          '84845','89935','79745','79488','44204',
                          '60961','34127','95781','14688','32385',
                          '21931','51357','95259','72018','77187',
                          '94040','93396','35306','26711','35657',
                          '88593','97869','40257','58960','41111',
                          '15783','28067','15367','89595','85148',
                          '77647','50897','84792','26825')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
