
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '77286','79693','42119','82850','73039','50567',
                          '99823','15390','79963','15335','20796',
                          '29993','39357','69767','45825','12162',
                          '48385','56950','80988','54860','85334',
                          '89235','87459','21911','10871','33655',
                          '29495','67793','45475','74453','21940',
                          '67757','78365','10974','56914','81021',
                          '17524','82598','23676','11004','58846',
                          '42709','66339','56899','22747','74042',
                          '42903','75302','93144','75196','63484',
                          '12521','88405','72130','42262','11127',
                          '44066','20792','81543','20885','95667',
                          '11296','28154','65369','81452','59360',
                          '19737','58622','84776','24218','82252',
                          '54236','15889','28634','44778','30570',
                          '37674','51223','67493','49943','84377',
                          '36127','10651','10068','41209','46611',
                          '18066','47340','50704','22857','62258',
                          '81001','56211','10375','15884','39581',
                          '26449','67482','53917','51720','56025',
                          '26223','79912','27733','33383','97833',
                          '18722','54800','56194','26815','16936',
                          '55290','64192','11029','75919','27877',
                          '60800','14527','74702','37128','56480',
                          '32440','37976','26273','31743','29366',
                          '75798','99867','62412','28332','65825',
                          '73541','73259','63526','72707','95137',
                          '32020','84673','58360','62375','17687',
                          '92744','29044','26207','41582','15931',
                          '28703','40719','82806','96102','41035',
                          '97179','26175','42882','10610','24037',
                          '65135','28548','84913','41299','63051',
                          '32285','71603','40393','49586','30240',
                          '54556','14429','91585','22787','36690',
                          '26063','43851','21740','79905','11952',
                          '75340','84558','38002','38902','67299',
                          '54145','65517','15084','16300','44910',
                          '40993','56036','35894','75606','87582',
                          '40022','11867','38720','17181','12527',
                          '73500','49959','33488','46555','39895',
                          '11682','75202','35577','66855','26825',
                          '21018','21606','95104','99007','33667',
                          '78171','23917','25338','53315','76300',
                          '34732','44993','13662','93873','31913',
                          '67600','14479','74598','15913','15711',
                          '16330','47360','80565','83625','12317',
                          '11648','14788','11157','40047','68241',
                          '48452','98544','45055','91298','37580',
                          '63892','98461','58026','83138','69515',
                          '56744','59725','34467','21086','86859',
                          '57938','94310','64925','13317','15878',
                          '66031','35985','24111','39844','41891',
                          '41095','94026','80859','90699','76107',
                          '73257','24302','19583','79805','64921',
                          '63034','54086','64422','20269','55735',
                          '84035','17086','39532','86977','33942',
                          '19950','27484','32667','13956','23670',
                          '80800','16522','24275','99471','68870',
                          '70170','97451','65806','69710','24481',
                          '29766','38603','46926','51042','49284',
                          '41468','99845','72138','58682','37332',
                          '33671','85009','29995','42863','20524',
                          '28238','31537','16209','30635','61099',
                          '53110','25773','41759','60756','46089',
                          '11027','63702','27952','17066','52078',
                          '33850','24378','12325','99847','72204',
                          '16896','46885','59597','24197','34169',
                          '19987','41412','93457','54246','63742',
                          '44301','60672','76886','86287','20739',
                          '55889','39802','17586','76623','96696',
                          '59289','33703','21246','65922','20267',
                          '32928','41237','52028','34113','69850',
                          '57334','51448','90635','41360','36342',
                          '44708','11149','91201','38219','43825',
                          '53329','67439','64898','11376','73511',
                          '21690','40780','68674','33138','56544',
                          '23781','91459','17080','60169','29492',
                          '40676','70872','70811','96247','87546',
                          '11971','20931','75854','53900','13882',
                          '39176','56872','62466','87731')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
