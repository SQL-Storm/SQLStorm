
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '94881','90690','64558','45889','37392','19516',
                          '61953','54866','13689','67522','63280',
                          '65092','59321','27074','25540','53681',
                          '57837','17609','10840','89260','33002',
                          '63818','23780','69782','14752','89750',
                          '33008','67432','20451','70544','63059',
                          '57929','58393','30617','65212','92591',
                          '64439','16192','47988','82714','58801',
                          '69967','19999','43572','50497','46306',
                          '37196','36279','90637','80679','66066',
                          '63572','87511','32040','83366','80733',
                          '68745','32483','88424','69372','12914',
                          '21802','55477','10930','15766','55473',
                          '18128','79845','61419','95086','32198',
                          '20422','36609','42722','65858','76859',
                          '36783','40461','94715','54762','52900',
                          '64283','78663','28237','31455','49008',
                          '75462','17451','52609','55183','18094',
                          '60213','25515','38868','26238','30022',
                          '39292','31749','81672','78072','56176',
                          '44244','70614','13481','42725','24534',
                          '38074','15141','68304','11735','30386',
                          '16224','35778','10311','17749','76030',
                          '43759','39887','78826','65135','12337',
                          '85389','24363','28334','72963','65435',
                          '17034','27818','86059','19604','17447',
                          '86750','44852','83419','35713','37856',
                          '59772','57445','19741','11254','83224',
                          '20351','32373','99449','13782','80813',
                          '34899','32324','68137','28849','47322',
                          '14806','55435','51616','75273','14916',
                          '45224','98280','36950','27847','69519',
                          '61801','22679','66892','25937','49225',
                          '15997','12530','21784','20028','54251',
                          '82709','35412','43267','80046','20649',
                          '90240','10342','48037','20588','72858',
                          '18329','45796','69885','98868','31167',
                          '57871','11116','21900','40275','60464',
                          '59886','20845','11401','62889','65663',
                          '59721','73454','69949','55901','33317',
                          '87788','29173','53335','67372','10430',
                          '48645','19284','32274','93023','51687',
                          '59461','19549','26141','57826','52791',
                          '31597','52123','31497','90762','49696',
                          '30093','29486','40890','18951','71226',
                          '78342','25330','23805','50037','23460',
                          '40483','69560','38930','15912','94428',
                          '64536','56217','18946','98146','78303',
                          '35704','23700','54153','28419','57797',
                          '51923','46872','35016','52898','44976',
                          '26756','72133','10333','51220','73336',
                          '83906','76792','35446','14218','20950',
                          '27832','17059','38008','16943','52953',
                          '51360','45943','65093','26714','49295',
                          '21807','59171','43687','86224','86259',
                          '24575','34951','58922','17474','99260',
                          '14802','10329','19682','93069','10951',
                          '52080','66152','92244','20378','11325',
                          '56634','44544','53142','91872','36514',
                          '37171','76485','47470','90784','39291',
                          '12045','47425','98077','21729','67672',
                          '64157','46588','53120','11148','12095',
                          '48266','26534','38119','36671','89373',
                          '20105','92924','29024','27674','75517',
                          '72680','23512','20234','12164','30120',
                          '53129','34877','11039','86267','93109',
                          '68091','15374','81901','12920','98801',
                          '18779','37025','75776','57810','50163',
                          '32185','52840','32014','85580','93196',
                          '11721','40868','44313','21409','28170',
                          '34004','37858','34721','27990','47705',
                          '31326','12101','16755','15347','18642',
                          '43099','71698','57001','59619','71821',
                          '61780','94441','76302','75976','30768',
                          '80470','20777','55262','28696','42679',
                          '60390','97885','56421','26479','43382',
                          '12037','57765','25009','97963','14832',
                          '10506','92469','82580','57408','81032',
                          '25122','34410','26520','21106','42353',
                          '79885','90270','17436','56649')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
