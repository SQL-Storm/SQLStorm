
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '82299','58792','89062','33736','48027','14925',
                          '28197','38543','49957','27132','24311',
                          '27650','14018','19681','46731','33153',
                          '22019','43826','71335','30285','59577',
                          '48384','10580','49849','85880','29658',
                          '45795','62279','62220','49541','52267',
                          '63214','96422','30808','57989','75007',
                          '74224','12886','54392','40992','11139',
                          '18295','25940','26247','13966','57953',
                          '21613','49327','25658','66394','73655',
                          '95020','90216','20921','31779','76785',
                          '95740','76921','68426','69308','20209',
                          '16702','89214','95149','87901','12885',
                          '31770','24819','48456','19214','42408',
                          '91362','96591','13992','35757','26084',
                          '28091','86466','59982','67346','34812',
                          '85908','37399','33871','78745','28560',
                          '72269','79800','55846','36453','31685',
                          '44208','49980','80813','51785','79357',
                          '85438','19314','26032','23620','78152',
                          '64038','94923','10545','38341','37270',
                          '19842','12405','25189','41610','34641',
                          '46787','22269','83585','13941','67535',
                          '22398','92463','49912','15326','32383',
                          '75558','53814','27718','27021','48830',
                          '72869','16549','44589','84647','44776',
                          '22240','50121','26616','84509','40491',
                          '94710','12938','55360','52068','98884',
                          '71200','79696','98782','13518','65184',
                          '15149','76400','90763','17883','71889',
                          '14790','20500','43533','34175','42800',
                          '19271','37617','71007','45151','15113',
                          '14947','35216','81304','94933','10912',
                          '62712','17710','38056','98663','59369',
                          '64665','21813','10841','60758','11381',
                          '31954','21861','57865','99958','62450',
                          '10309','45910','16465','66999','61350',
                          '40083','32869','25629','49680','45185',
                          '38727','43972','55423','56571','83976',
                          '75722','85514','92147','27849','46354',
                          '69419','40198','31113','61501','13734',
                          '70752','60579','67666','14746','77085',
                          '16927','32364','40003','76049','61103',
                          '74546','77767','37320','85922','91286',
                          '51602','53850','37652','95074','10720',
                          '41731','53484','46583','18389','98248',
                          '58198','24487','97099','29920','35360',
                          '85991','27400','90433','84750','56395',
                          '80034','56612','59618','14290','74688',
                          '61104','15489','92545','11964','17477',
                          '48220','40623','19128','68351','25802',
                          '58567','26471','89962','24388','92957',
                          '43507','45434','59125','62084','42990',
                          '26859','20703','39258','18248','44748',
                          '46993','38565','76738','71004','69186',
                          '30789','27869','44385','25607','51414',
                          '59852','54201','56965','91817','23974',
                          '68534','56513','12220','23178','67740',
                          '62590','40424','51616','63823','52064',
                          '42120','52659','27879','50097','45380',
                          '11297','36988','25020','67727','70507',
                          '82537','98887','68992','41011','18496',
                          '11857','11860','17437','30560','69633',
                          '95880','10232','93222','80004','13406',
                          '83859','82851','10667','23268','37263',
                          '65505','45698','92093','89113','46654',
                          '69951','83965','15826','10183','56382',
                          '35613','67829','97334','16797','18468',
                          '14610','17180','39732','56293','20002',
                          '41047','55538','57673','54241','40766',
                          '84455','47402','11163','41763','30595',
                          '99893','57520','78545','31042','28432',
                          '81436','41842','17446','91290','42073',
                          '55530','72052','57074','72004','98317',
                          '16851','25859','38013','22996','29437',
                          '66117','20294','93719','66637','90100',
                          '64542','10591','36305','39129','31333',
                          '92104','89940','45393','37132','32267',
                          '64389','65466','52113','36167','82676',
                          '38461','36808','25920','16681')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
