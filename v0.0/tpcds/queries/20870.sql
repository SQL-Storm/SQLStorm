
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '59049','44752','12289','30290','58520','77698',
                          '41569','53857','58722','95147','97746',
                          '77186','89376','12284','16865','58448',
                          '48722','10511','10521','51745','78871',
                          '14132','95710','15752','18652','19939',
                          '56028','12770','59828','40797','88391',
                          '44209','80411','64182','53676','35172',
                          '86692','50817','16688','39655','56732',
                          '58101','77178','32629','15858','93772',
                          '31586','73595','34588','24293','25847',
                          '58096','45783','89836','45302','60309',
                          '39327','89314','56874','93300','48489',
                          '16976','89474','54901','55610','38495',
                          '70226','94775','38552','87705','81912',
                          '64517','10294','39804','31451','33391',
                          '47985','12254','70798','34525','68550',
                          '97820','69579','11620','21604','63028',
                          '52172','94949','30580','37660','85022',
                          '86984','21863','44789','88104','84514',
                          '34478','19279','32062','47393','18319',
                          '96053','43111','69507','80437','42958',
                          '83910','29002','17356','19096','74765',
                          '49849','13586','79413','35449','98242',
                          '94113','57939','39089','97700','51828',
                          '71763','78679','61280','30337','45084',
                          '93663','53111','50530','23431','28362',
                          '30212','76388','44053','15435','46068',
                          '54000','90320','54334','38451','81894',
                          '86644','67527','22623','52838','20443',
                          '64994','15731','49309','41592','91116',
                          '33441','26463','73284','23001','55575',
                          '47362','38093','47280','67821','34729',
                          '30111','89999','51836','56877','61085',
                          '24405','29318','88403','42385','28950',
                          '13142','20976','19722','11435','90887',
                          '53945','41067','29649','82047','39760',
                          '11595','42806','80252','63784','22864',
                          '64658','85117','28128','54003','93166',
                          '88815','61157','36924','50170','77801',
                          '98166','26872','39582','96715','47669',
                          '18035','55186','33875','14134','31474',
                          '26020','90489','76934','21192','70401',
                          '26756','28725','45384','40228','56666',
                          '57510','23204','77949','20158','99797',
                          '45672','86490','60352','32396','49766',
                          '64883','18872','54473','14702','61789',
                          '48227','53937','14527','77648','14679',
                          '87486','16442','75394','18101','69632',
                          '77370','51588','49041','19106','37048',
                          '12612','64953','31886','63770','31218',
                          '28234','33533','26605','73753','52410',
                          '88008','22179','94409','54014','65479',
                          '66038','72182','52235','37337','37598',
                          '17790','30479','45941','87853','59675',
                          '29763','77575','50765','10981','82950',
                          '42909','20429','74072','51869','51009',
                          '82453','66788','73686','29204','72556',
                          '41819','19078','22031','37718','84605',
                          '38064','24261','51674','14235','16693',
                          '27605','47449','22734','16318','55052',
                          '15926','38233','29993','19068','51983',
                          '61480','83168','21911','70844','22520',
                          '12117','29628','48333','29014','39862',
                          '74274','30779','42536','43986','87685',
                          '38535','32838','84811','64248','23247',
                          '32555','13826','96442','45381','37277',
                          '62350','98306','62505','76578','98447',
                          '64038','14398','49104','65874','92229',
                          '45852','94092','82112','32301','21937',
                          '65934','54679','54060','21076','23934',
                          '59756','24125','25094','42394','13905',
                          '99818','30511','33244','26804','60378',
                          '22862','77144','12141','13184','61456',
                          '10954','36467','96234','65191','64413',
                          '79742','32767','86346','39617','94876',
                          '76056','49218','81488','97196','61715',
                          '12653','29199','99000','28705','34321',
                          '57586','74857','41539','53939','63678',
                          '96348','55296','66201','11990','43374',
                          '73706','38303','73292','54126')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
