
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '56413','91706','89601','81113','32802','59881',
                          '66543','33960','37343','78928','67110',
                          '37686','12244','90155','89783','34448',
                          '61365','24011','76152','15554','71107',
                          '32393','94845','24847','18118','76997',
                          '54096','49236','34155','39188','17958',
                          '97659','47363','71240','47896','58723',
                          '11752','51110','89483','65846','37726',
                          '60724','65040','12380','54251','39754',
                          '48678','76031','80155','50289','32224',
                          '91199','86597','13677','22568','37199',
                          '21671','51987','64914','74932','23371',
                          '67563','95629','71707','37413','17090',
                          '10693','79749','51969','30832','58028',
                          '35778','67194','67989','38583','37817',
                          '25962','52050','32318','21283','24242',
                          '43764','47040','32273','53478','29995',
                          '11023','31627','29335','25087','27772',
                          '21672','65029','30678','50425','81632',
                          '63804','72101','36843','19099','78629',
                          '81306','61267','82387','76163','50889',
                          '15770','99131','28270','22231','78704',
                          '63568','62739','15714','34623','56009',
                          '89173','31607','60261','95098','89113',
                          '39651','52107','93633','59824','50554',
                          '64858','59918','18958','12989','81860',
                          '40755','80156','36331','10127','78203',
                          '31657','44556','74786','80754','97822',
                          '10198','83717','99320','65213','31412',
                          '94394','51410','86213','49464','41672',
                          '51141','67256','57519','18794','15909',
                          '83339','47387','85988','72137','28047',
                          '36243','98245','14631','63064','93650',
                          '29027','24490','39938','29458','31804',
                          '16510','47592','10588','56417','79785',
                          '81390','49137','41483','17841','63919',
                          '78241','90859','40043','97461','46490',
                          '12917','41904','96300','40778','45115',
                          '46710','42428','82765','56447','28823',
                          '70380','64346','68530','33962','91902',
                          '32064','62349','22712','50647','81100',
                          '37677','67509','12232','97136','45376',
                          '73137','29442','12000','59024','98683',
                          '71706','29213','91520','41219','54783',
                          '28956','50313','74710','98537','59919',
                          '25398','39549','42641','88135','15877',
                          '86330','59563','48867','21152','75805',
                          '81231','52584','18540','76813','37744',
                          '98612','11849','49273','64826','23366',
                          '35319','91479','32961','90964','72338',
                          '37683','42194','76827','83951','32223',
                          '65266','40796','40902','42892','38585',
                          '27746','31062','21830','15791','81148',
                          '41824','75869','25960','54115','17873',
                          '15706','97716','10449','24758','30681',
                          '76496','44821','62962','31921','52397',
                          '66998','83022','10187','98135','26900',
                          '48556','87130','32679','81538','93761',
                          '21114','75152','26824','92317','73523',
                          '90634','80644','52791','52826','18363',
                          '91741','88770','45593','35524','63992',
                          '75397','45792','77572','54442','28599',
                          '36091','26832','18893','32938','53832',
                          '46341','85977','76278','84928','73757',
                          '53345','47970','53684','73918','22691',
                          '68800','32458','36019','89764','60039',
                          '98172','78945','98823','19687','80682',
                          '39864','62330','28144','42600','75518',
                          '51816','50614','32254','90966','28204',
                          '94106','68410','35925','21405','51697',
                          '59595','88413','16029','15402','15629',
                          '92830','15848','21662','55653','85881',
                          '40988','37876','40205','31312','50331',
                          '15011','90515','63526','45569','47132',
                          '65097','22705','21221','35314','28134',
                          '68918','23922','36314','67875','49788',
                          '54274','57972','92328','20930','88750',
                          '57841','16857','21913','45316','93259',
                          '46491','68297','74514','68244','14044',
                          '10465','71429','30561','30432')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
