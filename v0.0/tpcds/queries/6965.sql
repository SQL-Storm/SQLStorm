
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '30259','46236','24725','46835','28872','73465',
                          '21758','74192','14018','49304','21998',
                          '68040','59164','18572','57085','22936',
                          '85880','26087','15544','77722','70934',
                          '68930','55636','60416','54648','46628',
                          '43961','82892','32608','50239','63943',
                          '84259','56310','44758','34205','79103',
                          '26755','67689','54258','23188','72041',
                          '80422','95149','18714','37140','68122',
                          '70001','85476','61739','43361','20201',
                          '73354','81774','37749','52402','62730',
                          '89238','85924','78951','19539','12571',
                          '73190','30692','67903','41622','69806',
                          '83499','11602','94923','14552','58590',
                          '23017','10400','39712','91039','50342',
                          '43894','70280','41204','18231','28141',
                          '12233','74653','11490','16609','19118',
                          '38932','64312','16901','69229','15958',
                          '48194','31532','27209','29184','36934',
                          '18113','76947','37071','40041','75237',
                          '32296','47577','97943','59705','17809',
                          '51750','55168','19343','28956','40733',
                          '54475','32828','89057','76930','18357',
                          '96309','91614','92508','13426','62450',
                          '21588','68020','33730','85332','95887',
                          '81913','60254','30942','29600','30208',
                          '90031','92147','82646','97832','26205',
                          '57958','88232','90112','46933','22463',
                          '47611','66027','34953','63908','74269',
                          '68853','45256','55409','81217','38664',
                          '57965','93410','89696','85861','61867',
                          '22177','38337','78554','81575','46374',
                          '75416','87860','63352','95012','55868',
                          '28231','30713','73331','11486','49616',
                          '50974','13886','74584','13056','37923',
                          '41292','93587','69557','64020','15842',
                          '30179','65352','82803','13835','70203',
                          '60219','57364','48302','26547','35749',
                          '89836','42966','83879','97390','29927',
                          '30907','64726','10949','91984','45380',
                          '12188','42117','77725','51149','10839',
                          '99948','44163','21378','88290','78172',
                          '88834','31934','36632','50796','14069',
                          '25793','27170','56259','89283','91581',
                          '41816','67116','61674','38522','61466',
                          '72176','42309','36005','37727','35803',
                          '21094','29718','47100','54308','38375',
                          '96401','20792','94754','52373','69081',
                          '54135','91479','52862','30734','51008',
                          '72004','42422','81332','72313','99499',
                          '75865','88298','89816','52308','30527',
                          '27837','80981','93554','16053','13141',
                          '35314','66228','90847','36456','39670',
                          '26677','24780','77159','42324','23540',
                          '73742','18225','93277','27263','20475',
                          '81742','97369','97342','14126','44531',
                          '13235','88749','36749','73803','35396',
                          '82434','65748','48399','83493','36409',
                          '13200','76885','40346','71647','65521',
                          '45298','26552','13433','60860','11503',
                          '25289','30585','11105','71710','68571',
                          '61485','50212','20915','47894','24724',
                          '43356','17733','70723','26400','84987',
                          '49695','43482','17716','34126','50878',
                          '26804','26450','70445','22165','40791',
                          '56557','39923','29134','32821','20674',
                          '12522','28464','97346','54950','89502',
                          '42917','68130','65329','73704','35348',
                          '51034','57513','54005','52450','64465',
                          '32816','17559','10806','52554','30511',
                          '25333','64935','22891','18356','53744',
                          '74851','56927','50323','60062','67441',
                          '60039','48578','37787','53658','54749',
                          '50755','53448','10662','19320','74302',
                          '49891','73574','49402','26526','85667',
                          '12917','82376','75878','46115','41282',
                          '48977','91975','51317','22526','76558',
                          '10549','75623','51876','18764','87630',
                          '14934','41392','53603','93120','12012',
                          '79798','40152','18496','29726')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
