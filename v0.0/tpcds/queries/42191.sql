
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '86927','29001','94618','27479','93324','97376',
                          '77840','16464','72077','37370','24749',
                          '87979','33069','16839','65300','95611',
                          '54115','71130','50279','24894','33554',
                          '54672','96796','27938','63616','33776',
                          '63753','47887','77608','41853','29176',
                          '60799','43750','85435','12742','40848',
                          '19556','25044','89540','39313','68890',
                          '97755','26213','34235','15703','29040',
                          '45147','46649','10470','94814','34123',
                          '47770','84695','25243','23051','55008',
                          '51704','53059','12805','93113','51656',
                          '60928','58811','71521','42847','18584',
                          '78196','11645','83615','65201','60181',
                          '96028','17666','10979','91849','40711',
                          '15203','14922','73881','84381','52641',
                          '98324','18462','10068','10439','29762',
                          '73677','16019','22069','35419','13798',
                          '18090','46492','57829','20773','24073',
                          '30836','92457','47860','50460','84408',
                          '40849','90452','12965','49751','22544',
                          '22552','16633','24856','90095','41354',
                          '47733','36791','60078','64286','42850',
                          '16760','32234','35905','23612','81330',
                          '23509','20297','43074','72747','70426',
                          '16528','94712','98110','55931','30675',
                          '80330','20340','67020','61792','17042',
                          '57996','58683','21910','36598','46402',
                          '89240','75768','35934','28890','34411',
                          '89671','35434','26796','24191','17092',
                          '27052','15034','57675','43553','84892',
                          '68685','50810','42534','13191','40686',
                          '34761','85843','73064','18468','48564',
                          '33779','87213','29944','54874','90386',
                          '68965','89087','15482','65100','76157',
                          '16616','16972','59040','30901','86681',
                          '56121','57718','40844','19703','50079',
                          '34829','28922','15124','86041','63774',
                          '11240','87977','27755','36586','15857',
                          '22550','76777','80268','28414','77254',
                          '10737','35163','92963','76891','60812',
                          '55328','92606','13854','82426','90648',
                          '52230','21476','62542','80893','80899',
                          '32807','11272','92657','82994','41185',
                          '35239','16044','70711','29033','14336',
                          '11769','42986','27794','34999','78754',
                          '10246','87030','28934','12802','14751',
                          '39672','36189','46860','41673','92762',
                          '69174','67584','24068','83382','33519',
                          '78204','11685','89249','80518','37975',
                          '12503','54423','48975','16986','21045',
                          '61514','65833','12176','98807','40047',
                          '91815','34068','85987','62489','14158',
                          '18488','59046','94883','48516','77123',
                          '17210','27963','21631','67057','43779',
                          '43127','53488','24051','48064','61273',
                          '83905','45119','87693','10866','17384',
                          '53439','99854','25861','76939','69135',
                          '26725','19524','98915','29993','77597',
                          '49394','91901','50265','30809','57512',
                          '51554','27710','17426','82386','56054',
                          '65622','28402','95746','63689','23105',
                          '46029','29660','95531','13415','58778',
                          '22528','91259','16967','42716','48687',
                          '31746','13480','90180','71715','60092',
                          '12996','79913','34675','45336','71939',
                          '66015','20906','46145','68274','56603',
                          '21332','83198','47224','71820','11032',
                          '16748','33004','25232','64212','20111',
                          '88053','93996','99679','15342','24626',
                          '60661','54312','95319','31923','44530',
                          '63036','45782','41892','81145','35794',
                          '19680','80784','81712','12712','12860',
                          '77825','29715','52868','83472','11339',
                          '67791','25187','17559','30117','30222',
                          '50413','89692','92629','95332','88186',
                          '45658','54835','45043','18923','80135',
                          '23161','65740','79209','29146','74422',
                          '27187','29062','87111','24627','43964',
                          '10950','25577','10023','84250')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
