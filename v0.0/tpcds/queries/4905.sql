
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '32962','74389','87528','14860','55741','42506',
                          '79851','22767','72457','65336','68361',
                          '51150','30882','53483','14077','45902',
                          '41006','80285','35747','73949','34612',
                          '64375','62711','54485','82014','16208',
                          '26852','36104','17146','13617','12140',
                          '35852','78550','48030','48191','40505',
                          '56359','12542','47304','30341','78396',
                          '41459','52279','67059','49587','29672',
                          '40235','65146','36017','97089','25228',
                          '14676','44254','57186','83570','37207',
                          '39729','79299','29853','20533','10694',
                          '39498','89952','12338','74535','72383',
                          '68266','89130','72536','21494','22860',
                          '54746','14305','81762','38964','52977',
                          '49239','88026','98897','20254','78595',
                          '72460','50090','34691','91432','34708',
                          '60819','48613','39244','83200','60021',
                          '46558','99177','98134','16984','84633',
                          '75506','56801','43238','62909','59787',
                          '18576','36196','50478','85656','51323',
                          '24419','13789','19895','11167','51037',
                          '23575','83085','26743','59126','35581',
                          '50321','27602','48271','80338','62218',
                          '79576','40101','63370','31426','61533',
                          '69907','80775','57295','66305','39292',
                          '61345','81477','44484','16278','28115',
                          '65104','70481','82876','23382','20016',
                          '31731','12540','91891','52143','89217',
                          '32724','69047','24431','13006','48497',
                          '72502','29384','10061','42435','40099',
                          '56838','80429','46405','64244','94721',
                          '69069','53446','89699','17585','67159',
                          '11861','45345','80054','29053','54966',
                          '57594','70061','40455','54946','78797',
                          '17055','10607','85009','34978','27752',
                          '27265','55429','92233','69182','66813',
                          '33012','14226','17876','98315','52742',
                          '30744','28913','34700','58437','18081',
                          '35058','68252','23340','51989','35828',
                          '22516','69194','51663','66350','83079',
                          '33514','87560','64130','18818','89139',
                          '99717','56270','44118','70558','79418',
                          '63812','64006','66767','20865','16179',
                          '89020','35624','97446','75525','58457',
                          '95628','58040','42049','23261','22730',
                          '20728','31377','99791','98039','52678',
                          '83245','21685','79006','82947','66676',
                          '55103','78048','57865','73377','37826',
                          '21219','31250','79148','45338','26677',
                          '75305','35875','59373','49736','81091',
                          '64378','39007','67423','36851','45667',
                          '88194','47693','19378','81921','95481',
                          '97404','68446','72729','45274','15788',
                          '85210','52698','19458','96423','66839',
                          '92104','51357','86091','10846','24908',
                          '46353','15202','82273','66757','74178',
                          '66487','89784','91108','86079','35418',
                          '48508','28694','40165','58566','98588',
                          '95830','79266','72165','10914','34717',
                          '66095','68853','30570','31235','10328',
                          '57585','55629','45203','63967','88443',
                          '10096','12206','13235','45570','45422',
                          '47425','40790','30715','14080','37837',
                          '53104','58647','64003','15395','26849',
                          '56274','15354','19091','88462','67926',
                          '19869','85292','73005','14138','51878',
                          '53071','29714','82387','84864','26162',
                          '49693','16345','30607','26884','35257',
                          '84341','95249','63507','73435','36188',
                          '19315','16553','48996','37647','71477',
                          '77728','41401','42257','75522','28377',
                          '83509','76694','16085','67445','22816',
                          '36900','53589','44796','68684','93315',
                          '63705','71983','79419','63319','44560',
                          '10248','29323','25639','60469','13177',
                          '83292','26161','45269','94237','31502',
                          '60783','61939','65118','83682','22868',
                          '33239','72760','83281','22820','29993',
                          '73657','85834','45084','63545')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
