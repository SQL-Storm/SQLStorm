
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '43177','59721','24928','38803','95249','72059',
                          '28523','90613','94563','91421','25436',
                          '18832','54397','78089','93609','57077',
                          '48735','18540','31609','95002','32202',
                          '11144','37250','70040','46662','87792',
                          '94794','87443','25833','37497','37641',
                          '87090','97167','60077','14735','64583',
                          '32178','13540','15449','95176','38998',
                          '51638','94145','50460','56800','27748',
                          '17197','89756','15597','10971','60437',
                          '28613','93313','64970','67309','24298',
                          '74678','47444','82452','11862','28430',
                          '76660','41207','33658','42437','98527',
                          '36383','25297','41393','95670','78660',
                          '14204','99534','76794','89570','45928',
                          '44683','45428','37090','87238','51430',
                          '66783','71547','18526','40264','22301',
                          '59452','58806','91439','36137','44657',
                          '89671','89887','75446','43792','89199',
                          '22419','46996','31317','50054','62312',
                          '40975','46078','63270','13970','81907',
                          '53669','51643','41545','75845','51635',
                          '92334','42012','17355','19464','78962',
                          '53277','26535','43548','67166','40991',
                          '43758','10415','68847','72574','33891',
                          '62229','40156','88236','71567','51730',
                          '45081','45564','51778','27489','69709',
                          '50615','16209','60988','63729','75375',
                          '19963','20563','22811','15133','99420',
                          '48783','52723','11146','34752','84914',
                          '35339','27464','96074','30460','26146',
                          '48558','60917','63623','11287','20249',
                          '21288','65293','60102','58566','29232',
                          '79772','83419','97019','88775','73713',
                          '22305','18163','45633','93553','96847',
                          '87836','28957','54988','18876','26668',
                          '16886','55416','71462','39518','32268',
                          '95987','82978','75377','72441','64602',
                          '20272','69898','72376','40511','19722',
                          '45885','64428','26693','21318','51035',
                          '59164','16452','47914','28196','53646',
                          '12287','20064','57996','11147','42147',
                          '14023','37376','15160','41196','39068',
                          '30802','14873','31409','68948','90578',
                          '54560','13315','77254','77820','42389',
                          '53737','94940','27831','88920','33782',
                          '43860','24287','65302','60841','90723',
                          '14663','38683','41893','65556','35297',
                          '12619','31201','51410','22209','56959',
                          '41834','20536','27813','62128','41004',
                          '82033','20161','67604','93957','55726',
                          '16239','67788','22994','35317','24012',
                          '68425','24039','84368','17948','36369',
                          '69867','24582','48710','48828','42215',
                          '33484','25236','36445','36685','63074',
                          '77468','86221','16552','90641','62838',
                          '28319','10803','49384','45787','89314',
                          '68743','69787','47801','81642','64755',
                          '42227','89350','54979','83542','42602',
                          '51828','24932','66800','92469','67072',
                          '72710','13149','88971','34918','15745',
                          '63251','28465','36599','69320','40081',
                          '28052','14293','34058','60274','43353',
                          '71302','17833','25015','38969','19438',
                          '23759','66430','34010','28450','36454',
                          '16526','14523','49675','42511','82442',
                          '68521','89884','39590','16148','25247',
                          '60806','64316','29409','54817','39041',
                          '33695','77265','60901','98999','26660',
                          '13688','81046','87608','77730','74909',
                          '83592','13242','73479','35492','88897',
                          '40364','62567','35148','70753','17152',
                          '65591','49482','34596','50444','73954',
                          '15195','71089','88451','28809','15509',
                          '24725','68837','50892','15933','16660',
                          '71308','61489','74758','29111','97486',
                          '96188','36940','94624','26726','59920',
                          '70384','26312','97344','31852','18040',
                          '66701','89916','11556','42359','90687',
                          '32524','63750','69097','36821')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
