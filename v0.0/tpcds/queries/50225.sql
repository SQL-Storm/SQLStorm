
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '65998','71112','23007','57309','17484','52767',
                          '17701','65632','86907','51178','44988',
                          '38205','80974','43528','56502','85421',
                          '98807','97517','35327','21562','28373',
                          '32609','31156','80361','26189','23091',
                          '31367','72535','62456','16204','38983',
                          '39659','38861','13897','77999','60332',
                          '11087','14615','10117','66171','86821',
                          '18904','67387','34282','39400','51961',
                          '68684','19065','34437','27203','56268',
                          '49942','70911','12613','39586','48805',
                          '89416','48632','73638','14109','75650',
                          '13272','52981','72146','33450','15100',
                          '52424','33243','41186','55192','70772',
                          '76457','32105','50032','79822','61159',
                          '91803','59857','51194','23270','72289',
                          '52739','73926','74134','81799','22646',
                          '43870','48269','92331','45838','97618',
                          '10549','12673','71292','85985','46569',
                          '89542','15145','76470','16362','21131',
                          '37908','12402','22263','43371','23299',
                          '62639','24923','52035','26604','99804',
                          '68239','41309','88230','52765','87594',
                          '90198','24667','13419','49872','20754',
                          '20428','28276','16856','10835','64498',
                          '87706','11851','62000','12425','89988',
                          '62957','19265','43244','57529','15752',
                          '40286','12213','31603','96423','68506',
                          '83509','64075','53726','11947','62575',
                          '65978','23605','39849','19884','96876',
                          '25712','47754','23215','79806','22677',
                          '47022','26002','60288','60186','15792',
                          '55173','39965','21535','75926','49981',
                          '99303','37737','52188','87579','61810',
                          '66189','34546','51854','23728','24423',
                          '58026','67326','17410','52526','37465',
                          '76413','85655','26820','18875','54240',
                          '36014','14864','26202','65566','73627',
                          '13074','28749','86385','98063','10534',
                          '35216','46547','32848','38218','13870',
                          '43355','13643','58049','57488','39430',
                          '51386','32106','47674','53144','21512',
                          '98526','39551','35312','45344','21031',
                          '13635','86933','66231','43664','64945',
                          '27927','35928','82758','55548','68231',
                          '46995','36086','80149','12637','23659',
                          '54412','46122','54631','21819','31967',
                          '20677','63366','66936','23346','32927',
                          '71656','55716','63650','45810','64183',
                          '15987','43971','61361','56908','30723',
                          '18698','11106','22950','98874','47911',
                          '86056','31772','32398','76923','54682',
                          '70581','66887','85375','98253','28265',
                          '25069','11023','46128','56610','35748',
                          '39641','67916','71294','59580','91715',
                          '38973','70898','37919','95784','33754',
                          '91420','46290','87988','51207','33170',
                          '62784','26915','79310','93082','68644',
                          '56555','38253','42807','57688','17874',
                          '20539','46457','82061','38154','16693',
                          '52075','57410','15387','94943','42611',
                          '36792','47604','79599','49637','62760',
                          '54114','17772','82471','75264','89133',
                          '34361','47552','14476','58650','46673',
                          '33285','96784','26439','33268','43393',
                          '33492','44863','11825','88394','46137',
                          '66331','15120','61303','76590','40897',
                          '11107','79140','88711','71084','91728',
                          '20737','16393','76956','43723','48396',
                          '31990','25748','11332','57589','55516',
                          '77035','13809','89840','40860','55831',
                          '82709','52884','97400','27602','42643',
                          '14220','36253','44490','73570','92151',
                          '32729','17793','81574','11256','31273',
                          '67842','10576','18748','72404','95729',
                          '62967','33854','73499','79269','93066',
                          '19597','24084','89383','94871','38596',
                          '43638','58507','63767','95562','47814',
                          '66656','80210','32544','10165','11366',
                          '44212','92539','96716','37141')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
