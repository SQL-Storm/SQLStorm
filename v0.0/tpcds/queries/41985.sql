
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '78629','61832','63442','83314','64992','64470',
                          '51072','21504','57873','50635','26961',
                          '45962','40757','61427','52437','12609',
                          '70779','24363','81690','50473','13931',
                          '86239','11791','14663','97883','95710',
                          '20009','29112','10424','98443','95418',
                          '15774','57788','84910','77931','86856',
                          '86893','79708','23617','56671','17953',
                          '91462','74956','87691','16903','28276',
                          '65976','14755','30136','61926','84341',
                          '18957','73567','46222','15928','32604',
                          '89310','54423','34745','82768','73329',
                          '38902','69559','38847','37518','30470',
                          '13275','69771','29956','71493','25375',
                          '76449','63123','44924','88096','15297',
                          '30285','40961','15978','88375','30903',
                          '89395','31221','26631','36856','35954',
                          '19192','10799','94549','17991','68289',
                          '62551','35986','42308','31454','23778',
                          '74970','60507','61329','67271','29658',
                          '74622','29353','94006','21841','87561',
                          '22966','19617','27960','49242','40914',
                          '56852','64387','16106','81272','55545',
                          '78648','96757','26489','79276','55670',
                          '64199','25871','13663','26338','42740',
                          '48225','30341','34118','51094','39420',
                          '59240','80337','53563','57309','65414',
                          '12563','19676','69867','37510','16146',
                          '34845','63195','18139','66164','81836',
                          '87239','67716','31529','38720','27313',
                          '78145','41206','44882','15161','51197',
                          '71433','90727','93084','52192','48239',
                          '42491','50707','89653','18295','21469',
                          '78848','80792','29981','23708','77513',
                          '91490','21574','48723','38779','28826',
                          '35936','74223','62578','19062','30680',
                          '79655','83661','45543','14753','87903',
                          '35124','74349','78866','72254','75268',
                          '18348','56310','50092','19447','98457',
                          '33521','74884','34748','29065','84472',
                          '26608','63678','20106','24145','11173',
                          '28742','52665','63960','16202','22744',
                          '58411','23811','40507','30674','95155',
                          '40165','26979','36510','37402','88620',
                          '76000','11750','16405','54820','67850',
                          '48311','98968','37466','72510','63136',
                          '13039','87144','51643','33542','87330',
                          '76035','33848','52675','58919','25327',
                          '20133','50925','56138','53025','11455',
                          '23569','15863','37471','66291','23351',
                          '19620','42489','54608','96549','57750',
                          '33370','80696','53305','80255','59275',
                          '40936','53321','12076','63581','28472',
                          '15117','71868','43382','55704','99905',
                          '21803','44014','11580','36924','77466',
                          '15859','59562','80140','47457','33201',
                          '29405','19213','12743','19524','58327',
                          '28918','27850','15630','90953','47971',
                          '53063','61689','33715','24183','95217',
                          '41783','13339','87866','18016','59448',
                          '36504','28926','20720','36426','12683',
                          '64463','95545','23431','57566','82414',
                          '84128','36825','66148','58922','25993',
                          '83517','44757','43719','36339','34812',
                          '31796','64812','31724','17453','61606',
                          '58360','62789','85516','38604','70566',
                          '74284','67171','56359','98752','80512',
                          '98910','87064','86516','15076','50222',
                          '28437','85345','45278','27472','45722',
                          '56891','39426','97920','38401','72731',
                          '16014','12118','29106','47049','54568',
                          '13400','11175','33236','69212','84032',
                          '58872','95147','15620','65157','98489',
                          '16290','33145','49980','92817','12763',
                          '34254','40296','97425','13780','45762',
                          '65626','74417','27037','68330','58984',
                          '95622','18714','44296','30525','24388',
                          '34100','50086','99544','28525','16907',
                          '14207','70920','21940','37371','67301',
                          '84243','46084','86383','30335')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
