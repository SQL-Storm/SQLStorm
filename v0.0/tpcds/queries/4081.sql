
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '99087','31314','90697','36850','37213','18912',
                          '28604','61610','45886','67937','96138',
                          '90874','55761','33977','81599','66087',
                          '42518','45220','40732','83452','28244',
                          '24420','64484','36233','56693','54736',
                          '41749','59823','17398','24313','23607',
                          '18647','35201','55633','79946','28778',
                          '61574','23789','78012','28798','77870',
                          '15661','51833','37589','90567','65948',
                          '31164','57014','28974','12716','28688',
                          '27838','13098','17376','45531','28677',
                          '78939','89105','17674','91660','46290',
                          '48523','37606','67515','20897','48606',
                          '58163','98136','23806','74490','43703',
                          '36504','15598','98743','96660','22404',
                          '53824','31366','90764','83292','26185',
                          '50615','57125','75576','61520','31649',
                          '48756','77733','33480','65706','98802',
                          '15376','17685','48151','94514','59126',
                          '14303','27463','75007','26370','79634',
                          '31088','35852','72907','44563','35979',
                          '97016','27615','26691','22248','23663',
                          '78057','11158','44943','79290','40986',
                          '17520','59384','76128','12234','93221',
                          '83045','38369','55255','57370','65271',
                          '59750','41710','86856','65232','22268',
                          '98683','31847','39083','25477','12444',
                          '12614','27305','34847','49971','42893',
                          '64564','10441','76125','29480','33596',
                          '37317','12047','41632','59565','36474',
                          '96586','17300','91158','60087','53728',
                          '25388','34828','24855','67612','80601',
                          '56558','55053','88992','71967','18556',
                          '89387','88718','80202','34931','83695',
                          '81695','10344','31144','62497','34331',
                          '64787','65273','23890','93343','63520',
                          '15446','72222','77839','55539','11319',
                          '65251','17960','59749','73185','79418',
                          '49783','17160','90206','55684','67127',
                          '81850','84305','99964','89991','64700',
                          '81489','47505','86226','35863','81664',
                          '52302','79979','69227','23831','13345',
                          '71882','69499','98233','65209','58647',
                          '33296','91722','33952','89897','58385',
                          '56815','94297','15738','82747','97015',
                          '70199','12431','84800','52974','92104',
                          '85663','30184','96972','98366','85599',
                          '84927','37672','95548','38725','91108',
                          '98145','24296','24889','33802','79466',
                          '70611','24786','39633','18709','52334',
                          '49421','79539','59928','42878','37496',
                          '74991','44965','33033','29316','55903',
                          '59103','80855','63451','20984','84111',
                          '68170','79244','32562','39212','55384',
                          '88299','55449','11962','48865','23937',
                          '11903','25658','19997','81078','49247',
                          '27412','75394','97036','21061','68787',
                          '93362','11745','64810','97889','29120',
                          '60495','99892','53716','88990','37250',
                          '33756','38958','48922','73283','25972',
                          '22977','69809','86083','14578','58085',
                          '88503','49880','21245','16707','40825',
                          '16347','30083','28814','41403','95566',
                          '43032','47482','79223','77032','32268',
                          '95085','83580','22885','51190','11483',
                          '70396','39179','56446','86141','13759',
                          '55372','53324','83828','85272','89569',
                          '43775','33618','99130','75071','18729',
                          '19540','81582','85501','33991','44826',
                          '77931','76087','11070','80654','92346',
                          '30645','44928','14925','70887','62897',
                          '29746','47035','72069','18102','83097',
                          '25550','92112','51529','75728','18057',
                          '31358','57776','63582','28513','57652',
                          '30101','14659','82764','12755','49727',
                          '62354','23819','62766','64940','72042',
                          '74638','30520','99391','46982','32235',
                          '49968','82342','75428','91068','63494',
                          '46874','71709','94014','99840','19259',
                          '15930','29254','26950','92659')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
