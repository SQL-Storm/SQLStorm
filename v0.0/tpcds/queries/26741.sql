
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '29472','58632','86903','92235','74055','37922',
                          '15556','93872','32450','96997','17380',
                          '46234','31991','68709','36582','20746',
                          '79778','68347','15745','79256','34828',
                          '28880','14963','96862','49852','91661',
                          '11467','18981','85309','99845','83851',
                          '91529','54750','42962','94170','56108',
                          '99497','56763','41186','59060','50850',
                          '60151','59671','93018','21837','32178',
                          '85798','53966','83538','87042','53741',
                          '90471','22411','23129','67299','14045',
                          '84323','75911','66146','31428','34402',
                          '86747','59093','91315','87178','65846',
                          '38572','74261','86109','16805','47713',
                          '17653','40547','14530','61873','93479',
                          '14746','90019','34752','97275','16975',
                          '21341','27513','97079','40477','79772',
                          '84936','26793','60977','33109','11737',
                          '77942','16248','18332','19492','18746',
                          '43908','29854','82620','87282','59626',
                          '23388','78457','18782','35999','12631',
                          '75532','89499','44833','28227','82218',
                          '17297','14345','10447','90321','30832',
                          '33826','96491','58294','33947','66571',
                          '37163','17466','27270','49356','22705',
                          '28807','29967','10710','14981','99266',
                          '65493','21116','86002','85791','41763',
                          '25142','12695','46676','12158','20321',
                          '78121','70557','15219','67328','76444',
                          '34278','20922','27071','14984','82130',
                          '89152','28383','16439','54656','92589',
                          '42231','23622','32946','76997','44313',
                          '54394','45545','69567','52960','62676',
                          '28325','26424','13682','99710','86104',
                          '96532','69650','30203','46154','27852',
                          '50605','47387','12557','44952','81397',
                          '58566','22267','40454','70003','63568',
                          '77291','32645','91510','70660','61452',
                          '27248','25076','45631','33764','21868',
                          '28149','71241','65695','86289','72342',
                          '88732','42525','66537','44684','71591',
                          '59992','32896','62600','65226','41077',
                          '21291','16638','65234','35175','99922',
                          '16038','49953','32218','92031','72970',
                          '97609','43337','60896','62620','99651',
                          '94511','69036','22746','47914','47325',
                          '76706','27804','20408','80879','56553',
                          '21871','28513','15653','68803','68288',
                          '44039','57827','72010','13373','91367',
                          '25271','60033','39634','23972','88754',
                          '88847','51617','61874','13251','30954',
                          '73377','90034','24709','82842','69792',
                          '52538','68928','71030','45399','48069',
                          '93787','41840','10493','16122','42055',
                          '38950','60586','44983','20965','59639',
                          '68198','14310','94034','48600','26865',
                          '81349','45938','35825','91664','38463',
                          '28762','20667','74291','15332','65954',
                          '33383','42129','53705','46450','55814',
                          '41320','29301','63757','45990','65779',
                          '81546','29025','23584','17159','40043',
                          '50676','73888','40924','90111','13293',
                          '60739','41445','65350','80347','21893',
                          '26330','22345','79104','36342','62126',
                          '22241','36434','29159','88684','70987',
                          '61263','19547','65697','61410','28438',
                          '11019','15467','96513','77851','70311',
                          '29499','18734','90571','38568','38391',
                          '47370','44050','93243','59403','39952',
                          '44995','35361','27443','39503','51612',
                          '83197','79677','33060','66996','79426',
                          '90167','31453','41723','84583','92831',
                          '27763','21035','54410','72564','60079',
                          '93763','86018','42806','35155','50313',
                          '14117','14337','35868','21432','52824',
                          '63884','62901','49998','15986','75365',
                          '82499','17152','14543','20422','77228',
                          '28241','25020','98483','91283','26218',
                          '18395','61487','14801','37543','77485',
                          '48024','24941','75181','78288')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
