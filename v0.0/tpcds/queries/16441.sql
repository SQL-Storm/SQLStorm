
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '51569','80785','85995','80889','56648','36637',
                          '46906','42790','60320','74451','77216',
                          '76199','16583','81243','51773','15111',
                          '36278','58775','82985','33805','48824',
                          '45483','58930','31282','67745','27491',
                          '34025','20281','38100','21626','13839',
                          '33750','45886','13305','51007','21556',
                          '48999','35003','20326','25268','42061',
                          '52278','93682','65568','84072','27296',
                          '57134','18053','11177','38010','28640',
                          '87702','22389','72487','35007','40392',
                          '18832','86759','98741','34331','93162',
                          '47026','35263','20431','40930','64509',
                          '11141','77641','26666','74541','21179',
                          '36304','28670','45742','20355','25773',
                          '67300','80469','35618','66528','81080',
                          '89525','31203','38657','54427','19299',
                          '75418','97472','64419','84586','11558',
                          '71114','22078','94879','78638','62075',
                          '78351','12304','38400','25201','59716',
                          '17055','20133','56605','41749','35809',
                          '94414','86810','68722','80746','70529',
                          '63190','68533','75691','36216','65925',
                          '11593','33886','39287','60794','91940',
                          '56448','33523','30076','30097','57242',
                          '63794','40382','54984','13452','42493',
                          '50374','94812','81531','52195','26126',
                          '97296','12650','23506','16506','35132',
                          '31817','65255','37163','50538','25815',
                          '11832','45880','22780','77900','22528',
                          '31826','72215','21199','84477','93485',
                          '54595','85910','97799','59190','70160',
                          '92263','16562','18367','14346','59312',
                          '76999','60316','33511','45230','75138',
                          '93468','65536','18020','90965','29004',
                          '83567','74135','47398','68335','36735',
                          '13691','18038','91049','31164','15047',
                          '60485','78343','28993','82604','13500',
                          '79367','66933','65471','12733','63399',
                          '52170','99304','57515','49546','66274',
                          '30721','76370','48753','90537','32464',
                          '16603','34884','54968','26979','95912',
                          '16008','45941','17537','30461','16142',
                          '34109','29375','38184','11067','36243',
                          '51293','72938','14934','50044','45225',
                          '25437','53247','55064','16269','43899',
                          '97714','36648','17994','37787','90904',
                          '71983','74267','56033','11780','74765',
                          '23047','79887','84058','79725','66609',
                          '11918','98618','20152','50497','18392',
                          '77681','86938','89028','66105','20710',
                          '12667','72292','13337','88189','13609',
                          '60537','92303','46446','32052','79225',
                          '39815','35359','72230','11813','95644',
                          '86214','95292','18912','48876','84804',
                          '62582','73379','62691','41726','12595',
                          '44572','81497','28202','66431','65145',
                          '17074','85602','59182','51858','89963',
                          '14805','64391','96732','90877','17118',
                          '13999','42182','83014','66087','30143',
                          '54175','88292','82754','36918','47058',
                          '19137','22076','13267','97198','19922',
                          '30145','66410','88254','71047','11320',
                          '85336','77541','71611','14478','95524',
                          '18022','34748','27174','68139','15929',
                          '70009','18889','15193','67501','91555',
                          '98631','27324','84838','15323','12965',
                          '74156','15711','62360','94368','85940',
                          '84601','26325','41797','56838','78360',
                          '69253','50431','23178','46892','67291',
                          '33903','30261','64808','93976','47627',
                          '65553','27551','33874','11840','38738',
                          '60094','87504','56543','46047','87325',
                          '26038','43765','46623','51196','98206',
                          '47123','41339','33512','18316','47305',
                          '38438','78161','37869','16734','59126',
                          '89128','31750','54865','78670','71875',
                          '66155','11250','13390','94219','27783',
                          '15076','64028','18503','28416','50565',
                          '46423','24587','18681','16431')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
