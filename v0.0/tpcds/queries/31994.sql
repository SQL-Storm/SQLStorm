
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '58731','13442','89632','22161','73425','52044',
                          '51324','51373','41236','18739','84717',
                          '58091','49404','91536','91527','12154',
                          '15393','86157','51841','43809','83434',
                          '16042','28207','87849','43062','20999',
                          '83742','14236','48966','68393','61338',
                          '51381','35357','90184','28877','59965',
                          '42749','11531','53208','32732','67357',
                          '55588','26095','56141','20003','13133',
                          '45048','14354','19349','61522','39196',
                          '12622','76592','82040','78188','94424',
                          '21850','60869','63147','40748','84506',
                          '58992','17849','77531','52841','31772',
                          '26552','74992','54208','62822','47214',
                          '81475','28336','35609','13328','31332',
                          '43532','86428','25172','13944','98768',
                          '63372','26206','66384','67423','44583',
                          '79614','19953','89453','81175','15625',
                          '91741','65858','68435','85384','27440',
                          '73735','90134','81031','84779','43514',
                          '55788','64028','68042','16526','72564',
                          '89405','99753','81622','48084','93357',
                          '89920','89759','95646','53644','72150',
                          '84132','96996','30295','37662','24172',
                          '69828','34387','66158','70422','36014',
                          '29981','61115','25118','52304','23477',
                          '38692','72585','78464','66429','28572',
                          '18517','21676','48370','81368','78838',
                          '25166','10076','11433','62450','46841',
                          '55492','40811','43990','55971','32605',
                          '23634','52918','28463','89051','16271',
                          '41646','57795','47311','23359','44328',
                          '53350','79851','24835','92630','73407',
                          '13560','19957','27973','73707','52739',
                          '49357','21992','33707','64201','96911',
                          '11338','67743','76123','75787','32101',
                          '61185','49103','30480','53555','11333',
                          '36737','44079','32530','98386','81370',
                          '14781','14287','14331','15763','33506',
                          '44403','49813','27759','78688','65262',
                          '48655','67780','51615','25333','46743',
                          '62021','14845','28960','83674','23117',
                          '79391','24643','24208','68024','35473',
                          '70844','14485','91112','64669','15320',
                          '71052','73100','13094','13975','67185',
                          '43333','49952','58631','99694','88272',
                          '94640','53266','74334','73392','30621',
                          '78799','13317','45583','35251','97708',
                          '39083','45289','89223','38395','34352',
                          '15246','94950','10915','35512','44415',
                          '88523','97721','73876','40697','34095',
                          '60714','84561','61460','35883','11172',
                          '69172','78763','18205','18603','46471',
                          '87388','58637','49701','90129','39974',
                          '38379','49688','15401','26701','65778',
                          '15045','24154','19090','26812','78439',
                          '84320','68670','77126','20419','10921',
                          '94520','58156','73413','25451','16247',
                          '42953','38153','76891','71223','20187',
                          '23249','49080','24945','77777','46594',
                          '79532','70416','22897','20268','15046',
                          '47822','81291','14508','33411','54221',
                          '31960','23207','24068','79823','90931',
                          '63654','21714','51617','40912','53112',
                          '62108','10769','74492','12517','83355',
                          '68844','39850','26367','10966','49670',
                          '30946','22247','60120','71069','18624',
                          '59360','86416','44432','23610','79899',
                          '31861','50944','29748','15662','82196',
                          '22803','31293','50477','46182','13263',
                          '14120','39124','80049','13709','26888',
                          '50381','10794','13052','91927','22640',
                          '12299','30538','29468','33569','71047',
                          '82505','24205','52327','88633','16408',
                          '10905','53919','31062','38602','23582',
                          '42544','42632','21482','54508','40861',
                          '34247','62447','69192','83236','42894',
                          '71916','66677','43271','44011','20396',
                          '77406','29941','59148','30498','49422',
                          '11066','52619','61612','87981')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
