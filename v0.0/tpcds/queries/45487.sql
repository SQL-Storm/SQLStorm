
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '29587','69311','40358','46602','28093','96539',
                          '64225','43563','13732','11009','61334',
                          '17871','57175','23283','44433','77775',
                          '24724','53782','16370','28637','42285',
                          '73299','18863','47653','33383','54971',
                          '18447','17381','49466','17904','77389',
                          '33751','43551','45242','71374','92282',
                          '52536','55305','49292','99119','73737',
                          '11128','66239','60401','23783','13079',
                          '35303','85530','11051','86665','14172',
                          '83800','36070','10401','88080','61411',
                          '67092','40576','72235','37915','58471',
                          '18281','92630','15596','30645','74738',
                          '52394','94168','86028','12462','17953',
                          '93903','16831','32689','60807','71839',
                          '44854','81689','55697','43834','56551',
                          '83525','26569','83083','96693','44023',
                          '41567','57287','90369','67191','80320',
                          '42893','88601','92686','53771','14779',
                          '99090','63496','96818','43504','25953',
                          '80801','82312','46997','25859','17267',
                          '98517','10037','63830','71797','40542',
                          '19407','32918','94675','55631','53227',
                          '24898','39454','79522','61789','28259',
                          '50339','59455','12822','40889','28953',
                          '91488','16220','31868','89156','68575',
                          '60540','30708','15905','61618','83169',
                          '17464','31551','68088','23480','87073',
                          '52065','52156','26062','21904','69149',
                          '36384','37105','99212','50132','51559',
                          '52160','39325','16372','92362','32130',
                          '95266','68513','84359','48028','54382',
                          '72022','30614','36196','70749','15372',
                          '70261','87083','71269','75272','14795',
                          '96292','32077','86033','33035','60216',
                          '59362','71016','15005','15020','25742',
                          '47472','86146','84113','61653','19092',
                          '52416','43734','49840','54917','91524',
                          '59304','21407','11565','21673','38420',
                          '87655','59397','35222','57420','70825',
                          '45641','85438','31757','43039','47413',
                          '26324','78358','11368','35060','30752',
                          '82388','55378','29279','23615','94149',
                          '93061','37188','37984','23452','61503',
                          '94664','18386','10967','15115','45406',
                          '19809','12122','57059','88495','24671',
                          '13090','32382','79494','32033','74328',
                          '45814','47284','94790','83963','39721',
                          '82526','25020','78448','46744','28393',
                          '30280','14740','15852','88161','26833',
                          '32149','45048','64091','75879','25835',
                          '13086','28729','84901','22933','39477',
                          '24834','20928','44723','90546','19446',
                          '50896','34302','22094','56945','20981',
                          '94579','23966','79741','31342','32065',
                          '44949','82893','77347','51159','41211',
                          '13995','21481','41991','81419','57830',
                          '63170','67559','30847','37699','28674',
                          '68318','92759','40162','27324','92397',
                          '94226','46522','70916','97257','69449',
                          '89785','17858','70985','62740','24558',
                          '49306','75522','25609','98541','72099',
                          '10327','75964','35077','16604','79583',
                          '65674','15090','18520','54859','40643',
                          '19162','83096','84310','28668','31823',
                          '27657','69339','27954','14127','29997',
                          '96980','31609','19174','18532','62315',
                          '36023','93672','14027','54012','39171',
                          '75976','81130','44031','28686','22906',
                          '76135','41552','83276','66301','93760',
                          '19321','12712','87427','18368','52528',
                          '78147','45612','25447','33873','78812',
                          '55974','98060','39525','64058','24141',
                          '28688','24419','79067','81813','30586',
                          '41042','68495','80559','14546','42872',
                          '55861','37514','99789','95864','60472',
                          '25110','16570','56857','70406','79921',
                          '86727','10384','85169','95451','46487',
                          '87714','20146','18082','50183','37108',
                          '55505','32078','51732','65286')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
