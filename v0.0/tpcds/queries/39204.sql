
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '31394','15425','59350','28500','37645','53579',
                          '69965','14571','12855','58980','88423',
                          '38252','36637','18921','64933','60138',
                          '32096','31128','37458','90529','34629',
                          '51098','56858','93520','12932','64058',
                          '18333','49015','51378','91130','33255',
                          '39254','56044','54152','16841','91865',
                          '27770','72722','43712','14990','50577',
                          '11018','20808','87155','66325','47545',
                          '24785','56853','31980','52822','67005',
                          '76425','83600','94550','53542','43156',
                          '88704','60223','67526','14244','94252',
                          '85935','74532','54722','61838','61258',
                          '83031','69374','67246','33948','87055',
                          '28411','91685','11274','19116','36123',
                          '64357','46641','55142','85064','23955',
                          '25123','96528','19005','36015','65422',
                          '16606','19283','59603','34563','43220',
                          '68700','67828','99145','10523','11621',
                          '36072','79182','39985','38801','24806',
                          '46524','69032','12314','52594','37487',
                          '41145','66254','43001','97115','82623',
                          '54149','45865','63160','60419','47724',
                          '57055','31985','87446','97169','11069',
                          '37771','16467','55290','26209','49761',
                          '11361','92229','32412','29414','49709',
                          '17062','40033','27172','13653','16385',
                          '87333','67741','21024','85694','15319',
                          '64071','31398','18186','89854','32898',
                          '76356','36157','10660','50265','28159',
                          '96224','31656','54307','48336','17726',
                          '19441','84947','95527','61943','84231',
                          '56726','40721','45888','60528','85948',
                          '66488','56791','24736','33903','63951',
                          '13455','13893','41818','32694','21378',
                          '58840','42816','92245','49889','96610',
                          '61314','64517','70158','63123','67010',
                          '19482','15100','97089','18192','29313',
                          '52477','11616','18229','60752','99536',
                          '61209','71393','84292','51723','93282',
                          '63596','77975','79819','73841','51140',
                          '40979','23089','33081','30835','32909',
                          '87556','15757','50380','24853','71924',
                          '57816','40732','53137','26416','24353',
                          '72833','42309','32547','38310','41473',
                          '56695','13029','30441','22000','10600',
                          '15076','17261','83577','94619','36244',
                          '54334','14141','31959','42490','69835',
                          '10844','54118','18740','84884','38024',
                          '17647','63957','36156','54485','71249',
                          '28293','98873','15090','74361','76837',
                          '99487','33878','85672','18940','63004',
                          '46589','21076','25371','98296','33654',
                          '93657','26454','64852','92510','38137',
                          '54299','60451','11392','63920','41316',
                          '81858','64825','14178','34826','67620',
                          '70832','72196','23225','62274','20663',
                          '87078','13021','90415','12412','11681',
                          '65395','61406','87902','76042','99759',
                          '71395','33843','20009','54174','20548',
                          '57765','92058','62855','40031','10186',
                          '36856','73916','44524','44090','14849',
                          '20920','36732','14317','17771','46111',
                          '62466','51072','55987','75962','14688',
                          '70779','37747','64520','18651','69798',
                          '92804','82008','85640','72006','68004',
                          '78879','44160','53081','32926','66980',
                          '95237','99370','82033','29550','37367',
                          '18052','17392','70185','79402','29909',
                          '63006','17176','83501','78275','38771',
                          '56600','60826','80872','10676','98923',
                          '15028','90803','63666','35606','77968',
                          '35855','17217','11411','49711','75897',
                          '10973','49681','33988','28449','92799',
                          '63007','36607','64080','59788','61117',
                          '81177','65001','78035','30160','83521',
                          '37139','26499','43728','52909','65751',
                          '55929','38613','32553','96800','68569',
                          '14947','84788','31786','16462','16420',
                          '76995','37033','46723','29130')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
