
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '29907','20223','29755','27302','59048','28603',
                          '25574','72913','12768','21692','93729',
                          '86463','24199','41125','64985','96588',
                          '36883','37746','54745','85250','46541',
                          '69494','78751','34793','22867','78434',
                          '15172','74785','12958','11473','91648',
                          '92741','53700','28699','73137','75934',
                          '55249','13524','10113','73715','51925',
                          '38109','38772','29404','60041','66277',
                          '73594','96288','54972','40918','18084',
                          '12929','33295','18139','18141','23805',
                          '87374','46681','58568','90135','40580',
                          '13922','42553','55625','62772','67511',
                          '44683','71095','53248','86260','34515',
                          '45737','16925','67265','87499','63059',
                          '55939','54340','16155','22310','70171',
                          '17895','54698','67608','58069','11060',
                          '35072','79876','60087','74814','53990',
                          '15305','57097','85738','28628','89564',
                          '16204','63776','17502','85234','32370',
                          '68322','91841','66210','46788','26644',
                          '92490','15691','52014','49787','85409',
                          '67383','36789','92511','25141','11903',
                          '67875','12995','13206','55105','38558',
                          '54993','46764','76055','56859','48548',
                          '97607','51341','41317','73547','54041',
                          '79825','82485','84966','44065','30033',
                          '32118','58607','85356','47653','80087',
                          '25798','34558','43001','41959','95911',
                          '31790','30502','32348','22963','84798',
                          '23418','67481','66696','86825','13154',
                          '23112','51300','97069','20237','25886',
                          '18516','58166','40357','24098','48537',
                          '50438','95826','45305','27430','97537',
                          '27202','74356','16029','40296','10461',
                          '12882','56786','49986','96264','26648',
                          '39098','61408','61618','85825','30581',
                          '73336','34198','31809','97709','49694',
                          '58452','74098','58753','98262','49003',
                          '86894','71058','58947','41234','85484',
                          '87524','59022','45746','20246','25181',
                          '67528','14638','98487','66814','17049',
                          '83933','54514','59400','13231','75058',
                          '74297','44265','44799','38429','42805',
                          '46920','27697','29614','84134','61298',
                          '23820','58003','32469','77231','66249',
                          '78559','39025','34116','38842','51915',
                          '38661','27977','36502','36263','66605',
                          '98862','15335','11663','83759','68126',
                          '43472','43468','17536','26835','62170',
                          '69453','23288','22050','47661','11977',
                          '71609','21772','92988','83782','37376',
                          '85346','60877','86772','37381','43496',
                          '68617','82406','58579','84689','31441',
                          '47704','45617','53040','39275','49028',
                          '13766','43800','71514','38305','19045',
                          '22835','43535','27785','88063','34288',
                          '25990','88772','80154','69180','18847',
                          '22571','60466','26573','66180','22669',
                          '71491','27923','34896','54397','80439',
                          '96559','86297','17925','69115','55201',
                          '59149','51790','19017','96024','23480',
                          '40864','13260','94273','70822','95637',
                          '26216','82943','64164','97930','56452',
                          '63936','66944','73994','83698','11912',
                          '84986','61236','11505','66933','13241',
                          '12101','46095','98976','90784','32608',
                          '26577','72708','19036','85258','41230',
                          '69697','10649','66562','48249','23148',
                          '13550','59735','13667','62893','70764',
                          '93740','15045','47489','77890','45030',
                          '35223','44308','36522','46325','77413',
                          '13438','25335','61022','48004','38382',
                          '31885','97784','85721','87775','40496',
                          '62700','99871','55685','14573','47109',
                          '85908','98082','73666','20324','52314',
                          '96471','12989','68099','11005','96130',
                          '15923','34444','23247','40705','75931',
                          '92878','13868','34043','44853','15232',
                          '80635','60911','66807','43188')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
