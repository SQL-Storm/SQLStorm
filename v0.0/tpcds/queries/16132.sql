
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '50000','15260','91876','17127','62081','46592',
                          '27057','17584','96080','25145','93634',
                          '54860','71399','14001','82978','61358',
                          '81186','77409','18300','66426','52491',
                          '83842','61778','54016','96173','77874',
                          '77104','27381','69232','22071','19490',
                          '16178','75932','57555','61097','43437',
                          '89681','95452','93943','52909','35820',
                          '67894','69024','26752','41760','20215',
                          '22289','56827','92192','61519','61281',
                          '22926','98445','64352','10361','89296',
                          '45868','32597','26136','63398','27005',
                          '68673','24368','61786','38971','30774',
                          '72657','60341','91036','81239','86424',
                          '57114','60081','37480','83211','30369',
                          '53817','49230','54446','92163','25456',
                          '40539','48335','24780','95716','12593',
                          '96076','64620','15606','68831','90200',
                          '72110','53550','10987','55890','29242',
                          '24029','17562','74214','77620','15078',
                          '55497','64550','72765','45094','59513',
                          '88682','97639','56246','78645','26672',
                          '97370','92154','37890','63287','42669',
                          '78513','50112','15337','73639','35272',
                          '99333','38247','47234','22990','18546',
                          '84555','76918','66883','66662','66870',
                          '42156','11554','92631','69749','49640',
                          '32954','20584','84466','64406','30980',
                          '66773','29352','93773','70355','89670',
                          '25428','49956','74091','19064','50491',
                          '61936','12355','42987','47028','22047',
                          '31042','30232','21727','37568','29812',
                          '52396','66500','12415','38833','92035',
                          '63520','83430','81743','23987','39874',
                          '20942','45144','35387','81688','28276',
                          '85563','37732','51031','25259','31109',
                          '77465','91390','18333','61533','42281',
                          '27351','15032','85959','73111','10190',
                          '14443','53500','63694','11685','71655',
                          '89602','45488','78304','19550','27821',
                          '84515','19266','24646','97074','94152',
                          '52365','46376','49419','28725','83865',
                          '29234','53682','74871','93309','70575',
                          '77962','45556','59617','17042','21073',
                          '29562','26261','44311','15577','19816',
                          '48713','36364','32084','80384','98019',
                          '51159','23672','35294','38975','12964',
                          '52910','44638','41453','95187','36530',
                          '81309','48109','28641','25139','83697',
                          '39042','27352','61059','45798','49994',
                          '88181','14076','67746','20106','45919',
                          '56286','21473','79266','13755','42246',
                          '80353','81938','24884','11474','24770',
                          '43617','39140','59226','63079','37970',
                          '69741','23420','79837','43925','23300',
                          '86654','74983','61306','18509','59377',
                          '32237','86748','30926','83985','88689',
                          '70327','88532','13773','33748','40723',
                          '17587','63921','91208','66391','55489',
                          '37207','12895','64690','39197','41166',
                          '69077','46827','25025','19448','33196',
                          '32732','60397','79824','98081','25263',
                          '44581','93960','60279','98990','18860',
                          '78086','88317','67209','78014','41410',
                          '87926','11241','14353','91408','27325',
                          '45014','26344','21498','81031','21692',
                          '98844','48680','29415','28981','14953',
                          '56771','88791','90295','75457','19871',
                          '73477','46130','74324','40628','71502',
                          '24471','17331','40752','19846','23434',
                          '39768','77744','80819','37111','92370',
                          '48456','10837','28664','21570','99352',
                          '36666','26552','40844','27711','51920',
                          '54264','52723','34670','34328','52494',
                          '31087','60922','32185','50388','89095',
                          '24343','98879','38724','89022','73009',
                          '94531','92615','49145','89420','12949',
                          '12005','68468','23138','72367','52937',
                          '46531','71820','69193','44681','59324',
                          '96670','38075','70463','32110')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
