
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '33061','80170','31769','21733','77766','38662',
                          '12428','90032','31286','17315','87700',
                          '66439','47954','85573','91354','83245',
                          '66002','13473','50612','36126','50807',
                          '96381','66926','84512','14353','14148',
                          '19567','70274','25907','41516','23851',
                          '27149','57873','38837','20485','30082',
                          '10293','12136','12618','21587','32951',
                          '76171','30061','32573','15809','75398',
                          '20437','13920','67086','25793','50416',
                          '37347','12691','23344','20657','99183',
                          '81610','18784','62839','94588','57915',
                          '16454','80123','46814','89759','85927',
                          '22470','70883','58942','10748','42726',
                          '98681','57756','57513','43963','95291',
                          '17946','16449','59830','56321','43889',
                          '62177','66192','80097','73651','23065',
                          '83463','89376','86784','66949','75358',
                          '74803','17632','99508','36750','64485',
                          '13925','98876','82062','24978','58201',
                          '50824','59201','37601','91006','18233',
                          '18687','20155','68883','32479','96973',
                          '36954','29832','62551','41793','32394',
                          '43605','38059','45085','51195','43394',
                          '80373','13244','15910','86483','63252',
                          '28595','36640','15037','85286','56111',
                          '77329','37833','42560','21113','32867',
                          '27174','17633','36515','63906','89523',
                          '43619','32996','87567','86856','49260',
                          '48592','28364','90653','22877','74216',
                          '29974','33754','82609','15383','37093',
                          '97421','64382','85341','61181','33609',
                          '93600','30362','66374','92251','85330',
                          '38539','10158','47355','32120','43678',
                          '10507','68129','88684','16912','78534',
                          '12101','38409','39128','25994','24168',
                          '84545','29004','17145','57803','33549',
                          '93912','43610','67126','36353','33100',
                          '88477','15089','30592','14012','85765',
                          '49290','22610','75310','95225','91202',
                          '56675','61227','60275','39331','35166',
                          '96696','91117','96512','57815','73784',
                          '82291','15465','98012','69394','27906',
                          '19822','43407','23050','32384','54554',
                          '19868','41697','36769','17855','60984',
                          '29307','91567','75792','46770','18212',
                          '29209','79205','75969','38570','13416',
                          '69654','83424','65212','11605','77387',
                          '23365','39293','64064','47706','84578',
                          '12035','57226','54029','64912','26258',
                          '96172','81746','96590','24654','64227',
                          '73453','81015','69662','99715','56876',
                          '33079','49301','95196','77223','27539',
                          '11206','33283','38054','96540','86566',
                          '89577','44771','33913','14379','77032',
                          '53462','17288','32282','88255','57824',
                          '99255','39289','15274','53017','20326',
                          '31877','50209','78487','52625','86391',
                          '83683','12965','15776','78746','84707',
                          '30595','24815','32810','97994','11005',
                          '89144','96160','82755','58477','62354',
                          '46321','83030','27676','88655','71477',
                          '59588','45355','97187','56812','74894',
                          '45086','53143','29046','66005','81472',
                          '99676','67895','80317','12656','69344',
                          '49111','28671','30493','21509','94416',
                          '12503','22111','17582','72975','23349',
                          '21350','51379','68128','91038','40425',
                          '91633','11270','10384','21241','48149',
                          '46805','78671','29567','48048','53284',
                          '75049','76898','12366','92152','35065',
                          '91632','77964','20621','72987','80984',
                          '76455','67901','81907','20016','11584',
                          '81410','50396','35011','94438','31268',
                          '31905','23623','76238','80101','52811',
                          '31743','25818','37994','87028','33425',
                          '29497','87026','23628','31542','10599',
                          '57087','26278','46990','16090','23230',
                          '96432','40590','83150','10614','56611',
                          '14372','22793','74389','39750')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
