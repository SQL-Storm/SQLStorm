
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '84582','40856','22337','62013','78992','77628',
                          '54733','41670','37869','95072','84776',
                          '38960','99196','19424','62345','17949',
                          '29119','19071','67639','50209','95581',
                          '43904','96022','65857','61896','55918',
                          '29172','41277','31814','34216','13604',
                          '36136','39569','94628','82702','25831',
                          '44264','94621','31066','70076','39532',
                          '86524','53295','78740','51356','50370',
                          '55768','97875','10334','71595','19274',
                          '86856','58691','29340','99966','92593',
                          '20554','80657','91583','21314','47597',
                          '14896','40356','95901','74167','47960',
                          '27639','76307','47500','64856','39863',
                          '84641','44443','29783','49899','37611',
                          '67508','24220','20369','69845','52033',
                          '57186','18396','91872','52520','22344',
                          '59508','52676','22823','29141','44845',
                          '91163','14691','93665','44579','80395',
                          '31291','50382','14196','36006','18097',
                          '41178','33357','98269','48203','35035',
                          '28284','30289','30837','29186','23442',
                          '87930','84100','98230','31998','43976',
                          '90393','27992','85077','22480','14590',
                          '33460','26518','41305','52040','93478',
                          '43893','85335','66059','36950','64605',
                          '67193','62819','23597','29472','38437',
                          '39059','21150','58201','77202','52529',
                          '22971','35997','71973','51398','44465',
                          '66934','12604','92506','84386','52709',
                          '98930','77347','21648','74194','31158',
                          '42519','32386','11793','67013','11746',
                          '83021','64816','94126','26901','61318',
                          '47258','97526','78065','78722','96282',
                          '21591','17652','26365','36731','61382',
                          '16451','36132','90535','82097','35859',
                          '37559','58166','94179','19429','39958',
                          '49906','12420','55306','77068','36381',
                          '49711','29974','46266','19576','96262',
                          '13497','28035','35534','72513','27780',
                          '54879','22289','48277','11864','84002',
                          '29341','32805','86698','30570','54225',
                          '12056','13708','38850','13563','92928',
                          '59708','55995','27667','56273','14638',
                          '24291','22287','28481','99048','69073',
                          '52903','28723','58092','24844','22673',
                          '72537','49594','59790','99664','48337',
                          '70202','11549','22339','48287','31669',
                          '10912','99362','90975','47968','56574',
                          '90397','67435','62363','14912','39263',
                          '33189','44696','13726','21420','54745',
                          '49293','25126','82932','26558','35561',
                          '52224','79776','40922','99498','83924',
                          '78464','17316','78958','23947','34177',
                          '65569','81321','39884','28205','96396',
                          '18504','94230','13687','92698','18573',
                          '57600','17781','34090','71122','58543',
                          '21720','46910','30249','25647','20739',
                          '92829','66693','84707','63708','83702',
                          '80079','10510','45989','27873','25919',
                          '53365','24976','11702','56129','52122',
                          '82030','28799','60452','96488','54232',
                          '69876','76731','31504','85128','54907',
                          '51219','48878','47729','39908','55440',
                          '41630','63498','34671','90443','81531',
                          '33808','44836','22349','30221','45449',
                          '58490','90092','69319','87398','99550',
                          '87866','53634','74743','83694','60073',
                          '11506','35818','85289','69040','68883',
                          '32449','31505','96545','71762','91986',
                          '88574','82878','17815','66603','49572',
                          '99578','61934','81596','27071','65945',
                          '36354','91580','21171','44540','34130',
                          '35775','31739','74131','39329','50324',
                          '30757','34777','19792','17770','99907',
                          '13908','62884','20491','72406','13709',
                          '92533','15657','40762','22448','42783',
                          '60627','86489','10489','74667','36218',
                          '36634','94888','81112','38145','63611',
                          '19108','20768','57236','94661')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
