
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '60795','45886','85964','82605','62607','30142',
                          '45456','69834','88662','71795','13693',
                          '75566','87690','20978','34099','47738',
                          '21216','94709','63737','15462','84535',
                          '68187','51590','21601','57661','91110',
                          '31922','66698','80232','21385','18187',
                          '90949','64011','83205','42253','78272',
                          '23727','55239','89188','62920','92076',
                          '46904','48980','84697','18887','97847',
                          '97453','13695','17600','58249','32574',
                          '19510','12601','97586','52763','23904',
                          '28280','77211','70563','38120','53882',
                          '58228','76531','63492','19047','44606',
                          '56733','50733','81172','63073','62914',
                          '20886','25117','84819','85090','30975',
                          '88764','37033','11523','73030','96257',
                          '49940','72100','97567','57833','32442',
                          '35571','15291','25003','27420','85993',
                          '32260','60871','91347','51176','54643',
                          '21001','78160','16601','17308','12862',
                          '26445','33350','15027','46133','27655',
                          '32268','86188','40888','29675','59227',
                          '69562','46706','20132','44682','14380',
                          '15927','25031','35856','17292','19651',
                          '11517','37069','89643','61254','61298',
                          '97573','22255','89979','59914','99152',
                          '19498','66947','21501','92601','30424',
                          '26262','76598','54885','32461','24179',
                          '19471','23074','65976','14912','59929',
                          '62106','32640','64646','49314','43040',
                          '63703','77699','45807','61679','38030',
                          '31251','89461','92725','63575','80521',
                          '74323','24164','30976','86892','12807',
                          '92466','20259','51732','58662','79338',
                          '46303','46439','51644','84063','34355',
                          '44860','91507','32329','56857','17991',
                          '50948','62452','67634','32342','66399',
                          '80311','52769','35035','78693','54407',
                          '85763','96998','62535','16040','46127',
                          '29943','32275','94434','23841','36956',
                          '16258','70939','95587','17031','47150',
                          '78765','76431','18454','69339','70974',
                          '72833','44639','34090','70252','49461',
                          '97130','69638','20745','38687','71773',
                          '59568','17006','56238','19044','49863',
                          '52737','48358','46890','91216','42989',
                          '37194','30898','22197','84576','30463',
                          '50982','83801','63312','17695','11035',
                          '18240','28729','75025','68860','55120',
                          '58596','93338','34893','39476','38522',
                          '14547','95855','65813','45982','30379',
                          '14031','22445','73179','95028','10974',
                          '67624','92250','19799','28755','37000',
                          '29429','21882','96518','96087','60084',
                          '98232','71826','24460','18711','56743',
                          '13897','20022','36567','43066','70884',
                          '43000','28631','19881','30003','51341',
                          '33971','70558','42926','54737','47077',
                          '37482','82346','55784','56834','92671',
                          '19678','70295','15944','41136','32035',
                          '36677','51227','21848','67898','22710',
                          '71299','76673','13681','23718','29607',
                          '13461','65617','93993','70261','52764',
                          '69664','92642','92205','90813','21485',
                          '42494','89666','53435','35964','85019',
                          '65162','78456','73235','54143','75307',
                          '62843','33955','16608','81351','53697',
                          '16952','97828','34182','23358','19852',
                          '44130','85839','29591','50544','69810',
                          '40995','31354','98626','22908','87934',
                          '54405','55214','88710','37600','22890',
                          '45425','80979','58361','47125','97888',
                          '38381','14706','84864','58508','88421',
                          '78910','61290','52074','68874','46137',
                          '54337','65245','20232','98077','48116',
                          '28104','78229','68876','19262','50712',
                          '67334','54324','50160','68204','30281',
                          '60621','46404','13151','13791','91093',
                          '25804','33969','34652','94422','74474',
                          '99948','25948','70854','38189')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
