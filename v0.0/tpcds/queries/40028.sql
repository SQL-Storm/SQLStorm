
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '26048','24641','45785','27526','69479','13199',
                          '37550','49822','49477','35790','55473',
                          '17317','58727','24309','10869','92933',
                          '55440','59138','34561','22713','49786',
                          '72238','81531','56625','29183','54312',
                          '36838','24581','68957','44853','84088',
                          '44940','85342','49744','34771','47368',
                          '91487','61322','55042','48085','42550',
                          '77773','83777','46952','30181','64110',
                          '92097','62694','43316','68892','27307',
                          '63263','38772','81529','25814','27653',
                          '70144','91008','76001','20307','97544',
                          '30557','49686','41586','23032','13864',
                          '92804','94424','43481','11983','30257',
                          '14027','76059','96342','57524','43526',
                          '30132','42224','21051','24354','51296',
                          '11434','75699','66091','82723','10483',
                          '36995','27160','39771','79365','17096',
                          '20025','12793','74600','41135','76703',
                          '49761','26982','17681','20356','77828',
                          '50904','89661','24070','76574','21378',
                          '77531','85807','94490','28217','74177',
                          '69720','14514','67914','23596','33247',
                          '79872','87395','78627','62850','63713',
                          '86590','92176','14692','40037','32283',
                          '58853','76704','28581','59197','75120',
                          '44113','12884','25879','62166','90512',
                          '32476','29068','30460','74921','80925',
                          '35928','25468','28917','59099','31723',
                          '50897','90998','42213','79707','49575',
                          '64021','21504','11108','96624','68859',
                          '69394','44158','68244','10708','12705',
                          '21123','38459','71039','14418','37967',
                          '39947','94771','84862','62843','72440',
                          '28956','60560','47731','72166','65631',
                          '79774','27834','20036','57941','49041',
                          '65522','95499','15963','97285','31793',
                          '32589','99684','22121','77911','80467',
                          '10374','68654','71054','43676','73799',
                          '49281','39416','34380','93845','11690',
                          '36081','48954','89486','29153','31829',
                          '26608','28403','45269','85418','83480',
                          '34158','82540','41525','62674','34814',
                          '34429','85213','56638','35278','90571',
                          '12125','48423','79184','50318','38191',
                          '42059','89287','66104','30307','21488',
                          '25943','58302','24570','50860','14895',
                          '27891','13979','76925','25371','97229',
                          '19283','18785','24748','19240','46950',
                          '79970','65529','70152','17310','68040',
                          '60638','90432','12034','21087','42850',
                          '64838','25720','41906','39011','37827',
                          '11286','75728','82617','45148','19779',
                          '27712','40504','90946','37330','51952',
                          '11906','36656','91560','76793','15084',
                          '49440','15344','71795','40338','87310',
                          '89773','12004','70313','64486','55436',
                          '30612','12387','60117','26660','49880',
                          '57794','69333','98109','62082','86171',
                          '50559','94905','80185','57366','82950',
                          '70878','84749','82931','23865','66352',
                          '27201','94403','91380','11517','98948',
                          '30219','34354','68308','24716','27224',
                          '40821','81660','17349','98786','34673',
                          '17650','15194','54510','12081','57740',
                          '93961','33755','76929','88680','64663',
                          '60876','31775','65760','37153','13268',
                          '22648','75832','35593','28588','63348',
                          '26229','82205','75989','74812','94954',
                          '30928','18674','39131','55482','22248',
                          '38917','86787','17918','14844','19169',
                          '90977','18357','80081','87500','62310',
                          '75969','91231','13559','69279','99081',
                          '33760','68650','50606','45194','36225',
                          '45062','16701','48282','49594','22833',
                          '66728','21060','76331','88539','39388',
                          '68133','75389','16775','20796','22971',
                          '16031','36484','10188','86922','59997',
                          '10207','74903','41199','90971','28995',
                          '27072','24675','87871','11373')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
