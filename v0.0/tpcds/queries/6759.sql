
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '93940','88845','35647','41134','77272','86063',
                          '42271','45073','31206','31623','26261',
                          '42165','40913','25076','66918','99618',
                          '66710','95582','20611','20478','36669',
                          '90341','85915','55825','19238','97402',
                          '20322','17024','31333','26223','18228',
                          '48068','36012','95020','18763','79888',
                          '86987','70539','58071','11182','56400',
                          '63877','77065','23565','33330','34423',
                          '64411','83443','61964','49587','86561',
                          '26885','52064','35300','29449','76474',
                          '10975','75058','26179','87138','11748',
                          '16241','40080','12854','92250','34344',
                          '36575','30552','14055','13444','29636',
                          '32065','49836','16290','58780','21986',
                          '24388','87506','54886','62803','13177',
                          '69345','41759','34288','99825','49532',
                          '69235','86146','55769','49663','40539',
                          '34207','37721','64478','15401','43955',
                          '21060','39182','51045','45004','34483',
                          '57924','38678','14481','34454','50804',
                          '54486','72470','55804','85810','78407',
                          '77453','51538','17192','75558','48350',
                          '65403','60844','18098','39473','39252',
                          '50178','22462','51266','48358','55181',
                          '82445','38456','55662','59059','22817',
                          '80002','17478','61213','64792','58079',
                          '19579','88635','23488','68698','43883',
                          '96931','37727','85656','61110','47036',
                          '39776','62204','68701','19049','80536',
                          '71673','61422','54058','28789','65399',
                          '67490','81544','32391','19819','65620',
                          '93002','41878','26184','60896','55473',
                          '87086','11397','73368','84374','13932',
                          '68162','48655','36706','51110','74022',
                          '25081','74094','29477','85536','44270',
                          '68791','73378','60609','92634','31019',
                          '85847','72445','59321','11394','46345',
                          '60458','83340','51635','14807','65339',
                          '16051','30295','26814','95286','29218',
                          '84427','77015','75195','56992','29127',
                          '93474','22386','67369','32816','52904',
                          '97429','60579','39843','24726','22190',
                          '91505','31506','59069','80100','20152',
                          '11638','54501','34649','58037','57549',
                          '23347','87272','18782','92130','75198',
                          '33579','76018','47132','73215','70296',
                          '86649','25399','91126','71584','30885',
                          '65531','63377','94895','40893','88659',
                          '94514','87029','22199','62193','68574',
                          '21044','24618','24814','54645','47956',
                          '79911','23274','29858','61106','63806',
                          '65237','16705','72086','26674','16783',
                          '61886','57348','95887','31146','66560',
                          '61136','36943','46272','60552','76619',
                          '61269','38090','25550','20939','52204',
                          '36425','78789','27089','56657','10406',
                          '86536','86236','28705','17148','35709',
                          '76915','38348','79836','44827','31312',
                          '38810','54233','87403','46160','17489',
                          '85348','63752','57163','29504','52056',
                          '23747','10607','64517','93866','45206',
                          '24084','61661','25873','12721','16448',
                          '61459','20174','89054','89067','19219',
                          '47642','25273','63850','31416','43311',
                          '73952','52407','32900','16619','11692',
                          '25043','35562','78728','75067','92953',
                          '70715','79724','35085','10037','66271',
                          '34222','42292','56569','52604','32695',
                          '13016','14717','48697','34884','67714',
                          '71827','28759','46678','17052','30207',
                          '84947','31484','76646','13460','55380',
                          '56673','21898','45014','22925','66861',
                          '52546','61861','37029','16419','59984',
                          '97166','82705','27340','76818','52362',
                          '91460','96164','63975','61568','74407',
                          '65596','20971','49359','80232','99404',
                          '30940','56152','47346','51147','19488',
                          '60521','67814','20761','29011','92127',
                          '23818','26150','48077','94914')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
