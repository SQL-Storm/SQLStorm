
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '24493','37222','97347','16535','35510','93889',
                          '45430','45346','46244','97558','42502',
                          '56490','28184','16007','21063','88755',
                          '49899','50071','48006','51956','15940',
                          '18799','46002','12572','34983','69881',
                          '21723','25040','40879','20221','77930',
                          '29669','92348','42657','95379','34587',
                          '19939','35612','20486','17705','14167',
                          '80333','33577','52316','96220','20776',
                          '26781','63020','45271','18921','94743',
                          '28452','60082','18663','21602','57304',
                          '81044','59955','16215','80689','33251',
                          '19857','93530','95624','55054','26457',
                          '87627','31727','46680','21218','63621',
                          '88008','25364','41237','47123','81985',
                          '43989','35904','17418','71230','30131',
                          '60161','17129','26562','56531','38747',
                          '37086','68471','86812','33639','65398',
                          '12925','20220','65270','17288','35056',
                          '25247','97182','57361','47957','17760',
                          '30490','90015','82748','56906','99063',
                          '26640','17835','61645','60534','61356',
                          '80477','27650','14347','22462','59975',
                          '57776','83290','41306','25654','81010',
                          '67300','23789','68504','71601','67673',
                          '26787','12597','57773','93254','25167',
                          '20779','54180','80098','57186','93851',
                          '39844','19010','16802','46951','53330',
                          '98611','32278','59820','56734','52799',
                          '14854','82788','80275','45627','83166',
                          '32310','48961','36743','10225','14468',
                          '10317','18729','67655','31734','58137',
                          '44255','79650','90177','10310','18020',
                          '23940','44903','58118','97774','33272',
                          '92600','77820','33480','68247','24576',
                          '14336','92082','54962','65708','35586',
                          '66416','71712','92764','34054','50155',
                          '34265','20532','73494','75382','72584',
                          '76956','28880','23971','90574','53017',
                          '25576','28221','46044','21827','89870',
                          '22646','88538','99195','97497','85450',
                          '62103','38707','45863','94521','15151',
                          '70822','80758','19411','36121','37056',
                          '75888','46077','13140','32848','37474',
                          '61306','26768','27660','22981','24139',
                          '29132','12376','19768','98783','44279',
                          '82753','86652','59580','97702','79872',
                          '98872','91893','60619','94525','28766',
                          '49939','27118','54291','12439','55018',
                          '43872','34551','59491','71178','35157',
                          '98493','43224','77965','18207','51750',
                          '22620','25882','43394','57824','78511',
                          '28439','23897','40659','71983','77146',
                          '48269','11242','63851','29298','11132',
                          '65166','61273','99470','22809','14590',
                          '21325','51514','55180','89506','15910',
                          '30718','29335','32915','84394','46373',
                          '46451','54357','64756','32475','28611',
                          '27375','20467','67689','81613','56805',
                          '98832','98110','92753','10530','36972',
                          '56048','38027','24663','35060','51781',
                          '83110','52248','70244','71838','64898',
                          '53310','27289','34119','59871','49947',
                          '30679','13810','45787','15683','66026',
                          '71613','27342','45513','12187','83490',
                          '70194','31690','59906','95594','28056',
                          '52424','58424','35916','91535','79161',
                          '11098','40651','94140','92531','39124',
                          '29112','29663','75579','27149','16484',
                          '97438','56546','66404','21495','43940',
                          '72712','32249','15841','14097','28291',
                          '14421','60931','23363','65705','87512',
                          '45234','40141','49344','65215','30972',
                          '99594','19307','54818','18085','85166',
                          '66954','54783','25830','79323','18953',
                          '63814','63530','95606','43088','93317',
                          '51946','85550','61832','39978','45801',
                          '10934','46248','32643','73837','43997',
                          '43980','63875','81324','10469','29024',
                          '71231','89218','92319','39489')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
