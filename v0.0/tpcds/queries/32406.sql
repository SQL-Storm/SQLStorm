
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '31015','26807','79673','48056','40709','93543',
                          '19077','69922','93017','30578','32953',
                          '22702','24731','72435','21939','93614',
                          '67420','14281','17781','22015','32746',
                          '43237','85552','94284','65877','76804',
                          '66893','20030','20786','56959','34823',
                          '49081','71976','13455','59761','13658',
                          '60095','87802','11733','21797','66086',
                          '55715','54737','46439','56696','10102',
                          '60375','69199','12637','25221','35612',
                          '59541','12673','77273','22387','14193',
                          '89067','19600','23186','48744','86152',
                          '96303','44790','45516','35013','10741',
                          '32696','88881','38877','54669','38825',
                          '29199','12686','94483','80441','67031',
                          '64934','51109','29086','15465','92629',
                          '45041','39167','31108','37499','30439',
                          '25535','14068','69589','17545','11588',
                          '30707','28852','13422','23597','61057',
                          '10177','98479','41836','29737','46604',
                          '94532','79612','48613','76847','18806',
                          '65827','93785','69061','12759','46063',
                          '32110','14226','49616','49667','18517',
                          '51613','68407','23707','17642','87903',
                          '87481','70820','80816','20112','12444',
                          '11135','22827','75118','86996','11887',
                          '99019','56590','14724','46099','28181',
                          '15257','81264','94973','73181','20215',
                          '50274','37184','19316','31061','25537',
                          '19923','15757','41110','22839','47624',
                          '32763','98978','42054','95093','89555',
                          '76573','11911','22793','33673','51388',
                          '86407','89400','85865','18733','45821',
                          '60145','67927','21643','43177','14906',
                          '93841','52336','26633','14966','65144',
                          '87627','84739','12359','67728','60456',
                          '29839','91140','34764','96458','35368',
                          '56995','46608','18327','86422','89161',
                          '32039','40456','39484','50784','19001',
                          '92936','35331','42406','80138','60638',
                          '97521','76183','81707','30469','44274',
                          '18631','20244','74897','31058','80006',
                          '57769','59575','13554','90008','38101',
                          '25156','45788','43109','44872','11437',
                          '80284','75597','55057','88167','57362',
                          '81784','36576','65812','91649','13604',
                          '14594','69841','22851','74409','61345',
                          '10619','30327','27042','54437','43026',
                          '39999','67883','41701','54673','27819',
                          '23761','36870','86315','59518','52859',
                          '98610','12887','38283','22572','15041',
                          '69241','26328','67628','97999','16244',
                          '34520','40513','40665','33295','55303',
                          '50201','24740','81088','65394','31368',
                          '26766','99267','28546','97016','11248',
                          '88836','27293','27308','68068','48206',
                          '69041','83574','85030','66525','74983',
                          '75034','76171','18929','66871','67079',
                          '82128','60820','13511','57570','95649',
                          '98504','79611','48876','91038','13060',
                          '34768','41710','50409','51637','20077',
                          '67098','41751','11924','37335','94238',
                          '79209','77479','32934','80384','39866',
                          '94655','79177','66128','31569','45481',
                          '88343','62468','12272','60471','69689',
                          '62594','48555','46382','56663','60906',
                          '68130','33341','37541','26231','11065',
                          '20079','22754','18231','30260','62028',
                          '41425','11785','30109','84914','86910',
                          '44303','53397','31377','40262','45613',
                          '90646','32692','36754','83176','72364',
                          '13825','13201','48550','25646','69588',
                          '77356','70302','94020','81569','79876',
                          '43598','39002','36836','35365','28501',
                          '18511','17433','63404','13116','12083',
                          '20146','68838','25952','79353','21971',
                          '27275','97592','80374','13138','64388',
                          '82589','70638','62641','26524','44619',
                          '34273','53515','68864','46057','37742',
                          '82898','22251','37270','37361')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
