
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '24877','75374','88576','71939','97131','22363',
                          '47635','94965','26666','10880','33579',
                          '77797','52860','13687','63217','37423',
                          '15087','43499','24266','40787','96781',
                          '24688','58544','69064','78819','68412',
                          '96805','54120','95405','44854','78262',
                          '29885','98787','79368','65916','22982',
                          '21648','11563','46366','35046','32250',
                          '41272','12297','33122','56933','66875',
                          '18626','26225','28525','20630','55678',
                          '27428','11657','97550','19720','96159',
                          '43821','54709','17858','73407','91371',
                          '25331','25846','12415','71306','80154',
                          '99705','88165','64771','57194','70471',
                          '17820','90427','30190','24773','60254',
                          '52608','26049','30478','23815','36306',
                          '73872','65958','71876','88588','95152',
                          '54482','41172','45490','20157','42608',
                          '56386','69228','31291','22616','73720',
                          '46478','39701','38401','43825','16483',
                          '84760','81015','58663','92536','54608',
                          '10500','27325','44744','31625','51405',
                          '11312','24323','13319','27131','31147',
                          '40344','91702','10783','74082','47621',
                          '99292','15633','41410','72395','46578',
                          '75529','84910','54589','72135','86488',
                          '21052','95709','15083','27579','71073',
                          '38936','39057','33384','58523','21807',
                          '49743','65013','75898','55828','71816',
                          '23443','20202','97470','91290','22098',
                          '17462','52398','47862','59115','66309',
                          '37979','18128','36058','78871','88734',
                          '29510','22350','27456','10057','78206',
                          '57485','84956','60181','78635','91418',
                          '42721','37617','60658','43283','89360',
                          '30412','76562','14439','41818','28411',
                          '80410','44501','64711','75896','19273',
                          '83576','30980','33423','70524','51271',
                          '23693','43268','37871','57457','69603',
                          '85123','13146','16204','25516','27246',
                          '70567','15037','92054','23286','38826',
                          '34803','47509','21038','21687','27741',
                          '95045','53611','35673','32956','44220',
                          '57634','28844','99479','70303','42763',
                          '35474','36419','10214','51211','32749',
                          '99275','65017','11674','47639','39751',
                          '29853','39253','50275','54417','18960',
                          '36084','62980','17018','22348','44077',
                          '28759','83215','21814','77759','45307',
                          '47561','24894','82047','37495','78950',
                          '42983','50213','17988','12339','48209',
                          '85317','22315','28545','71588','38257',
                          '71371','25261','79001','19062','44722',
                          '46972','86941','91304','63137','95205',
                          '43895','17118','74229','96188','44178',
                          '74488','76011','27040','12530','53968',
                          '86354','11852','30852','25380','39750',
                          '95915','72157','83226','30767','77235',
                          '97628','78926','16994','47606','39698',
                          '19452','69508','42237','23178','61765',
                          '36544','10964','84620','60826','47575',
                          '20178','42837','40039','83183','34000',
                          '35073','37053','45467','55727','30890',
                          '54105','74925','73235','55537','82297',
                          '67532','13983','91147','33428','19075',
                          '94985','25653','96200','40914','87220',
                          '27977','23148','66347','98842','35335',
                          '52846','20895','97107','24312','60529',
                          '41014','53940','37754','40863','54628',
                          '28905','11325','67501','56526','43917',
                          '36258','58974','45565','35830','89183',
                          '35414','16081','71825','24624','52816',
                          '50808','48927','58234','78031','79611',
                          '42614','57886','33456','38253','62316',
                          '80584','27295','13786','49988','21563',
                          '47988','69802','71537','21235','71060',
                          '47096','89239','68951','68571','44893',
                          '18706','47937','87175','15696','34523',
                          '14375','50935','39684','28551','18469',
                          '40563','15759','31794','99860')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
