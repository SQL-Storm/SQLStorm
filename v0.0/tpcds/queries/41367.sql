
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '70006','74115','22029','28205','23839','80786',
                          '68982','26805','16532','88417','76211',
                          '91075','89001','38560','68317','33171',
                          '60666','43572','56096','13758','94900',
                          '35402','30719','25616','83195','52954',
                          '40438','13805','11141','73963','57430',
                          '38175','63594','99391','42678','20305',
                          '44480','36444','71997','10938','93056',
                          '24647','85444','75808','23188','50940',
                          '61334','80883','89134','64096','10919',
                          '36596','88898','39969','34607','91192',
                          '46834','35374','31423','35339','22345',
                          '45596','91370','24972','44263','99658',
                          '88112','39086','11819','12474','60857',
                          '71621','51745','56058','57795','99925',
                          '33049','11423','49082','57884','95040',
                          '47759','41585','22702','63314','70590',
                          '47006','43952','28588','24278','44687',
                          '69299','38208','57762','54347','54389',
                          '51844','37495','43130','14998','46775',
                          '36133','25685','36326','29728','16312',
                          '20320','28569','72550','75273','46288',
                          '49339','55703','40911','85772','47770',
                          '93479','42336','23014','60953','24331',
                          '10705','32337','86116','80429','68611',
                          '60440','91835','66496','71813','56308',
                          '10573','40179','44132','13279','17824',
                          '73975','31991','58201','20099','80214',
                          '56972','36129','43083','16262','22093',
                          '64388','96261','52290','64400','28126',
                          '46001','10701','35501','24160','15534',
                          '28033','97699','81682','25327','17726',
                          '65681','41147','14781','24940','53784',
                          '27835','94713','47842','63150','41566',
                          '85784','63003','37392','30088','19723',
                          '19590','92543','28573','29202','36324',
                          '53904','17780','11560','16691','50424',
                          '88920','18031','87370','62589','15754',
                          '66724','40296','77065','36154','17806',
                          '45335','31277','54346','67430','56448',
                          '30243','41581','34154','33403','59397',
                          '56005','11804','33788','68591','33286',
                          '17312','50366','22727','66370','57359',
                          '57301','95168','38196','43670','63182',
                          '88515','75556','58964','87434','14621',
                          '39675','42349','49320','91431','71106',
                          '70084','15751','17469','62163','37143',
                          '62460','57203','11413','18460','26083',
                          '46657','10725','12193','55447','37984',
                          '18452','93760','48231','62886','43118',
                          '58415','60379','42506','70988','83032',
                          '44630','39800','98887','44875','83575',
                          '14353','16392','77678','73210','18895',
                          '62766','90839','68879','30409','58768',
                          '40952','23555','77780','81860','25826',
                          '43349','92725','54767','25356','85612',
                          '21162','15456','63391','98654','48518',
                          '21472','65760','36689','94737','12911',
                          '41153','12332','79926','42123','22810',
                          '10059','60719','27022','59685','27599',
                          '69309','59454','18719','84899','60935',
                          '39823','97915','25180','34334','29006',
                          '36305','84983','79637','53808','37094',
                          '78839','56675','17482','97498','12051',
                          '71733','21897','46709','23486','35007',
                          '39248','24911','48797','56965','16210',
                          '51609','41534','83583','74521','31794',
                          '25040','89187','62252','52239','64604',
                          '11676','46314','65453','20384','68400',
                          '86352','58256','75217','31383','87072',
                          '70148','22526','87761','29672','65080',
                          '22350','59858','29204','19594','89363',
                          '54463','49718','23318','37704','34032',
                          '14194','15647','89777','36330','66582',
                          '81771','81244','14318','64113','11466',
                          '24400','25754','31114','99803','42319',
                          '36918','26403','99165','31322','37147',
                          '11904','48964','34557','45994','34619',
                          '48094','37076','14104','43232','16619',
                          '49576','74794','13043','28605')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
