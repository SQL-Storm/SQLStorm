
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '27589','46705','80555','17971','77206','88825',
                          '23312','65741','93385','41101','43747',
                          '28244','20196','74512','92483','37396',
                          '92417','10774','26191','20706','29079',
                          '38729','21696','58403','14408','95759',
                          '21427','82005','24321','62859','23894',
                          '25039','11224','95238','74130','95990',
                          '13653','54501','45895','66259','91741',
                          '90804','26033','29858','31161','28065',
                          '89834','78725','75485','70612','54939',
                          '25614','45700','14608','69007','54629',
                          '76592','98749','26928','21175','39489',
                          '16668','54720','32449','82509','20209',
                          '13096','18754','45682','52600','17139',
                          '94425','86346','19630','57438','32732',
                          '32145','45778','41052','58776','50276',
                          '26080','72513','36414','82854','34859',
                          '77328','29578','32629','14864','67899',
                          '31865','39749','22264','61741','54225',
                          '33355','71582','44724','97440','82822',
                          '93067','20061','38630','64076','82921',
                          '51666','68148','68312','19825','21402',
                          '72847','44736','79297','42253','48513',
                          '95504','27632','28874','33795','22960',
                          '73794','17829','48837','13487','47531',
                          '38304','87148','38710','38240','47616',
                          '59531','52049','37397','18074','78014',
                          '50239','80989','24404','47766','52974',
                          '65254','24714','23738','88401','50037',
                          '33394','15525','47536','82095','95698',
                          '64736','81854','32982','53897','24853',
                          '27308','95866','26737','68430','14215',
                          '51133','93132','94933','94112','64292',
                          '19649','22807','69419','77288','27574',
                          '13118','14687','15382','92707','30377',
                          '19384','16194','73520','79516','36233',
                          '10351','94505','73703','84557','50560',
                          '77947','91173','16779','54394','33419',
                          '76784','16930','46276','31405','10381',
                          '59540','20667','29461','37256','16276',
                          '60414','88794','83510','30508','46623',
                          '28167','37547','15269','28919','13975',
                          '92480','12994','24235','82663','93746',
                          '20001','28142','26151','34363','14731',
                          '96536','84521','59109','91335','12756',
                          '66593','13639','66756','81343','45959',
                          '45261','76494','29612','18419','16358',
                          '43584','16714','12055','16429','56364',
                          '39524','12984','84150','47303','15007',
                          '17191','82839','10287','42691','66360',
                          '98665','21912','86411','13757','39720',
                          '41145','21919','68773','60684','17656',
                          '35515','84893','29606','29936','19142',
                          '15472','89129','33936','77202','76480',
                          '72806','85636','45829','52042','61298',
                          '98838','80139','10844','77343','15976',
                          '14339','41610','35784','66116','57569',
                          '44679','64159','24152','15879','32371',
                          '20772','29042','91932','86570','86754',
                          '24376','15689','56680','46525','26249',
                          '14913','30240','12449','71609','27730',
                          '58979','74303','25498','51517','30663',
                          '12973','29056','53706','27473','14214',
                          '79303','81477','37998','52624','48126',
                          '91777','11494','36043','53276','73435',
                          '27527','44951','13031','60370','42447',
                          '81786','67785','50160','27504','69519',
                          '63327','26164','58187','11010','63200',
                          '10779','92141','56751','43925','54122',
                          '10635','23159','24976','21967','33561',
                          '85665','65460','30055','13932','16489',
                          '76750','96873','29085','13715','40333',
                          '10404','16010','53782','28939','73854',
                          '98605','16500','65291','36604','45155',
                          '76719','21180','72321','76275','11192',
                          '71525','21185','46448','13598','46755',
                          '62863','22594','74972','45408','40074',
                          '63440','13364','20385','35048','73531',
                          '51850','61460','82559','28828','96571',
                          '18596','23763','50077','97133')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
