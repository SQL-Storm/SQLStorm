
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12421','96760','76067','87020','25709','43039',
                          '63034','47989','52529','36120','17713',
                          '81637','20834','50782','44425','26259',
                          '34092','38361','26398','91979','72507',
                          '37038','11529','29966','13637','21454',
                          '54731','13627','45681','55885','51606',
                          '36227','44410','34600','45787','66491',
                          '39226','14944','86400','36397','64025',
                          '32343','16044','36737','24159','10813',
                          '55553','73265','27780','19694','25675',
                          '57094','96482','51809','67294','60628',
                          '16367','31816','83290','95569','87798',
                          '63900','83626','71967','13725','54046',
                          '59522','81175','14626','24579','80416',
                          '79390','25357','28939','51201','12730',
                          '55370','67307','43709','17710','74606',
                          '24591','26128','21153','19915','53929',
                          '83096','97333','41957','44026','13992',
                          '13142','26803','66483','45457','56303',
                          '52009','22024','59532','36594','49694',
                          '56700','52398','33094','95048','91597',
                          '89034','81464','51185','68310','89689',
                          '37676','12981','62184','52043','48531',
                          '16005','17172','57955','13511','55692',
                          '82663','51923','29975','21043','18033',
                          '10931','72442','35118','60633','71365',
                          '25902','46270','94136','24942','20350',
                          '75880','55830','27331','41339','85935',
                          '21887','58516','67960','49165','31145',
                          '49505','98198','37543','21000','80894',
                          '96972','88760','18061','66249','98073',
                          '38718','30910','71336','51277','58448',
                          '64594','76146','28183','54922','34906',
                          '39595','87299','37251','19000','89137',
                          '10497','10365','43082','94506','72266',
                          '38786','40078','67174','83839','88811',
                          '41875','75088','13255','73843','56449',
                          '26416','67402','41209','64524','51127',
                          '60071','23798','51401','22267','22590',
                          '47504','34493','93663','90338','39130',
                          '20821','89469','61282','99018','41805',
                          '19749','31532','87868','97509','48085',
                          '46409','26919','78939','33021','80609',
                          '78635','29670','73516','24107','89546',
                          '20559','82756','90486','32336','12676',
                          '52867','59575','16904','41311','33596',
                          '42541','52827','57699','73065','59106',
                          '80663','63023','64115','79537','76193',
                          '10016','27651','11366','25585','83348',
                          '28370','15572','71007','25245','47457',
                          '66552','24403','75008','17898','89987',
                          '17966','98024','16839','45103','87338',
                          '27339','56124','73619','97807','86259',
                          '51520','49975','47841','27828','42395',
                          '31132','68786','10760','23584','90887',
                          '97392','49036','52980','59425','54100',
                          '23997','98478','12088','22631','44490',
                          '35194','37015','36183','14787','39051',
                          '55097','16873','68329','72656','29866',
                          '38636','20142','44187','61993','91160',
                          '17027','23434','25111','92442','34661',
                          '82793','66250','21062','12990','23185',
                          '43581','41751','22402','23000','67820',
                          '85730','12387','77560','19098','40042',
                          '81462','38476','25610','66665','14102',
                          '70156','27462','33575','82984','77354',
                          '61489','68005','61566','44644','20985',
                          '99896','61402','64470','99579','93500',
                          '18829','10902','88658','31751','89677',
                          '30803','34467','79155','16702','23929',
                          '46345','67137','14540','18328','22817',
                          '66284','21995','60016','68425','84627',
                          '43463','26419','11181','22400','94965',
                          '45651','54850','17765','47724','44762',
                          '74748','54656','38944','43304','15848',
                          '20729','88691','68662','90449','86728',
                          '68955','65599','90637','31023','85882',
                          '93262','30700','52149','16364','40313',
                          '23954','46171','93949','80135','11200',
                          '64629','14016','12677','53626')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
