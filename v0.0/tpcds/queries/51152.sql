
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '76532','68165','33128','25816','89722','75032',
                          '37888','28496','89679','69971','89270',
                          '80289','49392','88428','16046','10975',
                          '17466','36307','84298','46047','45881',
                          '40256','76414','99238','49408','27283',
                          '17342','23754','14867','55008','22052',
                          '12989','73037','50267','21183','11011',
                          '74346','55657','71660','47515','37014',
                          '75260','45008','54998','91305','22762',
                          '62434','87292','35940','34367','50137',
                          '52870','36053','18784','55772','73129',
                          '47011','44357','41756','91441','82277',
                          '95373','40357','82667','84131','16011',
                          '70044','11673','45505','51886','73484',
                          '50952','18806','71617','25556','24217',
                          '34465','17036','31369','26816','55052',
                          '31324','28623','25756','20885','84499',
                          '10727','88223','44417','20651','21112',
                          '40929','49383','41390','57876','34089',
                          '53464','27692','13139','88909','89924',
                          '93402','94447','51880','39775','88025',
                          '25509','42188','16347','39411','97547',
                          '69990','95627','33238','31244','43559',
                          '75545','33935','25671','79379','28466',
                          '22916','33710','24124','44532','16204',
                          '32178','40120','49814','53933','34692',
                          '30653','20133','30990','50356','96685',
                          '36209','27639','17038','70556','47983',
                          '13171','34887','73051','91871','63716',
                          '85710','39303','66819','46233','19885',
                          '33357','60508','96550','72983','14709',
                          '84930','24052','69031','12883','31677',
                          '24715','73237','26064','91565','90613',
                          '20900','39695','87902','33789','93106',
                          '43977','71593','43590','42983','19979',
                          '95833','24721','91585','39898','62549',
                          '43900','80901','48037','10470','15344',
                          '85952','77309','96739','11508','36284',
                          '45925','70590','34017','64409','10199',
                          '38883','23016','12103','36719','65014',
                          '50005','35756','59151','94566','75935',
                          '31382','13984','46160','62930','86884',
                          '82458','15477','31234','95203','10044',
                          '77705','80341','34069','20809','36637',
                          '19468','30744','59716','75736','72375',
                          '95941','98170','12617','12094','12764',
                          '85947','55827','98929','58622','39224',
                          '14854','80861','89329','60580','84667',
                          '54183','25316','68384','29997','37266',
                          '73522','73501','95984','34854','89245',
                          '13205','11360','12948','88222','44568',
                          '64017','41700','18814','18795','13871',
                          '64299','86764','61168','90947','63627',
                          '46235','70950','75525','63649','42328',
                          '69899','90077','24424','63762','80108',
                          '33051','98210','88037','52054','48412',
                          '26771','44895','51157','12672','46675',
                          '86951','78341','27578','97475','47866',
                          '11192','64112','26451','25431','48746',
                          '75283','32880','66865','51388','69773',
                          '39427','10056','70507','99432','19350',
                          '46133','90919','58231','36605','74823',
                          '37709','13954','47997','17660','19297',
                          '66565','56389','75404','62932','97560',
                          '12345','16159','10190','37768','96365',
                          '31410','20229','65213','40007','13007',
                          '54366','45508','19902','73125','92890',
                          '10792','15623','96045','25574','58515',
                          '32530','33610','85545','50392','63511',
                          '73173','78123','17860','64365','77379',
                          '23334','20191','52174','25102','35196',
                          '18282','19599','84149','80164','55569',
                          '71684','44625','48729','77748','28866',
                          '34533','11606','14576','34047','45415',
                          '79070','12701','75041','98145','49190',
                          '41136','98294','59827','76415','14921',
                          '44832','75170','30672','75327','12137',
                          '92074','16604','55231','40686','98334',
                          '94704','59113','47007','84607','84312',
                          '38399','91435','55932','27276')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
