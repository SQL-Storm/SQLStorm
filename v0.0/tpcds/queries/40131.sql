
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '87384','96880','30446','52556','31533','14560',
                          '16356','57092','91210','11848','21160',
                          '18201','84412','82826','67965','49107',
                          '41796','70287','20579','48245','93452',
                          '66482','25567','46730','16225','67110',
                          '51758','73191','97025','30530','46401',
                          '77948','36096','90727','21535','41806',
                          '67486','59897','53602','70816','42400',
                          '56338','15775','41350','56400','83851',
                          '36873','61329','34702','30126','16929',
                          '94170','87577','62154','99497','23317',
                          '51882','49528','21813','55206','49779',
                          '78955','44992','30904','19607','55883',
                          '27713','16704','53471','73128','62118',
                          '52554','90769','37243','32780','19764',
                          '11604','13865','30323','95912','65462',
                          '64948','59261','27034','80528','66481',
                          '19674','11878','19689','14408','40634',
                          '70089','25277','75964','62494','27169',
                          '52562','33586','32106','84099','37346',
                          '54556','22574','34915','14143','40404',
                          '22169','52826','20720','80254','47757',
                          '63643','67870','55670','83984','60074',
                          '89589','28592','97004','69750','84720',
                          '92245','34268','84081','47557','44872',
                          '13082','26469','77412','81182','50939',
                          '15336','19551','82179','57906','18661',
                          '57540','91999','40140','61413','97730',
                          '71234','56937','27434','99168','83939',
                          '54898','14910','61797','14299','41002',
                          '77570','20684','78457','35160','83395',
                          '13346','77453','64288','30222','56727',
                          '46504','96193','14180','77616','26123',
                          '12760','83409','26317','13171','30993',
                          '52974','35946','91734','59236','72413',
                          '61198','58294','56412','18758','73013',
                          '29750','13857','35028','37276','37307',
                          '65936','88967','28897','34153','82898',
                          '14950','50228','85765','48918','21052',
                          '44187','41889','12518','27389','53081',
                          '40631','95871','38415','29484','71962',
                          '28761','23723','22213','96015','19982',
                          '47128','16780','70557','47762','96706',
                          '91573','66871','43328','35744','91342',
                          '96413','28239','53440','27082','87334',
                          '70190','55220','84178','39373','69913',
                          '17647','92500','42551','45066','84511',
                          '82994','61462','97987','26644','99367',
                          '40785','57260','38257','13680','25791',
                          '83362','91402','77106','12271','18787',
                          '19727','11429','90987','21229','93334',
                          '77448','58131','25484','93287','17075',
                          '46154','94955','45299','98821','67103',
                          '25265','39665','50075','22359','39659',
                          '50248','43957','17474','56423','25956',
                          '91976','32254','78216','71154','62739',
                          '62464','91510','85496','18334','62789',
                          '22658','26000','68941','21174','38672',
                          '91650','83273','11970','70830','40159',
                          '68426','14385','34111','93553','32259',
                          '65847','60133','32642','85492','45312',
                          '74190','19008','62490','13699','34681',
                          '86108','62600','32186','70520','23071',
                          '24119','24543','89626','96024','68509',
                          '34714','91697','11189','86202','13664',
                          '70175','69320','81399','77824','21197',
                          '17764','24619','52056','16523','25945',
                          '49445','69879','10895','11028','39618',
                          '83243','37205','54230','27650','13104',
                          '37087','34754','28879','29735','70425',
                          '61699','72223','10423','61572','23997',
                          '86489','92271','21140','76874','97840',
                          '12702','57044','33201','12653','94394',
                          '13373','82639','24163','99005','93020',
                          '57741','67896','24443','40233','43043',
                          '94002','69435','28310','19686','52469',
                          '96329','46670','25318','35954','62905',
                          '62208','78494','11389','21583','77870',
                          '35886','76011','20264','10434','56072',
                          '49785','73571','78985','70608')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
