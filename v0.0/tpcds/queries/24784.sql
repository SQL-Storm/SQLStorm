
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '10437','37254','46027','99469','30236','83887',
                          '42241','70036','85156','59321','11346',
                          '41411','19031','49169','15118','10859',
                          '11682','76749','54855','91255','96140',
                          '54801','49495','21609','20372','53089',
                          '49492','28895','47206','50899','50498',
                          '13624','88005','79081','15606','34885',
                          '50874','97256','94984','80833','92776',
                          '93805','41343','11986','19844','39396',
                          '75926','71272','96718','94008','96186',
                          '55819','92460','22348','54342','21245',
                          '25241','44545','48131','14329','12206',
                          '19140','39220','86114','33734','98127',
                          '18709','37516','18878','22520','72014',
                          '57520','36470','42987','81910','51393',
                          '16354','36215','13746','13270','62144',
                          '31447','38641','55017','66108','48976',
                          '96336','22510','77899','76021','15391',
                          '30721','19449','31906','49580','62311',
                          '27751','86329','55605','77045','15380',
                          '49280','30919','84171','70767','40013',
                          '10390','35973','45388','87301','44573',
                          '32760','23219','55405','30594','32494',
                          '21209','48983','77825','30723','11027',
                          '85097','49204','34951','30297','10549',
                          '42248','19074','14001','75194','22699',
                          '29986','22808','16249','29205','64532',
                          '27968','51632','45087','91800','62956',
                          '80962','23505','48077','90731','41296',
                          '14318','16660','62169','65683','51596',
                          '21671','43954','33277','46119','20251',
                          '34558','63311','37532','23363','18231',
                          '21483','46010','78806','56933','21551',
                          '99991','11125','24630','23511','65668',
                          '77599','93984','35582','23456','64657',
                          '53836','90101','26527','11685','60798',
                          '27155','13906','53720','58286','95149',
                          '32480','11797','95890','94933','10864',
                          '27766','84324','87707','22494','43208',
                          '29733','31246','17800','49948','19586',
                          '58362','98958','90605','42815','17955',
                          '17007','21434','73956','95765','19678',
                          '86443','99890','20949','65647','24219',
                          '62602','34928','29580','90111','22303',
                          '26027','68186','90041','24035','96644',
                          '13246','86550','40389','61847','88168',
                          '48841','45138','23484','86731','69321',
                          '85335','25331','10054','23635','27976',
                          '79449','69658','52262','17497','44846',
                          '52516','75623','12478','33400','18722',
                          '56217','48789','48000','38568','35921',
                          '84316','67950','25377','60634','92690',
                          '59536','11651','52891','19960','48602',
                          '33316','90821','75277','87748','60203',
                          '43755','51854','43087','74986','89823',
                          '16714','37239','87380','54660','45049',
                          '45875','44465','53191','34797','15928',
                          '54967','88115','37983','22794','13177',
                          '80515','24293','88166','60051','36752',
                          '79488','12602','99256','28357','19082',
                          '55207','17464','11804','73532','23962',
                          '11567','32955','27837','20417','89528',
                          '12414','22418','28684','73476','45751',
                          '15641','95277','45557','19310','55701',
                          '91048','13225','37704','39466','23986',
                          '84772','72749','92195','89076','77956',
                          '76176','63860','11025','10674','27725',
                          '92969','83480','97222','17670','11304',
                          '56621','33380','77410','53639','79601',
                          '41355','34717','79462','81042','46268',
                          '19533','17422','29803','16742','45623',
                          '61905','27173','12835','10788','78442',
                          '78743','55726','58801','32343','60671',
                          '17974','72568','77826','90215','44119',
                          '23376','44302','38949','62040','26187',
                          '62284','20263','27072','60324','12472',
                          '70064','28266','60326','11833','11466',
                          '81550','38456','66538','39232','51814',
                          '65193','23072','79541','45008','28190',
                          '91937','78961','58555','30067')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
