
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '90681','59566','12231','17130','13437','15410',
                          '50485','25112','36230','14565','90204',
                          '61157','30665','75200','31736','42325',
                          '34772','59448','45430','69252','10561',
                          '54267','24641','21543','30426','54456',
                          '82795','11939','28200','18455','78210',
                          '24934','96897','27399','32664','21616',
                          '38588','92911','68938','10812','59904',
                          '86686','10842','12445','87806','86967',
                          '92101','31054','13463','26854','25624',
                          '15698','27545','52649','24053','84083',
                          '66060','46146','33178','17740','21789',
                          '72276','46680','74055','12665','15631',
                          '39354','31738','10594','30793','84315',
                          '97969','34094','70473','32337','42868',
                          '29564','54852','21272','55725','77403',
                          '53827','32418','90090','33892','71533',
                          '18572','53814','22340','94959','60522',
                          '13060','68133','43210','96393','40953',
                          '81898','78357','35464','79146','17156',
                          '46922','13109','62180','29273','53083',
                          '26258','26206','69729','93187','88996',
                          '26543','57409','10583','30207','80517',
                          '41700','52381','34584','56877','73055',
                          '65493','50338','71073','22499','11301',
                          '51311','51652','73091','14005','27206',
                          '24685','45702','71172','86917','57092',
                          '29077','13179','95238','86167','68114',
                          '50731','51700','46137','37227','26518',
                          '25655','23445','22789','99613','19072',
                          '59202','83089','28810','33567','27916',
                          '79094','23942','72256','45693','41284',
                          '14407','91280','99634','76581','48130',
                          '37359','59699','11690','48281','11090',
                          '78420','55940','67936','23027','80392',
                          '17323','61134','59670','78800','93816',
                          '67809','40350','30724','81311','54168',
                          '31599','48126','21179','45040','33246',
                          '94605','44846','31493','29293','54394',
                          '11264','48959','22480','67562','13695',
                          '53950','30653','60317','55170','15513',
                          '11878','44529','72584','30795','93515',
                          '23165','31330','98995','96171','73260',
                          '48771','75565','38266','56859','86471',
                          '59569','45660','54899','59133','34102',
                          '12093','82163','82614','72586','48268',
                          '21609','47170','93765','86678','60478',
                          '78988','54138','92085','15824','63502',
                          '29854','22810','37071','86012','55046',
                          '29403','47974','43130','43922','48885',
                          '41249','36942','12476','91414','50661',
                          '21790','12975','13972','16208','22412',
                          '34765','88299','45907','37129','38039',
                          '46214','56607','36335','78775','70635',
                          '81414','16313','11906','21387','72091',
                          '45835','13044','24480','45707','44470',
                          '51543','75194','70797','70713','86334',
                          '34375','69293','49985','38970','16856',
                          '48224','77314','92824','80776','49169',
                          '23090','18432','21813','61885','65284',
                          '91809','41104','40023','61340','87894',
                          '27555','14769','73755','16998','44026',
                          '61147','84648','84457','14786','28628',
                          '38549','21301','28784','63935','87446',
                          '68155','42892','28910','25575','41013',
                          '87242','59709','36645','36167','54133',
                          '93292','80342','83339','50776','25129',
                          '99997','17663','11545','46150','72762',
                          '87440','33180','43018','10829','89557',
                          '25925','72335','85057','12196','16919',
                          '25230','98384','25477','85295','43837',
                          '81829','96132','36051','43178','33189',
                          '24490','11983','95897','84067','76264',
                          '59873','42739','89875','20137','64006',
                          '65303','14250','14898','61222','54058',
                          '63233','15231','86418','90476','21457',
                          '14896','51529','79280','95184','49624',
                          '44870','48857','75495','84683','96321',
                          '80462','12833','80073','15747','43489',
                          '92887','38139','42926','31008')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
