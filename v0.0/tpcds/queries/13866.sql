
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '85534','51438','40768','40075','33296','13217',
                          '69883','98152','18970','15851','30066',
                          '12021','40213','38177','52704','89910',
                          '31645','84446','32808','48937','96836',
                          '11847','43840','80882','31286','21259',
                          '32095','54103','27886','83730','17142',
                          '53598','25849','24359','57041','46365',
                          '51310','74456','77129','72781','17512',
                          '59773','78787','67273','78719','80347',
                          '19866','34464','84428','54523','94482',
                          '30985','99707','65503','37133','42300',
                          '14358','36126','91221','83762','82796',
                          '96601','62430','12985','69275','68690',
                          '31510','50897','66824','11341','36770',
                          '48269','48194','19956','43745','78692',
                          '19599','94324','59518','49748','99430',
                          '32033','58854','16954','51701','39232',
                          '81618','68126','12083','53443','76163',
                          '24407','56234','97555','90248','96159',
                          '43550','18624','80385','19320','93863',
                          '66611','44374','61687','46061','30082',
                          '38619','13120','58304','83788','46270',
                          '55325','82200','13674','22642','86694',
                          '69562','55301','93714','75620','36290',
                          '46792','15795','60216','18261','12698',
                          '64091','10210','94502','17548','15632',
                          '47244','16203','17678','85496','34488',
                          '74226','39659','52268','98708','22328',
                          '92584','93217','31800','43595','39822',
                          '82374','71443','38847','20862','26900',
                          '53408','31662','23738','43185','93709',
                          '42224','20954','58224','53807','80982',
                          '93793','52728','18615','46560','10626',
                          '18321','83179','88503','49026','28635',
                          '31555','16056','42049','91819','68557',
                          '61621','25343','19917','44426','16615',
                          '17959','79716','16454','45332','23382',
                          '94440','32632','18183','50825','63357',
                          '78052','28306','53046','28387','51522',
                          '70907','70267','32281','45891','15257',
                          '66376','79958','70823','25752','66743',
                          '12792','73349','76260','89918','18728',
                          '31570','68591','10387','43170','36888',
                          '26365','46425','61854','83503','44650',
                          '36492','17600','27600','18471','28521',
                          '34527','44987','50494','56035','60840',
                          '49393','48445','75256','65770','27538',
                          '21666','26333','24775','14279','93540',
                          '38783','50835','60343','42724','50803',
                          '16537','58999','16484','98199','70853',
                          '33826','45236','78873','23400','65218',
                          '60943','81284','99787','99143','46284',
                          '85588','50607','91939','22890','80561',
                          '26322','19715','62107','21863','72402',
                          '29575','90642','97301','84957','63673',
                          '27300','16921','53267','22144','78059',
                          '79219','88423','38526','55402','74992',
                          '30660','79530','77049','54226','71877',
                          '27508','95063','78581','84447','32530',
                          '32351','43583','20905','43375','42250',
                          '35103','21055','71380','66594','83413',
                          '86646','21793','69379','49439','39656',
                          '68762','26063','30009','80058','31033',
                          '32393','88154','81868','36113','11524',
                          '86956','16389','18014','82152','45867',
                          '14617','45857','56978','98452','83246',
                          '14534','93507','32744','48734','38852',
                          '17709','19552','22543','85818','69064',
                          '19653','41793','21946','56427','11877',
                          '82555','42364','17347','35848','24371',
                          '32192','52838','56495','89160','65379',
                          '45929','23519','38549','16801','49303',
                          '22380','26773','94715','67648','69914',
                          '13477','22288','97737','60493','30132',
                          '28257','12660','46945','32939','63252',
                          '12119','70158','47293','61082','58137',
                          '66110','61076','58343','17930','25899',
                          '66381','99235','74934','57066','11226',
                          '95647','82348','44479','15358','59831',
                          '40335','48377','35104','47555')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
