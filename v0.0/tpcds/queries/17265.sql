
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '40680','47636','66672','30297','40807','69317',
                          '80829','55592','55469','53725','25510',
                          '90613','82431','34450','15413','83324',
                          '83048','34849','78608','63954','19156',
                          '54168','48376','13249','38659','78241',
                          '70425','38732','62183','15875','17914',
                          '62915','32819','16102','11996','30869',
                          '23932','23258','39930','11411','30568',
                          '29033','11339','46164','30571','95396',
                          '32129','26185','94718','40020','15119',
                          '74365','28824','89037','73739','36673',
                          '12757','21438','32659','98216','29982',
                          '12179','27752','61060','23576','30701',
                          '35608','90266','54061','89375','38578',
                          '83699','38100','32513','28789','88052',
                          '12334','21418','21100','65417','38681',
                          '80378','15749','47882','11661','98750',
                          '86683','56452','38234','38010','67994',
                          '69898','40162','38433','68276','17014',
                          '88140','83801','34071','15813','72890',
                          '94543','56740','17747','37111','19628',
                          '99869','44326','95417','42319','47826',
                          '32774','76163','21790','94616','27412',
                          '16368','36424','68109','37079','78521',
                          '32088','74979','30842','54290','61269',
                          '49451','17441','91883','27065','62793',
                          '48089','58919','99533','82823','67011',
                          '55263','91572','12337','22611','80306',
                          '60335','47849','43958','21501','18241',
                          '47553','39549','74057','14494','28796',
                          '32767','97684','19485','11049','24761',
                          '93460','67323','60094','36067','76370',
                          '66112','26843','83003','70640','77105',
                          '82943','12589','16365','30142','56056',
                          '57459','21530','32943','60649','20927',
                          '30194','19561','93633','76387','82483',
                          '27874','12508','18589','59148','26326',
                          '70176','68301','25921','10248','38238',
                          '31258','62263','21147','67688','56801',
                          '10454','97628','58821','21959','14489',
                          '69686','89385','76638','43105','47127',
                          '65984','65987','35034','85775','78182',
                          '28066','56675','86958','44677','69561',
                          '27469','89952','86388','22999','96108',
                          '26097','49792','67904','62052','60354',
                          '74570','44371','92698','33879','52387',
                          '16216','69534','82337','14108','43056',
                          '32366','15528','47628','17625','82893',
                          '74674','53099','32904','90238','22557',
                          '55617','94100','50314','33372','33611',
                          '36975','22005','23804','76282','39425',
                          '68018','39744','58738','52222','19338',
                          '74559','49427','88278','55918','71736',
                          '70607','68050','35144','65934','90072',
                          '12904','56202','70755','19163','19403',
                          '23811','18102','45584','76123','65352',
                          '98586','11747','69470','56453','98714',
                          '44110','50090','47531','91893','76689',
                          '39504','15556','49345','18446','56174',
                          '56455','96891','35931','28510','63924',
                          '13064','12740','85169','32271','11264',
                          '10005','85834','41145','85324','14198',
                          '46357','32237','35079','28268','88153',
                          '57338','75939','39224','43343','31487',
                          '69595','69110','25361','43001','89496',
                          '94572','22859','26129','30256','87268',
                          '54018','13049','69574','72657','80328',
                          '83452','63171','47665','32977','16784',
                          '45184','11299','24347','12646','85325',
                          '72121','64676','74978','59104','14832',
                          '63203','58274','72366','52910','58765',
                          '74930','39179','39250','23854','58701',
                          '16971','89738','65117','14214','18681',
                          '58711','22144','47220','71029','58300',
                          '49704','77000','64658','89524','35809',
                          '49672','54176','75967','57992','51173',
                          '65295','21561','50808','34827','58278',
                          '25227','43284','90430','81083','18172',
                          '84328','39632','67496','48242','55894',
                          '24055','21291','20098','46130')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
