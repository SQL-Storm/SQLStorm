
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '67402','87664','47248','71044','31861','53151',
                          '61982','15053','69082','20241','83512',
                          '27081','56280','99116','21497','23773',
                          '58379','15701','53459','18191','97483',
                          '66029','60541','86242','13952','14866',
                          '31061','48762','25588','12267','68736',
                          '31520','81688','31736','14089','50658',
                          '12066','12160','29299','33550','13734',
                          '77719','79935','37795','51869','94120',
                          '51104','87576','79111','68055','24398',
                          '70887','27029','81403','49539','30775',
                          '35772','22246','92845','25686','69909',
                          '50162','79017','42263','86067','29174',
                          '16227','21168','67784','59420','71892',
                          '19701','27126','26507','76687','40841',
                          '37983','40520','44942','85487','77191',
                          '25589','21849','22365','60323','17968',
                          '78111','94559','33404','27934','81371',
                          '60202','10229','60022','21868','41195',
                          '98605','32639','30398','24789','59187',
                          '28863','33672','29184','42016','12784',
                          '63489','55478','85702','21632','22779',
                          '70617','18307','75692','52131','55459',
                          '96754','17168','69506','43205','19557',
                          '72926','25647','67255','46089','53016',
                          '35313','37201','15736','74215','22313',
                          '10946','89731','16537','33267','51338',
                          '23814','61527','80801','30296','79595',
                          '61013','14746','53824','43336','19555',
                          '93631','41383','10399','18201','14510',
                          '18303','33669','91407','24900','19518',
                          '31262','68443','27555','53805','46856',
                          '74429','62079','88507','40937','31074',
                          '58470','56373','69173','83343','48637',
                          '92915','82252','66744','25225','12765',
                          '61945','21232','31620','32470','44212',
                          '49488','32870','79983','17627','13784',
                          '74199','51282','61051','41140','16816',
                          '40644','63761','47870','29481','28216',
                          '59804','54568','83559','42185','52053',
                          '73209','71431','64338','38425','87814',
                          '12943','92351','12825','35493','86735',
                          '13165','24501','21924','46878','79438',
                          '63582','13582','21306','23654','33374',
                          '72248','80184','47313','20228','72513',
                          '29799','47818','81144','11479','24610',
                          '76050','35020','58010','90088','60432',
                          '14308','27200','78155','64509','44103',
                          '86389','46271','31976','11827','55131',
                          '29521','99325','54609','12389','95604',
                          '43482','25685','34905','62068','26416',
                          '25478','43811','13594','47174','23837',
                          '71273','54045','66721','89297','60808',
                          '97838','42181','18163','52501','10164',
                          '49910','13721','34872','41227','90744',
                          '16458','51526','66033','90832','94138',
                          '69238','45028','93502','43554','86690',
                          '55059','12110','21380','19609','15425',
                          '41801','62189','45400','28391','50793',
                          '57680','13857','82698','41202','37194',
                          '42426','39597','26328','75436','67591',
                          '15963','59320','30035','42103','30205',
                          '36298','19781','38217','89650','42874',
                          '46040','11287','60683','91211','80377',
                          '55988','17146','19913','55976','17932',
                          '71327','19220','14356','67523','64986',
                          '61404','63910','28219','22919','20822',
                          '80955','62729','90814','41986','40200',
                          '33543','15027','83624','46960','62099',
                          '92435','26560','68811','30305','40604',
                          '58696','32154','44606','31311','87361',
                          '96303','39745','75371','46764','25964',
                          '27810','54739','30632','40519','17700',
                          '85624','74959','69426','27658','45177',
                          '35836','84258','65150','32047','98342',
                          '12091','48552','25810','57668','23004',
                          '17321','55695','48535','37725','41113',
                          '57281','18872','40986','22667','58398',
                          '97834','85212','56916','81855','64065',
                          '69335','46302','47374','16622')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
