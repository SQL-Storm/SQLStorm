
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '12630','16288','35731','45994','26049','16155',
                          '79037','39015','41260','26877','49523',
                          '98925','32419','32326','49511','93999',
                          '62691','54956','12343','22113','52351',
                          '38027','77480','60051','26221','97348',
                          '54775','20054','73338','94384','16399',
                          '36094','64018','88906','14801','23604',
                          '24354','16044','58388','95062','64541',
                          '30203','52424','19978','32088','25208',
                          '25007','79438','86861','22131','74258',
                          '38149','37961','67992','29458','32494',
                          '17584','83441','36997','68168','14295',
                          '46427','31231','25177','39002','22411',
                          '26520','55414','83007','29202','22962',
                          '36277','88722','40534','30618','60916',
                          '41199','16105','40973','33394','81972',
                          '25634','78682','86578','14515','98828',
                          '80127','94953','34165','79573','72675',
                          '65859','66198','11730','19903','11073',
                          '59535','44426','36812','61171','23572',
                          '69928','23370','77511','76394','32800',
                          '26588','28527','25425','33323','74567',
                          '56541','93916','95111','22677','62579',
                          '79658','56641','32948','10387','55645',
                          '55511','17545','59336','39788','49504',
                          '68316','92795','75504','45842','15474',
                          '84251','10978','16778','44009','96876',
                          '34248','95287','45299','70005','98533',
                          '73757','61370','78465','83672','74423',
                          '50675','36284','29796','47439','77276',
                          '73248','30827','65752','18496','28251',
                          '74051','15190','64709','23228','95102',
                          '17423','66147','62312','82782','50884',
                          '51697','17101','53946','84319','44196',
                          '81740','68782','60758','43986','26249',
                          '83507','74928','64536','99401','58096',
                          '55850','47612','43862','94408','61609',
                          '12988','77133','88506','88446','30387',
                          '23287','86314','81989','18584','24406',
                          '85384','28004','15347','60377','58797',
                          '70286','23426','80490','71791','30630',
                          '66604','33735','76416','24146','99781',
                          '25088','67969','20177','19450','55612',
                          '91361','50618','59089','29379','45262',
                          '88890','32922','18405','34138','49639',
                          '73540','85882','82728','32262','68488',
                          '26923','59091','96574','21327','95712',
                          '74318','97270','19555','37010','20838',
                          '43657','12969','36229','28919','63468',
                          '29211','63248','44093','50423','79577',
                          '14705','48532','26780','44612','14639',
                          '38291','35301','42313','76998','13768',
                          '24679','30967','33673','56333','34856',
                          '41948','23121','18205','36577','19614',
                          '45300','80135','24678','51940','85268',
                          '47111','70710','52725','66226','67789',
                          '98160','19887','60687','64851','12208',
                          '46035','33803','24184','48434','22786',
                          '22690','31823','31194','66222','84498',
                          '45597','59246','96176','36209','82840',
                          '13547','54853','95456','16662','98177',
                          '56290','24890','28835','59885','20917',
                          '36001','38254','32700','30503','12146',
                          '99964','41048','46640','71331','88580',
                          '13651','54007','61067','12459','56408',
                          '18848','46116','47792','31662','15035',
                          '36117','64862','83629','44142','35495',
                          '20652','14244','97838','62622','38470',
                          '54905','83886','55710','51837','13079',
                          '19872','86572','11252','71326','40255',
                          '60271','43432','24714','97166','92222',
                          '71457','91001','42857','23477','79381',
                          '93049','28232','47651','23003','53638',
                          '62476','37827','12166','30335','56088',
                          '28388','73141','86397','71234','37072',
                          '90977','10560','28585','50258','17738',
                          '22305','96491','99938','10551','84617',
                          '58536','34772','39001','81664','50775',
                          '41215','25534','98919','34959','23676',
                          '91709','56696','83838','24623')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
