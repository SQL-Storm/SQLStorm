
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '67746','15875','68756','67771','14544','61380',
                          '26406','34097','45350','19150','64531',
                          '42839','15484','17881','31126','66514',
                          '78402','45358','85676','82653','58108',
                          '43764','11545','19814','98589','14289',
                          '37666','30130','46868','18130','64828',
                          '45640','66810','14466','23170','89436',
                          '20597','35031','76963','56948','73329',
                          '30165','78247','92867','45756','54226',
                          '59522','81178','55542','33974','32052',
                          '70728','18143','41147','95958','82952',
                          '57069','11286','10799','48153','20697',
                          '31386','15471','19746','44145','96785',
                          '72287','68046','43389','46048','21689',
                          '22343','50600','57657','76859','26154',
                          '81272','29400','63872','20104','46553',
                          '93122','11315','78970','52141','88640',
                          '21137','52466','77361','83489','46742',
                          '25054','25631','90158','97778','25547',
                          '99604','41554','99997','18181','36303',
                          '15534','44882','18189','33322','98446',
                          '82367','34014','47512','14880','63754',
                          '77916','70598','13287','28672','41818',
                          '38779','62658','34305','33421','31662',
                          '69055','86398','43276','46391','96251',
                          '45497','84805','56310','33289','14852',
                          '89553','82042','24672','99591','47354',
                          '24006','51521','29014','42768','80971',
                          '63921','27057','74237','85211','91254',
                          '70259','28738','24339','54296','28207',
                          '55282','70116','67302','13927','18549',
                          '43153','90429','33272','62438','65493',
                          '74527','43211','43388','50839','34068',
                          '66291','95065','95149','59529','48327',
                          '60120','33200','94005','60327','33435',
                          '26587','80698','32295','38468','59192',
                          '86437','85427','52041','79412','29818',
                          '84632','56229','47438','66800','24670',
                          '38277','61739','35513','44922','18764',
                          '22684','37722','26499','40061','26084',
                          '51898','38051','29778','17113','14698',
                          '23683','72208','54345','37802','19038',
                          '17403','43871','31801','10069','32626',
                          '85875','24831','87087','76188','92900',
                          '20911','37162','79334','82627','37020',
                          '78701','37634','91901','83253','97444',
                          '80644','13763','87870','11589','29795',
                          '89164','26415','43060','45343','40789',
                          '95786','13430','62316','79720','52143',
                          '78070','68744','30432','55656','78901',
                          '80057','59542','85154','95582','24379',
                          '33323','30274','75348','26837','16907',
                          '88217','50842','47056','37597','16302',
                          '62118','19128','31688','69550','77827',
                          '44782','94923','13617','76919','37425',
                          '14552','89473','99574','32854','58590',
                          '58623','90650','40208','85209','37271',
                          '81666','65695','79946','72414','48207',
                          '94217','42342','95079','95644','74875',
                          '61189','74344','91911','91159','23715',
                          '11477','20893','22509','10271','53846',
                          '16309','56104','34620','84279','33140',
                          '83948','19345','91948','34385','29608',
                          '26894','30986','16831','36639','16480',
                          '39263','88503','73022','43292','59034',
                          '90097','55161','15592','28734','44211',
                          '15065','37325','17847','99797','68452',
                          '24944','91708','84721','13872','23140',
                          '78688','19646','71260','14882','98576',
                          '80868','29949','28172','54699','94765',
                          '86150','94692','22977','27322','51058',
                          '47833','48836','25491','33811','13431',
                          '29794','87015','37094','47588','98993',
                          '90078','27588','22845','25940','61275',
                          '87431','20407','77605','88662','56268',
                          '45410','44327','93509','15561','38421',
                          '94964','43692','85265','69456','78131',
                          '98911','24696','76947','30081','24544',
                          '10165','49874','56258','87010','24909',
                          '95042','17251','59327','50584')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
