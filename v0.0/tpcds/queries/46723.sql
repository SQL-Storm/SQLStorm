
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '55004','68726','66607','14025','63557','91255',
                          '71508','22014','72495','43150','49552',
                          '83657','57399','18270','94433','71320',
                          '18593','41112','27565','29393','16198',
                          '44068','13242','54252','82120','12420',
                          '94986','36126','42932','53412','57012',
                          '23183','75766','30031','41332','99077',
                          '57102','39638','87658','45356','10801',
                          '51532','39320','20648','50828','30355',
                          '23538','48321','51381','70417','17566',
                          '64057','10292','41994','62975','37587',
                          '41012','14396','40115','24439','57056',
                          '52920','85098','51446','59693','11482',
                          '19635','78963','22176','68421','16489',
                          '75978','70241','51193','69440','88600',
                          '50313','98885','77523','36554','98976',
                          '52567','80247','32622','49924','20012',
                          '55288','77809','41370','43958','36416',
                          '98346','26296','77710','32462','12363',
                          '53678','69890','56514','35138','75334',
                          '17033','26695','71059','68800','42937',
                          '58721','28279','27509','58450','21848',
                          '25977','86373','58713','35086','38416',
                          '63789','25363','92266','82895','90630',
                          '28224','37317','14423','11544','50751',
                          '88296','68712','48353','37345','60104',
                          '24475','85713','20791','37052','19529',
                          '92666','16689','35333','59233','77370',
                          '27472','47600','25741','26032','69088',
                          '14284','25604','33419','22400','10443',
                          '45283','62450','65981','19105','58006',
                          '93614','82226','79510','33590','45782',
                          '15020','49212','36797','24780','20286',
                          '51030','20371','14758','29047','32870',
                          '44891','49256','90090','44972','82756',
                          '82482','20680','40658','75187','87308',
                          '75624','54803','44850','22457','92539',
                          '68735','61432','10932','93440','16200',
                          '21078','39338','52525','78511','91964',
                          '99887','71063','59431','45417','33870',
                          '83549','81779','38457','37801','18985',
                          '49670','68536','35882','34555','29250',
                          '84294','12760','22050','73946','75590',
                          '11044','22546','33070','97609','40548',
                          '61246','28355','93496','26320','26469',
                          '43091','19333','18211','93698','35594',
                          '44925','21502','60118','69864','40470',
                          '13453','36220','14360','17250','20920',
                          '97208','12119','49219','69208','40503',
                          '26770','33037','38893','50407','90240',
                          '67235','19127','42800','68210','38592',
                          '51536','13783','27726','78575','40320',
                          '26621','42530','48230','10331','22242',
                          '29335','65338','64258','37272','91516',
                          '32257','39795','50047','16605','20787',
                          '25578','37138','70303','65656','91526',
                          '17610','62812','37812','68032','84526',
                          '62206','40973','95197','73240','66418',
                          '58507','31392','10138','11577','80337',
                          '42194','91269','50501','69298','32504',
                          '51772','93393','76079','52450','34113',
                          '55771','21963','80440','86356','28656',
                          '23232','57813','13057','41378','37961',
                          '32020','88699','37058','37633','20047',
                          '19444','44864','35538','55952','66822',
                          '22545','76687','99357','44448','91272',
                          '30217','61511','84532','57292','65608',
                          '31256','97012','79371','29316','77202',
                          '83436','12235','10314','48158','10969',
                          '86012','17864','66628','13487','41863',
                          '64040','26327','49200','78681','76609',
                          '10099','50281','58437','73177','24008',
                          '39505','48567','89429','52924','91901',
                          '44980','43702','43257','22939','71246',
                          '12726','22870','39707','16786','61487',
                          '81721','32336','37384','61212','55269',
                          '12908','38452','68725','36376','12439',
                          '22407','70978','68871','28636','37312',
                          '16394','49986','36402','94680','57002',
                          '93919','13813','81666','97533')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
