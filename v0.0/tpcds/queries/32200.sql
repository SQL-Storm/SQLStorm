
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '74161','67148','23492','31932','89109','41734',
                          '56962','46255','19971','50287','22738',
                          '32606','19554','18555','24643','40468',
                          '15313','99499','84451','98034','58512',
                          '80039','62975','11863','28813','77170',
                          '56339','45282','47349','17676','74625',
                          '23210','87529','50416','12672','57765',
                          '69710','98681','53285','20094','12516',
                          '90012','40416','36122','85576','15577',
                          '14862','32052','89683','85715','33840',
                          '94108','62241','48354','14488','10941',
                          '83159','72224','42096','22566','80779',
                          '25879','53841','25513','90458','66801',
                          '64283','32869','90154','41747','78508',
                          '20548','27274','40629','32268','52924',
                          '30211','48087','70260','17373','14817',
                          '58553','20002','53405','39481','27202',
                          '38110','66130','60643','11374','27747',
                          '62943','93940','66504','86783','57228',
                          '84185','11358','40795','38691','90059',
                          '30160','90097','80088','90304','55936',
                          '55489','32221','72165','14230','15128',
                          '24153','55942','12492','93479','42157',
                          '74555','75405','50277','24098','52242',
                          '17705','62370','11999','14700','57620',
                          '29449','32289','76261','69650','31857',
                          '44143','31904','42407','99469','70200',
                          '61446','67415','93712','32304','71897',
                          '53645','37229','73144','82349','64271',
                          '73069','10479','76857','90177','82567',
                          '65352','34637','45829','13407','55860',
                          '65268','64736','20621','73516','47858',
                          '94137','62950','76059','83203','28719',
                          '82546','10396','21680','58442','74336',
                          '35933','98005','84277','54800','26804',
                          '63721','50140','82513','77800','41235',
                          '90846','99166','72911','58993','18116',
                          '24548','28998','82040','92404','33826',
                          '45263','97624','18712','34093','60265',
                          '78276','23810','94131','54826','44733',
                          '82786','25147','16670','98355','15278',
                          '99077','89170','54642','21221','88256',
                          '33031','16627','95503','19684','69257',
                          '95132','78320','25910','46553','66076',
                          '87944','68841','37397','39477','28010',
                          '99419','71785','92918','26818','10530',
                          '40827','13377','88198','49222','37647',
                          '57321','27094','66805','94001','13664',
                          '19081','54095','15488','28535','80664',
                          '75696','46926','28810','52491','19061',
                          '15836','83145','57827','24909','25032',
                          '81651','47593','34717','97906','75154',
                          '98098','17617','96815','17511','20591',
                          '70998','90717','11202','53834','69200',
                          '26668','77117','11305','67898','50333',
                          '93764','30527','46761','17262','49161',
                          '50275','76122','54715','30354','21593',
                          '82417','67120','34123','18561','27826',
                          '36691','12071','18456','38029','35364',
                          '92016','67522','13183','15690','15178',
                          '97112','41949','45834','50915','96310',
                          '58153','12541','23754','74147','61732',
                          '49424','55096','37830','31927','62121',
                          '69667','82204','58517','49154','82588',
                          '38504','14945','91785','36524','31562',
                          '42656','28837','60154','67461','57612',
                          '34385','54623','11038','69691','22924',
                          '87275','63842','43288','49494','56817',
                          '26216','13993','97838','52897','27435',
                          '83523','42345','68528','23333','17444',
                          '30611','89539','29254','51619','38432',
                          '69481','51007','20129','82730','20245',
                          '45630','28618','24717','72720','30508',
                          '76357','50106','94548','63436','24432',
                          '39045','28321','77647','62782','18948',
                          '95720','19521','20402','10011','76416',
                          '47699','26187','91313','48187','98641',
                          '29076','72076','78016','86039','83725',
                          '50105','57436','10214','29018','68992',
                          '56738','44242','53863','32804')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
