
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '13257','25483','31735','95667','93367','44893',
                          '13769','25041','32645','59886','15990',
                          '70168','72828','59828','65422','97429',
                          '92609','35325','13062','98918','11527',
                          '53850','52841','49605','95205','49490',
                          '10157','15169','20889','20067','88350',
                          '40245','79188','17328','92748','65748',
                          '18518','40521','20003','27425','24677',
                          '82376','47161','77952','26022','48755',
                          '47290','56798','91261','47329','56121',
                          '28701','53483','47082','24898','51655',
                          '92330','17193','15585','58482','25479',
                          '37989','38402','88382','10843','82011',
                          '71373','75576','51310','39367','80496',
                          '57245','17596','60839','70835','91905',
                          '72783','71160','64509','82692','97837',
                          '73315','90714','64207','38751','96153',
                          '17772','47229','23670','32797','51533',
                          '88419','78823','92533','15390','78515',
                          '92021','18392','24803','58661','49449',
                          '57007','34980','68467','81923','85289',
                          '74287','32713','85781','91583','16021',
                          '77003','68284','36330','13446','35027',
                          '93996','92663','21126','42389','36365',
                          '12775','26299','25330','34384','31525',
                          '27729','26859','27801','51517','73965',
                          '24631','26387','11033','21295','17675',
                          '87821','13225','95140','12874','40465',
                          '88404','90236','43681','58085','77802',
                          '59830','85244','44724','22021','93044',
                          '98231','68006','52691','59711','64704',
                          '42493','74185','54393','61480','16441',
                          '78979','42892','11967','35025','15070',
                          '59777','88398','58261','28331','22847',
                          '39432','67059','39677','77097','21538',
                          '12100','58683','15103','29689','28452',
                          '76090','50938','71158','36645','57249',
                          '12978','77759','20784','93257','54991',
                          '15972','47875','42397','62197','22689',
                          '95099','93348','59312','19124','36015',
                          '31676','17793','53273','87879','38666',
                          '46263','22727','53208','45758','62906',
                          '27924','57186','68399','94905','52801',
                          '35236','53791','98785','96396','24762',
                          '70237','69869','99223','19376','41833',
                          '25983','19933','66848','74601','46376',
                          '12967','35708','21867','63399','21302',
                          '31650','24397','69228','75949','69407',
                          '23115','35663','36152','89858','44007',
                          '41719','21259','34507','80408','62639',
                          '83326','94113','31448','44048','46867',
                          '35012','37067','16142','42752','19413',
                          '71832','40387','47480','10633','46736',
                          '95966','32920','60207','36257','39502',
                          '70490','70772','42055','28138','45035',
                          '16557','12784','73229','74527','75982',
                          '78115','43511','80217','47172','96715',
                          '41571','17047','42713','27986','21245',
                          '51264','72131','62261','21313','31622',
                          '57956','93740','97716','16200','12530',
                          '68925','71762','98630','55375','41832',
                          '67925','98072','51885','21431','35669',
                          '86347','20944','45663','37917','25772',
                          '42032','43157','84605','46538','78595',
                          '21171','87589','52362','15604','40197',
                          '48194','59642','27525','24217','38389',
                          '24218','15674','21815','20024','81913',
                          '67438','88853','52297','58512','20837',
                          '87874','50131','13690','10259','44447',
                          '37361','77009','56731','44468','31102',
                          '60031','52313','27024','38771','94964',
                          '29946','19954','98120','98438','18939',
                          '24663','80473','21842','72616','51248',
                          '57240','10706','71887','13439','17688',
                          '47187','76610','29957','80145','57147',
                          '29625','30156','71626','38226','33472',
                          '32818','74641','49698','43002','90889',
                          '22073','27301','64256','41078','29624',
                          '14415','76563','21187','52929','55744',
                          '48940','62392','60333','14869')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
