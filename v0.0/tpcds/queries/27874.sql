
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '22051','56151','67457','59661','83744','72835',
                          '65892','70409','83185','64612','75172',
                          '87507','48539','78533','33254','37160',
                          '86734','25787','53528','41588','14073',
                          '71495','37679','78750','35057','14960',
                          '53551','16580','15982','33224','41379',
                          '34820','14830','89225','21802','62964',
                          '13164','88491','10653','34551','80067',
                          '62754','67910','23139','49350','43848',
                          '99111','68482','32672','64006','51581',
                          '82117','48461','20615','42658','75599',
                          '18138','52518','83104','59642','16187',
                          '20470','23563','28371','41945','14653',
                          '91257','60387','42783','21293','68034',
                          '54986','86700','51778','27566','52816',
                          '72149','31113','32890','34776','52647',
                          '16405','44231','21242','15904','67715',
                          '98534','73309','13323','13241','47619',
                          '50940','17076','61997','14890','33123',
                          '37324','54330','27343','54063','33023',
                          '28348','12225','58741','60898','49000',
                          '74616','56971','14442','44404','16993',
                          '21649','74783','74134','68002','19878',
                          '71027','41373','13332','22261','36234',
                          '83350','24731','72459','87252','27086',
                          '12390','37933','26548','65384','35951',
                          '33657','49047','39396','33076','19776',
                          '43286','32524','38103','56276','29759',
                          '63972','67048','20975','37108','32007',
                          '43352','11404','10729','47281','58483',
                          '94238','50637','10565','14905','62241',
                          '47421','89941','49720','49395','44401',
                          '90841','67261','32132','21129','23305',
                          '81396','29093','17632','27474','25045',
                          '16505','24861','39850','42138','54581',
                          '85236','74128','24690','27863','37610',
                          '46687','87318','32718','31756','48730',
                          '44932','43833','26137','54522','26622',
                          '45922','90807','35881','37154','19486',
                          '35425','38958','46883','51261','97560',
                          '20087','80581','80574','86903','58727',
                          '30984','73512','44049','27205','45051',
                          '84288','69064','27001','76850','60734',
                          '28059','80318','49264','83933','29455',
                          '46200','43471','20004','24876','18399',
                          '90695','10523','92613','90998','22352',
                          '22476','43760','72367','68674','15129',
                          '92986','53139','74094','77735','12799',
                          '10686','42532','14885','66149','42153',
                          '73876','66191','78183','13110','99575',
                          '84895','38088','28087','62074','25105',
                          '45258','72338','10965','96753','43999',
                          '94462','53386','27134','66140','62361',
                          '44506','55293','67491','57822','48655',
                          '89296','50843','40189','29829','24809',
                          '21788','11866','11230','61110','32840',
                          '33296','86924','75380','93006','40531',
                          '25006','35914','55087','60161','53495',
                          '26468','35286','48621','20852','67313',
                          '65782','74207','68888','60579','38068',
                          '34429','47167','94542','17520','87127',
                          '52967','65016','26768','18025','53635',
                          '45472','95853','25408','93272','68073',
                          '88232','38485','51622','37642','44915',
                          '61691','55640','55255','77207','96474',
                          '68956','94131','11122','51942','26326',
                          '47095','18413','87440','86626','26254',
                          '53976','35347','13583','22251','22847',
                          '16807','24130','14380','15122','56947',
                          '40622','80253','95655','40995','81525',
                          '24886','79059','44337','85936','45272',
                          '26641','25730','16463','22498','71453',
                          '24007','63248','73484','39953','44236',
                          '54795','47319','72970','42237','62122',
                          '24784','48062','35747','59208','86895',
                          '35569','57947','45734','13930','64147',
                          '55827','36098','63045','45157','20660',
                          '42480','17771','14497','15038','23291',
                          '61843','14973','37608','51083','67285',
                          '89929','33470','81787','60697')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
