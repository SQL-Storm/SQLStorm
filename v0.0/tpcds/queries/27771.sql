
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '77420','96427','25595','70149','70984','20412',
                          '60559','39300','49933','28103','90735',
                          '20394','34699','94545','48119','16476',
                          '65510','64116','90836','18992','93896',
                          '40068','77679','13224','61525','81933',
                          '25912','43404','52704','49595','24283',
                          '47227','56650','11458','84446','21759',
                          '92619','82662','48937','42129','57173',
                          '90542','57573','10410','63790','81857',
                          '89935','92816','31286','81807','78844',
                          '57482','42427','31005','79358','60635',
                          '18715','67075','53465','23639','27407',
                          '96784','39984','19266','25849','18464',
                          '13874','29798','33647','23548','72210',
                          '14787','25817','58866','79471','11723',
                          '71610','19099','85478','49686','56599',
                          '84822','83500','87603','81935','47382',
                          '31416','36251','27052','43216','23655',
                          '45166','10722','49644','32460','98670',
                          '77099','99604','61920','71771','44862',
                          '50180','66966','26308','88474','66739',
                          '68470','37698','51392','73928','71745',
                          '12497','64399','13697','27706','81481',
                          '33225','16954','31336','89975','25788',
                          '18837','61224','19260','83514','21824',
                          '29718','43427','42824','50961','40966',
                          '66539','60364','25355','73706','88962',
                          '54804','22551','11341','69784','32151',
                          '11098','48269','63863','10311','23429',
                          '48515','49238','50649','99963','71252',
                          '12450','19225','37475','38145','49730',
                          '13041','55788','31100','54306','99430',
                          '21131','11808','27229','24549','31403',
                          '88626','13474','83358','51838','19439',
                          '15829','58336','99246','62055','83562',
                          '27102','72043','18448','82697','76163',
                          '19971','60399','67629','37107','67642',
                          '97555','44524','59653','30269','88545',
                          '14644','60912','88405','46773','62037',
                          '80385','83028','69561','13110','93863',
                          '39104','98432','47998','25407','42226',
                          '42720','46697','92699','10255','77417',
                          '85442','38619','17126','93564','65916',
                          '61587','92374','23707','41531','45542',
                          '69336','71476','75795','54953','12081',
                          '13674','65449','35751','18422','14834',
                          '13456','13347','13437','35759','16171',
                          '53905','16537','15518','83711','26405',
                          '88299','49133','72524','14157','41155',
                          '76171','23351','41728','19152','36602',
                          '17597','40755','23157','97919','39510',
                          '94502','62567','46953','20828','65642',
                          '77528','93770','83877','46813','42367',
                          '42643','85105','24368','14647','77870',
                          '25227','94834','52004','76266','13421',
                          '14340','88481','53679','79243','84853',
                          '75756','83198','10424','18147','49983',
                          '87635','10482','30827','14804','50106',
                          '18105','82374','41169','43368','14590',
                          '68717','55902','32501','49313','11768',
                          '56558','30306','97190','42222','66825',
                          '31673','33104','38757','12856','97784',
                          '96267','11355','59577','11321','45040',
                          '58224','91061','54447','68578','70909',
                          '10383','12607','93236','70656','80863',
                          '41316','33801','13005','61127','66491',
                          '73520','38706','80574','83179','67703',
                          '25417','28543','25049','23924','58635',
                          '13790','28614','45261','54233','92503',
                          '37464','74727','31046','37636','51950',
                          '36319','42384','15227','15394','82003',
                          '86216','68390','24147','88463','88605',
                          '84304','17959','95782','95503','47846',
                          '90400','34305','95473','32507','80245',
                          '39971','41178','96679','20459','93466',
                          '62230','55803','46814','62000','62969',
                          '89555','46845','50005','14505','79610',
                          '57547','98469','49867','18483','64020',
                          '91293','78842','18482','22936','17280',
                          '70669','93106','50670','83507')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
