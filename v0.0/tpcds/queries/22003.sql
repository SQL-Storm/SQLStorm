
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15975','13237','72657','43895','23673','81927',
                          '80178','79321','24687','42600','11103',
                          '63133','72178','30308','46315','52035',
                          '49320','20887','34118','15221','40769',
                          '11720','53195','78152','62030','98987',
                          '11393','43083','87607','31990','33611',
                          '53730','47610','33442','74216','43622',
                          '82252','23053','58055','44870','45857',
                          '80550','13344','24591','43371','24002',
                          '39662','36647','23872','32348','32978',
                          '34329','32712','97229','49721','66244',
                          '59578','23520','43534','38118','28179',
                          '79082','14129','28011','11525','27641',
                          '66911','33270','39025','98058','17478',
                          '63927','48517','21748','37275','53720',
                          '58540','10472','48095','83455','66301',
                          '65233','44530','24515','91922','51065',
                          '74048','82885','20720','42326','37257',
                          '34164','26596','80692','62832','44533',
                          '31374','77920','68420','18640','40277',
                          '80188','77151','42078','32882','98890',
                          '36649','83536','45284','34770','86166',
                          '29048','74330','91621','26709','77810',
                          '89616','13782','25362','99886','71140',
                          '30097','37225','14281','62900','27542',
                          '49430','14456','69177','66023','25515',
                          '11791','36099','87143','97753','81730',
                          '43109','52578','61610','61761','15045',
                          '88332','25241','24676','41238','35580',
                          '25312','12645','75863','61163','51263',
                          '78087','60965','82757','79294','47928',
                          '35970','62391','46520','74222','74359',
                          '77300','36194','35778','31546','25005',
                          '26053','46890','51167','33706','66707',
                          '27146','59397','65856','32922','74996',
                          '88576','10930','48917','35327','35517',
                          '17158','64710','76457','67752','78479',
                          '57385','63979','15706','56774','34202',
                          '79196','68086','98555','81703','10212',
                          '48015','57785','78790','82403','85130',
                          '79209','30733','43831','49790','69812',
                          '18990','22856','96707','46444','46117',
                          '70598','93545','43016','15001','23831',
                          '20042','93077','86127','55527','80431',
                          '16349','83260','17439','16887','12177',
                          '41024','27947','96711','74095','83555',
                          '94556','32234','42109','40276','21638',
                          '83002','37701','99313','50857','16215',
                          '46090','47303','62933','72273','11359',
                          '33644','77873','73520','28310','48558',
                          '94898','12105','13015','47943','23487',
                          '60433','80535','63181','28318','21402',
                          '60244','71718','92681','63625','34036',
                          '69563','67873','56020','34554','48911',
                          '18617','45341','12869','24679','54306',
                          '63094','23563','66012','25198','94285',
                          '93144','25841','33689','91672','12549',
                          '48420','20965','38636','49949','75782',
                          '35127','86341','85904','91408','56286',
                          '35530','12562','19931','59096','89436',
                          '31923','20670','77090','50706','30051',
                          '22879','89534','34889','38569','85787',
                          '76897','25415','92038','93108','72561',
                          '99191','26861','33551','27464','21370',
                          '77985','81455','27260','24860','35357',
                          '48184','95649','11432','23774','74642',
                          '89692','25997','97747','80207','92227',
                          '34065','69181','59609','26960','41325',
                          '93830','35130','65838','43364','13315',
                          '52137','17005','99387','45923','40904',
                          '74070','18217','15422','12502','13817',
                          '67403','46877','62320','17127','39000',
                          '55726','30746','41057','18005','32150',
                          '65073','62228','98820','87619','28357',
                          '76242','88205','34522','62256','16703',
                          '33066','29804','79614','68132','22738',
                          '80654','62438','12391','17615','44101',
                          '29662','99673','18822','91172','21318',
                          '39902','85220','68343','33395','60128',
                          '12062','44340','79898','36535')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
