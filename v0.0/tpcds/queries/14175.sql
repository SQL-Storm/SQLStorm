
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '83189','66398','34887','12908','55600','18688',
                          '83676','32544','46246','30924','89837',
                          '33360','71342','74210','19060','96134',
                          '23063','40150','70311','45772','40763',
                          '69841','34639','11772','46228','23778',
                          '67582','79356','93107','76647','66509',
                          '55940','72799','15702','67861','94151',
                          '24904','38880','75911','41647','40269',
                          '60084','13445','97960','35399','38281',
                          '82611','95728','27086','74786','16058',
                          '52913','92669','64054','65701','81972',
                          '17408','87426','16182','26209','43365',
                          '59788','48348','97207','60404','92243',
                          '22304','37247','20099','66130','44909',
                          '34448','28525','43584','46739','39376',
                          '71176','32419','53261','28103','15854',
                          '76966','52671','32676','43821','24463',
                          '10557','89300','19450','72854','17088',
                          '27386','83888','13501','22996','18756',
                          '97872','39944','52514','42280','19724',
                          '75870','31601','82994','46980','67787',
                          '98275','35421','98648','52371','47727',
                          '74404','94675','59978','34061','16168',
                          '55424','88850','41145','43449','95175',
                          '10938','96464','11053','95619','47724',
                          '75513','80541','32174','12448','65052',
                          '75554','12482','96578','51409','34102',
                          '88578','33594','93252','80133','85449',
                          '69614','56142','67023','17002','72320',
                          '45174','94407','51111','63794','99633',
                          '89247','29075','81015','17328','60366',
                          '70336','17875','73058','11996','45823',
                          '36544','31701','83750','87348','86317',
                          '16698','17337','46624','29305','55514',
                          '97561','12778','12321','59924','94223',
                          '29326','28699','25974','46192','81504',
                          '69685','96668','22874','29460','23909',
                          '19543','34033','77352','30485','58465',
                          '35538','18677','34486','53572','32184',
                          '34312','63384','23833','47868','25827',
                          '38570','92431','25221','12933','56115',
                          '81502','40007','11521','48272','81611',
                          '92567','32658','11525','91967','32335',
                          '72226','53613','32299','38619','59820',
                          '24046','73082','54747','10287','59417',
                          '26716','47525','15687','21458','16866',
                          '38865','75842','37119','76625','37363',
                          '85007','52939','68703','47846','80427',
                          '94537','87538','30897','21191','43668',
                          '27694','60403','15622','81567','86750',
                          '44914','73000','18250','40187','29464',
                          '58949','25103','68232','35204','22457',
                          '57056','83227','23481','30086','31210',
                          '16167','34446','19020','44705','21727',
                          '49866','23131','16343','10166','92598',
                          '58555','54907','68867','80112','77741',
                          '72968','48912','44454','66672','92800',
                          '51699','13235','45916','31020','29952',
                          '54618','71565','84105','47042','96370',
                          '38833','51085','90342','89665','21377',
                          '42593','44473','75285','90534','66362',
                          '23286','65608','49145','22605','70209',
                          '92609','10060','95421','27741','39171',
                          '43568','18927','20010','26885','52184',
                          '12204','20949','10532','75344','29916',
                          '19253','38989','48778','35686','79020',
                          '89078','45033','45961','21776','81799',
                          '99448','21029','10908','89577','65746',
                          '72622','47679','82888','11294','39751',
                          '74302','58942','70522','37965','81063',
                          '33016','86637','74705','89211','49628',
                          '90336','17368','13698','59271','79228',
                          '24387','79383','91115','23038','58865',
                          '60811','54703','17522','52379','36821',
                          '12484','92830','28848','66805','24022',
                          '31319','14283','19987','31014','59766',
                          '67051','90211','76151','80147','38426',
                          '19984','40352','58824','28281','28821',
                          '16562','24291','47034','21938','92970',
                          '91762','13623','73144','57966')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
