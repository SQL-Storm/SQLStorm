
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '23246','11547','92815','86839','27214','58518',
                          '92337','93268','50001','76879','64767',
                          '49057','56181','41939','48080','35254',
                          '37451','70535','42988','72911','71129',
                          '33247','50493','27979','73502','21516',
                          '85275','37199','67956','87009','51700',
                          '75461','22087','65799','33318','22161',
                          '66823','58717','73854','67768','19290',
                          '68914','37174','62429','49323','29918',
                          '80334','48682','30212','27036','32240',
                          '23408','42709','89479','46666','15844',
                          '17021','95823','63375','34842','59072',
                          '50071','57136','39328','18390','85221',
                          '46609','58045','18051','34971','48551',
                          '34538','51556','39185','87305','50996',
                          '98235','12216','92425','96675','13359',
                          '76714','37430','56596','41745','14252',
                          '61794','90135','71298','59116','30986',
                          '10359','94517','98394','71021','26262',
                          '54309','85517','11552','57125','82625',
                          '10528','13043','74577','21680','37891',
                          '54052','13649','47209','24694','35361',
                          '38308','77824','59399','69835','91114',
                          '65847','35863','29430','36783','48557',
                          '47755','80940','46575','54707','46104',
                          '93115','26343','31059','73277','43711',
                          '27906','47807','45707','11185','48942',
                          '11771','37456','57753','11980','16382',
                          '49040','82577','13008','68076','28909',
                          '74513','64925','94305','59794','38749',
                          '96823','56007','90918','45658','14689',
                          '54313','26079','91075','25447','52841',
                          '27031','89436','89223','51213','52095',
                          '80063','26457','74852','43325','64934',
                          '65130','39950','51431','32310','87059',
                          '45115','16139','37010','32914','56889',
                          '32587','62408','85751','56587','23857',
                          '86006','84017','35029','80059','90737',
                          '64869','31417','68466','37612','24075',
                          '26238','14205','49565','63703','70036',
                          '86363','79810','99379','95193','34999',
                          '51218','59544','13950','86381','25916',
                          '35819','92763','28638','75812','24683',
                          '88741','19448','61670','11628','41288',
                          '80517','45566','52382','41297','80393',
                          '55500','50625','89125','23518','34178',
                          '30141','53923','61598','66749','68818',
                          '57595','74888','89186','62668','70197',
                          '29324','46759','46584','77366','29782',
                          '35439','45200','85143','29936','28301',
                          '38027','13937','70107','91875','29193',
                          '93106','30354','85844','51993','80835',
                          '46216','83697','32282','55044','95687',
                          '58234','29914','22172','27412','27820',
                          '67293','92572','31682','85272','15260',
                          '89650','14343','30250','17969','11549',
                          '31386','14055','32114','78919','66391',
                          '32767','50669','50256','32335','44992',
                          '50396','62476','20748','21635','41529',
                          '24786','43870','58616','20741','19634',
                          '97023','27471','34787','38346','72569',
                          '78772','98232','40340','74474','75081',
                          '92444','41786','45936','26742','90528',
                          '52645','52891','49267','70844','17022',
                          '88280','79206','44295','35636','56118',
                          '37383','81643','59032','25925','15463',
                          '81218','27890','19182','19128','57352',
                          '32525','76973','39360','14961','97368',
                          '95552','40935','33042','80776','86650',
                          '73518','99381','78820','43278','91225',
                          '83505','22835','77885','26516','80788',
                          '84413','26747','35924','47253','91490',
                          '33929','83521','45798','82101','82529',
                          '19061','87396','73534','74833','12583',
                          '86796','76106','42898','66618','48063',
                          '37508','24765','62716','24023','92462',
                          '45305','41068','74319','32262','18749',
                          '85439','30372','27856','42324','49779',
                          '11403','91365','62282','25285','10856',
                          '94285','55519','82336','10153')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
