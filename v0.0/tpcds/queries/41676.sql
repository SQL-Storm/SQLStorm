
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '39997','23481','12302','10223','17798','22659',
                          '97189','64809','53964','44824','14704',
                          '46342','50866','46817','57593','71701',
                          '49807','52856','69883','11791','49020',
                          '28245','60742','63306','67378','72899',
                          '37412','59903','25439','36342','31424',
                          '28569','48389','26263','12310','86149',
                          '27367','82010','28819','96434','27959',
                          '37636','14588','98144','72973','84551',
                          '51686','58090','59635','50386','39010',
                          '37743','53270','34387','73546','16898',
                          '10651','48937','73661','51284','10364',
                          '33754','24105','65309','20529','12421',
                          '76370','52820','90470','50252','62435',
                          '13657','24053','79392','38408','57611',
                          '38976','62392','14815','62527','10613',
                          '80409','48890','36404','97498','80952',
                          '38112','83730','75292','50695','77273',
                          '32891','15711','50035','22773','19198',
                          '47704','12582','73418','37958','29108',
                          '14919','69246','25214','66478','25154',
                          '10881','24554','77616','64068','66601',
                          '68679','22722','77422','77129','18899',
                          '42133','42921','16581','29541','31541',
                          '93508','90012','42410','26869','83570',
                          '92547','65875','76859','13056','79477',
                          '13822','40079','55359','35651','83245',
                          '95874','19207','71442','39413','53335',
                          '10429','32396','64114','61301','22170',
                          '39421','45284','14411','54944','35118',
                          '52591','67107','51212','19553','87478',
                          '98262','49213','89826','21010','39398',
                          '54086','98214','35843','42384','25268',
                          '88361','69805','35539','43429','80224',
                          '35134','37624','22329','46274','34916',
                          '83405','41807','46102','74045','82796',
                          '69956','15467','93356','97600','54639',
                          '59395','79157','26523','30961','50125',
                          '78449','73883','16188','65159','64658',
                          '25425','38208','56177','38400','19267',
                          '80177','98685','43122','31233','20150',
                          '24727','34984','41470','16735','72478',
                          '87414','96853','48269','29431','41439',
                          '20638','93278','40001','54160','13733',
                          '12180','65950','96325','14935','21837',
                          '15658','43154','37391','29893','85224',
                          '42809','21774','43094','24864','68603',
                          '67642','19215','47886','67229','22925',
                          '78395','37927','77380','18170','55113',
                          '21719','75026','66941','20422','91726',
                          '11267','25706','21726','14560','79800',
                          '10354','20011','13303','97427','33984',
                          '26990','29069','54489','29536','85754',
                          '54695','35227','52954','16970','46828',
                          '18891','95427','54786','21650','73280',
                          '22987','43467','56152','96279','16201',
                          '44008','53676','18282','19410','31327',
                          '84684','43638','47593','14248','46255',
                          '41294','86590','83560','45457','99442',
                          '51411','37029','12444','40048','94731',
                          '15417','76484','35366','28942','61646',
                          '97143','51730','24112','10376','38122',
                          '12637','58187','13772','42098','85803',
                          '37232','61923','38619','11043','11363',
                          '81126','63808','40393','77986','24874',
                          '35169','97054','65860','48907','64509',
                          '55129','41708','84583','68532','95176',
                          '46010','37841','43521','49256','39229',
                          '58952','45978','53115','11619','95271',
                          '23889','41525','13347','49302','76101',
                          '16257','86289','82076','80184','39661',
                          '20831','47112','26079','13974','44719',
                          '59844','38960','90496','45557','12220',
                          '60800','18909','68782','52544','84886',
                          '57072','62214','34849','32041','34337',
                          '16355','16825','68777','73244','47475',
                          '94681','54114','88531','68696','17700',
                          '42673','10883','57778','54273','16790',
                          '68375','53998','24518','53636','17221',
                          '18777','26814','65330','25289')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
