
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '47220','35387','71426','34810','78545','56196',
                          '74741','98925','45015','96270','62808',
                          '24123','15502','34891','93133','33173',
                          '85791','38473','36434','68460','66922',
                          '67515','93773','76258','60789','80496',
                          '59364','38813','36735','16637','11047',
                          '11668','68397','53679','64224','21406',
                          '48494','64722','83759','44800','24146',
                          '14376','83314','69038','63120','13554',
                          '73137','11941','15005','99196','40856',
                          '73744','15729','87064','80799','12390',
                          '11006','92873','31259','31417','10353',
                          '94630','40019','29671','21326','19698',
                          '60818','27257','32368','94396','14753',
                          '94389','99638','63116','66998','60925',
                          '74462','39248','61491','25231','16336',
                          '47892','39217','68253','10655','42403',
                          '14015','16117','86300','37216','22278',
                          '58782','61740','70792','65381','55216',
                          '22370','24282','65932','52504','15811',
                          '41151','36392','93283','75141','49155',
                          '40162','30923','52639','84556','67283',
                          '81804','31302','42097','29215','76051',
                          '68870','60869','68102','13938','34266',
                          '68327','18780','74101','69552','54426',
                          '28689','49323','24587','71642','60114',
                          '45417','74558','63994','13122','10139',
                          '70182','62119','37956','82109','57357',
                          '44893','13794','18097','90428','55809',
                          '36618','16118','70575','99107','93797',
                          '72598','58504','79036','98338','62763',
                          '12737','28916','90152','57950','98043',
                          '91353','73133','74525','69469','79151',
                          '28020','77326','95236','99473','21765',
                          '47585','12095','89707','16372','29615',
                          '97218','27469','19854','26221','38964',
                          '20022','29295','55234','83973','91342',
                          '67851','36785','41721','17916','34506',
                          '50425','35595','15531','63627','43564',
                          '46180','27197','30173','95838','62593',
                          '78984','35716','44337','54298','99903',
                          '28081','66435','97090','79311','44086',
                          '90443','36835','33653','72276','58645',
                          '13871','49496','61069','45514','90981',
                          '10565','52837','72122','68695','40596',
                          '78447','11752','75548','20348','51696',
                          '31713','20280','11159','74443','49088',
                          '85327','50803','85529','84852','62511',
                          '47970','79659','23849','56514','92151',
                          '74237','37699','66386','79021','17278',
                          '91131','92838','35972','68392','73225',
                          '22364','21034','13811','69149','91560',
                          '13973','98938','28747','30010','56740',
                          '42402','41795','98313','59630','61989',
                          '24723','17295','53633','87630','62002',
                          '25977','14654','61692','77432','36544',
                          '98591','32685','28077','41876','27151',
                          '27833','94257','53248','74514','77762',
                          '47202','30019','61383','95038','35732',
                          '59050','37952','99882','41134','61980',
                          '39740','27582','37812','84488','78386',
                          '93654','26149','62966','88191','35479',
                          '11672','41003','40370','79336','99296',
                          '18734','73358','79601','77596','36918',
                          '87028','69874','12070','60397','39559',
                          '49513','89951','71910','52484','16287',
                          '15980','36746','37477','25907','99605',
                          '52799','87742','78798','39275','61215',
                          '79653','29132','87039','52394','77508',
                          '66793','83402','22273','75594','39236',
                          '37909','96360','10677','24938','19236',
                          '13429','52691','90637','99634','15336',
                          '68662','61954','62493','49610','13433',
                          '34980','92808','42349','43706','26521',
                          '66223','71611','57717','78398','84397',
                          '57764','82737','37944','14117','31963',
                          '92092','81908','42295','82816','11470',
                          '74692','80882','86422','63649','70136',
                          '53305','67459','85312','72223','29133',
                          '49417','49058','53235','14733')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
