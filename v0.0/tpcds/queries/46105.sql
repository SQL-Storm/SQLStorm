
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '14052','12152','28596','62006','49581','76478',
                          '10719','87622','46290','53050','97635',
                          '17562','37040','71168','30638','26945',
                          '38648','42261','51945','23660','42299',
                          '10015','12811','27752','53725','56798',
                          '57592','42556','57226','45148','19024',
                          '21353','36735','14612','43193','78992',
                          '21769','48188','10023','98306','15884',
                          '42836','13698','38911','67929','74486',
                          '84817','65684','32739','77688','30002',
                          '16791','26644','51788','87487','45076',
                          '18572','82973','90433','17890','14295',
                          '39267','16270','23815','23934','19492',
                          '10366','71170','56977','88433','47976',
                          '52790','91958','94594','28205','83228',
                          '11987','45492','46100','57604','25563',
                          '12125','20449','27255','85555','47866',
                          '80044','20749','64161','73780','67090',
                          '15094','48899','35145','83334','33620',
                          '27734','71059','63683','11699','26788',
                          '51547','30532','19274','76727','65673',
                          '19981','49446','69582','12561','18750',
                          '58719','91261','39295','24109','38395',
                          '92520','29232','83433','50708','14368',
                          '73135','91158','96917','98794','79437',
                          '89892','65152','25439','25505','71368',
                          '64275','72669','58195','91317','67857',
                          '31094','46361','73605','12425','47481',
                          '94685','79727','40393','74123','33411',
                          '84375','65784','48856','79300','90121',
                          '36934','42949','30033','51722','49568',
                          '91029','25854','28892','59762','28839',
                          '11212','69536','53557','95595','70265',
                          '20648','42667','16535','39690','73209',
                          '57144','28153','48205','28830','84568',
                          '48924','45848','98782','34495','75963',
                          '91636','88163','47628','71415','11655',
                          '18584','24968','26800','38791','15527',
                          '31028','43770','83687','74031','49705',
                          '96010','33673','15624','41527','49171',
                          '55514','49656','42171','94043','46886',
                          '27216','10221','57344','72999','25302',
                          '74319','27171','29588','13289','40001',
                          '32154','56413','70750','57354','69297',
                          '71738','12399','55129','63039','41698',
                          '87453','25154','88997','79205','16914',
                          '28265','60863','25272','41306','16506',
                          '68986','91768','16087','16134','15845',
                          '44410','94929','25084','22687','37819',
                          '51006','76858','76959','24284','13838',
                          '33133','28380','64421','92678','80251',
                          '88140','77399','14789','78589','44031',
                          '90038','40277','88753','80917','53279',
                          '56334','69172','37242','78706','90901',
                          '97495','14595','19894','26418','71426',
                          '27416','80222','45192','37659','18192',
                          '46816','92315','19603','15317','37341',
                          '15672','11329','13226','95194','35494',
                          '99264','68969','77332','40631','48457',
                          '32774','11629','23773','97583','37712',
                          '61845','65323','16555','89176','79722',
                          '96756','52358','46785','44272','51193',
                          '52679','27758','49808','25894','63206',
                          '96915','93905','12257','81619','29714',
                          '53001','16062','91305','87310','61628',
                          '84000','36194','73664','49439','45818',
                          '12091','54482','12939','91319','51775',
                          '81635','50342','58054','17025','70795',
                          '69587','16616','18539','81196','26043',
                          '97125','12676','19059','47995','57119',
                          '50316','48729','60543','47131','57084',
                          '33145','29911','63934','12707','59547',
                          '60383','78986','25672','25471','50320',
                          '44000','47999','61393','54860','15348',
                          '75239','61336','23813','87283','72226',
                          '94261','34919','42892','17977','37917',
                          '35299','45063','48982','56792','15070',
                          '39432','38684','52949','16787','62558',
                          '84564','13158','53719','88550','63653',
                          '35854','65953','39560','17344')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
