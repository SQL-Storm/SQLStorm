
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '41136','73044','75128','64321','70471','83341',
                          '45252','57846','91171','53781','70339',
                          '51036','46382','28971','89253','97026',
                          '38299','82240','91710','82587','64958',
                          '88382','42096','48284','85178','63577',
                          '64509','41243','55759','47229','51533',
                          '18230','56720','43684','93321','32623',
                          '17144','79742','19824','30173','24428',
                          '20169','49442','85021','16972','83850',
                          '26091','51937','30089','80326','88186',
                          '71999','42493','53502','42892','15070',
                          '94745','13990','96819','81018','10925',
                          '29268','42543','19980','51592','89769',
                          '59312','64334','96536','47763','89264',
                          '80122','70415','47800','30279','93067',
                          '58083','56152','63399','20097','37162',
                          '22254','82402','42921','12338','12267',
                          '16142','86184','82958','35815','78812',
                          '31905','11020','95394','69644','97751',
                          '58307','65425','92090','83380','50047',
                          '83552','47361','21431','20944','95097',
                          '59225','96197','75670','69758','95145',
                          '18617','47657','52818','42674','67537',
                          '48613','21102','95263','76679','77506',
                          '86852','15118','17595','48957','22058',
                          '82977','33017','82975','13396','63155',
                          '36054','39825','38613','31752','18869',
                          '10242','73453','49702','89960','31009',
                          '40778','56232','27070','63957','43324',
                          '84004','40037','48647','63963','30796',
                          '82425','59126','24231','56329','78124',
                          '44568','58892','28237','64908','20844',
                          '16151','10867','32618','23866','45226',
                          '70259','82160','10607','63385','34492',
                          '75576','23872','15318','22351','74068',
                          '56141','48248','24797','24975','41688',
                          '29147','81404','33505','86606','80387',
                          '54618','87526','46193','45940','21414',
                          '11450','50508','34579','25282','22037',
                          '81871','66441','77403','91740','74437',
                          '87216','35278','42558','28353','49875',
                          '78212','53413','24176','11622','50460',
                          '71740','68361','10984','29632','18879',
                          '50527','52480','69697','82257','50897',
                          '29595','11776','58444','73079','78494',
                          '50560','80406','58950','48339','11627',
                          '97783','27383','65031','14160','57821',
                          '12982','14676','23574','81583','89694',
                          '81423','21226','61383','67042','47101',
                          '95448','41636','59314','42694','20960',
                          '72184','72612','17948','83472','50281',
                          '48338','31404','44311','44606','85346',
                          '56376','36198','41648','66115','20577',
                          '65405','39159','44386','68075','48315',
                          '17887','24851','66227','28223','23966',
                          '57341','68811','31077','29392','59877',
                          '16304','81171','30185','27697','49620',
                          '51313','84756','63520','45163','32760',
                          '46652','60711','93611','11654','10556',
                          '56531','48519','21273','83797','12869',
                          '55407','60588','96233','85238','61589',
                          '12867','96603','17048','49838','65499',
                          '10096','49294','61857','32305','94853',
                          '94135','21053','11855','79980','93016',
                          '27926','47936','24147','13580','45831',
                          '44048','11015','14539','35573','30461',
                          '99324','50389','36124','96150','43974',
                          '71663','38724','42390','21936','15338',
                          '93841','44497','11154','33572','26506',
                          '78371','24539','19499','74269','27523',
                          '75663','53750','64112','77082','98322',
                          '93096','42368','53009','94307','30234',
                          '65542','92461','15890','70711','61495',
                          '30936','58293','48434','32491','31084',
                          '56877','50573','94579','85327','11328',
                          '66205','89414','65729','28625','13339',
                          '86547','89430','26969','60003','64846',
                          '19828','18454','91928','35429','37046',
                          '16006','54415','85406','67049','14560',
                          '40075','62544','25055','48461')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
