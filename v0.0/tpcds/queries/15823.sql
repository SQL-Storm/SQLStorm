
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '79052','63380','35888','26488','34869','43832',
                          '51770','45530','38075','33566','37405',
                          '78079','48967','29345','31908','25345',
                          '19696','21245','16651','54605','55625',
                          '25848','70979','17523','69189','34863',
                          '47480','24215','94011','44651','39984',
                          '21530','31649','77513','23243','97950',
                          '46716','46125','53688','19558','15135',
                          '14054','32557','80121','69825','37368',
                          '34634','11954','71248','49781','85369',
                          '40637','94964','69032','14486','80565',
                          '46200','72984','13752','98061','22548',
                          '49320','82303','12125','81957','75248',
                          '12246','53937','59535','81584','83463',
                          '31329','81420','93146','61594','30144',
                          '73816','34642','13774','34985','21291',
                          '17305','90049','94561','65355','26816',
                          '37713','68721','52300','80681','35879',
                          '77862','79182','59108','54532','63489',
                          '66005','40151','75237','52052','15589',
                          '48637','75401','88925','11293','43961',
                          '89052','12115','67463','16938','85968',
                          '14840','73326','63133','28886','68095',
                          '75161','25130','88137','45614','74957',
                          '52218','86770','33859','30222','18013',
                          '26945','86295','47124','30551','62629',
                          '22626','41217','19066','52082','93489',
                          '99590','39245','11678','43235','57859',
                          '30720','74695','35422','78425','56475',
                          '57306','48161','72921','20457','17078',
                          '87990','40469','33389','32572','76047',
                          '45397','43091','48507','75593','24517',
                          '58555','52263','48573','82474','11513',
                          '50041','15638','39975','93538','38981',
                          '17748','64775','85849','40314','95148',
                          '67421','27080','66790','38867','89962',
                          '58688','42116','10282','19587','57038',
                          '28747','39939','23476','46088','62686',
                          '83081','10583','25017','59631','30401',
                          '85135','55561','15019','69139','20739',
                          '10624','56306','20591','33952','19550',
                          '14926','35645','28095','69589','20108',
                          '16179','67252','13359','25693','56035',
                          '45797','92297','34493','25683','35947',
                          '51491','75976','71899','48174','81305',
                          '60204','63538','97972','29082','70603',
                          '53641','35630','61101','25370','65079',
                          '20052','58313','38678','65000','67201',
                          '10914','12409','16882','20599','58477',
                          '63551','29681','38463','31185','65142',
                          '23895','74652','18800','94040','49151',
                          '60664','23017','73633','64232','25359',
                          '18885','49318','93322','82621','30918',
                          '47419','86242','34637','32411','59647',
                          '39316','41548','33248','76424','45443',
                          '75332','52621','59921','30017','22710',
                          '38208','49031','82423','80794','96715',
                          '23526','21743','17101','36382','10680',
                          '14016','49665','33264','59144','89929',
                          '48646','83209','21605','50736','11125',
                          '78955','76781','26242','19859','50247',
                          '42075','16582','71012','43991','11950',
                          '99797','63024','53421','41463','45479',
                          '80658','59167','27241','10815','42098',
                          '19052','17139','91581','38330','29842',
                          '81372','29819','39785','29936','15987',
                          '27038','19547','80963','87818','81438',
                          '17224','69565','53201','58062','70307',
                          '77105','59582','78553','85761','94048',
                          '26878','86902','91375','14887','88900',
                          '39913','52663','39816','70246','65619',
                          '73451','62562','36527','94300','58003',
                          '63219','18930','33897','51418','14584',
                          '49941','81774','18887','54208','96628',
                          '46092','95682','37438','74956','54960',
                          '20072','70680','24411','19228','67853',
                          '65748','63480','41535','31994','60243',
                          '18409','22837','47252','90659','42228',
                          '95305','39102','99343','60946','18329',
                          '27216','65848','62020','12952')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
