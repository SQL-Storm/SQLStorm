
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '50586','28709','17504','48574','63923','21948',
                          '32645','77417','72451','86006','69532',
                          '44529','10533','34184','89060','52356',
                          '61138','79736','12258','28383','24745',
                          '82487','66229','23721','96055','59627',
                          '66933','61557','47444','25550','57219',
                          '60725','10051','34088','18115','80224',
                          '29018','13740','18986','51329','18213',
                          '51397','77676','14376','60603','58390',
                          '35091','10673','85931','18728','79141',
                          '24026','78962','67509','75379','83065',
                          '12815','72783','28518','96377','73625',
                          '30165','76633','86389','90140','96782',
                          '56772','49548','20071','49079','24453',
                          '27091','81609','51637','22256','16208',
                          '37715','76782','81923','11640','61654',
                          '13482','49624','21840','10759','86461',
                          '59241','41062','43865','48704','82767',
                          '33834','84755','36913','49025','24775',
                          '76163','60401','19466','94553','12581',
                          '50579','16958','10099','62845','43967',
                          '59608','27035','12142','87913','25935',
                          '39386','47836','32302','45771','51948',
                          '26693','79327','29715','44126','15597',
                          '77916','38167','17981','90527','74597',
                          '68050','61787','10331','77053','14067',
                          '33421','95040','50101','43056','27690',
                          '15857','35502','41189','13488','18938',
                          '45367','18900','15063','14495','11486',
                          '43096','51337','33451','13516','64074',
                          '95497','55093','44453','23938','74866',
                          '22209','49143','65795','47873','96867',
                          '65662','86000','34957','45962','53754',
                          '58758','51991','65772','73510','44956',
                          '75486','87799','78436','35708','51147',
                          '35240','81498','11139','68469','67251',
                          '11581','19587','89403','89917','90437',
                          '89952','10201','15580','20092','16414',
                          '84936','11480','20237','95230','47134',
                          '86172','96165','47884','60085','31697',
                          '60252','54517','61308','94559','17628',
                          '12131','29551','25912','34560','25490',
                          '21855','34007','98933','73821','69626',
                          '29810','46881','13005','50709','83807',
                          '58164','96356','28741','13322','78875',
                          '70164','50481','28548','35951','33673',
                          '28930','64746','15768','10468','33851',
                          '14595','96568','72263','55384','78595',
                          '68013','93345','41259','26482','16182',
                          '50090','18675','78679','38718','12263',
                          '96037','95171','98827','91620','69790',
                          '61091','35495','90375','22929','40578',
                          '77286','57663','35548','10787','78797',
                          '98563','32450','18923','32173','33715',
                          '82548','68607','46496','71107','41959',
                          '60304','62166','23508','77719','61075',
                          '14151','52790','90879','49817','94360',
                          '54497','94031','74144','13597','74208',
                          '24162','30922','88608','85985','90872',
                          '48166','37895','29199','25749','66670',
                          '76694','41780','23697','42061','21692',
                          '46884','56885','53800','35392','25548',
                          '43950','51059','32395','37608','75180',
                          '71311','12368','78496','98728','14350',
                          '46734','42156','88360','19895','40015',
                          '36874','79188','45909','88391','20082',
                          '83332','61490','31719','22077','84046',
                          '55564','59477','39248','30614','38515',
                          '86141','18431','46424','76435','89075',
                          '53021','85241','78492','93792','41770',
                          '27602','42307','49692','86527','27135',
                          '26218','82933','23122','19177','66976',
                          '85076','14935','28326','90755','51620',
                          '40101','57118','43431','78966','18588',
                          '27307','53664','26767','59877','64699',
                          '69719','87274','80308','37547','70078',
                          '62580','58481','38511','84420','25667',
                          '96544','40031','11728','59209','72863',
                          '40970','18111','56194','35340','15716',
                          '44869','70206','38889','19357')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
