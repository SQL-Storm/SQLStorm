
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '99140','38961','20469','82611','22693','27524',
                          '30152','52004','25412','45653','39559',
                          '13730','88444','98007','34060','39627',
                          '54632','22133','24180','48033','16736',
                          '23430','19742','33436','15593','21150',
                          '86876','31689','12417','91391','80412',
                          '13645','50326','43281','22312','76437',
                          '73039','26055','12353','61480','42174',
                          '31180','53259','27324','25967','69360',
                          '76850','84877','11092','18409','59240',
                          '85002','92191','17680','14126','98771',
                          '33668','18223','24613','14353','70582',
                          '82660','54897','84457','72666','54989',
                          '60996','14694','74376','32813','41573',
                          '61477','53917','10725','36873','68049',
                          '20910','82717','36979','29800','10091',
                          '63766','89751','74298','58748','97181',
                          '80863','69175','62506','43320','67430',
                          '39883','26356','49700','41999','78584',
                          '61786','49366','76163','96220','19593',
                          '50171','69427','67138','65870','57362',
                          '39032','70375','39680','26394','89971',
                          '91558','42100','20083','18700','51201',
                          '54934','26846','12054','33207','36543',
                          '96864','95842','33068','25250','87794',
                          '39041','14506','77682','11380','37775',
                          '13357','64475','62383','13834','54296',
                          '19285','49999','78131','15973','88459',
                          '34169','15971','14360','20612','18298',
                          '77456','11595','71363','99145','17161',
                          '12087','44253','48112','22065','82586',
                          '73498','90657','99083','18070','12162',
                          '54475','29005','12863','73645','68717',
                          '78590','46889','88281','60112','53050',
                          '27939','29273','21762','42947','14489',
                          '17214','23914','83669','12063','41535',
                          '79893','25207','94059','80446','60585',
                          '92819','55293','51022','77055','95088',
                          '82211','68331','55931','58186','52773',
                          '98015','65220','83085','60356','39213',
                          '73854','77390','96395','48914','97148',
                          '34531','17459','10421','72704','26933',
                          '82852','74929','50462','95202','12904',
                          '18826','70420','56722','13978','97931',
                          '50085','18346','72455','12250','91892',
                          '39228','43297','18112','27825','20533',
                          '77406','93691','42587','19213','52459',
                          '66819','39489','20486','36958','65708',
                          '20449','87947','20053','81068','62524',
                          '28602','14887','35875','73608','55272',
                          '48721','22368','11871','66378','21890',
                          '61560','52252','24465','24102','27449',
                          '36956','91087','28611','53448','24267',
                          '94761','55144','58907','43063','92179',
                          '80914','25512','14446','64238','16114',
                          '24271','45100','58807','51230','91389',
                          '20807','38596','20179','13720','86229',
                          '35740','99252','33162','34707','89435',
                          '65496','54032','10677','22349','75775',
                          '52220','13976','20974','93116','13394',
                          '73429','26308','40529','38904','21562',
                          '77668','10700','34210','57941','34295',
                          '61444','92526','93119','55764','86407',
                          '40965','13035','49012','51848','56762',
                          '35586','40461','79691','19436','59880',
                          '13908','32547','60944','62834','12130',
                          '19020','96756','87789','53575','36993',
                          '88858','74492','47724','61122','48340',
                          '10278','62817','71596','49542','95233',
                          '25342','67381','72889','76227','80934',
                          '65856','99423','96676','18425','18139',
                          '69061','74467','70138','12911','94420',
                          '69685','13372','32551','57307','32534',
                          '34363','68561','68180','70826','70792',
                          '17811','34081','26541','74033','39927',
                          '88919','46070','27872','51199','88705',
                          '63521','52703','45544','78312','16111',
                          '89832','39924','96997','59377','17992',
                          '55660','68926','82672','43133','14025',
                          '89659','37075','51483','89199')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
