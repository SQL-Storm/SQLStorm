
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '73571','37413','54143','23951','81696','79839',
                          '82132','33604','58650','48553','61378',
                          '57795','42685','40402','11185','91916',
                          '23108','65540','54623','70876','56229',
                          '11655','70023','53493','50434','37815',
                          '31678','46395','18685','58521','43800',
                          '14178','46902','32498','57238','62536',
                          '54021','46005','64356','57397','14131',
                          '96318','61030','84747','17599','40326',
                          '70845','32431','14094','83326','33874',
                          '51189','38775','28339','20563','27594',
                          '55964','30168','84889','65813','11882',
                          '31021','71345','46408','38297','61516',
                          '90101','62600','16589','83252','17202',
                          '39230','78245','93642','22757','19845',
                          '81362','16667','50944','52200','39627',
                          '52422','61400','57435','46486','13308',
                          '40198','79356','37001','79806','15795',
                          '88774','52702','37981','63880','37684',
                          '37246','64676','68390','48272','30723',
                          '34529','60114','26196','57455','77047',
                          '13867','28054','90532','42486','76000',
                          '78425','69648','65160','25533','94598',
                          '21358','60826','65835','70475','39649',
                          '54701','32229','40056','64902','93113',
                          '74188','68287','64486','38510','68889',
                          '21446','46566','41745','52456','49677',
                          '30451','98931','15335','18732','72365',
                          '35179','37677','72885','73811','58129',
                          '24023','61094','21255','29683','89140',
                          '15569','32197','77558','16020','79517',
                          '54328','51887','66555','29737','86360',
                          '51015','14824','31546','50398','93125',
                          '39335','74741','69049','25555','76177',
                          '18317','22084','21848','83858','51757',
                          '96443','30632','18956','90262','64716',
                          '46032','87742','13492','48159','34822',
                          '21393','40525','53569','50550','76245',
                          '18153','89448','18738','95244','94168',
                          '96389','37048','53780','26456','88534',
                          '73788','13184','60493','15525','21231',
                          '12233','41485','70819','49233','63441',
                          '29376','82388','94382','49740','18518',
                          '64777','20782','55266','85476','94967',
                          '76876','51959','27736','55072','64276',
                          '95859','99168','66699','47821','87781',
                          '88893','16561','50603','19600','91286',
                          '69650','20256','15128','52329','69325',
                          '97405','21420','54818','26810','52026',
                          '66292','32237','76646','64767','31921',
                          '74270','12017','12572','56297','65422',
                          '85137','47169','26559','76327','21484',
                          '54810','55070','29062','73968','68663',
                          '68353','13580','30700','30664','22137',
                          '48601','66170','55622','46623','26514',
                          '42328','56496','50226','38010','26261',
                          '31072','80971','10441','77349','90688',
                          '26436','11486','36297','20879','13737',
                          '20784','46493','47016','93063','59830',
                          '51806','94488','62394','16546','59350',
                          '43842','62401','60601','53971','60545',
                          '90835','44342','12200','26098','10234',
                          '45477','43927','36698','18330','34175',
                          '24593','24746','56852','97985','31971',
                          '78287','34310','81853','23300','75361',
                          '30045','25509','70347','53357','40906',
                          '96499','19584','84758','29820','17740',
                          '39149','24343','10844','72142','70430',
                          '38163','70099','96930','54398','13211',
                          '13603','31312','10095','37710','21237',
                          '36184','92423','44681','11107','15480',
                          '95625','54256','48988','34115','88245',
                          '41524','12332','72540','13601','92935',
                          '31950','86266','98826','28254','32819',
                          '23363','61015','59582','68729','69552',
                          '28984','85935','50284','69888','19055',
                          '15330','79685','13267','14231','19516',
                          '78390','48463','49321','32350','71838',
                          '83856','10920','52677','71548','48230',
                          '91815','86433','21771','11073')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
