
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '96742','95234','47215','79548','42652','32192',
                          '71981','14195','63686','28258','75456',
                          '72775','85441','42234','95903','31896',
                          '82666','63727','73072','53475','36089',
                          '33446','85297','84471','37304','10327',
                          '66121','19207','93438','23554','10737',
                          '20460','33585','64826','29231','71838',
                          '18018','26020','28068','67009','98225',
                          '24283','54762','37730','80051','16512',
                          '86343','75099','24476','22297','97208',
                          '22702','55866','17459','54591','41498',
                          '55177','54250','99063','62212','56089',
                          '21824','15310','20629','95673','61596',
                          '54057','47641','57745','86401','59947',
                          '11977','77906','57831','13583','29265',
                          '73012','43528','44532','50380','93726',
                          '25364','42024','60183','70799','29852',
                          '26609','98907','24242','60952','29122',
                          '37362','22308','56676','19467','32440',
                          '10825','66926','12271','90937','37557',
                          '82646','69755','50492','53526','82213',
                          '54964','23139','14197','97880','63844',
                          '54014','18512','11491','53888','95069',
                          '51331','54273','79314','76314','23654',
                          '94042','55822','10871','32965','49768',
                          '96900','15009','21695','87709','22431',
                          '36193','33699','13607','34051','69590',
                          '11875','98644','76630','40190','84594',
                          '78404','23974','95872','14062','88276',
                          '58363','31860','20419','46575','91362',
                          '29634','38863','68400','66488','62091',
                          '35701','15976','16257','37399','55174',
                          '61584','16120','17562','96421','22037',
                          '40813','11535','88282','54952','81758',
                          '82482','73122','82018','45570','27429',
                          '85890','84476','15303','17641','13705',
                          '16539','51312','45075','49095','71373',
                          '70011','88112','80892','30046','66439',
                          '53805','18060','65610','40555','31554',
                          '85785','97610','26078','25950','98873',
                          '47330','98256','78770','17245','41962',
                          '64359','59253','61038','14614','70969',
                          '73124','34049','99371','24558','74063',
                          '20311','16077','58707','16848','73555',
                          '61333','14431','33241','99244','25564',
                          '96731','19683','35869','77824','25259',
                          '86520','29094','34982','45539','11356',
                          '33991','51209','70589','26465','23052',
                          '64324','61379','47867','14518','43720',
                          '62624','95480','65884','87603','44037',
                          '68328','96322','87208','29632','92714',
                          '41880','36035','50759','51223','95028',
                          '24218','13948','16586','88694','47242',
                          '77976','99260','76583','99745','48586',
                          '88605','75931','17571','83665','77487',
                          '57750','40911','69888','45215','85914',
                          '67969','86572','11322','27725','45243',
                          '46054','74822','38694','33460','94643',
                          '81776','52598','21302','45573','59598',
                          '60640','15268','43134','99880','64926',
                          '64640','99340','33898','15023','80920',
                          '32489','87707','68282','43282','51342',
                          '87363','63219','40987','95754','61009',
                          '20721','48149','32358','74224','44258',
                          '43580','92169','28267','76414','58450',
                          '13352','38629','57150','41106','45723',
                          '60866','61258','42939','26435','48869',
                          '98940','31587','33511','96278','56622',
                          '83708','39187','21235','18888','51343',
                          '69146','67619','99087','92341','81019',
                          '17507','87512','60287','50170','52235',
                          '19089','10591','83897','68318','48401',
                          '22857','39150','46482','70865','80884',
                          '13266','92703','35865','44870','38254',
                          '30001','85076','34759','87196','83203',
                          '25231','60085','46840','70335','62163',
                          '83195','38024','95110','48088','22679',
                          '71530','95005','38150','22051','23353',
                          '91273','45526','13530','83575','49169',
                          '23711','98648','66678','21696')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
