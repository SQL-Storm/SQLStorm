
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '33197','19746','47866','97568','67815','52538',
                          '39392','69185','90027','55963','33115',
                          '59093','61724','78106','61897','90607',
                          '61118','48874','64588','83307','99570',
                          '81684','57047','65462','50361','85719',
                          '29300','69094','44050','16484','56243',
                          '37991','11988','58038','96033','68230',
                          '87473','23871','27158','67361','94666',
                          '51034','16332','14935','33159','63533',
                          '14710','98970','30946','20990','37822',
                          '99405','48336','57753','85622','68548',
                          '27823','28957','78008','21282','90840',
                          '10085','69020','26369','52548','13496',
                          '30329','43775','79082','77586','95423',
                          '49156','73138','62045','90214','64322',
                          '48065','52263','23818','94870','91996',
                          '19370','71906','44369','13728','23852',
                          '94023','23228','20121','52881','40890',
                          '12430','12300','72382','64808','42383',
                          '12466','21401','23044','46134','21862',
                          '89595','16199','41653','13286','28609',
                          '28475','49599','60668','21639','69152',
                          '41965','81786','34636','63873','36388',
                          '81491','21481','28442','91726','39580',
                          '12975','32284','28091','35639','46019',
                          '54075','61743','68765','24223','28102',
                          '71373','34264','63161','82575','12633',
                          '17192','71928','86660','46811','32471',
                          '22454','58540','24529','84678','90336',
                          '14414','12066','22891','47260','74150',
                          '93490','60681','34147','70709','96630',
                          '24830','68289','30484','30802','57492',
                          '31908','41033','10911','81979','45599',
                          '58759','15762','14957','11690','66010',
                          '38744','33590','95011','81048','29646',
                          '74247','83731','17237','97930','38395',
                          '18921','12553','77350','82564','31799',
                          '51833','60906','36976','12983','82389',
                          '99636','59431','80717','59758','76843',
                          '85136','84278','67429','89859','91761',
                          '79883','99241','62529','43673','66423',
                          '23662','35530','94807','34092','37418',
                          '25848','36982','21965','17301','16298',
                          '68012','53771','62778','51076','89751',
                          '64122','27342','17079','72759','92261',
                          '25775','34767','82141','96314','65742',
                          '78658','52648','57269','96581','61526',
                          '51992','53416','25986','90001','19162',
                          '22635','72495','45025','44812','93846',
                          '18981','35466','77798','61589','44678',
                          '84899','53072','55718','70364','41956',
                          '69146','11394','99228','21200','78200',
                          '67332','62586','11468','20737','78743',
                          '19348','15399','32606','65652','50347',
                          '48487','80499','21591','75669','67409',
                          '12719','30285','71765','63984','96742',
                          '28127','71932','43001','49002','20266',
                          '30622','78457','74485','48249','56432',
                          '78142','22468','89518','50714','63816',
                          '36900','33824','30520','69701','44749',
                          '48883','23684','26301','41456','29578',
                          '46155','21935','12788','69366','59162',
                          '35408','84244','27831','25090','71555',
                          '23664','46071','19144','85846','31928',
                          '44655','54911','98594','62750','45093',
                          '38917','43233','28527','77192','19991',
                          '98894','21193','12090','25609','84640',
                          '26215','16423','41615','40567','36794',
                          '16066','79219','17936','16942','17476',
                          '46945','73838','88057','71895','49807',
                          '66818','33058','67358','28566','44458',
                          '11105','61578','61035','21758','11793',
                          '13472','94652','90774','72845','31696',
                          '10922','26394','58314','13541','18075',
                          '51121','79935','62192','82516','44504',
                          '43822','80362','94961','91059','12958',
                          '11902','31226','29276','70403','11339',
                          '40288','87763','95391','23119','10465',
                          '75920','67388','50162','25761','25512',
                          '73707','29622','60882','46446')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
