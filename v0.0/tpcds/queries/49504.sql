
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '14840','14783','60258','58581','85476','66412',
                          '90926','63598','92583','81526','82682',
                          '12061','64712','27065','55786','27335',
                          '67131','91283','34496','58711','92831',
                          '68953','53807','32041','28861','33793',
                          '40284','64028','70862','81685','55417',
                          '29220','63577','71826','43280','32437',
                          '74676','28318','30244','52432','49551',
                          '25397','97734','30133','58217','56879',
                          '76117','89703','37098','78809','75737',
                          '85547','61524','11183','73536','18487',
                          '15914','65595','16875','79695','22625',
                          '52240','79486','23617','50509','12234',
                          '71260','26668','45662','66212','99796',
                          '21884','70052','10915','78481','17151',
                          '70612','91752','93634','51837','57496',
                          '81658','11360','72731','40467','99200',
                          '57449','15581','75879','14798','97442',
                          '28570','62759','13692','41377','77952',
                          '64297','56682','35151','14318','11281',
                          '24702','46836','22710','75462','44251',
                          '56326','71642','66773','38733','59306',
                          '37583','29456','90752','34446','29596',
                          '50609','11210','28987','73864','96825',
                          '28494','37348','46131','61269','12027',
                          '81114','89837','34114','57929','52287',
                          '65120','52224','22752','31139','25146',
                          '16995','56220','29956','72068','99106',
                          '82023','10074','41519','24071','11532',
                          '20621','11199','54267','29644','43682',
                          '42008','48034','74346','60054','21174',
                          '45381','24317','70714','24696','12982',
                          '78412','59028','59061','33408','20785',
                          '49366','33990','51395','49056','86781',
                          '89401','46686','21893','48922','23477',
                          '42643','61054','10453','54186','52111',
                          '56541','68746','12026','24493','55726',
                          '16164','62864','74599','93054','77385',
                          '17748','41602','67055','26592','43727',
                          '37971','63630','10180','66885','29322',
                          '58824','76025','38356','64687','79458',
                          '26910','82077','86028','20612','33459',
                          '81906','36268','24411','83190','21374',
                          '78030','25342','31608','95580','61666',
                          '17317','27703','63099','97881','26005',
                          '19414','84350','35887','33446','14551',
                          '36937','20098','91579','49049','90779',
                          '94661','82333','16569','96910','60410',
                          '10960','95308','62003','86276','13934',
                          '37665','31390','29258','13398','14500',
                          '47560','55306','43919','48970','42865',
                          '67956','88206','98252','34624','27046',
                          '79009','36663','81347','63428','43910',
                          '66058','25132','42698','96819','65455',
                          '54603','58302','86206','11349','13939',
                          '23927','30767','83255','55740','41827',
                          '73329','53115','97517','40015','70620',
                          '82852','45654','27411','29181','33467',
                          '94074','14964','64153','13044','38894',
                          '61595','31701','58917','36145','16704',
                          '55074','62411','37355','34578','13926',
                          '86739','43592','26191','38680','28169',
                          '13231','20467','85218','48228','50906',
                          '47421','56584','35027','88849','24124',
                          '54235','44871','58308','11965','39231',
                          '56345','12927','11655','91290','34046',
                          '65895','12235','71248','24181','93251',
                          '56556','26968','35629','98370','18261',
                          '55205','95620','19345','25159','20394',
                          '45913','13586','34857','63613','44152',
                          '24563','54165','21100','71509','98351',
                          '16214','92110','43645','99113','62702',
                          '77268','35134','13732','76933','36059',
                          '45594','49182','33383','75943','79084',
                          '31998','13522','65907','56595','77447',
                          '48167','33270','92721','38528','16800',
                          '18284','95548','82078','88761','56918',
                          '90872','62111','36570','89563','47005',
                          '63589','94075','89128','43963','60451',
                          '95837','30078','18294','11232')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
