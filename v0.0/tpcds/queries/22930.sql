
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '70080','15265','13011','72872','37226','11405',
                          '93864','52233','28320','79115','53484',
                          '72848','90912','87309','61315','66192',
                          '55729','19882','19625','40405','60547',
                          '18918','38298','64000','47755','24768',
                          '29521','65911','90564','59462','14785',
                          '27060','57993','96523','12794','71205',
                          '46855','72343','76946','63699','57929',
                          '48923','73406','72142','93411','82104',
                          '51750','46622','10065','33366','83091',
                          '98583','21189','99235','18022','23362',
                          '44350','29259','26894','33031','73706',
                          '80973','46992','15261','89910','33727',
                          '31743','94364','76363','91008','51037',
                          '39716','25182','28871','16553','59902',
                          '60909','24427','20977','17386','36235',
                          '42215','59528','17499','95540','58477',
                          '48716','52656','35888','57170','28930',
                          '28466','75153','63864','42816','58201',
                          '61819','68779','54188','42836','40122',
                          '19773','51112','41293','82971','11807',
                          '53845','56390','42115','14611','14831',
                          '67506','75725','61777','57169','13697',
                          '94696','67379','58709','54990','32065',
                          '55863','38263','17054','94282','24366',
                          '47036','25030','72073','92850','17878',
                          '14690','21288','55949','58991','11762',
                          '30435','54257','55228','36542','91194',
                          '95556','23727','91927','83367','46508',
                          '52929','57400','94358','28346','19554',
                          '97857','83940','30825','21316','82613',
                          '15281','88630','43588','54803','65454',
                          '47538','69466','83938','24595','66603',
                          '61019','96844','69210','33165','37718',
                          '85456','61046','25843','65331','69432',
                          '16996','18178','48020','83568','11228',
                          '52608','47622','38676','12833','81918',
                          '82504','76585','98002','71477','73043',
                          '85105','48536','21911','19009','73500',
                          '90893','86370','30020','34041','22385',
                          '73085','54730','80264','83104','38766',
                          '18329','59034','32251','33966','50681',
                          '21221','84346','20474','45059','40859',
                          '75819','25760','37278','29086','21060',
                          '98772','75003','45875','52615','16013',
                          '38523','88653','98944','23113','21983',
                          '74645','98568','72577','18501','44672',
                          '21662','34443','83030','17164','90235',
                          '46839','52637','68328','56031','47090',
                          '69221','27529','81055','25671','40731',
                          '56988','58280','88912','85603','90227',
                          '19242','93277','32899','80019','12636',
                          '26197','85931','15500','50513','43391',
                          '11855','39939','26374','51099','11188',
                          '45816','80957','91114','35038','48085',
                          '11739','60726','85423','37465','12036',
                          '34583','75370','15636','79734','46133',
                          '94514','37594','74590','62210','31456',
                          '45305','73201','27300','22512','59599',
                          '17116','20104','84407','29565','63375',
                          '34834','70506','71217','30164','45675',
                          '46545','12764','56383','86569','49864',
                          '68391','19376','26956','28305','55925',
                          '32256','97696','86135','29434','52998',
                          '34835','61344','91253','35799','22611',
                          '58458','43515','63388','99709','47862',
                          '17576','18003','96722','46888','17762',
                          '21914','82595','44478','42791','69961',
                          '20823','14624','31986','89584','62348',
                          '19070','17727','78912','90514','48985',
                          '74162','36680','62101','94222','16098',
                          '20947','14363','37563','17864','13283',
                          '41661','87535','45787','33024','47300',
                          '64289','11030','31822','10579','42158',
                          '30117','80096','29925','20142','41456',
                          '30731','32332','16455','40259','11992',
                          '77124','47025','24381','48384','45438',
                          '68084','71720','74718','97217','55189',
                          '89703','51351','72472','31219','95055',
                          '69087','66169','46704','15758')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
