
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '27314','54603','55033','33812','39546','58958',
                          '47606','73545','44177','56943','60129',
                          '79077','18335','65066','98725','76027',
                          '29735','93334','65725','23010','82140',
                          '25680','38491','35687','50955','68850',
                          '12549','55813','20088','31057','22241',
                          '38786','55125','89550','10061','52304',
                          '52528','17540','28794','58408','87692',
                          '81035','51310','97118','19911','39672',
                          '26004','87536','23037','48854','35753',
                          '48205','19364','24578','81046','11572',
                          '89566','30067','32302','52075','72068',
                          '42756','46140','46812','76352','49053',
                          '42366','64169','88770','36788','67424',
                          '34018','94043','95597','63114','77131',
                          '31551','13692','84423','17938','35257',
                          '48715','70311','63247','29339','39859',
                          '58073','73274','64454','14656','18568',
                          '63063','43310','58750','11938','14510',
                          '79586','71929','77623','64322','53386',
                          '59669','89029','39088','35080','61415',
                          '17538','13027','57804','92274','96755',
                          '73061','14676','95680','27392','90784',
                          '18359','30631','86666','87451','91103',
                          '13480','39903','93582','43827','67309',
                          '35898','13328','77478','66406','94693',
                          '27183','37569','29322','61048','55638',
                          '14200','19634','66843','52682','13668',
                          '54668','45587','69247','29005','33642',
                          '23431','70239','21345','29943','11162',
                          '74961','67647','35720','17856','23711',
                          '42704','76062','36041','45590','40457',
                          '65989','49306','51172','34108','47713',
                          '64653','91139','41775','94097','17780',
                          '17605','54717','47851','12105','41764',
                          '17400','14971','52886','21436','35249',
                          '31589','41176','98608','16846','56204',
                          '57102','37119','98959','34371','97779',
                          '96798','20312','72142','43283','91213',
                          '83015','94390','28503','63385','42628',
                          '58237','40285','38432','26594','64192',
                          '21479','48989','17667','27082','48175',
                          '58466','88970','16430','66767','12555',
                          '37166','47136','48502','85935','58386',
                          '69869','39556','67654','20009','76522',
                          '27787','19943','91117','88844','33207',
                          '76359','39281','73070','42502','10491',
                          '16992','67942','49731','43281','69060',
                          '74246','99729','12080','76790','58363',
                          '88373','72977','52878','72662','73482',
                          '16498','65627','28766','14816','19887',
                          '52521','76589','55461','22697','35237',
                          '28926','67742','83457','60524','96246',
                          '22234','73485','92821','20941','85743',
                          '99261','82356','31593','61222','70846',
                          '57043','59410','47377','70778','80198',
                          '83705','34760','63722','66635','43378',
                          '73165','58643','48789','79761','13075',
                          '46266','87218','67459','16571','49973',
                          '88138','39681','36390','95356','35485',
                          '45248','98795','80778','75369','50789',
                          '83356','54165','40945','24069','29030',
                          '36892','24087','33024','48528','97977',
                          '50628','42021','60920','43570','92431',
                          '96513','31913','54761','59363','74767',
                          '32738','13636','22825','53553','25005',
                          '77595','26975','64144','46688','27364',
                          '67858','80853','99651','33956','68565',
                          '35262','45865','50780','92037','49335',
                          '30919','85655','64268','39694','67941',
                          '38980','59802','39985','30963','66850',
                          '70930','42169','96072','56676','12752',
                          '83932','28342','83891','55097','42218',
                          '21393','54930','91542','18474','42300',
                          '27774','80646','55891','56379','28257',
                          '44684','11473','84178','10875','35480',
                          '81638','69371','42082','29899','43521',
                          '40595','86492','15408','19575','41023',
                          '54640','85451','10835','69596','11490',
                          '88442','83310','86728','67877')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
