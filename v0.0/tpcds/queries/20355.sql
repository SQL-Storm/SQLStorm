
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '39765','66533','19973','19000','41557','66489',
                          '44394','15042','63708','20521','57312',
                          '55539','10011','12278','40718','50003',
                          '19001','47196','17075','49954','10151',
                          '31497','78615','37930','66910','89329',
                          '31095','46073','80350','80657','41262',
                          '46908','86250','38393','17261','40120',
                          '71407','25753','12635','83833','37180',
                          '94335','23932','32742','88058','99618',
                          '11520','63033','82243','34847','14180',
                          '34078','46190','54798','81051','37133',
                          '49003','72356','69384','22510','19898',
                          '59077','16591','53211','76748','16391',
                          '59451','93292','22259','36091','17161',
                          '34441','63099','41574','71975','97277',
                          '72171','34954','51973','16868','67626',
                          '86258','62528','43567','99473','38594',
                          '10996','16764','63658','12720','18466',
                          '64918','93161','83432','74556','39872',
                          '30284','45201','71109','25010','28554',
                          '84759','29540','16801','95422','79888',
                          '31758','23761','70116','37470','27055',
                          '46167','93234','44280','69544','76484',
                          '69879','88794','37738','83146','55852',
                          '31125','75434','78729','79691','86810',
                          '62045','46054','66960','17255','64562',
                          '27777','78000','79990','13186','34423',
                          '58404','65903','11190','20746','50607',
                          '46773','10308','68183','15905','54162',
                          '33635','20112','81231','19141','60422',
                          '60020','29842','25529','40121','17060',
                          '50246','96079','48203','22911','75494',
                          '66636','31621','99119','23315','40382',
                          '37171','73215','46487','57056','15568',
                          '83237','43862','20125','33086','22064',
                          '54427','64942','75556','42600','23125',
                          '18936','68073','64517','41088','92755',
                          '63762','64103','58836','75311','59481',
                          '92919','38404','11122','35273','35322',
                          '44008','33637','54738','48243','20714',
                          '17155','41595','69865','14097','43121',
                          '25341','62182','98458','81858','73875',
                          '20507','25506','15226','30275','10853',
                          '87219','80869','67205','40298','48749',
                          '37990','69315','55636','97288','16692',
                          '16922','39808','68136','40365','93257',
                          '73657','47006','72246','38603','11992',
                          '51098','19853','26553','65634','41964',
                          '14919','31166','84683','19030','14423',
                          '25771','11928','16932','16531','42058',
                          '43130','37679','59625','32709','46572',
                          '52437','49820','57780','14650','30508',
                          '92062','43656','79993','21406','85917',
                          '15980','77764','94012','48561','77946',
                          '76828','79906','28814','98779','54595',
                          '79067','94268','77251','96628','59316',
                          '57414','15401','81409','26447','49627',
                          '84348','71081','48174','90679','52144',
                          '39182','60159','60182','24479','59097',
                          '65747','90510','74913','37185','32465',
                          '54230','26391','77907','74490','88949',
                          '20587','48348','76124','93641','41834',
                          '52175','93750','56574','62521','35695',
                          '87081','24925','84064','17449','28353',
                          '39277','56716','35024','35367','26284',
                          '87534','30187','38452','53642','77367',
                          '25311','60900','95372','68921','11383',
                          '70952','71944','57176','10037','87117',
                          '53237','75620','28458','84276','21964',
                          '80599','26489','24303','31591','94484',
                          '13083','25678','36385','56148','21963',
                          '54719','53170','19201','72084','85852',
                          '70329','66086','96060','25660','79788',
                          '74035','28913','12787','83326','83367',
                          '38633','49245','69762','69129','92708',
                          '74378','11196','17086','10678','70369',
                          '54106','68392','65217','68151','89269',
                          '64640','19997','38389','50908','22496',
                          '17104','99793','39760','40977','75161',
                          '42336','73948','60631','92539')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
