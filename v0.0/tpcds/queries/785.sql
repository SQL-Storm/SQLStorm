
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '16646','33490','23207','93035','30531','82209',
                          '79525','34511','51592','15442','63258',
                          '19807','58307','66255','77807','48679',
                          '15775','69722','16244','59126','49570',
                          '33961','57355','23460','50827','48750',
                          '85498','26175','97059','33596','56264',
                          '52059','81844','86045','65416','19314',
                          '63520','98565','91286','68270','42136',
                          '14893','45932','61722','74481','78101',
                          '92104','18133','91108','33702','86480',
                          '80486','23538','12490','29201','99980',
                          '55625','34433','14884','24170','53881',
                          '93205','54184','56550','63639','53722',
                          '63653','56138','57031','62728','78574',
                          '62897','24038','67878','41521','12787',
                          '59423','32711','96883','40118','13385',
                          '91385','41331','28976','52493','29861',
                          '77070','36465','73816','19723','61880',
                          '35239','97746','33986','60074','52325',
                          '87075','47801','28255','45463','16008',
                          '46627','30630','54790','48702','57924',
                          '27404','81712','44459','24750','54131',
                          '68028','21021','98402','92047','11702',
                          '99105','67318','86426','76564','62645',
                          '56563','66570','88233','45531','76472',
                          '30179','40932','62441','67644','30354',
                          '40655','55843','67964','52161','77157',
                          '26026','38006','81088','81937','86093',
                          '15179','53816','14559','30136','74224',
                          '76778','45790','96779','35271','80938',
                          '47971','66859','52015','58289','61134',
                          '42513','54352','95983','16281','77160',
                          '23560','79815','20744','43695','53565',
                          '15945','28424','97709','38941','47975',
                          '17469','29674','34626','56028','30052',
                          '22167','87973','89274','51400','25777',
                          '95865','61544','94471','71150','29929',
                          '82363','26971','41887','21783','16456',
                          '15897','57682','12692','89867','72885',
                          '54112','91972','43474','71878','61298',
                          '33849','31690','46343','28997','41888',
                          '12435','34751','73714','63585','17442',
                          '19366','64319','15990','24524','25731',
                          '17815','69656','98113','24274','37762',
                          '22588','12739','33429','22009','21334',
                          '29461','62597','27990','13842','56368',
                          '38051','43751','13352','13310','94536',
                          '62653','11718','40028','24052','93388',
                          '32518','91969','12242','33446','14519',
                          '78297','11573','65287','12714','92197',
                          '79084','44653','68176','14094','33500',
                          '33748','67182','99525','77856','14305',
                          '72337','34385','41735','40978','78823',
                          '86481','47720','36005','68318','84772',
                          '52269','37349','90626','85331','12379',
                          '63527','59760','99459','90695','69309',
                          '28942','51419','14346','88535','12363',
                          '77454','97902','13771','11311','86052',
                          '45596','80965','71554','39987','58435',
                          '33917','64710','63936','87943','26747',
                          '53680','72758','27009','54407','88767',
                          '21911','42260','41028','89760','14668',
                          '36536','94935','27733','19666','95528',
                          '72003','86956','39218','29845','46637',
                          '16850','92905','44766','23955','48700',
                          '12419','15444','98289','82019','89361',
                          '84158','56051','93300','84507','17766',
                          '35487','70110','62802','29096','53178',
                          '54231','57776','43101','37604','45298',
                          '97391','74187','34760','26108','41189',
                          '82318','43851','28299','47533','77382',
                          '85950','21202','28194','60627','32049',
                          '40116','95882','34822','19149','25453',
                          '41648','84394','55506','52739','81624',
                          '86021','45662','28048','80033','19263',
                          '91201','79302','78494','89177','55868',
                          '72960','83459','22336','49805','46636',
                          '31347','82434','87041','46987','25115',
                          '15044','38261','77979','23337','37346',
                          '61375','64004','40212','70473')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
