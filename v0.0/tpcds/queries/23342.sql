
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15011','16285','19038','14491','20373','49552',
                          '18798','25841','24799','32578','27459',
                          '96347','24717','27148','38181','32244',
                          '84948','22380','41956','58656','10392',
                          '51219','14922','20720','51381','17566',
                          '72435','10819','51383','29474','30330',
                          '85098','59693','44545','13299','34038',
                          '15499','66643','10798','77523','45306',
                          '11070','81083','79883','42004','20178',
                          '13593','50688','53678','24315','81637',
                          '48332','68800','58721','57575','11983',
                          '12903','59738','59316','53566','30853',
                          '12811','58973','15375','50622','10888',
                          '26345','97164','78365','72763','10047',
                          '70816','36537','14562','36544','34253',
                          '84189','60546','93614','49272','12518',
                          '39527','34034','31801','71786','56830',
                          '11299','30992','40372','77436','87308',
                          '95997','59972','85679','39943','16695',
                          '32510','42679','39454','14389','43212',
                          '34219','46158','31007','16451','19574',
                          '95137','64140','11044','26917','96656',
                          '32605','54266','19764','23664','20353',
                          '21502','46898','31923','46448','36113',
                          '96839','66431','56354','43653','30214',
                          '56829','81180','74177','88977','78039',
                          '92735','28279','15396','55219','17724',
                          '26512','12219','87595','75786','40509',
                          '20412','76312','80747','14479','81368',
                          '43119','78290','36439','26563','69342',
                          '57437','62324','62723','90262','35327',
                          '73957','54222','27253','78832','23873',
                          '33056','17009','35525','99357','11484',
                          '39598','18237','55036','44166','88795',
                          '45422','12513','27229','17169','12296',
                          '43065','36642','67153','43024','41524',
                          '95540','32402','76368','70805','58604',
                          '33420','46423','32823','19412','23575',
                          '35366','36376','72330','71436','92806',
                          '68385','12483','44837','72709','49381',
                          '91775','82451','69229','45077','41913',
                          '23532','27887','95440','95642','16449',
                          '15457','91306','17756','45151','17195',
                          '44666','45132','67685','58578','15332',
                          '18004','99106','93572','61837','11813',
                          '43122','46068','14106','93673','29648',
                          '54695','11377','31883','22850','87143',
                          '50978','19934','20613','24372','12284',
                          '15771','39243','78509','22250','85118',
                          '28170','31869','59409','75204','10446',
                          '77533','46075','96291','13636','86544',
                          '11010','16457','15687','27123','46600',
                          '63311','32188','61504','41897','88840',
                          '78299','79493','37928','65460','92582',
                          '27470','18753','63454','87497','60394',
                          '75113','85838','66274','50273','60405',
                          '55629','18390','14125','81981','49206',
                          '32927','73105','62852','50786','76525',
                          '13530','56579','24384','26899','40739',
                          '55938','50635','30520','36473','73062',
                          '94716','32437','20692','27988','59924',
                          '58284','60982','35888','14619','50090',
                          '48344','35781','77099','22513','54715',
                          '90361','29291','47564','88002','67534',
                          '96597','86315','21917','10493','64056',
                          '68819','51993','55856','10707','37036',
                          '83834','35756','89090','66167','28835',
                          '28437','50330','88268','16482','82272',
                          '88542','60485','60852','37943','25783',
                          '72807','72200','17088','70715','26493',
                          '17144','24473','54286','34078','19146',
                          '58548','38242','61072','27285','66965',
                          '34220','77493','52948','31949','62389',
                          '17638','24095','12751','49939','48048',
                          '19145','56103','20118','65595','30772',
                          '26331','31248','65516','22623','59601',
                          '16261','56667','27480','70823','24809',
                          '14522','34862','15365','16142','44315',
                          '57292','60078','29542','62935','12839',
                          '96960','78513','42657','32599')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
