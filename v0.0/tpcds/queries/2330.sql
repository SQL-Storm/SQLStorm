
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '60795','28124','50419','22309','85116','66716',
                          '28260','32680','35179','50594','49571',
                          '23600','14858','28707','66433','36180',
                          '15638','60199','92935','55342','78163',
                          '78937','49224','65002','43943','97003',
                          '54202','20977','98852','16477','56499',
                          '84497','12809','34825','34908','27038',
                          '36929','19567','24461','76958','53862',
                          '28186','24968','16418','27810','91568',
                          '78069','81557','25179','56070','27246',
                          '19802','28670','34542','19367','31943',
                          '88012','41596','19760','24816','16793',
                          '55657','82047','57509','90225','80243',
                          '12584','57473','53541','61422','69235',
                          '86364','29931','41502','82556','28120',
                          '73108','40039','81375','18536','14317',
                          '60986','18462','58177','17945','31334',
                          '33672','14593','18606','35414','80888',
                          '29736','29281','21349','41888','45833',
                          '94339','17426','54695','89322','56601',
                          '48310','17030','63990','18450','72839',
                          '69427','59332','96599','38207','74171',
                          '38313','44439','36979','31005','79611',
                          '40113','71946','88074','84051','54709',
                          '34863','21784','18517','52037','15414',
                          '93883','14787','94723','44377','17531',
                          '75499','31060','59185','43402','76841',
                          '93732','83639','33582','53479','46317',
                          '20500','23754','13072','12476','62211',
                          '22037','30028','52780','73735','69652',
                          '19936','12421','52154','21038','59729',
                          '23643','22634','27320','23653','50614',
                          '88400','11500','69737','20708','38552',
                          '38226','33495','24739','23983','65717',
                          '85681','21900','36820','60145','79640',
                          '32839','23715','12456','74974','89957',
                          '35544','92948','38970','52950','69095',
                          '68630','26997','22909','10957','73554',
                          '38558','20653','97413','87343','20322',
                          '17342','10282','57329','90407','19195',
                          '62797','22973','96426','45353','52691',
                          '96900','29672','15426','78556','81936',
                          '52095','40227','10255','28655','89870',
                          '64313','77447','52014','66900','84331',
                          '21526','55930','59267','17752','23418',
                          '57855','42580','57933','65542','61183',
                          '37258','37891','43036','16246','55413',
                          '24655','57802','34362','74669','94621',
                          '68290','86561','20969','36376','36915',
                          '69318','67371','49963','36198','37266',
                          '92491','46403','64955','37655','17340',
                          '53815','27220','20371','23289','45370',
                          '43960','15489','72251','10678','79701',
                          '83911','44726','65439','76209','65358',
                          '15693','72033','78320','63819','78473',
                          '43858','84179','16384','66292','66291',
                          '16258','14663','15920','44522','24491',
                          '95803','25540','25527','42606','23633',
                          '53512','93144','80234','52570','83545',
                          '91495','42613','63060','58699','67942',
                          '27274','36370','86643','73164','51768',
                          '27913','68729','81173','59970','24202',
                          '83769','69916','80304','18256','12745',
                          '35610','19065','42823','35398','74962',
                          '22033','52203','97774','86913','10894',
                          '16417','10597','40726','93411','89326',
                          '80004','61475','69741','18658','47732',
                          '26781','51785','86589','21979','73104',
                          '79324','24876','85840','37040','32626',
                          '28466','47099','64029','85196','59063',
                          '74654','75701','16160','59747','86275',
                          '12222','95257','22946','46095','47012',
                          '18458','36532','59435','45708','28800',
                          '88543','81032','98078','83136','85815',
                          '84691','32399','10016','60233','91207',
                          '27576','72448','24628','59088','88001',
                          '62230','48013','95400','21467','48371',
                          '26798','11643','72099','45778','48940',
                          '20306','98913','15040','52590','97383',
                          '87627','83994','31967','48599')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
