
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '88336','20123','77385','21414','58382','36636',
                          '30427','50630','36122','19116','65597',
                          '71695','29003','13976','13609','28883',
                          '99004','44793','64580','13852','28645',
                          '81109','33111','88533','51987','87612',
                          '35715','69582','42429','53489','77006',
                          '25990','85213','70853','40040','23913',
                          '18029','58147','83578','42092','51707',
                          '32493','45248','81074','27255','36931',
                          '61579','52908','13185','49475','28346',
                          '36073','89402','51200','16369','14005',
                          '42298','20038','39712','68811','18900',
                          '44592','16838','69805','27886','22792',
                          '27850','54036','13769','84446','11866',
                          '48951','95417','79636','21716','46043',
                          '97321','49151','52435','19757','59121',
                          '15497','80113','68844','43946','36193',
                          '26887','52145','60798','73130','45185',
                          '99686','16549','54293','29141','17988',
                          '41217','60263','34211','23646','16317',
                          '47341','70071','16314','37602','37177',
                          '76687','81875','61706','48255','33100',
                          '75909','24868','46379','58528','59925',
                          '32483','28383','19561','15413','39723',
                          '22608','51202','99230','39527','15076',
                          '70209','50279','70539','57670','43078',
                          '65393','10214','60072','52830','24465',
                          '94931','31784','34278','24483','55552',
                          '26802','65233','76967','45171','77612',
                          '49302','12338','75992','91368','52531',
                          '41135','40712','25414','57443','43464',
                          '88674','11294','69161','92333','20796',
                          '84608','51229','13679','35853','99688',
                          '28629','37491','93586','73204','70802',
                          '60178','11943','52016','11817','49104',
                          '83463','27896','26072','77353','33117',
                          '92921','49721','11329','47907','20104',
                          '35811','29426','60566','75670','89804',
                          '16592','13117','11774','63705','41201',
                          '10303','20332','96642','10262','61798',
                          '19791','10824','32176','18031','19053',
                          '60969','50514','32237','11094','16774',
                          '77809','11117','21133','90883','26716',
                          '26482','74485','22428','92972','95288',
                          '28695','57294','15349','16881','41452',
                          '84141','88311','27200','25368','78955',
                          '28937','17748','90759','42241','73202',
                          '35782','53403','62968','49528','15993',
                          '61592','22103','50749','44649','81279',
                          '99059','92797','10071','98807','81927',
                          '12377','32331','73673','77507','75340',
                          '10604','57712','43560','27148','11256',
                          '22499','28068','29689','61856','55466',
                          '91635','69592','69505','22933','83504',
                          '40012','26290','78386','76926','42985',
                          '79328','55881','53594','19847','74784',
                          '75740','86372','76725','94623','23075',
                          '34858','10808','75487','29711','16903',
                          '42645','25360','31244','52003','13961',
                          '57411','35810','63704','13707','43371',
                          '47638','78090','73298','25911','70843',
                          '43242','58584','78838','46053','42799',
                          '74756','35714','84602','52179','28289',
                          '93678','28721','59029','92229','25210',
                          '51600','10976','20241','95240','48527',
                          '23736','28544','92060','47312','27277',
                          '44407','42033','15481','49654','94710',
                          '24733','33827','98974','75466','49457',
                          '17515','14296','36107','53783','41164',
                          '57704','50503','53319','22092','41104',
                          '41967','42183','19460','46090','69798',
                          '17335','87871','91618','74103','19211',
                          '64420','93159','87704','60838','71882',
                          '32545','96778','82674','66886','68505',
                          '33067','84667','54094','48645','50912',
                          '98566','73479','77228','78217','83779',
                          '42085','13603','68646','84434','50897',
                          '76963','11548','65738','76763','38469',
                          '93770','29755','51391','44219','24981',
                          '72064','45612','57626','26581')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
