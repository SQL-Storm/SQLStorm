
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15899','29572','31752','14948','16791','85213',
                          '43957','46297','36463','26052','68219',
                          '77154','29493','62667','11613','50303',
                          '98388','17137','19131','99009','47155',
                          '18911','46294','11624','54313','81799',
                          '79361','97432','75208','34258','13704',
                          '78502','52421','97794','11421','52855',
                          '55373','21035','35535','38559','49565',
                          '73652','39285','58823','50969','35319',
                          '50531','40872','26424','51388','46122',
                          '31094','50296','63697','30914','92516',
                          '90353','40034','88688','42806','41296',
                          '28241','27624','64418','81918','67937',
                          '17994','85869','31843','33270','36630',
                          '13363','84504','17141','11554','63564',
                          '42372','51645','89038','52509','19386',
                          '17654','70253','58039','15180','88698',
                          '58316','66894','11490','45188','67788',
                          '37273','44108','15364','50242','59505',
                          '11657','37474','43162','54984','29121',
                          '68671','38241','34699','30064','77879',
                          '80927','33335','96691','90814','33271',
                          '58217','54238','55768','25550','31141',
                          '41400','28657','17983','41129','28479',
                          '39226','79083','52877','42648','23081',
                          '99574','64957','38043','94532','51473',
                          '17664','72664','15452','56561','88435',
                          '76908','70484','99312','76830','13584',
                          '12969','51671','33850','48184','44607',
                          '98089','23318','32956','56960','43288',
                          '87191','81822','49169','55406','26958',
                          '16065','75758','13074','64303','24221',
                          '33668','32939','55350','50566','43454',
                          '63396','34219','98345','33116','69007',
                          '64140','98774','84561','84349','51987',
                          '85018','62039','78957','65723','76606',
                          '90677','43154','53525','29381','31021',
                          '38370','28425','16576','55298','17585',
                          '80103','63886','49749','16601','13243',
                          '62864','75948','83818','42679','47856',
                          '31932','28672','77502','36877','30875',
                          '21222','59519','48836','13985','55730',
                          '12313','70234','79799','15218','26291',
                          '53148','33278','87306','29846','71671',
                          '45495','55575','12988','35717','92733',
                          '88683','85695','64856','71766','97679',
                          '70347','22441','20430','30097','50860',
                          '27907','67370','54797','93185','28501',
                          '45382','14202','20096','10723','19588',
                          '73923','62245','50165','68657','14433',
                          '62119','35470','97427','80657','71917',
                          '45569','94111','91136','49596','68545',
                          '43323','31212','20261','27928','41170',
                          '72157','36402','60010','38231','29151',
                          '61644','23784','44018','61301','15682',
                          '76849','87753','31841','85034','49384',
                          '45392','71628','38473','75373','23549',
                          '48290','49044','55731','42529','96112',
                          '20510','69336','53179','55242','40455',
                          '67841','79499','48285','81714','36359',
                          '72117','31208','23276','49238','86948',
                          '22015','40052','13897','96270','13726',
                          '52419','55302','13104','30013','54116',
                          '19415','39499','83955','25448','18539',
                          '97852','71346','73170','45446','65131',
                          '97678','27510','18551','13376','43758',
                          '68768','43034','85659','19543','56751',
                          '77224','49245','25536','32662','61757',
                          '51316','23702','30861','12086','31123',
                          '18954','50229','89600','40526','49576',
                          '91782','78359','35595','81094','29701',
                          '76333','29683','12397','36509','22606',
                          '36761','19724','80367','90270','67800',
                          '17444','94625','64268','35800','71010',
                          '95957','13303','30953','32718','13469',
                          '30315','33912','72528','10511','31792',
                          '81736','52067','28037','64971','84181',
                          '81069','14887','40770','49981','14114',
                          '98226','33214','13583','67740','14710',
                          '25514','74924','32249','78671')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
