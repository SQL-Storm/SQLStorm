
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '44903','11231','16713','32361','11173','56210',
                          '61501','44002','76269','28197','32351',
                          '23168','26474','70569','40269','18997',
                          '16021','45939','77603','76273','37624',
                          '81852','44370','46124','14833','30845',
                          '58086','33475','95548','95313','94324',
                          '86136','86782','14210','57904','37317',
                          '38968','16605','46277','81336','70841',
                          '87265','41743','51743','50332','87049',
                          '67369','38094','41158','43935','56449',
                          '98005','43810','95791','13844','64474',
                          '32582','55951','68415','89374','62054',
                          '61032','37285','55851','98683','88774',
                          '99261','31764','86012','65140','85692',
                          '81725','43772','63650','50859','94939',
                          '85231','27366','48212','60042','61604',
                          '19543','30023','24532','70302','57183',
                          '32608','58519','55271','39871','56048',
                          '43719','33805','12139','87424','39161',
                          '41797','53501','87354','95917','26206',
                          '37327','85387','30428','28879','57978',
                          '71455','26111','23113','71124','75839',
                          '81975','36954','42569','22917','13214',
                          '45639','54270','20756','92255','10574',
                          '28949','29910','25279','26230','70484',
                          '45174','71803','79574','31374','42388',
                          '29796','58451','41224','22483','80166',
                          '54037','83558','65255','23624','43821',
                          '15850','10428','15624','37745','23866',
                          '92871','85240','74091','61844','74782',
                          '51116','26586','71993','92223','10438',
                          '58752','63032','42113','50153','75010',
                          '68612','50403','89461','10057','99399',
                          '14064','24295','96804','33718','55856',
                          '59766','40394','47976','56841','37928',
                          '19205','29120','84889','33536','45952',
                          '99467','86348','66684','38303','67397',
                          '24404','20625','48263','44187','15078',
                          '50983','32481','38234','91090','20056',
                          '61528','14227','80038','70431','97932',
                          '57616','73105','57528','53665','94088',
                          '17109','83888','18722','19566','23815',
                          '87611','28760','85964','61372','70013',
                          '25827','65248','43070','70756','78393',
                          '92428','55906','49116','10713','63672',
                          '29874','98205','89876','28339','77870',
                          '29142','52557','72039','94081','15252',
                          '14659','34567','28431','28743','71613',
                          '82572','71021','54580','49419','71594',
                          '46817','27635','11860','46959','93422',
                          '33207','38546','48091','77430','31514',
                          '10881','11480','13793','19144','97114',
                          '52576','47873','34361','35830','44261',
                          '58561','76339','24381','59771','21804',
                          '62737','94423','26679','18504','73196',
                          '94514','40026','30876','91436','26066',
                          '41026','16118','71658','96096','61985',
                          '45861','81744','32293','16916','92583',
                          '84144','31986','45989','73482','36067',
                          '40146','53352','90591','34877','55764',
                          '75849','50628','82970','77521','87475',
                          '71543','10340','17834','66044','47632',
                          '22618','52111','43855','70551','20843',
                          '29967','88664','67963','35484','23783',
                          '16282','32845','40878','58609','83866',
                          '30688','27935','88797','89905','43820',
                          '33173','87447','86791','30964','71782',
                          '75290','96268','55812','90232','58473',
                          '92290','25952','17102','24194','60139',
                          '89287','27334','29340','82706','30131',
                          '50722','74435','50823','74952','41519',
                          '51270','31142','87267','30000','99156',
                          '65520','26793','74747','27794','91441',
                          '23318','48875','41892','98704','55120',
                          '14691','80726','60276','73114','45259',
                          '53049','92726','42861','50871','26788',
                          '11894','55825','28729','51495','57376',
                          '56562','87122','57200','87850','70488',
                          '32539','18852','45262','66704','63090',
                          '58387','76524','79117','54496')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
