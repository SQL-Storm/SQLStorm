
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '82977','76437','26489','33574','27262','13944',
                          '16714','22403','71220','60890','67297',
                          '63482','48758','25418','29464','32805',
                          '96074','14840','99670','38978','97205',
                          '87150','45169','76381','35091','73809',
                          '34425','45573','78039','19022','42682',
                          '10158','20036','40623','97393','64737',
                          '83004','18905','73767','61414','25416',
                          '26820','94307','54485','90832','30444',
                          '52343','18040','69590','95080','48961',
                          '49148','72346','90519','37443','32484',
                          '39121','21197','38255','70257','32408',
                          '49156','71122','20635','55847','20681',
                          '71103','75539','36322','74523','32539',
                          '53812','11234','83316','74491','73727',
                          '47205','53047','46905','82746','43265',
                          '10246','18307','84076','49871','73042',
                          '26427','52462','17910','63979','87957',
                          '23511','71654','16379','14524','34143',
                          '82933','30132','52628','15413','10633',
                          '82309','27001','13206','38857','31848',
                          '73295','80884','74194','73310','51844',
                          '20124','54944','62442','41377','82425',
                          '61350','57000','45675','39772','33697',
                          '12284','68947','83118','30523','79264',
                          '12653','28309','56401','14165','62907',
                          '21366','37284','35033','44403','43036',
                          '75710','50040','49105','58051','13675',
                          '90994','20257','33707','96222','46915',
                          '25413','17994','29296','28459','76815',
                          '15283','30911','15901','89554','49792',
                          '30501','68317','17176','34933','66903',
                          '48863','30722','63199','34835','19077',
                          '55732','39263','39856','98750','56424',
                          '95743','55456','76592','70517','35230',
                          '84800','14150','99545','14142','58888',
                          '18064','59923','22943','10589','67870',
                          '63526','34282','11840','34842','98641',
                          '48005','54640','21776','68034','12406',
                          '59734','64587','35308','26920','81690',
                          '64483','68603','11351','41224','99376',
                          '66102','45523','92373','28150','36243',
                          '67984','30249','41025','82787','81848',
                          '66060','67505','67862','74919','68300',
                          '86018','43361','90566','52911','20142',
                          '93470','25612','55880','94842','65468',
                          '33427','23851','99408','84575','31137',
                          '53610','56320','37903','96936','94196',
                          '22856','10000','42259','32072','60854',
                          '27378','22481','28500','15144','34895',
                          '10569','36404','82484','43551','60846',
                          '48508','48625','42312','43119','95118',
                          '58393','56855','37893','14409','53271',
                          '23446','23864','48586','56668','29830',
                          '33992','39325','83786','33522','95815',
                          '14007','24272','13363','96992','59575',
                          '34123','15414','53850','51387','70063',
                          '74906','21180','97899','69441','11244',
                          '51859','93133','18251','77503','42214',
                          '39124','72192','15580','12849','82626',
                          '24694','61627','17089','53420','24523',
                          '81063','31914','76613','40275','36810',
                          '26649','66944','65575','32001','19219',
                          '11565','24636','70911','13254','39000',
                          '13724','87052','84732','32266','79488',
                          '49327','92251','22584','17394','28873',
                          '45357','10519','88886','62804','96942',
                          '66783','43521','41878','33114','50186',
                          '53530','68633','50944','52128','53635',
                          '23404','14224','16004','63045','17627',
                          '21795','41740','97939','19845','88391',
                          '27867','32079','67937','90101','21695',
                          '29404','77525','93275','34260','82808',
                          '70093','53371','56053','42722','91815',
                          '14500','78160','25106','84197','62178',
                          '14728','72368','11037','15809','34269',
                          '93974','11597','90705','74022','91225',
                          '66334','18553','24493','80756','30732',
                          '75135','52824','55454','10889','52135',
                          '68624','91493','95295','45693')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
