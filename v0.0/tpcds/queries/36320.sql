
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '79600','16246','84984','89599','63158','80300',
                          '81129','16143','48249','77613','12613',
                          '87272','49129','29940','52960','87762',
                          '40082','30360','60522','45147','24784',
                          '69474','71009','43513','62173','20108',
                          '15765','86651','30497','37807','31842',
                          '17920','60312','26180','51056','58101',
                          '18788','28975','10468','24628','80303',
                          '36825','48895','44270','74525','21489',
                          '92825','24179','43657','44092','64023',
                          '38845','65338','32432','46671','44898',
                          '50633','58358','90313','73139','38144',
                          '29346','20723','48741','34371','40058',
                          '39183','16840','81313','26227','74995',
                          '12823','21537','25317','65104','18487',
                          '16722','91342','53451','73356','79175',
                          '15373','35271','28980','17065','26846',
                          '22656','25595','13074','96677','59392',
                          '91495','41584','14954','19941','95101',
                          '34890','33509','52075','90690','37312',
                          '51247','37722','21802','40268','43330',
                          '74585','34067','87379','80964','54669',
                          '16562','52122','25749','79121','97709',
                          '88427','20872','27710','66963','31090',
                          '81160','89488','54401','67004','69605',
                          '18809','61089','90682','18664','43028',
                          '90471','65222','84378','72034','87090',
                          '44175','61607','67392','38613','49826',
                          '15001','30046','91028','98047','26401',
                          '52615','16483','12890','77953','43176',
                          '20901','60142','27575','28402','20537',
                          '18835','11674','96630','97943','34811',
                          '10478','39219','32910','43942','31890',
                          '64573','73567','98234','62989','37652',
                          '90563','69037','38171','23649','38107',
                          '29532','97010','67514','25781','88946',
                          '14001','99587','52536','44930','79828',
                          '23865','16498','18536','23866','75274',
                          '40501','26809','99936','79677','74926',
                          '71585','83622','57867','29353','32555',
                          '71829','60666','32644','92813','30348',
                          '22899','12722','45755','63922','26451',
                          '20326','11349','21081','12114','43996',
                          '26177','24031','66950','70101','80879',
                          '97576','69490','15651','55852','22191',
                          '85246','42879','45941','76144','22195',
                          '39367','89127','15410','18230','81547',
                          '75993','83930','46298','52906','43965',
                          '22151','39077','37189','53968','58290',
                          '12133','12568','25060','97178','12280',
                          '58742','23427','58748','23712','33774',
                          '48361','19607','11327','77781','60192',
                          '97249','37935','40179','34378','12292',
                          '11695','22097','49121','54287','13670',
                          '64560','24264','27413','45383','70622',
                          '21674','57625','60697','58041','49453',
                          '55648','19546','38609','38013','38194',
                          '15285','40026','16735','15497','90415',
                          '62149','43191','64227','68085','13887',
                          '30373','32633','25834','53429','15382',
                          '71940','20213','31916','31997','17183',
                          '53008','56315','16887','17941','90506',
                          '94443','99675','31845','37091','64039',
                          '96400','67896','24605','26185','50111',
                          '83280','75635','11796','80410','13421',
                          '57668','70136','19391','83590','46421',
                          '79756','16261','22858','32092','87924',
                          '98594','59459','78748','96489','11168',
                          '42976','20103','65974','80437','39546',
                          '33411','26946','93986','12371','75472',
                          '39107','25904','37001','53082','16010',
                          '69027','90035','16229','46622','17587',
                          '49515','67340','14870','99687','18401',
                          '87449','36723','45252','71212','42270',
                          '54845','37264','83042','14244','86520',
                          '60849','60793','57935','38490','48457',
                          '75900','54639','56512','92619','97609',
                          '22900','24422','77998','38766','22236',
                          '33026','64566','83738','12090','65017',
                          '56660','39582','34294','56489')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
