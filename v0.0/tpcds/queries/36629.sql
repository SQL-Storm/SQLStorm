
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '90218','37869','29613','60898','55149','70967',
                          '26850','69933','98191','45502','58698',
                          '43039','32037','15973','42513','64460',
                          '73102','51235','63875','22809','38146',
                          '14309','24909','78713','92454','43378',
                          '16635','78569','13439','10646','95836',
                          '40819','58593','35373','22309','99526',
                          '12552','24700','77705','44318','14081',
                          '22901','43677','65734','93221','45346',
                          '85918','94745','14158','67059','21386',
                          '89994','12616','12199','32924','27043',
                          '33143','22520','32338','68582','48494',
                          '62094','38986','85405','43556','71060',
                          '24692','63316','56661','25545','97023',
                          '54735','95179','13734','15939','59766',
                          '69858','77257','11545','67519','52010',
                          '53831','20156','12854','47426','26624',
                          '91998','43138','35578','64776','28130',
                          '19860','45037','71277','22133','34505',
                          '22885','37014','39031','42040','70547',
                          '47714','29581','11995','72310','72823',
                          '56605','51628','37723','76039','13238',
                          '31654','81880','29331','33887','34829',
                          '32238','28204','12069','38040','94368',
                          '51696','91041','75289','45401','30176',
                          '20008','96204','45003','33986','41248',
                          '51743','31333','45273','31594','16558',
                          '97953','63545','96432','51626','22947',
                          '10159','79635','95352','52723','74736',
                          '96377','56570','55643','20994','76315',
                          '19778','33922','64273','42230','82528',
                          '52258','64242','18773','74539','90864',
                          '61491','66211','34889','19898','31833',
                          '47459','65873','95115','28833','47325',
                          '24424','87248','52309','47545','32231',
                          '49832','69287','15488','72926','31060',
                          '21880','40150','37624','98087','16739',
                          '98224','23462','14169','70409','60882',
                          '93257','44336','85808','11604','29870',
                          '15141','33583','76585','39513','66302',
                          '56915','80630','41094','86276','15246',
                          '20561','39436','14230','70647','25706',
                          '35248','79666','22219','90809','83164',
                          '32324','17087','28630','87052','19574',
                          '23022','67305','16641','21829','50401',
                          '86488','87820','87324','57233','53199',
                          '33699','14329','54928','62685','88522',
                          '71969','42562','77397','65845','44105',
                          '50596','16521','97743','84481','18998',
                          '38319','97997','60374','75957','80871',
                          '36839','85819','21817','41899','55648',
                          '70674','77048','17987','88856','48503',
                          '28668','70555','44481','71856','63933',
                          '42987','25495','48003','78988','15333',
                          '27489','59400','36804','59625','69717',
                          '52929','17151','23307','65915','49820',
                          '70406','17909','40789','98436','89229',
                          '87989','10028','68161','15410','10335',
                          '11637','54218','69751','14643','70529',
                          '39331','72789','10904','65708','51543',
                          '82412','42753','69731','55937','93867',
                          '11565','23876','41201','66146','96819',
                          '71273','81968','61207','93447','62829',
                          '58024','28794','60219','48924','55776',
                          '17974','15621','81539','33220','77976',
                          '64577','84302','34032','25330','88421',
                          '78584','72899','84634','86125','61792',
                          '73119','37794','58133','32693','14346',
                          '94878','41990','18249','14810','46238',
                          '28856','99963','27001','85117','20339',
                          '65893','13950','78824','52933','14138',
                          '11555','21388','36740','41978','35532',
                          '48543','25014','34365','21937','40837',
                          '75461','86172','29687','20255','88601',
                          '64224','18682','26159','47296','11007',
                          '80049','64802','42845','28068','89907',
                          '76841','31525','14729','20467','85023',
                          '23811','45683','22955','55395','73281',
                          '61786','61910','94671','33356','54963',
                          '17140','10793','60765','62170')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
