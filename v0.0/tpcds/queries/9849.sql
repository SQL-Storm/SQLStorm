
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '98847','35579','36103','13769','32645','92503',
                          '30767','93799','10488','30671','79955',
                          '31355','38238','19836','67023','25186',
                          '22911','29657','39388','37201','77660',
                          '93771','49710','12225','91261','70945',
                          '24340','62207','55912','23034','14279',
                          '19168','27045','50390','51334','88934',
                          '30812','21436','40897','64509','64825',
                          '32826','35927','40800','54015','71733',
                          '70469','30291','90380','73665','16208',
                          '19351','46736','46222','59273','21124',
                          '25072','19824','48171','21887','50768',
                          '26299','73305','37580','39990','91006',
                          '36531','94212','59840','14181','42072',
                          '90236','30089','93644','85418','95953',
                          '59985','73932','94166','43170','53919',
                          '70204','67239','36806','26786','22847',
                          '67885','49515','28606','77922','91707',
                          '50938','31498','11579','65912','60516',
                          '51011','13601','97089','10430','19573',
                          '97685','19314','67341','84555','92645',
                          '57186','78131','92891','51460','78506',
                          '43502','80966','11332','61730','27687',
                          '10256','63399','92894','38783','24435',
                          '15952','54543','43504','76461','62639',
                          '12338','44525','14589','16142','49027',
                          '81379','64576','52919','24786','19676',
                          '70772','92689','72104','29557','84120',
                          '59343','33904','83781','79043','18659',
                          '15243','34313','58651','16011','93346',
                          '99116','55375','20100','81222','25362',
                          '20028','44742','54292','84605','78595',
                          '87589','12638','85750','36231','43244',
                          '26986','79765','18355','24581','57528',
                          '42674','27631','70909','12718','57593',
                          '56481','25548','76370','96158','63703',
                          '80473','30282','80242','75839','17688',
                          '56023','53607','36855','96629','27136',
                          '57840','36265','27095','81099','40540',
                          '58002','41771','37374','93977','68008',
                          '41384','44740','30886','78770','66157',
                          '48278','33759','17066','54467','78899',
                          '58226','60571','83412','11860','49751',
                          '67533','76896','88720','95022','96893',
                          '19886','43628','54612','12215','56677',
                          '87380','93129','10376','12543','56323',
                          '71875','72225','14699','88050','14971',
                          '29921','62138','35081','15816','44810',
                          '76956','28347','50357','40101','72004',
                          '38790','80671','96963','87028','65606',
                          '50609','97057','25098','32296','74852',
                          '35334','26997','61466','58732','39696',
                          '82740','46065','49868','12899','25865',
                          '94807','44987','46847','56567','14868',
                          '97756','45052','94331','70481','65781',
                          '58279','98216','65580','59074','20016',
                          '62614','27510','10651','36545','53390',
                          '70786','22766','29985','55349','89217',
                          '39477','29663','85832','60657','15463',
                          '24431','54151','50682','78382','73545',
                          '84463','37705','99781','29384','52946',
                          '87871','11257','39237','74832','40099',
                          '27773','62372','85006','56288','31573',
                          '73101','71579','64244','60928','59500',
                          '49543','59320','28005','54626','70099',
                          '12547','20917','61800','60827','30750',
                          '52322','14603','11776','18275','85129',
                          '12494','49427','97944','76080','54966',
                          '29484','75066','59907','38568','34355',
                          '68681','38286','54946','96199','62375',
                          '89847','17055','69870','84952','61541',
                          '21389','13186','74513','17927','42702',
                          '80545','95044','14472','63837','32061',
                          '22373','12860','59460','14622','31183',
                          '28594','74354','58837','11733','10879',
                          '78743','32197','52299','20937','52742',
                          '45220','42321','42443','88473','22997',
                          '48466','30021','20399','76565','99843',
                          '31046','37975','66561','75050','63546',
                          '78903','78020','80167','85859')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
