
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '90983','55798','15914','30578','99893','82197',
                          '47697','12784','38662','83001','17041',
                          '48075','60848','47971','80490','97044',
                          '44987','56844','70118','42253','83300',
                          '49910','66441','85230','60710','44721',
                          '65351','94743','58891','83393','78016',
                          '30077','80793','94473','62267','61568',
                          '93798','13300','47589','13565','17797',
                          '51948','80543','20766','81842','39553',
                          '82658','83537','99945','15824','72443',
                          '50010','51591','68192','77946','87073',
                          '27559','95995','29111','68493','45433',
                          '46716','74109','88415','58020','92895',
                          '46141','58599','20044','23350','94067',
                          '78618','40135','13008','76093','19778',
                          '31458','60383','67460','54724','24847',
                          '95869','57865','21776','12816','99341',
                          '40501','61591','69600','75917','85702',
                          '24215','15520','10402','39928','27140',
                          '24012','77607','10275','39948','18904',
                          '91812','50210','56784','40197','20539',
                          '14073','97971','16952','17914','46381',
                          '85761','39165','65896','46931','70480',
                          '74736','17528','11561','69149','64774',
                          '75770','15666','10716','70490','89848',
                          '15883','64172','30689','16973','44972',
                          '39637','23696','37356','62571','29368',
                          '90669','23819','77519','33613','41402',
                          '16525','44711','14765','52256','51325',
                          '67818','76033','12999','50436','35061',
                          '93116','29679','82687','38805','37703',
                          '33830','24269','12477','91263','48272',
                          '30832','76492','86214','88596','11746',
                          '54395','86373','49854','57773','61506',
                          '10873','59510','27441','55503','43255',
                          '98123','65504','14037','31700','98312',
                          '57179','39652','38447','55136','94405',
                          '27791','40432','36722','16708','23449',
                          '68657','63480','88912','11081','56558',
                          '97806','20505','22895','87857','44209',
                          '18673','14264','33332','19112','38096',
                          '22797','76157','86651','33316','63983',
                          '11894','65138','23136','30719','42089',
                          '67867','43674','86565','30979','98978',
                          '48670','29049','27254','27611','37235',
                          '74170','99003','10623','30891','24984',
                          '12622','65620','28143','68127','41426',
                          '73374','22315','61689','50636','97169',
                          '73113','73380','19872','24279','71184',
                          '38462','53125','31436','13601','70067',
                          '21041','33831','48399','25028','76297',
                          '43582','21856','52006','44817','95874',
                          '49368','11777','51487','64803','42755',
                          '14219','12421','74007','37841','15680',
                          '76386','45294','81993','91901','66725',
                          '20511','51839','22582','12753','32340',
                          '11655','57672','12627','48946','30664',
                          '39727','31959','17405','54735','31794',
                          '51506','27620','70770','79954','14572',
                          '39371','86868','11272','64369','12105',
                          '14792','52266','77435','35566','30914',
                          '55299','44545','38737','71051','39545',
                          '90045','10545','21854','16919','53290',
                          '43165','55025','85858','58595','98765',
                          '55341','41543','81200','59875','24652',
                          '32700','96636','14945','41851','68497',
                          '37783','97958','69370','41794','21258',
                          '98019','13236','16912','34536','12898',
                          '43905','19468','69287','13455','59556',
                          '90543','59939','24934','59157','17294',
                          '89432','13904','32537','90303','19312',
                          '87504','38942','39241','98957','46711',
                          '82304','35941','53285','90101','21998',
                          '37144','84220','85755','60024','85936',
                          '32296','70393','61715','92400','66735',
                          '71249','20861','71398','12063','16657',
                          '61539','39283','66322','64843','70660',
                          '89254','33787','38502','18022','40475',
                          '39610','35438','53184','87101','34236',
                          '44213','53204','40206','45015')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
