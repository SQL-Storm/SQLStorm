
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '40093','71952','68175','40565','35344','19706',
                          '83273','31509','44714','45388','50328',
                          '57934','44987','19155','83119','18737',
                          '41068','85509','13082','16992','55576',
                          '78040','74831','62536','72121','14744',
                          '54315','99234','66680','69014','60052',
                          '64658','71652','74108','30891','16525',
                          '21009','32645','78749','21913','82608',
                          '69594','82231','58310','20470','34737',
                          '66082','33847','45709','87347','51041',
                          '48760','14463','57080','44578','90305',
                          '72141','53663','27272','75057','13389',
                          '92272','41184','54405','53702','16699',
                          '34092','46246','36510','38957','10585',
                          '56481','21677','21480','47049','29427',
                          '47472','62467','79497','99368','40879',
                          '59571','29579','81089','94027','29373',
                          '31771','57425','10347','15487','63931',
                          '39090','31273','37947','61827','21267',
                          '10355','93772','29452','16127','45311',
                          '56698','54387','13907','32747','15189',
                          '58366','30815','58120','69003','26178',
                          '39084','56727','39937','19971','75102',
                          '23842','33830','51351','76862','43519',
                          '15661','39856','44400','36990','30135',
                          '25842','76811','87687','22174','12141',
                          '21997','11279','43087','36904','68748',
                          '33643','21082','16727','40556','71548',
                          '57034','31435','36074','10305','62320',
                          '59267','89921','42092','83739','95599',
                          '13677','39824','85569','56733','51136',
                          '51519','75423','98464','80245','11567',
                          '32157','80781','48291','23950','93238',
                          '46473','89780','18824','57016','16671',
                          '35635','19868','45653','21295','80521',
                          '19226','93621','92344','37540','93611',
                          '60782','76163','16359','61255','40232',
                          '34332','21940','50308','63809','20087',
                          '75830','57133','58350','72448','16061',
                          '57710','93124','96115','39510','51869',
                          '11298','22127','62079','52545','43422',
                          '19598','43140','67269','18697','58722',
                          '38643','24254','18264','30716','24117',
                          '19290','59344','67424','48478','10822',
                          '53760','14253','12178','50378','21810',
                          '15150','28576','73884','67492','42150',
                          '11252','15717','66428','23026','35158',
                          '40706','28659','64493','36922','14928',
                          '57335','79101','31467','59354','35370',
                          '34230','19736','84175','85400','98069',
                          '68866','97254','49138','52590','81184',
                          '10308','17780','67215','86213','25439',
                          '48996','80076','90551','13904','53440',
                          '19191','79316','20745','48595','57672',
                          '90268','19287','77264','37414','30044',
                          '16186','70936','57166','85976','62472',
                          '50187','94376','79332','83097','57668',
                          '22623','30517','72077','16632','15556',
                          '95664','20116','37048','44969','56841',
                          '19433','45936','24934','34815','66515',
                          '58171','65788','12014','63480','49774',
                          '86128','58331','30900','16293','66842',
                          '61370','63930','20387','64199','24527',
                          '61909','36812','80144','45848','76574',
                          '40853','11238','23711','60071','36228',
                          '66311','38941','13709','10476','17029',
                          '79014','42764','31014','37720','13719',
                          '33800','38347','67995','38761','36244',
                          '62730','51437','26980','57720','40668',
                          '15832','91305','84221','83183','37126',
                          '99967','39474','52776','51537','82896',
                          '86917','78295','51536','57552','30796',
                          '19944','51956','35241','18731','32964',
                          '15445','41577','94598','56676','52235',
                          '16877','18052','23110','76584','36553',
                          '18041','53464','51284','39662','27415',
                          '76122','51286','50769','81495','29793',
                          '62578','40893','33757','18373','23879',
                          '25588','22019','79487','69509','17908',
                          '38449','72081','24947','98634')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
