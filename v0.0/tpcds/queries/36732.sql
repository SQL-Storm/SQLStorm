
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '53905','38813','70121','53130','31520','58974',
                          '28687','36187','21200','79489','25855',
                          '22750','35420','30781','64991','15667',
                          '10822','29040','69551','34045','16223',
                          '63871','15204','14224','70129','55217',
                          '82144','45668','15840','80600','17685',
                          '25588','73887','23137','34597','28683',
                          '50897','15946','30923','82999','49564',
                          '26810','38661','34568','92922','21835',
                          '54668','31620','22653','31241','61858',
                          '13711','30283','36141','59487','16176',
                          '43264','39784','95371','55013','13287',
                          '66657','71776','27646','58037','10422',
                          '95722','41516','59878','55767','98627',
                          '66588','49139','65003','59158','14635',
                          '41511','49452','26408','91591','18438',
                          '62465','30983','96714','32341','19181',
                          '25112','83827','59498','34801','91410',
                          '32095','84259','61773','11925','51691',
                          '17903','67041','11584','70403','14981',
                          '44875','84439','92373','99256','25248',
                          '86463','54685','81171','46515','67085',
                          '48752','41241','77828','81497','76632',
                          '39338','37167','17450','61519','51682',
                          '24340','33989','57220','19041','71785',
                          '17745','97434','15815','91262','32729',
                          '53272','38978','78843','30720','45232',
                          '33017','32776','52451','34970','46105',
                          '11310','27423','48449','49334','16080',
                          '57474','91639','90710','60442','60434',
                          '49857','43571','82788','35936','31621',
                          '57598','34048','78108','57794','67379',
                          '85018','89202','94417','35243','68950',
                          '63082','10005','98160','15659','97910',
                          '41533','59685','49172','27628','86908',
                          '38261','69892','54741','40994','23022',
                          '99010','83535','88859','96541','40179',
                          '73013','12745','71052','19035','55851',
                          '78248','29678','18537','56603','98201',
                          '96993','20226','48383','65853','21399',
                          '82964','33139','20508','48887','27879',
                          '24017','59436','76618','42009','83340',
                          '86529','10355','66445','96384','78258',
                          '89468','72083','18794','94820','12052',
                          '94055','48201','32196','42066','88810',
                          '21462','78762','56291','40516','52042',
                          '50960','14104','38682','35413','93885',
                          '29399','41323','47080','25960','16968',
                          '28438','54996','16344','49561','20935',
                          '37539','11508','99949','96677','25604',
                          '70605','27178','65914','82554','68438',
                          '54644','35352','74394','24885','49838',
                          '43907','96154','59058','76446','17874',
                          '61561','18001','21086','71697','79930',
                          '66504','25475','46829','72971','34745',
                          '64899','50868','19805','42775','34812',
                          '97656','66419','32527','26868','60102',
                          '30408','36747','14329','44877','11693',
                          '68592','55322','33561','28404','45481',
                          '50208','37010','74096','27018','27162',
                          '83012','17632','95179','33917','56554',
                          '39934','51856','23381','93894','26199',
                          '22230','36923','48882','78182','31685',
                          '43754','34935','87051','66770','43197',
                          '11003','49980','84660','39033','83374',
                          '15461','48117','55584','46527','81811',
                          '75177','11581','80084','33060','58435',
                          '93896','92690','57446','99885','32306',
                          '22956','97655','27236','77363','60741',
                          '36921','15489','20251','47300','43561',
                          '46431','82552','43774','31168','59551',
                          '43081','94923','43964','96770','81687',
                          '10708','78277','46514','21336','70673',
                          '16543','11709','46787','51992','11435',
                          '10982','28158','65132','50490','30460',
                          '10536','10462','36641','22776','11158',
                          '25292','44093','28827','22521','52369',
                          '75538','62046','36244','56783','86621',
                          '79593','85011','24280','60395','59091',
                          '14507','80509','61974','80904')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
