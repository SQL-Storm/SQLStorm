
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '64706','23987','14195','85142','23507','48373',
                          '23970','76688','99909','52440','17425',
                          '49350','39200','34228','15452','57231',
                          '19881','41565','40502','38213','20883',
                          '88733','82024','86282','35965','36167',
                          '81089','72096','21062','96092','93439',
                          '48088','81234','37853','82246','73886',
                          '63674','26404','37362','21152','88016',
                          '77396','98196','99888','51245','41532',
                          '77201','36430','11637','42784','12729',
                          '41285','62472','80039','18890','47649',
                          '41946','39668','28859','21892','10808',
                          '72514','45058','59583','38321','83006',
                          '22579','16086','59878','95868','92231',
                          '41876','71632','79718','25437','91162',
                          '27268','32191','25544','20032','21813',
                          '18453','10620','58713','41953','57531',
                          '25783','58060','83010','19289','71904',
                          '73173','91697','69879','87503','33763',
                          '28132','65351','25818','49473','81439',
                          '69492','74682','66020','87415','99884',
                          '22503','24044','96425','28514','96402',
                          '18036','24012','13246','12247','14160',
                          '78206','72647','91260','24356','87246',
                          '81978','12260','15969','77246','70120',
                          '93085','40263','13648','31525','15751',
                          '16324','59621','40154','26838','11408',
                          '39334','92694','34968','43715','74262',
                          '91552','39473','27800','36371','51200',
                          '89300','50402','31567','63864','17264',
                          '41070','93821','18767','34112','14745',
                          '22224','22417','99340','86104','10841',
                          '76805','95900','13916','48391','37156',
                          '32263','19669','86814','22008','41102',
                          '17640','28739','28441','90394','52327',
                          '77682','55180','60248','31205','89969',
                          '70412','74792','11795','22460','39230',
                          '97730','50624','35156','86823','60575',
                          '82837','37561','51546','92742','40727',
                          '23251','36848','72556','40818','18873',
                          '28274','71216','59269','90641','87129',
                          '10915','32468','43993','74982','24447',
                          '61931','64994','66261','80368','95546',
                          '30075','90986','37621','90204','58180',
                          '95950','23238','65914','61944','47544',
                          '63452','66053','18438','48717','89651',
                          '27521','37569','79549','39359','28027',
                          '36326','64467','11460','22810','45079',
                          '41188','83881','26920','90962','55551',
                          '33003','66463','33197','79474','26241',
                          '71624','33336','48036','12639','21903',
                          '95302','71957','32244','85467','39505',
                          '22455','50590','93813','98700','33730',
                          '80109','39594','84055','78166','33537',
                          '18565','22068','37958','39284','22082',
                          '81466','41569','70208','70136','87861',
                          '42768','16877','77652','19783','17106',
                          '48381','81797','12600','60087','68961',
                          '30714','54851','85758','32584','15481',
                          '57306','85930','29609','28962','12637',
                          '32881','12225','72319','42069','89167',
                          '28892','39159','38160','36012','74865',
                          '11263','54702','22630','37049','14530',
                          '39251','11828','71074','94406','80627',
                          '76227','19764','71458','26234','73212',
                          '78742','72685','70102','22236','33127',
                          '86476','30819','82687','52292','52799',
                          '11360','30120','56966','70140','77744',
                          '72288','60711','83265','81285','78522',
                          '11399','32917','73109','25290','72715',
                          '83598','59753','98888','21066','64604',
                          '52747','96169','27473','24727','94074',
                          '56989','19322','27430','48178','15882',
                          '85801','73351','14551','42592','36052',
                          '11456','30747','28216','23628','84203',
                          '32754','99105','58736','32529','99510',
                          '61215','78057','67907','17070','92006',
                          '20337','83117','93087','33588','46181',
                          '73785','49717','53000','73231','21930',
                          '40611','20239','27920','93200')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
