
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '47313','26681','31924','44772','30924','16552',
                          '33705','15828','93453','83843','85444',
                          '25014','66477','12574','16805','27981',
                          '74092','24515','97240','37715','31402',
                          '27971','82373','27302','49313','57059',
                          '67456','41601','35729','68047','83977',
                          '61201','27884','30151','43613','52936',
                          '31148','80072','55083','44910','58697',
                          '68507','36955','46402','99021','22453',
                          '21813','16245','40454','58818','35469',
                          '21974','14974','60498','73163','16667',
                          '31463','39012','77195','85750','59152',
                          '87382','13703','36006','58379','30085',
                          '51780','35713','61194','72840','50760',
                          '12180','69088','79278','74773','24744',
                          '91961','21727','26135','88376','60231',
                          '28488','54255','16586','27220','11710',
                          '77596','32199','63627','65882','59917',
                          '78217','11574','66725','38504','86317',
                          '11147','63555','92909','12482','83124',
                          '88853','35142','42503','94631','61094',
                          '18050','70590','97947','35466','42007',
                          '13821','81043','24677','77994','34334',
                          '34049','89234','61832','84833','37994',
                          '19506','22071','55023','40311','18453',
                          '74731','14166','73346','10145','89451',
                          '88959','70508','17054','44407','66155',
                          '65857','34951','17213','19548','91303',
                          '28313','78546','15720','94151','78460',
                          '32873','24691','76257','81419','31192',
                          '73164','32238','23166','52686','95338',
                          '41352','49115','39074','22283','39189',
                          '44500','16842','80847','80512','94182',
                          '70359','74261','11202','73483','23693',
                          '31600','33304','23951','41771','89623',
                          '21357','65964','73175','44568','12163',
                          '57440','79295','41765','10881','52537',
                          '62063','95182','98044','99620','46129',
                          '79202','85049','62675','72704','78043',
                          '46900','12831','26944','18389','57420',
                          '84888','87823','16135','89655','32807',
                          '10639','81293','16020','43659','41060',
                          '59689','36331','30366','20991','30363',
                          '76828','53791','10490','72196','10774',
                          '35692','36557','37923','44464','94252',
                          '23633','38030','21281','58566','73650',
                          '17337','58216','88759','63162','13244',
                          '92994','29378','90087','76408','48775',
                          '77816','30187','56254','83985','30773',
                          '57288','54111','57656','74147','16439',
                          '55447','39568','99846','81641','40361',
                          '51720','39967','42325','76805','27430',
                          '36486','40616','63228','56071','37332',
                          '38192','74799','27136','11871','22925',
                          '36583','22420','86129','63689','82263',
                          '26890','35017','36918','72299','34731',
                          '61808','23030','64256','44342','42840',
                          '76530','11996','85211','55926','73185',
                          '94846','61781','32810','27329','75596',
                          '25939','62662','39270','37627','40125',
                          '96964','86001','37092','34113','30524',
                          '14518','78799','83059','95919','37164',
                          '52567','29696','66245','80236','13041',
                          '72981','13050','17281','62848','95510',
                          '14962','25438','64974','28536','56987',
                          '85001','35758','34980','92009','20994',
                          '38213','45988','15678','40005','40707',
                          '67582','56855','43794','14324','97490',
                          '55910','63298','81516','48667','11566',
                          '56169','63785','15641','39272','54998',
                          '87218','14018','12366','10929','14957',
                          '26213','63423','28841','12553','34295',
                          '42149','68163','74849','86085','47592',
                          '33376','89541','58454','22118','72481',
                          '57882','86759','16979','11563','18279',
                          '43413','32569','95744','45531','16733',
                          '44740','28374','58317','57821','89437',
                          '78265','32805','99314','75578','39009',
                          '25290','25770','38228','18354','86667',
                          '28053','59423','17425','78731')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
