
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '11417','51188','76975','97679','11428','92147',
                          '52910','85729','35213','32331','86772',
                          '93132','51527','42291','26326','55174',
                          '40492','17161','88669','35762','51799',
                          '74060','57434','35184','92648','91468',
                          '64246','11116','70994','69009','10455',
                          '11653','35386','68955','26174','11904',
                          '78318','13952','83836','36442','26687',
                          '53075','48227','64187','26701','58932',
                          '33498','13974','11973','39944','75385',
                          '28321','46890','92451','62514','67541',
                          '60065','47558','10172','12047','97183',
                          '62625','30631','12658','50072','95345',
                          '17360','79092','18449','19574','90441',
                          '71297','29505','37959','13731','27282',
                          '61141','87041','53580','87122','10501',
                          '31316','66761','59620','18136','84717',
                          '23824','20158','41245','16585','14171',
                          '65447','82088','94894','13607','87261',
                          '68386','52482','17913','42046','43157',
                          '44719','68814','43152','20654','40972',
                          '12725','65267','49535','75320','60019',
                          '75682','11346','98853','16148','88363',
                          '80504','55344','87138','66267','35429',
                          '37690','39445','90499','94273','68355',
                          '91253','91372','25371','88988','16481',
                          '52911','73360','33807','33139','40080',
                          '45731','21796','41432','55093','69429',
                          '44511','22816','25215','58200','73239',
                          '86010','73240','44533','35198','73137',
                          '35314','48108','22926','65410','77581',
                          '10364','86592','12963','85043','10346',
                          '83623','41275','44651','60042','84742',
                          '81606','10499','71601','32927','42230',
                          '29827','86333','91795','66538','55555',
                          '17496','90734','30815','47989','31014',
                          '17363','79317','57691','76529','28909',
                          '46947','37330','14034','88205','21618',
                          '73036','68427','87796','29122','92408',
                          '67222','71778','99583','21584','96126',
                          '51582','54582','26849','19940','69819',
                          '93110','14063','76919','10505','21615',
                          '50890','25152','27058','72349','69696',
                          '73257','21054','43808','20135','36859',
                          '76786','94030','99147','55785','37170',
                          '52105','21076','46482','56039','76048',
                          '64402','50706','87218','27154','47332',
                          '26166','40561','72124','30437','78043',
                          '25240','72918','32083','67140','40791',
                          '21675','69938','39504','31275','34172',
                          '37993','64024','42838','41872','96835',
                          '49257','46606','54515','77880','82964',
                          '20604','41928','51513','89869','36921',
                          '60633','65818','54731','85108','38436',
                          '57945','45065','51428','44785','62472',
                          '14696','27776','58380','24799','74921',
                          '40096','40137','97487','95281','59544',
                          '34508','19325','96014','24948','15042',
                          '81333','14491','15545','38211','12634',
                          '19761','50711','87802','63588','72600',
                          '19190','53740','86669','59324','51419',
                          '66754','69847','45281','42219','42937',
                          '39939','80139','53703','16026','23869',
                          '40396','30086','30770','72712','95546',
                          '25472','63603','77812','41756','84528',
                          '13126','76845','52204','12268','88822',
                          '44319','79626','96518','70728','11797',
                          '85928','33433','78652','71346','17967',
                          '62103','32871','56265','95369','67503',
                          '40725','94454','22895','27714','92033',
                          '60753','60476','49160','62848','51909',
                          '73839','90230','32658','72017','48720',
                          '98014','67579','80089','42342','26581',
                          '51665','20319','78103','35067','38419',
                          '66490','56438','94274','11195','13726',
                          '52308','62813','43494','15521','20007',
                          '64837','20617','26096','97082','94569',
                          '47468','48313','54044','21357','22580',
                          '36715','32379','55767','23874','55681',
                          '23463','63203','61220','25483')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
