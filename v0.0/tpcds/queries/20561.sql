
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '24490','75981','39645','93579','10524','27162',
                          '11631','89388','42443','48740','50462',
                          '47083','71387','84344','44992','26819',
                          '73718','14719','48366','17256','34018',
                          '19853','28095','78340','63461','66382',
                          '77309','53293','36490','14303','78028',
                          '92149','30409','64514','19155','87180',
                          '54873','14626','40766','73422','29884',
                          '36361','67105','28163','72143','83634',
                          '67329','13849','56224','23345','85076',
                          '20977','31839','58243','18296','91420',
                          '70911','41625','32485','71002','28771',
                          '27293','97203','32603','21762','20340',
                          '33103','74823','14693','74529','23698',
                          '17595','80715','13186','28682','13657',
                          '36375','28758','72875','29162','18772',
                          '39424','45467','43330','68504','40947',
                          '22535','23861','36200','43938','72453',
                          '79181','23509','90374','32978','78270',
                          '21166','61354','88911','22660','92303',
                          '72403','31359','14743','99166','56675',
                          '52946','78369','80625','24021','15713',
                          '54242','15786','26145','21858','50744',
                          '96557','89622','62202','84783','22025',
                          '49661','61944','81683','80121','44398',
                          '38022','81926','31367','42872','41749',
                          '32937','67782','67240','40120','68722',
                          '21606','45275','14090','65184','42658',
                          '48928','18554','89680','37743','73764',
                          '67813','65042','90862','51463','49846',
                          '94553','86336','21618','16923','91856',
                          '21957','51595','31155','34409','22060',
                          '15023','70943','46135','13888','46122',
                          '29425','56292','11017','44208','60027',
                          '93423','31642','51128','15187','48004',
                          '77805','43313','61134','91369','12223',
                          '11575','83155','63456','68442','40564',
                          '16018','52710','78741','62976','16145',
                          '56548','95556','76438','70205','61822',
                          '70204','76583','94381','91598','77870',
                          '61903','28664','21535','20671','27885',
                          '15077','51882','45298','22346','14175',
                          '62112','42830','42765','31110','50990',
                          '61480','24749','34232','55834','83567',
                          '80894','90540','38108','26503','44235',
                          '46309','40440','50141','21358','28320',
                          '47370','18292','14675','14532','33432',
                          '90655','22708','64270','98257','95677',
                          '60867','34420','67170','39785','51821',
                          '90366','29184','41093','77920','85057',
                          '27101','31156','74193','49318','76535',
                          '52926','14108','56176','98024','29422',
                          '10923','52660','37822','90328','91597',
                          '27604','51508','48610','47561','81447',
                          '62775','18593','27341','32694','71093',
                          '54052','48670','19623','97731','51643',
                          '97056','28106','29899','65301','71411',
                          '21866','24752','45487','21634','45630',
                          '61006','64758','72483','57652','13883',
                          '19191','49545','41311','76932','83355',
                          '56018','18550','43117','18165','69034',
                          '61570','40928','52991','86866','22338',
                          '10061','56424','75104','33116','24290',
                          '43021','36465','73912','81509','13445',
                          '36113','64533','93480','13440','38372',
                          '29757','94964','70357','48569','49330',
                          '56856','72180','85812','77595','14018',
                          '39827','83916','42302','27881','16513',
                          '57169','23847','26659','31049','18865',
                          '21138','41554','33313','42154','62237',
                          '29574','80326','33424','38131','14652',
                          '21065','21084','60754','65417','33687',
                          '17556','60501','24755','50828','39156',
                          '78517','97206','25379','15495','49412',
                          '33207','24421','18619','15630','13846',
                          '26690','24299','50669','41362','53824',
                          '20498','64452','70377','33102','26969',
                          '83049','32474','50797','84417','13819',
                          '85433','16839','73586','45400','99660',
                          '52352','26859','52239','12401')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
