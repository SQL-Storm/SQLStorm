
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '67935','87434','87388','40607','71355','97532',
                          '15379','46020','18036','51972','75203',
                          '43955','73947','89134','73174','56105',
                          '71215','57946','64829','57646','69978',
                          '23976','68406','19007','67325','48298',
                          '62648','16287','63605','15296','13186',
                          '58420','50584','31651','29910','99265',
                          '43913','81099','12757','68585','98894',
                          '13748','34034','26396','10496','48419',
                          '19724','83799','86949','41028','38877',
                          '21871','61092','25585','38772','33745',
                          '81479','43450','50362','70653','77169',
                          '70290','76823','32075','26718','11919',
                          '29083','17158','32944','24596','23219',
                          '51773','25263','51230','17883','21331',
                          '23700','33626','55489','60006','64396',
                          '12683','20815','37657','32777','58816',
                          '12593','89591','37369','38918','26870',
                          '43978','76907','93073','24878','32297',
                          '57663','10944','27390','20688','80548',
                          '49726','89225','63319','31103','90477',
                          '68247','11867','92606','29690','43159',
                          '30897','23644','92790','51241','17984',
                          '11026','17211','24604','39568','81537',
                          '78728','89129','11300','96530','79637',
                          '85370','62212','16409','50730','82458',
                          '34222','34945','93249','24863','66333',
                          '10545','91778','91669','13181','26543',
                          '74142','50322','77279','90408','15320',
                          '51885','81517','85516','46102','35950',
                          '75332','77540','79232','47125','49747',
                          '71573','57026','86721','13332','64654',
                          '85152','38466','12336','66294','10024',
                          '59953','29416','82281','73597','16720',
                          '71419','31481','98289','37176','98411',
                          '20760','74926','31048','81480','39981',
                          '47347','55660','72725','73026','64507',
                          '12141','57332','68424','47376','16198',
                          '94214','30817','88973','40507','99171',
                          '64612','88082','96632','47826','45524',
                          '78663','60087','26774','71029','89334',
                          '15567','26797','51242','23007','30165',
                          '81275','91957','92633','13835','54818',
                          '63726','13134','43547','76380','25583',
                          '22542','50347','88415','63062','59995',
                          '98138','40815','28026','48445','84878',
                          '58131','13227','25239','34765','35409',
                          '66651','27650','63895','57939','84088',
                          '95232','67122','83965','69695','33859',
                          '37566','87410','42134','13092','11274',
                          '66435','91366','37042','60992','34219',
                          '41672','40104','50700','16818','11553',
                          '20984','49384','17879','50073','65560',
                          '50965','52882','80690','20826','93038',
                          '67110','77463','95798','19828','16890',
                          '69263','92224','20767','47184','32485',
                          '57988','19130','10055','88006','36551',
                          '11061','11484','16660','60261','65473',
                          '39148','38757','74047','39318','81022',
                          '37361','76829','27695','92778','14841',
                          '25930','37549','82911','80462','30041',
                          '14770','12298','51677','41657','65124',
                          '37108','75935','63115','60656','18859',
                          '44311','76321','23124','24766','15604',
                          '10384','52710','17855','56914','33700',
                          '13890','49025','43355','44558','14407',
                          '54416','74107','13760','10968','93612',
                          '45139','21093','27898','95092','28265',
                          '42839','55292','43145','46782','76473',
                          '95838','78650','47304','16140','39646',
                          '19896','12687','28404','52688','38051',
                          '44316','14250','31662','75155','12551',
                          '80903','62899','12796','22878','22608',
                          '94766','73255','57127','74463','22753',
                          '76640','28283','31111','35609','51015',
                          '51322','62607','29262','30182','15390',
                          '19969','56707','16065','83405','67295',
                          '41827','90892','94365','46658','36269',
                          '60651','88305','76559','62924','45873',
                          '29426','30063','60839','73589')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
