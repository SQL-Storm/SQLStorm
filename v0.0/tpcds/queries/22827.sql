
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '13387','44380','31353','23056','34978','32616',
                          '44182','13897','91234','30056','85249',
                          '75720','88063','97962','61812','13649',
                          '68830','71165','87700','56754','66238',
                          '55672','58038','70671','33795','91413',
                          '57558','48773','25127','38982','91005',
                          '68901','40032','34933','99405','19287',
                          '33692','73768','13841','87954','84314',
                          '99125','22946','41798','60801','38458',
                          '59701','19606','33473','17327','42985',
                          '21167','44763','74454','66978','16009',
                          '38907','25166','49094','43753','31471',
                          '70057','15395','42365','20892','16866',
                          '80720','29944','12469','82940','50680',
                          '64195','18141','87347','95594','32500',
                          '11949','66058','52739','29925','17586',
                          '57897','36057','62913','56912','54124',
                          '23946','56922','81456','76517','21714',
                          '72045','40025','34322','22454','31589',
                          '43524','52804','28330','27680','13673',
                          '82634','34147','69483','15535','70902',
                          '58875','36714','36432','47252','63463',
                          '87075','95860','10096','45117','38414',
                          '52163','59438','47156','45417','85542',
                          '80218','83953','66974','78746','44097',
                          '24449','14607','35504','50142','15137',
                          '48798','81941','26117','32422','80948',
                          '27871','16359','45548','50050','27425',
                          '14528','27796','48423','87668','13764',
                          '51076','22974','76163','11298','77606',
                          '90162','23333','23626','37582','24107',
                          '19887','16742','39606','71548','34172',
                          '57260','19795','23026','44438','86413',
                          '13416','81904','46030','68999','47873',
                          '15348','60366','69733','11343','11462',
                          '50714','95255','44825','52240','40531',
                          '81703','97467','29136','95857','10830',
                          '15625','87302','21295','74468','20266',
                          '79413','13065','42407','27613','16974',
                          '91452','42560','26323','61122','36804',
                          '26589','28767','37753','37356','95417',
                          '69366','52785','54307','82506','76318',
                          '53423','39180','60968','48275','68967',
                          '18675','29318','43233','12307','67565',
                          '73964','49444','64624','56018','42770',
                          '18876','44773','17704','69772','38239',
                          '35189','65384','57074','11480','73307',
                          '45654','34188','45693','98790','71873',
                          '83686','57998','93785','12071','92581',
                          '35678','25544','45159','73211','90954',
                          '66604','81943','95937','60074','27069',
                          '23709','29316','43571','25743','50663',
                          '91425','31904','60767','62163','28632',
                          '95317','39012','78347','69374','40221',
                          '97776','24882','56822','95006','37565',
                          '35661','88205','48859','97299','63593',
                          '22085','40091','55850','26498','53332',
                          '75456','74962','91854','26984','35563',
                          '27546','96987','63990','37143','72130',
                          '96252','55883','60995','95338','25851',
                          '61687','89979','25770','60971','22621',
                          '34405','77957','58663','31130','30484',
                          '26894','34228','19770','19570','27044',
                          '33808','11709','85826','56329','13992',
                          '11072','25621','16648','45167','39635',
                          '29354','75669','44125','24795','12796',
                          '12597','24096','82483','59075','75848',
                          '14066','62365','57837','70443','80187',
                          '19764','16895','15291','46746','27780',
                          '91897','28942','61187','68383','25763',
                          '62740','17597','81912','13495','26063',
                          '65321','96359','81891','63021','56571',
                          '95840','55222','61732','31420','67616',
                          '70615','11731','60921','27701','56350',
                          '93350','84506','65417','44982','45799',
                          '54331','25635','89055','61695','87848',
                          '80169','95991','30949','43750','62446',
                          '47212','13988','33306','23950','42156',
                          '66386','24576','62983','57701','93826',
                          '15844','10920','35893','92180')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
