
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '44847','27101','86449','74698','14272','17165',
                          '35535','20062','52213','50447','93307',
                          '49734','17781','58581','70469','35743',
                          '74045','46783','36576','98354','33660',
                          '47723','49531','70314','75134','91593',
                          '21797','24095','64881','59397','36168',
                          '71348','19200','30922','30092','44121',
                          '22387','97221','64673','65313','17391',
                          '62644','45886','34293','14055','93814',
                          '71466','75231','73851','43652','28889',
                          '40910','31025','53082','19710','49538',
                          '84053','78518','16577','73091','20976',
                          '30483','39484','31396','11476','21295',
                          '19007','89691','35457','48335','20046',
                          '72423','37797','55069','19267','71323',
                          '78829','34352','94654','33065','14838',
                          '44989','34469','55207','79345','39153',
                          '17990','65660','61060','51489','53471',
                          '74528','16413','96817','45000','77554',
                          '71980','37536','28613','45909','25311',
                          '96355','18660','10232','62751','67778',
                          '23007','95857','69050','39879','46943',
                          '41278','59487','96411','88563','76334',
                          '61151','34539','58416','23203','48614',
                          '61698','14021','21104','23624','59516',
                          '39430','57068','25530','31331','19599',
                          '41464','92529','41943','28107','83370',
                          '53436','79123','78938','84191','76163',
                          '33099','20072','16211','33428','31429',
                          '62425','12415','26505','11770','57362',
                          '41418','26451','89252','48797','93037',
                          '53297','73501','48529','47711','54237',
                          '86703','27877','38987','50400','93881',
                          '78708','80736','19880','27078','48508',
                          '42808','37134','58002','62274','65716',
                          '47120','38597','64720','57709','73130',
                          '80789','28546','15716','50523','64127',
                          '64880','10432','30031','11239','96192',
                          '54693','92422','56254','36432','46001',
                          '98979','86539','89600','73125','73759',
                          '66872','55750','10966','14034','30732',
                          '87373','54307','68557','63728','35529',
                          '98494','26520','19778','93079','11106',
                          '52947','45025','62073','30808','96723',
                          '43836','10696','21703','69842','15743',
                          '35527','73211','16034','34433','34731',
                          '43374','15659','76450','41444','58814',
                          '37378','74794','82429','22666','86913',
                          '33543','10372','56899','37576','58412',
                          '11126','65296','90877','68777','63577',
                          '36956','14811','95636','81432','39997',
                          '80934','48768','18419','94431','40206',
                          '45187','62460','47053','72162','87255',
                          '37361','19827','43018','67023','52128',
                          '67470','97394','82755','17919','24930',
                          '61719','23371','35105','34375','39884',
                          '80497','26932','42165','22208','33367',
                          '38008','32462','46855','55665','15775',
                          '25968','18500','36681','43443','72275',
                          '39003','80677','36569','66321','74158',
                          '68357','61390','32197','58349','80668',
                          '17283','67215','40955','82117','66517',
                          '61407','57104','33786','43871','55541',
                          '96437','99173','47419','38677','66668',
                          '24353','89232','82692','42723','88458',
                          '13259','22146','34530','96768','11820',
                          '38533','81311','13134','28096','76998',
                          '97050','48863','13370','89576','63723',
                          '26715','38659','49288','53631','59156',
                          '42052','45158','22134','23072','60777',
                          '51708','62258','86369','60597','86547',
                          '89574','26998','73827','25729','17608',
                          '80669','18084','31861','27194','43647',
                          '62302','30785','71520','18786','38513',
                          '36177','10640','90293','36097','43497',
                          '92786','87928','24704','29009','58286',
                          '37093','69451','11103','65361','37403',
                          '80162','15280','70302','27679','16970',
                          '53737','90907','75994','29803','49632',
                          '50699','43469','89087','53824')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
