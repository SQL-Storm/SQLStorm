
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '18958','40507','27216','16713','31326','82491',
                          '20462','20217','52437','52217','98966',
                          '32928','84763','65820','98044','87157',
                          '58782','93795','38482','48060','48259',
                          '40269','51127','23958','17249','30807',
                          '16630','87812','48037','15953','49662',
                          '44590','77383','40443','36556','40376',
                          '92039','83217','50008','75180','10807',
                          '99738','13197','40890','79849','10654',
                          '66078','45716','38674','25758','39522',
                          '52007','17566','80168','34897','81837',
                          '10345','80263','39089','60619','92144',
                          '49370','24132','17223','94185','86337',
                          '64144','39469','20980','13781','67894',
                          '70290','12481','42298','16668','93891',
                          '60605','52721','70494','43239','41235',
                          '49171','51985','69865','58220','58486',
                          '11391','82778','92855','78573','64278',
                          '44275','34290','21492','61370','77462',
                          '26239','37729','45339','55228','12234',
                          '63759','27860','23715','66978','32172',
                          '20213','44373','19390','21771','14316',
                          '27594','60994','86767','87075','44089',
                          '22907','36356','55567','90400','82818',
                          '29704','30702','36479','36458','74813',
                          '18250','12704','23342','77186','39304',
                          '57474','13027','75177','24959','32110',
                          '55925','27160','20125','50635','49427',
                          '72210','43362','52443','40924','33975',
                          '23247','19019','40745','60268','79194',
                          '23497','86931','65910','88334','86745',
                          '34951','54345','61838','19406','20691',
                          '47751','76957','31954','23570','32179',
                          '11636','38553','15635','29887','36960',
                          '11658','17488','14186','45639','72430',
                          '34600','11874','61365','80546','24984',
                          '44003','85975','13454','10472','46739',
                          '39468','49222','59564','61280','96531',
                          '26474','51933','27214','83458','71332',
                          '76238','65565','79252','14826','55074',
                          '33247','87429','75618','66315','64139',
                          '20663','80024','88123','63855','36271',
                          '36416','18483','38621','10225','82507',
                          '33740','17927','23926','95528','90975',
                          '85465','48819','67635','57605','66172',
                          '63011','10214','26586','31544','91737',
                          '88439','55977','25968','25146','35882',
                          '58260','16788','28109','67356','57419',
                          '19733','11531','23594','96450','49666',
                          '57410','14593','62020','16486','42057',
                          '89196','90094','47251','11929','31601',
                          '32769','53053','12866','12521','53847',
                          '34462','13132','50104','58421','49641',
                          '59727','18805','23683','19467','45952',
                          '34277','97987','71156','24862','77338',
                          '47086','65735','34805','16997','50704',
                          '12405','70909','60663','54474','26795',
                          '16914','69439','70082','10032','43569',
                          '19009','35264','86509','14843','40208',
                          '63553','35417','80354','33260','54291',
                          '42176','49077','93782','57456','64080',
                          '25654','71336','24196','63132','31874',
                          '80193','85524','98960','53730','82926',
                          '63853','63852','54986','64309','74452',
                          '28686','23824','14714','27952','65052',
                          '79478','76188','18085','58940','28158',
                          '30870','81170','55906','42449','15849',
                          '88452','51332','19334','13638','17949',
                          '91611','89876','52796','16326','81526',
                          '45365','29865','99946','41221','46636',
                          '19168','64920','88572','86414','14120',
                          '75081','41349','18646','82283','56910',
                          '64412','32943','26143','16285','45174',
                          '62000','39010','24067','83652','99668',
                          '90657','11860','43590','46005','15512',
                          '91623','47265','49776','83240','92590',
                          '41190','50425','83093','33802','84240',
                          '37166','20867','32841','39951','36490',
                          '19916','23676','69208','20672','11189',
                          '43375','41576','91841','13552')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
