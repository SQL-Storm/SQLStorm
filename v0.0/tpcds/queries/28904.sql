
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '29153','44352','86938','14476','35769','15898',
                          '62797','27125','83754','36434','79000',
                          '38637','65731','57168','25014','44829',
                          '33012','65075','47976','67522','24921',
                          '43116','86648','34471','45049','12328',
                          '62687','55833','62248','20013','70457',
                          '67381','73274','10960','30872','25336',
                          '53951','46914','71112','29428','28520',
                          '26521','55868','38906','29559','84118',
                          '73779','28285','78516','18758','40135',
                          '73656','72681','70277','48364','40070',
                          '79470','89411','55804','55287','84867',
                          '69386','41091','77160','80391','90216',
                          '23322','45493','32031','46826','46198',
                          '80582','42067','94499','40366','94472',
                          '96170','40966','73920','46891','88060',
                          '13922','62365','30592','46519','88596',
                          '18412','90242','49680','48079','17699',
                          '16386','93638','58092','54955','17368',
                          '99030','10971','85765','10017','28857',
                          '56174','84875','49642','29726','37076',
                          '97958','60866','44535','52886','22293',
                          '79848','72260','55088','16236','52986',
                          '35081','98802','37202','48289','12113',
                          '46187','98677','37229','81149','93075',
                          '31608','79688','61471','21542','77642',
                          '19755','64526','19103','85417','29389',
                          '20555','21176','36242','54863','61548',
                          '32813','23945','53137','71942','23774',
                          '83493','54762','15379','12099','43303',
                          '54087','85377','25652','49551','18622',
                          '10075','19478','32626','93719','97789',
                          '63626','25514','35825','79447','77680',
                          '69398','42066','34978','78385','57081',
                          '89626','94255','19709','69630','16987',
                          '47463','41922','75011','24757','68273',
                          '26643','60288','51482','23867','29867',
                          '44642','32059','17719','72505','48613',
                          '30371','34538','63811','68177','22678',
                          '14970','14677','72001','25951','29010',
                          '60315','50567','36606','39221','24359',
                          '65652','78828','44378','19583','56861',
                          '16234','80549','26042','45239','56007',
                          '66524','69335','16394','75813','14461',
                          '65871','88863','30168','68739','33045',
                          '59775','45668','65267','63169','26331',
                          '87797','31496','46686','50530','71709',
                          '97654','73243','53238','81208','91264',
                          '71386','90306','94834','42167','23660',
                          '93982','96189','61540','57410','33683',
                          '94750','19891','32103','49036','14683',
                          '50173','24364','95378','69577','48592',
                          '26658','58702','70422','28176','22599',
                          '54467','79055','80833','88201','46813',
                          '10509','32807','50989','10750','48290',
                          '49789','29725','13729','37363','41235',
                          '69128','24895','21599','57811','60008',
                          '17522','60819','60099','27035','81485',
                          '14637','74554','30538','31236','15275',
                          '58037','29836','54530','45555','22450',
                          '98512','58479','28122','20082','38540',
                          '61137','15134','65578','96052','31570',
                          '62952','16768','75327','30974','41316',
                          '33911','30120','76235','10988','78181',
                          '60207','41663','46617','35398','25468',
                          '28954','17925','20938','13372','23794',
                          '21602','34429','11999','59228','23646',
                          '93219','60808','89797','62096','57088',
                          '44662','62937','24887','30280','36261',
                          '73880','31326','45917','99290','37345',
                          '46286','14754','16316','36482','93142',
                          '29603','89496','87937','67607','12030',
                          '25956','54190','55916','82657','12502',
                          '37263','89597','55378','76336','15201',
                          '38210','92752','68915','38038','15185',
                          '61672','57852','86190','26490','36233',
                          '91434','68926','42315','32747','24273',
                          '61925','33285','44465','53085','58290',
                          '45550','74073','63818','45129','16231',
                          '89823','39080','78998','67518')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
