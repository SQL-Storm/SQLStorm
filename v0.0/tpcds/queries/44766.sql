
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '20314','29342','49845','90723','95692','58287',
                          '26030','38790','16578','32684','68621',
                          '62157','42292','33870','42766','61433',
                          '48759','16352','33619','98345','52583',
                          '30067','63979','54793','32306','66250',
                          '41593','49817','87869','27352','22305',
                          '43653','12973','59283','87339','43236',
                          '61696','91394','38848','14705','21603',
                          '19952','74889','25379','72014','21485',
                          '97313','79229','28292','65584','25503',
                          '29405','57181','95748','50479','85048',
                          '49099','35973','95163','90647','97414',
                          '14740','30777','65970','67369','36558',
                          '46535','31422','28862','73267','66845',
                          '45149','42344','10997','42217','83432',
                          '10085','29634','24668','51181','92723',
                          '17776','23769','67850','12608','90732',
                          '59769','29076','11137','43721','20129',
                          '51244','83931','84322','92810','21739',
                          '30221','90924','70005','29323','81069',
                          '30466','18604','23443','33572','33805',
                          '49347','50636','56146','66770','69040',
                          '78751','94054','40663','96593','59990',
                          '10241','17254','36927','14146','30815',
                          '78970','68527','41683','61213','73582',
                          '12944','72335','41309','89576','68493',
                          '36085','74286','68521','33145','39417',
                          '53545','12386','22618','31671','81699',
                          '45827','32724','50394','50366','58091',
                          '13088','25016','80518','33528','35732',
                          '49270','50790','26363','78339','66813',
                          '87268','91647','70814','32859','92929',
                          '63027','49677','79169','17412','21705',
                          '67072','32256','99470','13513','31379',
                          '51595','24465','77667','31209','18487',
                          '17005','49767','39744','36031','50282',
                          '89652','41116','20312','92173','67365',
                          '66200','61997','54290','82207','33926',
                          '99779','25032','66348','52821','23085',
                          '86842','97770','40102','72327','97775',
                          '49301','34030','88689','73822','98322',
                          '26759','16240','29034','88538','19436',
                          '56396','28135','22534','17748','32881',
                          '52176','25223','27498','41483','15386',
                          '17361','71191','32641','45440','59058',
                          '37526','14341','87955','55521','43909',
                          '43208','54043','80032','32853','36787',
                          '16724','36972','54884','50837','15003',
                          '44632','12989','26209','30383','74886',
                          '12988','48627','66429','67390','18304',
                          '36870','16857','91413','21295','24860',
                          '71754','36014','14295','11096','23325',
                          '93324','12911','46847','62074','84565',
                          '78815','93312','88279','63734','13747',
                          '21025','34260','47739','84281','90085',
                          '48238','23704','25335','60199','73647',
                          '13934','16106','83915','99705','77307',
                          '34922','72561','19907','63798','78762',
                          '47084','61972','70041','14536','87366',
                          '88208','82835','65723','23549','10591',
                          '33168','53840','65643','47369','90549',
                          '46696','26740','32233','71713','11662',
                          '45695','82324','41620','53223','39065',
                          '20921','77283','24232','14728','61660',
                          '34389','11046','56409','81489','88188',
                          '91453','58912','10792','24161','46761',
                          '32529','56657','59637','27871','59961',
                          '51016','69913','35279','98418','51816',
                          '65513','79331','33931','45103','83077',
                          '52855','88516','34216','30624','29821',
                          '31740','21601','64276','27409','26474',
                          '65818','26049','12733','42332','84608',
                          '71454','38589','75455','89166','31722',
                          '70424','13523','94593','35698','94750',
                          '38530','25405','16225','56545','27587',
                          '10529','91605','10600','96713','85306',
                          '91385','41214','22019','58027','47443',
                          '41660','52474','40279','50250','39561',
                          '35148','42321','69513','47825','78865',
                          '31114','78451','76801','53126')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
