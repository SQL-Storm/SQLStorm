
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '36675','50036','95028','61660','34474','79332',
                          '43442','71053','84664','72601','97539',
                          '22563','17761','84551','49396','53478',
                          '13687','47672','19325','43075','59025',
                          '99833','19193','33819','48508','36498',
                          '24584','36877','62776','74253','69363',
                          '52660','25207','77601','99028','22247',
                          '68035','94305','82260','20133','56155',
                          '22054','43121','78930','84446','48694',
                          '14812','89060','26914','51042','95330',
                          '73746','13950','53808','85079','32916',
                          '97701','67234','74110','19738','39270',
                          '49054','84520','52439','73509','86825',
                          '53389','22012','89542','35567','83962',
                          '13215','28161','64600','79303','76277',
                          '24918','35039','69464','97223','11064',
                          '63225','31237','15977','62936','97368',
                          '18593','12123','63432','75973','50999',
                          '13455','98630','92045','84866','36224',
                          '45219','24135','94144','38413','95657',
                          '33806','75085','64024','27435','43502',
                          '48227','10913','30674','12086','14435',
                          '17571','21842','11453','72272','10715',
                          '24370','86524','40328','60309','56072',
                          '61263','40902','60436','15472','69183',
                          '72603','78410','33625','27388','62731',
                          '79216','41870','40099','77797','38147',
                          '74767','34600','43511','38560','55333',
                          '34440','50712','23902','55735','53469',
                          '71043','25726','32395','64158','70972',
                          '81473','57100','16623','75344','19404',
                          '66079','75966','72093','55617','11030',
                          '11082','47922','49130','36052','39848',
                          '31223','27837','11801','50354','20155',
                          '60181','53424','11363','78866','55860',
                          '65043','87352','27794','59141','34689',
                          '57471','40838','27082','32272','74888',
                          '51217','42426','36690','69339','55421',
                          '61712','15203','52474','11497','94482',
                          '34972','24284','24741','70387','21309',
                          '25915','65844','25802','53799','82080',
                          '66503','72100','86086','55502','37121',
                          '87524','56604','95148','30659','37648',
                          '52186','48487','70056','48090','62484',
                          '71695','38971','23151','43440','72661',
                          '49446','63281','34138','41159','42954',
                          '37846','14422','15396','69188','90564',
                          '21796','86267','36467','98286','92909',
                          '81933','90137','37932','78785','45979',
                          '34823','42682','10941','17799','23383',
                          '13901','71982','87776','85669','12824',
                          '12961','13501','59109','78664','17562',
                          '65577','28425','13954','38997','50746',
                          '11889','80891','61832','84675','27770',
                          '71672','19535','36333','64135','76005',
                          '73325','96445','42729','63806','45204',
                          '96030','69718','69478','46554','43422',
                          '47472','76211','88981','25546','18614',
                          '32055','10452','93981','77233','14671',
                          '63014','16880','57120','65614','47373',
                          '51080','39970','28515','82999','25643',
                          '89874','30135','26548','35327','59689',
                          '97261','48240','73291','75005','16581',
                          '34542','53496','41453','87947','39615',
                          '74415','32172','37987','76789','87751',
                          '67674','66394','85332','78750','10394',
                          '80746','47653','77960','35738','11375',
                          '70525','34195','33566','31674','81610',
                          '33050','37325','55129','83292','22081',
                          '18536','39179','15866','24417','32589',
                          '95877','35550','66319','27564','90433',
                          '78131','80626','34217','69532','96285',
                          '68332','10210','18368','62689','58644',
                          '34766','49171','70305','71209','10648',
                          '85223','53416','62784','97153','14682',
                          '34613','26047','22253','39542','38436',
                          '13014','12577','12900','97410','62383',
                          '51447','30368','17715','28917','76224',
                          '58632','75342','58637','68848','27981',
                          '23380','85704','90820','81890')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
