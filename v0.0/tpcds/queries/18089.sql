
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '53778','98134','58865','60037','38794','99186',
                          '42355','98163','20111','62896','73467',
                          '76360','82063','97651','46987','79732',
                          '45305','10923','19535','70080','20845',
                          '29739','13106','37963','55987','57541',
                          '63271','56675','33477','57495','54197',
                          '31976','80393','87323','85409','49671',
                          '20481','48314','41535','56722','56031',
                          '26207','24701','45837','83596','13199',
                          '48254','19982','12775','21774','52656',
                          '55025','24831','56998','78170','44930',
                          '68682','51976','71927','85803','65253',
                          '48295','69086','17609','24775','60773',
                          '21376','97818','13110','89002','27055',
                          '47309','90304','67360','96700','45462',
                          '61756','13034','12080','40084','92635',
                          '67785','42316','92357','37414','26333',
                          '91595','36124','18402','10515','25376',
                          '63444','74924','38925','88784','96420',
                          '40186','31601','48052','27317','90959',
                          '82031','10172','34080','67444','35627',
                          '13724','62938','37605','16260','50640',
                          '85891','83280','11883','74031','40638',
                          '75239','49153','51501','52388','10319',
                          '97728','44576','12998','33747','83187',
                          '59538','60206','10114','82625','66517',
                          '75343','21114','24558','17172','42799',
                          '12212','20900','80358','99653','39656',
                          '63932','26917','48735','76565','45452',
                          '76921','46410','71106','75979','70433',
                          '35202','83237','64561','70330','22104',
                          '24566','60434','89614','41845','70059',
                          '33753','18677','51286','56071','16613',
                          '39950','75836','74680','42179','64287',
                          '21450','91779','82285','68607','87311',
                          '88685','58798','59854','62192','36760',
                          '83847','11941','47912','93606','83777',
                          '32257','76754','52704','63819','42683',
                          '43000','15701','15266','82465','44188',
                          '33055','89599','54673','75430','27939',
                          '10713','83881','74440','44843','89754',
                          '21380','90737','15100','77194','62077',
                          '46946','76948','17469','59507','82876',
                          '24790','41583','55622','13109','72326',
                          '75486','34258','75729','33363','41181',
                          '51173','25203','92965','76417','37433',
                          '13364','12948','29766','99160','62675',
                          '99993','21472','31050','77305','76280',
                          '79360','19958','50613','42968','34732',
                          '37557','19048','81143','62276','86784',
                          '39449','17962','81620','66934','91045',
                          '20275','42935','73108','90188','16511',
                          '45898','28857','17403','45197','78960',
                          '39272','47857','87292','81453','24273',
                          '25780','60727','14606','35392','28679',
                          '20178','21365','22129','45506','41013',
                          '33880','35259','58540','83859','16514',
                          '71146','86016','48333','14847','65183',
                          '43494','33270','12099','38635','46890',
                          '30986','67953','89325','10893','96929',
                          '53134','62086','29656','60750','96383',
                          '46657','61539','65410','59994','98297',
                          '48185','32751','68961','23037','19798',
                          '35693','52877','25480','49350','32580',
                          '20690','17324','24594','64990','16220',
                          '65602','73513','17418','96162','94139',
                          '12904','88774','47957','22750','51618',
                          '28633','13817','42956','43854','57008',
                          '34272','92795','92456','21180','40629',
                          '83599','71633','17616','73151','52373',
                          '69917','21295','79924','19508','68119',
                          '60879','32976','85629','27514','15247',
                          '56292','91972','46027','96693','51328',
                          '62299','40780','58227','17649','96287',
                          '75147','29014','39414','91772','60846',
                          '71087','72475','52644','16811','86252',
                          '44666','96409','36338','10621','60907',
                          '86790','72469','72228','22285','33182',
                          '81760','55520','39393','81081','69350',
                          '65524','39232','76521','10544')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
