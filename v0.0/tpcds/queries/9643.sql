
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '35566','36412','17273','81710','83533','38605',
                          '35250','18413','66628','29733','65435',
                          '79238','56692','53427','93786','27931',
                          '95028','56841','68680','24496','36636',
                          '22204','35328','45557','46325','65577',
                          '68031','61340','49532','57841','63734',
                          '79330','65945','76301','35892','59341',
                          '94827','16905','37113','13733','24034',
                          '82049','84356','45651','28053','73500',
                          '74876','28258','22478','24211','87247',
                          '81037','70326','48871','42673','28206',
                          '57142','85848','14731','52535','20182',
                          '32908','26776','43779','44304','58512',
                          '26793','44565','12669','42955','59448',
                          '67479','76201','88680','33324','29287',
                          '15810','52604','55249','85721','59754',
                          '69180','31888','30288','36253','31862',
                          '73379','59591','81749','42702','29727',
                          '95656','10492','37183','41498','22118',
                          '57744','25484','87356','46827','52834',
                          '59132','83245','57930','20778','75274',
                          '62368','24341','95995','26861','85770',
                          '72407','20452','78831','34550','41496',
                          '28775','67555','34579','15205','72421',
                          '30199','34664','33133','86475','15257',
                          '67143','22894','98558','12084','61981',
                          '99392','94939','23668','96411','80976',
                          '54603','81287','10412','63779','68145',
                          '34110','47061','83016','75423','79999',
                          '42987','77324','74397','50474','39226',
                          '32605','55442','42927','24150','78858',
                          '78829','81830','75025','26264','55665',
                          '21468','74685','69591','62757','91312',
                          '31402','74386','94514','69723','60156',
                          '36105','38555','87148','97769','31653',
                          '92228','34235','69980','99627','50049',
                          '28374','91286','26984','26294','31129',
                          '92868','37869','16950','10733','45298',
                          '94313','17429','16468','82912','19192',
                          '54852','24567','78570','32801','14754',
                          '19150','10948','48572','21748','45848',
                          '10862','49608','73626','26709','18042',
                          '64256','12091','44049','44058','15967',
                          '11101','42392','26758','60422','23327',
                          '25830','23202','20963','76713','79431',
                          '50540','10995','45961','37469','47122',
                          '23795','39804','74928','30247','87917',
                          '49640','23854','59494','35626','98513',
                          '18075','12851','94301','42480','66257',
                          '84999','15237','73832','22360','38148',
                          '66638','83484','18232','34633','88379',
                          '64344','21888','84085','40180','46506',
                          '13332','20565','61258','54468','10722',
                          '24217','20964','43508','58013','59951',
                          '81097','72552','84280','71024','14301',
                          '63207','83375','38574','54048','16281',
                          '34558','68482','39852','28898','24054',
                          '86527','85536','13231','43579','98909',
                          '37891','52046','58851','27484','93630',
                          '87484','26786','14725','33412','40902',
                          '54522','37944','49801','95645','27068',
                          '52969','68634','20679','57817','93135',
                          '44618','63739','50787','58571','88520',
                          '27525','73252','81545','86671','31504',
                          '45413','83594','65902','13020','57045',
                          '53766','47913','55487','72825','19951',
                          '64264','32384','18493','61735','20132',
                          '99204','58070','43866','77066','23067',
                          '34877','50073','25240','36539','70808',
                          '57556','86603','87916','63503','99578',
                          '59514','19389','16273','23496','51466',
                          '44465','14964','73169','64063','85796',
                          '18611','21496','54922','30468','85474',
                          '26216','66166','47303','10357','22808',
                          '29242','42249','71474','71548','66625',
                          '69096','74194','46638','11951','17398',
                          '52090','81760','36097','15568','29790',
                          '64405','29648','57842','83793','34486',
                          '19534','47075','97743','14148','30070',
                          '24553','28303','90289','61895')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
