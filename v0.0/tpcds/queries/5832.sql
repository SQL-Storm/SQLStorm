
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '42160','72270','13294','66204','63719','61108',
                          '26242','36183','84111','11851','12292',
                          '58119','20249','37708','68568','17814',
                          '49665','67837','20091','37401','18771',
                          '45651','85065','79054','18911','62709',
                          '42517','10888','22023','19920','35469',
                          '70789','86877','13236','42729','60939',
                          '86219','24023','76163','56286','73948',
                          '18557','93091','54036','99627','17552',
                          '80947','36740','75718','60822','18645',
                          '17604','46532','76570','24727','19356',
                          '92170','70680','49693','63397','56221',
                          '74131','69620','75653','65766','18092',
                          '42007','66577','30891','48975','53727',
                          '20203','15399','49026','10374','59789',
                          '95177','48490','37635','40193','73467',
                          '81664','19560','47132','39099','14103',
                          '86558','90425','68761','64366','57868',
                          '67660','23449','39479','46025','18520',
                          '57976','20576','40560','84989','86063',
                          '35308','78348','82020','30291','27086',
                          '92078','63602','86327','69369','52359',
                          '86545','51222','58117','86227','90037',
                          '39611','41010','61442','90972','56460',
                          '39551','18028','40444','60947','58357',
                          '10478','76913','12295','99362','67887',
                          '31867','22949','88160','89759','38047',
                          '40410','60971','18182','26598','12927',
                          '53357','87128','25609','28258','49345',
                          '40704','43554','30484','67040','67693',
                          '70036','90820','41419','91556','13865',
                          '92022','10342','85667','61842','22402',
                          '27931','50168','41276','79729','17116',
                          '74081','34284','38202','53537','19025',
                          '17878','68825','90371','45439','17141',
                          '50615','66846','28729','12842','31083',
                          '59033','64659','60203','67278','70252',
                          '14474','35938','90236','18172','85282',
                          '86190','51523','88883','43811','50273',
                          '87411','36497','21270','89575','98239',
                          '16392','54153','14687','56655','82141',
                          '72750','93062','68883','62610','67845',
                          '13337','79799','84168','26148','46904',
                          '72535','74875','41688','32203','73760',
                          '35939','42664','96213','80867','21425',
                          '69639','60165','17785','57565','26674',
                          '27617','16502','80978','13902','26633',
                          '19155','97443','62388','21950','31402',
                          '11319','92842','21616','28991','93205',
                          '54690','81199','10202','42699','90771',
                          '11731','26255','38917','59689','12832',
                          '68452','54790','11833','53493','39729',
                          '75591','65134','18599','14945','85696',
                          '95577','38281','71128','65123','43769',
                          '95409','25569','94219','17037','61429',
                          '75941','77345','78696','30431','66712',
                          '92544','60908','55662','71471','31724',
                          '28899','67108','86230','71262','74997',
                          '28552','77069','42991','85078','61224',
                          '67320','28950','25520','65184','40853',
                          '88790','28424','58142','28110','96856',
                          '31787','49440','12537','29918','90780',
                          '52270','21818','45602','32868','94740',
                          '54442','53952','23395','42681','35686',
                          '46433','28597','37996','29836','61004',
                          '53452','52496','43494','92045','81278',
                          '24387','54012','90796','10651','91721',
                          '59469','54719','44465','66342','13439',
                          '22978','89001','91515','14356','56818',
                          '57358','54983','52265','12058','41161',
                          '40376','22665','63158','48682','50842',
                          '40917','24982','55156','94909','20489',
                          '55063','70912','36075','33215','52242',
                          '47150','56112','67798','22903','29489',
                          '64637','53298','30548','44397','55303',
                          '38683','91730','77647','77145','49730',
                          '86115','23566','42620','74693','35403',
                          '19992','12224','89323','19583','37205',
                          '56445','45950','41710','29201','49322',
                          '77257','84017','11890','34163')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
