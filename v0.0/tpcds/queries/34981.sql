
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '19311','48802','17610','36172','39768','13355',
                          '12772','14560','26361','45575','24001',
                          '29889','94595','62039','30137','83514',
                          '25842','29625','38683','49941','63725',
                          '21471','18284','65679','53236','11434',
                          '61171','31431','50096','26886','35123',
                          '10226','78230','60850','53727','20923',
                          '11427','53853','83442','61775','56554',
                          '53472','22347','78978','62725','25102',
                          '22541','22618','87839','22213','16653',
                          '57038','75266','33155','19853','57778',
                          '76339','20255','97457','37780','99181',
                          '21972','51415','12389','25323','45379',
                          '14820','20046','46248','10428','20273',
                          '35949','21997','18367','78408','42508',
                          '21455','16400','11428','32616','23866',
                          '50165','82320','83855','82208','39421',
                          '49364','91403','17904','66260','75063',
                          '66675','24080','25100','95634','71893',
                          '35668','47854','99996','19617','52259',
                          '24560','78615','96064','37564','43489',
                          '60807','50132','68908','55942','33458',
                          '72621','24115','51634','61605','73296',
                          '81297','40639','29754','52683','98580',
                          '86995','43513','40484','13370','58639',
                          '63380','90450','43765','78821','47103',
                          '93793','40072','38120','20644','69588',
                          '11400','37706','52336','24791','63107',
                          '76357','20094','63820','92546','54571',
                          '20506','42038','54218','35528','13299',
                          '46749','12880','10375','29301','89331',
                          '16923','30315','18178','44965','43739',
                          '40279','31919','12605','75056','78395',
                          '30210','32048','56651','52716','57623',
                          '96442','84642','84795','25276','28865',
                          '73349','80637','55581','56799','13886',
                          '38046','29496','42331','35524','13321',
                          '43479','45652','34212','82588','91445',
                          '28903','32621','81134','80670','27339',
                          '49943','85337','10131','66269','28790',
                          '40826','29168','76202','91140','81784',
                          '12707','29845','56453','70546','17017',
                          '63225','80278','17381','15863','19535',
                          '89393','25362','23264','27907','33286',
                          '11492','42280','88366','81460','10485',
                          '57229','37011','62113','85611','53113',
                          '65012','88175','83249','79606','73708',
                          '78837','22169','92064','68616','20655',
                          '93400','59402','57697','31238','54095',
                          '33472','80037','30775','25083','17635',
                          '75071','93976','28396','53620','14106',
                          '15534','45891','37852','47810','46521',
                          '78009','14464','17338','99651','16289',
                          '31300','11038','77471','25890','15590',
                          '72691','57640','59858','88987','89281',
                          '11386','34234','30379','44659','28063',
                          '24174','43931','77528','49853','19606',
                          '83113','53449','16659','67549','12480',
                          '60299','23555','44573','39063','42917',
                          '82039','30429','48065','12674','17829',
                          '15500','52831','45797','10271','58263',
                          '87709','47921','65628','32172','29849',
                          '68167','27826','69023','94459','43445',
                          '96504','48531','67028','55647','20390',
                          '45949','56240','61280','30433','99065',
                          '22617','68991','41372','11192','69215',
                          '24522','57136','31515','81553','16769',
                          '20198','91223','35982','19004','81125',
                          '35651','24268','20726','59514','11231',
                          '21884','11547','23707','42874','58250',
                          '24534','46777','68699','81639','72221',
                          '39657','82633','21990','15964','27804',
                          '23524','19994','58091','96729','26327',
                          '74878','11073','73554','43909','61445',
                          '60029','36359','27006','83567','69168',
                          '97560','90504','77883','10571','45526',
                          '50293','76203','87415','85908','38049',
                          '47913','74464','35732','34543','24221',
                          '13506','38181','11690','49927','34989',
                          '88986','59880','71535','29519')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
