
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '79556','29925','24820','56685','87508','86028',
                          '65077','49050','26256','21904','42960',
                          '10795','17846','93122','50413','28043',
                          '13375','16215','56490','74247','36311',
                          '33304','50086','70329','57231','17405',
                          '28496','30934','58773','57941','74286',
                          '86898','82821','24766','15071','27082',
                          '71361','27207','79059','74569','57426',
                          '48375','49334','42064','19477','45360',
                          '53320','77411','80200','30954','55327',
                          '45516','65962','79880','99478','37718',
                          '41703','81706','69340','74412','58458',
                          '97812','21564','56810','41712','43611',
                          '31548','21169','39657','38607','16825',
                          '55480','25087','38242','62750','28103',
                          '60107','16613','58386','43076','26752',
                          '26834','12435','47996','71991','22711',
                          '66025','77626','56287','59923','47440',
                          '20690','87637','90542','33193','40127',
                          '60349','21939','16112','82140','98823',
                          '56101','54020','55443','24547','60115',
                          '72115','24017','85460','40126','62602',
                          '68682','55139','35669','22940','26022',
                          '64196','22261','76191','82389','21252',
                          '13007','82960','75265','80839','15474',
                          '60868','61041','51709','62570','67366',
                          '75599','55198','82077','44535','10492',
                          '77588','72911','24575','70840','77364',
                          '68079','61382','17869','75718','50739',
                          '18763','60822','15161','97471','12587',
                          '47314','53886','56317','66132','29416',
                          '53047','93578','57463','37191','63488',
                          '34062','80542','14065','37815','30793',
                          '99591','80381','75131','63315','84950',
                          '56180','17217','78573','34005','32403',
                          '69771','32152','37526','31230','93206',
                          '99080','12542','76960','22305','82245',
                          '26463','12297','12127','84609','68550',
                          '40751','48068','32161','70947','31470',
                          '11152','18723','86899','67919','60451',
                          '35527','96670','36280','60873','89873',
                          '68809','62430','14787','17856','11332',
                          '40098','97933','17690','83387','43416',
                          '49298','54741','62070','48680','94765',
                          '43081','24343','11343','36474','59789',
                          '21621','94125','12305','65699','43903',
                          '18292','38627','24908','89280','75026',
                          '16362','52876','30697','23084','45869',
                          '77302','86352','39592','33775','79613',
                          '66774','52038','30920','77689','12117',
                          '76345','66632','26784','30953','87598',
                          '65130','15458','11735','60373','53174',
                          '39674','82047','21134','40113','57086',
                          '21310','62261','25572','85367','97654',
                          '28427','63058','82655','41568','24053',
                          '61419','21780','68160','83997','12019',
                          '83983','46025','32368','44973','75170',
                          '40041','98415','38449','83193','10149',
                          '43075','31732','40149','80941','27190',
                          '15148','92307','35052','86401','85299',
                          '72721','38801','62829','58462','90566',
                          '89904','78514','42441','36272','78691',
                          '27637','43170','73448','32495','61835',
                          '12933','54626','83508','17210','59972',
                          '63602','32099','16692','80357','85716',
                          '11352','37445','20480','56074','16086',
                          '59512','64740','92809','71849','33275',
                          '91835','36984','54591','11730','38946',
                          '48932','67001','87249','39457','85525',
                          '76374','91217','10129','53583','35742',
                          '25513','92073','38106','48661','55230',
                          '19102','24423','28261','94959','35831',
                          '55187','32874','26917','22003','19215',
                          '76576','63173','23315','32807','68465',
                          '24458','14847','18505','35895','43413',
                          '12055','87894','85877','45824','27638',
                          '48584','34586','51864','30430','77481',
                          '91962','36066','37512','35591','22352',
                          '62423','11829','97414','30724','70894',
                          '65577','12787','39118','88840')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
