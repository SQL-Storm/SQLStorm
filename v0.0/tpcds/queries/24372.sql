
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '50834','28172','39873','73574','16768','72090',
                          '31837','37155','38230','33031','11890',
                          '71394','88356','61953','16766','84567',
                          '50467','40953','99985','44097','57444',
                          '56583','35034','45055','99557','88306',
                          '91016','72924','10927','34332','59408',
                          '89825','19218','14402','23407','38195',
                          '54267','52393','17948','51396','30102',
                          '67428','11322','55628','77604','44240',
                          '32459','72882','38772','46852','21324',
                          '46790','84852','15179','62393','88186',
                          '43348','33012','73206','53069','17932',
                          '41091','43672','59663','47831','71574',
                          '46258','52811','16604','34317','71374',
                          '96651','71275','60382','14797','34353',
                          '36643','26953','35822','45365','48078',
                          '15289','56905','72283','37062','37251',
                          '29719','21541','42815','49918','73861',
                          '28571','99839','75559','76108','81868',
                          '13204','22429','92697','97961','95937',
                          '14024','60479','46767','13777','43957',
                          '89065','49220','41882','90196','66689',
                          '98464','94468','93904','34571','57420',
                          '74958','22704','43577','73157','20288',
                          '17030','25034','70046','45205','32955',
                          '51632','11585','38412','40502','39489',
                          '97902','63336','44749','27589','25666',
                          '30281','74158','53072','40136','50924',
                          '65009','53252','83404','13498','97577',
                          '40687','25777','15336','20209','68429',
                          '65685','27652','65716','68534','36508',
                          '48197','29745','76163','58608','50703',
                          '24930','22481','22612','42253','73522',
                          '52019','73185','14564','13273','47469',
                          '18127','26095','68135','43787','96424',
                          '53966','12144','34515','86834','37475',
                          '74223','34333','64584','36652','35660',
                          '57192','86426','95455','16897','14894',
                          '10508','23463','81153','23410','70852',
                          '24972','49202','40056','25426','22399',
                          '42147','94274','60401','14399','42037',
                          '15889','71127','64015','31599','59142',
                          '69349','70059','37322','64121','82678',
                          '23699','47821','89173','28779','16510',
                          '18432','10658','42344','48363','91415',
                          '95400','13980','72175','72429','66305',
                          '60585','69597','15555','14474','28443',
                          '59159','83887','21042','37401','25172',
                          '15299','76826','15352','69064','31843',
                          '67640','21129','24999','67644','91021',
                          '87388','75858','55807','31314','42555',
                          '33713','97754','88945','23530','72641',
                          '20921','66201','91283','64302','54977',
                          '94514','14773','90287','33954','32420',
                          '24808','24242','28926','92814','13943',
                          '84569','60782','87651','24329','73863',
                          '39070','53926','85257','41649','14131',
                          '30862','88162','77173','28047','81164',
                          '19989','16603','24854','38046','12535',
                          '84140','33786','81410','10462','53879',
                          '82774','89149','79696','29281','47576',
                          '47263','47772','69560','18807','97386',
                          '57805','44976','78694','11990','97018',
                          '99218','29316','43850','56466','14573',
                          '44142','89239','25033','11772','29026',
                          '36371','46647','49732','93917','65697',
                          '96733','83824','39437','51162','39969',
                          '19436','42600','50983','43667','47895',
                          '79506','42664','75063','11515','71380',
                          '71827','66016','58300','78466','52431',
                          '28658','96592','32757','10864','75436',
                          '87946','12008','68084','48489','30143',
                          '13686','65376','50259','44041','82816',
                          '10121','54316','92087','67754','37324',
                          '74848','63426','46364','21691','57848',
                          '41500','90410','64272','14075','55830',
                          '40927','61666','34465','81931','13868',
                          '57667','37700','12448','32577','19216',
                          '23389','24367','48135','76183','23598',
                          '58726','75184','74363','78800')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
