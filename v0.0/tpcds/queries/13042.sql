
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '15392','20121','54333','15282','18936','65320',
                          '29989','51098','95674','52092','33255',
                          '15117','30736','79666','98609','22478',
                          '77366','12808','49308','51330','78600',
                          '82020','38128','23023','61154','28020',
                          '39601','97352','72434','31061','48266',
                          '24067','65223','20465','32675','82272',
                          '56582','28365','34948','19858','48529',
                          '70340','22091','58786','22041','16385',
                          '10744','35132','73092','52157','20541',
                          '27907','94534','14364','15336','82037',
                          '85049','24314','89296','64889','30339',
                          '15626','19260','54908','83525','11701',
                          '90109','58251','31670','37888','93568',
                          '52031','34030','26416','66471','14473',
                          '90304','33670','72606','41550','41610',
                          '12924','94608','89687','69591','56854',
                          '19950','85402','76129','57291','11773',
                          '11392','98218','15211','49534','24839',
                          '47205','58826','39279','36908','30550',
                          '55388','59678','14130','22081','38974',
                          '74571','58752','77073','46509','12880',
                          '58631','63602','43889','77655','36576',
                          '50253','94361','44937','99057','40357',
                          '39427','82283','80862','13286','94949',
                          '66219','87041','57292','88320','16810',
                          '42969','54008','10925','38539','28322',
                          '72773','52606','38284','76097','89941',
                          '13198','42898','11668','41496','24264',
                          '75586','16602','36412','19187','13936',
                          '78591','24402','10943','96796','42576',
                          '17835','88349','66392','52913','71006',
                          '48517','64757','96528','49707','11060',
                          '12377','22804','49424','13733','45702',
                          '67564','37063','50785','85570','15487',
                          '92687','86278','60272','17200','35936',
                          '59444','28173','36963','33511','46184',
                          '37566','92121','17985','65509','73947',
                          '26208','44048','37925','46963','34791',
                          '73650','91589','92647','48546','15289',
                          '35349','97521','61156','20752','13140',
                          '27349','42246','41382','86293','77438',
                          '67136','27423','82501','33275','91109',
                          '73642','95259','83502','71237','31581',
                          '37116','44244','41858','67067','20083',
                          '84158','28786','42579','66711','87786',
                          '39575','58400','14526','48706','50589',
                          '52661','60370','32251','44791','27711',
                          '40282','77623','48004','81155','86878',
                          '73939','53751','11212','67225','55091',
                          '57130','26246','67462','56955','65533',
                          '24149','17750','93107','66704','80756',
                          '11667','23468','53852','90481','77212',
                          '55111','86461','56197','46482','94805',
                          '76945','57823','45294','63048','96495',
                          '22069','52425','53605','79710','16642',
                          '60278','75865','22718','71183','41423',
                          '23275','49077','87691','45498','57890',
                          '71783','97715','10304','89897','63967',
                          '11006','13713','43337','51522','71399',
                          '50372','22063','26482','75460','70864',
                          '10868','91306','10463','48108','11617',
                          '28274','97519','45225','99427','78570',
                          '85196','12722','39901','96897','86636',
                          '65478','17834','66896','35454','89274',
                          '29972','10936','41853','73181','87533',
                          '31452','70888','54361','12763','35856',
                          '98413','17758','35378','72282','32052',
                          '26415','13356','78846','61017','41069',
                          '45729','42208','88073','32759','90642',
                          '55534','93408','88293','40226','21702',
                          '99559','48356','56698','14684','56497',
                          '78619','81723','28645','76148','30464',
                          '51392','62835','60763','29210','95143',
                          '56348','76752','97493','49226','40578',
                          '26594','87994','65427','65553','92390',
                          '97836','71265','18725','37972','94994',
                          '10980','46566','81541','92771','83090',
                          '62305','11659','37674','96650','66679',
                          '77184','81797','38506','34660')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
