
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '90218','38835','20673','16287','65147','19916',
                          '44940','72261','90005','63834','23485',
                          '31417','76499','48274','69962','79054',
                          '16294','58490','75497','61405','13388',
                          '91460','54992','85918','93051','68513',
                          '34080','89285','26226','98237','94742',
                          '74530','13681','67687','80318','51330',
                          '62201','31267','79137','68983','27559',
                          '72674','55277','21909','83498','74374',
                          '81310','54319','17594','38530','12466',
                          '57286','72310','32698','63286','13238',
                          '59534','62833','17993','91366','72932',
                          '77871','38669','72658','36940','13658',
                          '35239','33482','53592','83000','93069',
                          '46549','52590','96377','90796','68369',
                          '29907','44388','62505','64347','90319',
                          '20844','92881','45055','44161','47413',
                          '60252','65778','17311','34212','45757',
                          '63576','47948','72492','65838','60882',
                          '44283','11604','49018','76585','68834',
                          '21918','19791','11465','95723','48120',
                          '55511','92470','10040','21312','29232',
                          '98408','95832','77395','95541','53199',
                          '62943','15926','71969','17479','37773',
                          '69138','26860','87658','60374','27540',
                          '69762','76407','84768','23795','35019',
                          '53593','80751','42987','90061','78896',
                          '53977','36139','16768','23307','80214',
                          '33907','98436','25643','50706','60859',
                          '63817','96346','15710','12321','15334',
                          '21523','26475','46064','61604','21749',
                          '34163','40140','51895','33332','66877',
                          '24543','98459','67445','34032','10382',
                          '34871','30680','26704','58133','40184',
                          '17435','43939','41572','13451','90899',
                          '73926','36284','67962','46740','66024',
                          '88505','23098','75461','25133','58370',
                          '90163','62832','65861','51955','60543',
                          '39626','68992','65843','79349','63820',
                          '34768','85529','17140','33157','81789',
                          '20058','39935','55945','44962','46329',
                          '45632','28329','65369','14741','14756',
                          '10848','12208','16110','11353','26660',
                          '26982','20609','38583','40113','11120',
                          '19405','60717','12754','17520','14568',
                          '53075','90734','90486','70784','97338',
                          '17580','40615','39052','12376','91085',
                          '45656','30341','70603','48609','23146',
                          '27122','84446','98872','73475','33509',
                          '51247','63508','99849','72218','45436',
                          '23420','75776','88299','30444','25177',
                          '27531','38211','33196','80305','62752',
                          '43418','40278','14877','90236','81967',
                          '75859','98165','29002','12796','95321',
                          '11904','97004','51110','37620','64449',
                          '76465','99706','64648','14156','12251',
                          '82027','81347','46200','60429','20234',
                          '20411','19300','23171','95751','58102',
                          '21885','18614','65711','71808','23831',
                          '76547','18460','97276','64879','49481',
                          '61648','16993','29920','77969','22898',
                          '56988','22795','21092','14022','86004',
                          '12451','11601','28463','34242','34736',
                          '34094','40579','91492','12855','27642',
                          '77135','81706','28582','88935','70543',
                          '11375','68869','80313','72343','35321',
                          '56345','45424','38771','20985','77720',
                          '12753','65526','52716','75445','42521',
                          '33574','14636','96888','71991','24943',
                          '61252','64953','51033','28057','15170',
                          '92761','46702','62490','56107','96357',
                          '23843','31738','45970','25282','76457',
                          '22488','21854','33314','29969','10696',
                          '40134','57188','90459','25703','94301',
                          '94152','13841','16132','10981','64737',
                          '59238','66030','80408','75008','31807',
                          '88421','35470','59169','18469','60660',
                          '35851','72842','93799','75696','51493',
                          '76580','53642','23434','42488','85239',
                          '73784','15127','15992','42241')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
