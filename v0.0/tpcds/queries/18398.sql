
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '83857','13355','67097','23274','96054','13269',
                          '93469','82342','31196','25109','42488',
                          '72632','16405','59376','17685','41213',
                          '16310','82289','69086','27031','39217',
                          '46211','86069','36398','66583','80352',
                          '53060','39304','53052','90931','28191',
                          '38668','48497','96516','11609','44527',
                          '85285','51314','28870','17664','25653',
                          '47692','65614','94113','26767','29813',
                          '73359','44193','15060','21815','66410',
                          '15624','82466','82369','26586','31041',
                          '83731','41847','50705','40971','64897',
                          '11260','80365','41357','68343','87332',
                          '74470','66029','48794','89650','84381',
                          '89221','96813','44681','44063','18263',
                          '82526','31285','20045','43774','32549',
                          '42534','78745','25140','67775','25770',
                          '78271','15040','60862','33232','11443',
                          '34569','55897','14717','21532','58183',
                          '94508','42981','88943','14773','83426',
                          '43589','43887','54593','62010','68252',
                          '44952','26232','34623','23223','47428',
                          '28241','59519','84063','70022','89648',
                          '16331','16340','48334','65305','73896',
                          '82217','82807','50857','64129','36917',
                          '96077','63918','26883','41856','32643',
                          '22606','75113','99519','38248','47414',
                          '72688','78913','51634','14158','98883',
                          '93632','46322','53059','99901','43165',
                          '20798','85587','94012','43266','30836',
                          '41792','13926','55227','12303','96393',
                          '15428','10767','52981','46633','68642',
                          '45577','16097','23526','23248','45891',
                          '76112','24781','74983','27478','88096',
                          '16260','66556','80422','29906','58869',
                          '64825','91214','75792','47684','53563',
                          '18667','64085','11906','57190','39458',
                          '87539','21681','85738','72145','85509',
                          '22361','26933','18448','24003','36571',
                          '43950','18294','17228','59690','31579',
                          '54513','86852','31119','46226','98145',
                          '39626','93533','76713','18316','29543',
                          '28984','85459','12254','86659','57490',
                          '31525','12525','98405','98118','20243',
                          '50606','39353','34951','73666','34745',
                          '47434','78403','93860','17784','45198',
                          '34946','46291','32093','28110','96448',
                          '36156','14386','67077','94944','45609',
                          '99819','88403','26675','97554','35048',
                          '42879','83028','72923','87673','16082',
                          '23797','79269','46919','21605','30324',
                          '31307','58015','89781','99831','55636',
                          '68765','24102','13235','53271','69445',
                          '60912','62000','51576','29566','86795',
                          '32849','97882','26506','92893','22364',
                          '23644','77760','75860','46846','48290',
                          '30092','39098','14784','64593','58360',
                          '50711','47867','75562','90444','23746',
                          '67774','80904','97482','85218','70330',
                          '21557','20683','30299','95459','76304',
                          '19794','31492','67471','55949','79332',
                          '13977','46129','54073','34528','72790',
                          '81878','37951','51723','47546','71684',
                          '20040','23098','26850','75753','48718',
                          '70473','41420','57810','10664','69283',
                          '54992','36722','32488','26389','35370',
                          '91698','26288','56386','50878','36271',
                          '18973','56968','84921','74495','44147',
                          '93162','24776','40421','61804','60322',
                          '73473','28267','59866','19160','38392',
                          '76551','75833','12609','16633','80876',
                          '22111','91385','25373','92814','14574',
                          '57750','76795','25251','43404','25498',
                          '57736','59673','61603','31432','93454',
                          '10478','99431','51637','33150','75333',
                          '44255','12387','23654','17352','75977',
                          '26617','40507','87742','37267','65350',
                          '28883','17841','67713','32461','23366',
                          '17358','37128','88171','15073','58817',
                          '27382','12273','97574','22413')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2000
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
