
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '31146','71178','81494','36930','12134','59677',
                          '64263','39048','92463','93458','55218',
                          '82117','74322','61475','95187','11870',
                          '25106','20475','60082','60547','18810',
                          '70961','23594','12567','14542','89278',
                          '93983','35317','52586','30525','26840',
                          '95727','80018','49567','73197','13401',
                          '61097','42128','33177','40481','83244',
                          '18848','28931','78465','67369','70651',
                          '38092','33300','60934','68343','37815',
                          '70169','18996','68798','59524','28438',
                          '25223','34708','93956','61239','62145',
                          '42517','20517','82815','46902','25303',
                          '77048','56201','24629','30582','89124',
                          '16693','19922','29059','69366','68140',
                          '77489','94081','91887','16445','75401',
                          '94843','31667','74964','42106','43841',
                          '50309','39915','81968','79469','20962',
                          '68479','57582','10640','58635','59532',
                          '30381','44826','15209','55908','27205',
                          '73874','36181','11585','31484','57979',
                          '28339','83246','29168','24730','57793',
                          '74812','45648','78692','24633','83155',
                          '78071','72190','87907','66134','20468',
                          '55343','53860','40703','26140','64133',
                          '35598','61243','82824','21013','61516',
                          '24160','89484','90464','94911','20409',
                          '50901','28366','83252','43048','33486',
                          '47521','46280','23867','78245','43903',
                          '93642','10749','22757','47642','11348',
                          '27490','67925','55115','52225','20027',
                          '34966','65913','52200','45236','28196',
                          '31445','36917','84911','22414','86249',
                          '68669','30560','30415','83721','11686',
                          '95417','40198','88386','13074','28378',
                          '14313','14401','58218','71787','98310',
                          '39871','81836','16983','17884','14845',
                          '32785','56051','85059','72503','17450',
                          '98387','66059','11122','96840','43235',
                          '99130','83979','46097','64881','61194',
                          '26767','33178','84988','37798','45496',
                          '38902','40442','12666','35628','30267',
                          '48751','55426','14172','96809','47966',
                          '80582','87753','11517','63371','49550',
                          '60104','57252','20801','96121','33635',
                          '19131','45260','23585','13966','75561',
                          '78930','57566','47347','92564','87617',
                          '54810','64364','20783','11010','39649',
                          '11162','26475','62064','60548','94051',
                          '31844','59749','60607','53747','86517',
                          '99895','55575','79517','42040','84333',
                          '70273','57853','34113','61181','68889',
                          '66159','75602','29390','91011','29009',
                          '27111','43412','57752','66663','47056',
                          '47792','63240','56921','15894','19608',
                          '64711','31017','96804','56993','93846',
                          '42621','68294','96229','26292','81375',
                          '65014','43181','28942','13718','12922',
                          '81484','59046','24696','56183','80373',
                          '73989','32252','24714','29444','14243',
                          '84036','24801','26330','43973','21089',
                          '81669','71518','24758','42195','70757',
                          '25136','32651','26010','33330','35652',
                          '25068','55869','36108','41396','24616',
                          '62433','40768','11821','89088','38576',
                          '35983','67516','20537','67247','89561',
                          '94077','85830','70607','43824','73263',
                          '27101','45038','63539','75171','31946',
                          '72678','65526','21224','15148','83261',
                          '32542','43373','50146','45399','71864',
                          '32719','84845','49275','30632','35416',
                          '81217','75344','15479','37419','73566',
                          '66055','10705','16578','17201','63628',
                          '65954','15673','24544','11942','40945',
                          '16950','78722','66987','92762','70853',
                          '18637','20462','70506','37277','28109',
                          '99435','75422','33811','84603','28556',
                          '46874','25526','94994','48688','28195',
                          '33966','44919','40918','19347','32396',
                          '25064','64816','78472','15463')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
