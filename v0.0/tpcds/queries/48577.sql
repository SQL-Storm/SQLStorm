
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '66658','68318','87837','51492','90663','46426',
                          '38767','71283','49943','93140','35359',
                          '13083','92446','86871','14589','84281',
                          '13905','12955','58872','50047','12465',
                          '12973','34457','67327','57117','12010',
                          '39502','31680','80617','75135','57761',
                          '94950','27188','97387','77604','30381',
                          '16660','98999','80257','83308','73912',
                          '76430','30113','22459','27137','27726',
                          '25499','32378','81667','91745','15592',
                          '76266','77404','14864','96169','96078',
                          '94721','60538','82265','69377','43670',
                          '50349','32024','25469','99821','39481',
                          '95352','41814','58566','31696','49577',
                          '21499','73943','43651','85566','54799',
                          '43443','55478','52057','19566','50525',
                          '67411','62875','16114','30267','28483',
                          '12629','18347','19440','17203','35080',
                          '76568','54840','66605','67514','16905',
                          '56651','92907','67473','22732','85894',
                          '50028','54996','71963','40181','50498',
                          '68918','16136','26290','24147','28474',
                          '50797','42371','19257','19306','51185',
                          '80302','68012','10965','75756','50651',
                          '90055','59682','23693','21963','15203',
                          '86715','27094','99253','53657','31663',
                          '78943','73759','73690','50503','84423',
                          '34985','69765','10557','46878','96096',
                          '70217','19763','77133','62118','12949',
                          '45808','91533','15200','84537','24139',
                          '28591','11332','55587','90459','33469',
                          '92342','24957','45481','34813','26719',
                          '19725','62814','79522','85039','67771',
                          '14424','57709','50997','23346','72661',
                          '57675','47182','54289','11621','65063',
                          '14614','50641','46286','20675','43929',
                          '27130','15198','72995','46248','21897',
                          '40228','18057','16957','12655','32675',
                          '53739','95652','10847','21978','41581',
                          '15674','21300','20879','30589','65261',
                          '83171','17075','36969','88692','38425',
                          '27571','66461','58166','56500','11323',
                          '36983','76891','25986','56858','61913',
                          '12976','20987','21318','51438','46361',
                          '16198','32130','47662','64923','34780',
                          '36849','12415','63147','73632','51467',
                          '28013','24987','10764','22473','18784',
                          '14555','98606','73715','38693','24389',
                          '48103','59941','22756','13858','22755',
                          '87841','75333','46360','20054','45978',
                          '84291','25549','38187','30099','27786',
                          '31815','28953','16861','24860','83765',
                          '24623','37809','88187','18012','78868',
                          '33891','95192','77767','76970','59113',
                          '93065','52331','54363','45822','81493',
                          '20162','45546','79218','66848','81541',
                          '26345','80392','22075','65113','64570',
                          '38718','24868','94637','37995','82220',
                          '81727','12288','47581','24699','57490',
                          '70457','45482','29222','56515','21956',
                          '30048','27506','20263','57000','58726',
                          '76085','92147','69510','19347','16639',
                          '46473','13217','14307','79373','28406',
                          '77651','59956','16584','97572','17000',
                          '30443','80274','77962','17976','56924',
                          '51224','70156','42137','55285','78950',
                          '61920','48985','88835','23333','30500',
                          '69214','44209','33375','82272','44392',
                          '32725','13728','46431','42637','26010',
                          '36011','65751','51042','59261','70492',
                          '24471','42768','57789','69424','28986',
                          '80992','42473','82597','93644','66134',
                          '20706','79335','33554','61511','17426',
                          '60626','68360','67858','23952','90651',
                          '70910','74707','29423','68942','10730',
                          '74214','67716','69467','94994','42474',
                          '45201','98143','87820','98910','31732',
                          '84593','74623','40105','98884','59470',
                          '88237','76749','72736','81813','32585',
                          '61540','37550','87271','69999')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
