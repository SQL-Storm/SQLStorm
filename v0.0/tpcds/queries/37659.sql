
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '18882','68384','96786','96558','23923','91326',
                          '86907','13108','70037','26004','57059',
                          '49650','15015','94845','15853','45737',
                          '26330','40651','37394','11051','75843',
                          '45147','46518','85271','14127','67944',
                          '73298','12805','21679','26498','34914',
                          '31513','28363','63863','55414','96097',
                          '64559','15719','46101','27627','45116',
                          '49707','34348','30698','52962','64365',
                          '53758','85570','30067','22823','40860',
                          '20043','97714','97063','96460','28825',
                          '25264','57950','16262','57117','46256',
                          '19547','12151','36094','90970','34737',
                          '46757','51816','65157','48379','10028',
                          '93513','48578','69202','31780','90852',
                          '45676','75194','33094','82855','12659',
                          '37959','75680','53336','78041','57304',
                          '17916','63702','10784','42808','35058',
                          '84375','19336','35074','13565','93317',
                          '87198','19557','87352','32765','73031',
                          '26216','23502','51095','14831','64743',
                          '13659','29201','97825','33399','81793',
                          '48236','92850','54041','96637','47284',
                          '74353','19638','65889','44541','86521',
                          '75325','22119','10209','52450','62894',
                          '36246','84338','47412','34319','57119',
                          '93079','53585','68273','86791','16822',
                          '42234','63827','54269','66486','35228',
                          '37513','53733','12678','61592','56506',
                          '91086','90036','97666','15973','66754',
                          '63274','46720','14421','27593','20835',
                          '83104','47955','98296','68030','65912',
                          '43880','32474','48891','41058','17486',
                          '18053','75803','71191','48861','74796',
                          '24873','14804','29194','33217','88325',
                          '81787','10351','43787','89210','83500',
                          '66939','61331','96983','47983','61106',
                          '57607','27352','64814','43425','42740',
                          '91402','10975','67289','73329','64441',
                          '69176','60693','88287','13514','18888',
                          '22707','10704','26551','70862','20127',
                          '83155','67357','35117','60863','62046',
                          '71630','52314','22567','87840','82080',
                          '31427','32850','59945','41307','51209',
                          '92017','15193','54279','65692','27997',
                          '20680','12978','85112','95722','94396',
                          '13722','39197','73075','76791','64396',
                          '20288','72516','54906','46568','46673',
                          '11681','51912','36204','28552','17973',
                          '68396','14461','23347','80776','22366',
                          '51996','58044','21301','12938','19110',
                          '95813','13170','21434','18283','18860',
                          '66620','35737','68640','53690','40637',
                          '43802','18766','34403','91546','56377',
                          '32231','72052','63643','98106','59522',
                          '79897','34762','44500','63693','35728',
                          '93655','22730','18512','43700','13516',
                          '37221','57228','88773','88966','29895',
                          '66599','16690','18718','30208','15967',
                          '24303','16210','86546','21086','35093',
                          '55298','12931','33226','36238','47832',
                          '59277','33362','14699','58183','46031',
                          '55538','59241','19479','41282','24480',
                          '50771','11144','30361','93076','58471',
                          '25790','78449','50613','25281','82753',
                          '12535','17096','25363','86531','98694',
                          '74930','72829','14201','61531','59184',
                          '27910','27695','42637','60420','24438',
                          '76860','48607','45988','89184','43960',
                          '38579','65223','82724','51150','33132',
                          '90682','78184','98750','13054','41197',
                          '82403','86670','53920','85937','31306',
                          '28009','64109','14790','59339','90937',
                          '70545','24069','67721','54354','30592',
                          '99681','44522','49078','52823','29297',
                          '24049','14447','33378','39452','97300',
                          '11507','85238','42477','92977','68427',
                          '16726','28489','68895','80270','61249',
                          '28691','39424','31875','26931','58309',
                          '33819','65310','87053','77320')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
