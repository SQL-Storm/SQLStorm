
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '21523','31233','23651','29401','61772','27510',
                          '69222','29184','23986','91047','92899',
                          '34154','13148','39358','33730','24176',
                          '27412','76466','73135','76507','14131',
                          '99497','98890','32202','30138','25513',
                          '66456','14845','78121','22757','30266',
                          '12170','61972','40975','15418','43492',
                          '23427','84027','37190','45370','64816',
                          '50919','49396','32720','92935','70842',
                          '41684','63100','39015','43758','85988',
                          '26954','97296','43933','39912','78209',
                          '33098','91276','66803','23867','85547',
                          '24956','45191','49248','65108','59124',
                          '10790','51244','21639','99405','11744',
                          '84261','62079','73605','72948','61659',
                          '50500','48658','26819','51397','36568',
                          '36877','79893','39106','79300','18832',
                          '13277','73278','63693','25166','60880',
                          '26716','34172','14036','74454','58635',
                          '69638','70418','18705','44981','50758',
                          '81416','17844','67892','75009','43356',
                          '99008','12737','84726','22609','29656',
                          '94305','52188','44335','97456','77060',
                          '93709','52101','17335','14705','48016',
                          '14371','61540','21039','46707','16827',
                          '73959','48180','45118','76950','22546',
                          '39257','37504','73761','11099','18045',
                          '35375','96504','26884','18384','28682',
                          '89060','60253','45677','31417','33116',
                          '13385','10698','40344','42581','99062',
                          '48007','40476','29867','11812','72117',
                          '13950','13298','80734','35932','18613',
                          '19597','33869','43741','18410','22248',
                          '34574','22343','80691','88972','40463',
                          '56771','19346','79784','35149','70971',
                          '85127','29067','63380','66244','14622',
                          '49928','28544','36886','59039','31015',
                          '23800','65513','41021','20033','25280',
                          '51152','73509','31725','88532','16378',
                          '88415','87941','33506','23865','75939',
                          '70449','96498','15176','47739','23535',
                          '23307','38574','26792','56127','87849',
                          '72252','66163','19214','99246','91689',
                          '68318','32865','35247','45443','77450',
                          '21436','11484','51714','78473','29890',
                          '29017','29027','26892','29335','43255',
                          '55838','89016','10456','33352','35520',
                          '73899','97223','41346','94856','84618',
                          '71838','23079','35636','65065','85706',
                          '22663','18044','88467','33395','15962',
                          '81539','61838','32810','29583','28793',
                          '12152','82387','55491','42343','27994',
                          '89827','34747','52556','14870','54942',
                          '71429','75973','66602','36424','53055',
                          '30470','25884','95350','78367','79857',
                          '30493','52913','40577','23075','14479',
                          '89504','55988','13222','32661','63528',
                          '24585','18002','99614','96286','48546',
                          '64509','36107','38973','38050','80920',
                          '98148','21589','14084','29323','40390',
                          '53851','72001','31767','37523','40174',
                          '72268','44121','11112','76091','24248',
                          '42920','64263','56966','37719','29741',
                          '89977','80081','48227','76545','43512',
                          '82946','15444','22389','91829','73569',
                          '41986','41963','56375','74984','17533',
                          '45783','70947','38122','60258','21426',
                          '82095','72977','94463','87726','46395',
                          '31666','95576','92283','14039','62289',
                          '61117','91471','15027','81547','90297',
                          '43649','71813','81417','65799','94357',
                          '86047','45392','78802','40379','52051',
                          '72947','86807','15054','84418','31219',
                          '40902','61746','57538','18086','31201',
                          '12286','56599','78350','19600','30397',
                          '96543','35882','92949','84302','95306',
                          '14773','48989','37101','28285','77147',
                          '18403','11786','54893','73102','62731',
                          '72247','11252','16255','78587','52473',
                          '74449','42995','85164','11446')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
