
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '23099','75445','34433','46044','66136','78766',
                          '25143','39683','49780','76989','21154',
                          '10790','35740','22444','49776','14778',
                          '55020','85409','71022','97052','99618',
                          '10626','10081','12988','26889','71187',
                          '24831','25151','39025','33748','31355',
                          '67110','63099','61745','85919','46508',
                          '81841','96700','15595','18835','65686',
                          '56071','67302','60204','24693','65078',
                          '74924','22159','19285','89910','47623',
                          '14987','36085','96156','66916','36304',
                          '58747','74031','15840','79010','34423',
                          '44576','43106','21835','10705','27756',
                          '72879','51567','12212','67448','22604',
                          '73655','35232','49981','14140','88759',
                          '83237','10489','84762','13767','96318',
                          '73839','98215','70926','74680','62709',
                          '91779','88282','20946','55258','75316',
                          '23972','38856','52637','46216','93277',
                          '15701','45539','34061','84554','73218',
                          '46016','33959','91450','35546','98770',
                          '21434','58414','37255','55622','27228',
                          '38484','11143','12147','32745','91133',
                          '83084','75267','89322','73018','55438',
                          '95688','14390','49073','44242','23498',
                          '35595','41648','46651','79867','38259',
                          '67243','12381','39272','87292','20458',
                          '51093','50611','84664','54827','38256',
                          '39319','76070','74368','57874','10334',
                          '33270','79605','87716','76569','76039',
                          '35196','48509','72979','65410','94157',
                          '24506','79627','74862','99484','81674',
                          '30075','49763','37861','78036','65131',
                          '93433','73130','66608','12770','41723',
                          '92795','49054','49361','19547','31127',
                          '30210','54804','31751','92220','55693',
                          '92623','62386','96348','77931','96287',
                          '21129','66785','28176','36026','19398',
                          '96409','19904','37158','91233','19843',
                          '66219','49800','91387','41979','36252',
                          '10357','54644','39044','86484','49506',
                          '99185','65585','54374','24878','67205',
                          '77951','61108','13735','32460','88262',
                          '12664','70792','75425','71779','55473',
                          '55427','71190','22427','37152','38790',
                          '82179','58506','33100','91624','68717',
                          '22081','98298','90969','27525','90180',
                          '47781','63705','21135','28088','56296',
                          '84041','11803','63193','13376','66243',
                          '55829','33769','54736','33047','90216',
                          '25316','34833','58718','35291','24910',
                          '15332','24290','34709','19180','58256',
                          '48650','36180','21069','26814','47043',
                          '55492','38895','84427','64260','38787',
                          '66430','69821','54127','19520','50097',
                          '90697','47453','35804','27796','70507',
                          '26372','61589','22948','98267','64789',
                          '37397','52855','35286','18098','81033',
                          '37102','78139','47803','27531','39022',
                          '54501','80905','27439','58213','62641',
                          '54699','45014','68043','45473','15247',
                          '14765','87946','70181','25244','81128',
                          '56913','98573','57365','99402','78597',
                          '22847','78271','22212','33596','17546',
                          '30189','14074','76887','51798','86532',
                          '93776','38660','29034','11727','40138',
                          '13173','91211','73979','20553','88486',
                          '70254','10129','13321','95096','50193',
                          '46531','86413','70202','29858','92969',
                          '14415','46289','36437','86944','47205',
                          '88211','96131','26040','84525','41505',
                          '35440','74977','76158','84064','69794',
                          '12007','21847','92180','87233','36151',
                          '54326','17030','54829','61884','46645',
                          '43209','35597','22315','22416','99101',
                          '86760','65167','54084','44194','10921',
                          '14662','22530','51012','42316','18211',
                          '90219','28003','91912','30377','13256',
                          '56554','69481','88583','90541','91620',
                          '46789','21440','44416','35641')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
