
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '98286','99887','88367','23574','22566','49181',
                          '64099','46731','46651','22969','27754',
                          '25470','85880','14841','71354','10161',
                          '16010','28077','30195','43872','52009',
                          '75257','35936','21613','41898','50494',
                          '57971','85581','77934','75718','76134',
                          '62518','49673','50870','34201','42408',
                          '82755','35757','42315','67320','16291',
                          '36747','15204','71868','31046','31685',
                          '28422','41639','85084','48967','83687',
                          '94923','63195','24181','20890','77944',
                          '49694','43461','81037','36478','53560',
                          '35268','53586','27751','65664','42573',
                          '77969','52276','88642','14604','93149',
                          '79696','42401','31088','19663','42781',
                          '32434','60536','31815','54739','13678',
                          '35216','94933','42933','61860','20498',
                          '34948','60758','46887','17666','51037',
                          '20224','97613','14325','75893','89679',
                          '84914','14726','55247','96132','48269',
                          '39287','53761','70752','60679','78060',
                          '30151','31474','67600','22629','18930',
                          '28394','61135','91793','22604','34796',
                          '13023','51232','51457','64236','56395',
                          '56612','75787','10444','22786','17477',
                          '86435','68351','29665','47324','41602',
                          '66847','15810','26859','71239','47495',
                          '17611','31629','21916','23821','38458',
                          '31255','70086','31292','29680','12192',
                          '89644','26083','57230','29685','42599',
                          '12972','12074','35945','44396','96545',
                          '53015','30560','85504','93222','19632',
                          '57474','44307','68126','16233','91581',
                          '26154','89851','31822','97334','34509',
                          '29686','56585','84976','91617','24716',
                          '15927','92014','10947','37699','35933',
                          '41842','13164','94450','77200','93724',
                          '35051','21435','66117','82989','90100',
                          '69364','94394','84733','61470','56602',
                          '40916','89581','55712','92400','78104',
                          '23023','71900','22119','22421','34639',
                          '84039','84003','35657','80225','82041',
                          '47611','18006','10288','34291','36923',
                          '18065','53811','81114','56190','43420',
                          '79915','28749','91789','94361','13523',
                          '32544','76550','81560','10466','72633',
                          '38665','49912','12481','16784','36098',
                          '41953','86173','24997','41780','13003',
                          '42713','96867','55772','58655','72162',
                          '32376','13405','31170','16576','18488',
                          '48085','25312','24071','81118','37855',
                          '76584','13246','56643','59018','97295',
                          '10163','24541','45311','48366','96175',
                          '86760','74851','37409','77655','95213',
                          '80751','47491','64066','18855','26393',
                          '20395','50389','27193','11245','61575',
                          '31750','26380','27088','18517','72459',
                          '61782','22916','89431','26837','11133',
                          '36595','27712','20049','39897','70392',
                          '48235','76330','15704','49026','73108',
                          '88967','25506','28120','12510','34605',
                          '25587','37008','87667','89320','56035',
                          '10929','92041','23146','99477','45669',
                          '49764','54452','63610','31870','40401',
                          '81999','18714','50530','73572','57397',
                          '81269','24673','48439','32628','41436',
                          '15798','46983','46487','12985','19049',
                          '67807','12321','29636','66675','56058',
                          '37345','25905','56713','18955','82369',
                          '11146','21827','26682','24801','22207',
                          '60970','65248','32490','15250','40351',
                          '78939','75584','89273','41778','68247',
                          '44301','24462','17530','47469','79533',
                          '88743','18050','54581','83000','99159',
                          '47805','69139','63220','24894','57292',
                          '79107','12305','54644','96271','94665',
                          '28278','32732','40988','51941','85595',
                          '80217','38572','31543','65390','21134',
                          '28262','92376','87861','68084','84448',
                          '35084','65228','59784','35800')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
