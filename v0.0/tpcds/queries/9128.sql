
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '71618','62280','30355','92753','50004','52778',
                          '12018','92484','16294','94770','15077',
                          '17936','85719','64609','50139','86351',
                          '46689','62133','65293','10540','98518',
                          '54018','85896','27179','48873','84257',
                          '72310','64359','30184','50213','29724',
                          '82029','71711','77667','19199','39888',
                          '81101','90796','40460','84492','63780',
                          '92881','15204','89070','32384','19748',
                          '42479','11533','96377','80061','68834',
                          '71758','95723','40616','33467','74488',
                          '76591','28279','63820','71969','46352',
                          '88936','54212','38153','84768','75449',
                          '53909','90061','21666','79883','80214',
                          '65101','17514','65505','46165','12568',
                          '26031','24018','34163','57847','90224',
                          '38088','47312','99126','72924','27455',
                          '35954','73364','87296','22825','37779',
                          '19067','75066','86003','10958','95976',
                          '72142','19778','63355','88017','95903',
                          '33202','59896','71797','32318','41111',
                          '27580','82955','79600','38583','42262',
                          '56408','58756','43698','50760','81659',
                          '73682','87281','10234','23264','88595',
                          '19814','73475','51247','13189','60594',
                          '76327','94287','38308','33196','27090',
                          '83542','20892','96409','29970','41272',
                          '62419','68056','94344','41319','55061',
                          '13690','51480','69067','60335','21203',
                          '80882','63166','15364','11161','63357',
                          '22629','51700','46069','36386','58673',
                          '35128','13490','34094','45459','27642',
                          '71545','13617','31242','11977','64256',
                          '38937','13472','39852','17216','60549',
                          '18236','10766','24909','12863','95450',
                          '55577','44146','33383','82495','30391',
                          '35856','13373','39856','44602','76009',
                          '75355','56778','10315','18626','95844',
                          '35262','76993','51869','12376','51493',
                          '53642','76427','71003','38953','41918',
                          '20848','62515','77973','85245','15934',
                          '25733','21301','37266','57371','34839',
                          '59973','62140','99879','56687','81407',
                          '55817','15305','55762','90717','78896',
                          '90736','59025','56965','21338','82228',
                          '76538','92191','92067','75488','30887',
                          '32879','40340','81136','20524','71390',
                          '60321','43525','40302','41768','19408',
                          '60385','56631','41268','25343','21755',
                          '41397','78578','32908','90965','69542',
                          '21842','25779','31750','38517','61648',
                          '48730','39315','80262','45153','13124',
                          '38384','21963','36053','95293','90984',
                          '14460','14850','61325','72081','10959',
                          '23394','65774','62329','38687','17880',
                          '26914','28916','34148','74727','74774',
                          '37696','51556','61676','20183','79537',
                          '54926','15900','56441','88843','38260',
                          '10410','11947','21870','62850','87447',
                          '75134','39941','12885','70913','30422',
                          '21493','87388','89257','37958','14599',
                          '63863','95375','12370','40609','73529',
                          '11226','54094','97946','37571','19192',
                          '32711','99661','11443','58345','44479',
                          '33002','99279','16115','80658','68636',
                          '32264','14554','60275','13573','51424',
                          '27225','80559','16056','79373','29407',
                          '55613','22022','49588','13219','71420',
                          '10191','82380','50268','85996','11703',
                          '50011','51815','89291','67206','23594',
                          '91079','25175','95378','36106','98179',
                          '74713','98083','24809','38907','62778',
                          '16460','16835','28775','39424','37262',
                          '10431','24666','77548','54388','49007',
                          '48900','10108','32907','88117','97076',
                          '95013','89613','18212','48208','94197',
                          '73728','55352','79572','72968','23215',
                          '75152','83245','56542','23211','65811',
                          '44295','23514','81229','72354','78661',
                          '11183','76689','63161','54531')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
