
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '65590','62959','16399','12286','91110','85065',
                          '51277','26603','19993','43135','94597',
                          '39592','91936','97391','92068','22964',
                          '91800','69918','94424','25761','19636',
                          '89883','32305','27095','38845','30217',
                          '94930','41171','14576','80463','64436',
                          '99232','24784','96225','51660','28810',
                          '87930','70928','17445','18472','54560',
                          '77068','85118','53486','40773','88383',
                          '86036','28312','57450','25582','89376',
                          '80966','63419','58080','50707','29785',
                          '57717','37392','10727','64247','56464',
                          '56273','31449','27825','28002','47583',
                          '17981','52774','24700','50413','10965',
                          '99264','97933','85916','18453','27337',
                          '74217','35686','81857','56553','64235',
                          '92361','63024','83170','84907','31522',
                          '25237','69179','44220','49866','95119',
                          '33189','97791','63014','17189','46767',
                          '94116','19449','90527','25337','48591',
                          '14705','56332','89739','22068','75873',
                          '16778','24607','54240','54179','10623',
                          '29055','17351','31345','48597','14818',
                          '16636','65846','13735','97998','41852',
                          '20901','48766','41025','51949','26659',
                          '84572','52835','88353','39712','34020',
                          '29466','47757','95344','74423','72255',
                          '19017','66764','30709','54966','13579',
                          '60617','72997','72912','28272','10683',
                          '19419','41858','21512','92241','27334',
                          '56934','13556','92352','42733','51930',
                          '53095','85595','38692','76923','51916',
                          '32649','17439','53557','55281','12830',
                          '42999','85202','25602','90609','25637',
                          '90466','12156','35726','75479','23810',
                          '83331','73484','23802','89278','70593',
                          '51981','45109','36440','90933','61922',
                          '65476','54572','18488','23903','23699',
                          '22889','56727','45387','48676','28364',
                          '43391','56320','96062','94590','33093',
                          '79749','28780','36922','64045','76735',
                          '96103','12954','23759','97759','48431',
                          '50479','15981','28704','87479','97703',
                          '55158','26673','96631','44630','34680',
                          '43982','54547','44158','74210','37817',
                          '72119','86856','66753','35586','60991',
                          '69507','46570','65395','13911','48114',
                          '78322','57566','10525','16902','36612',
                          '54194','15253','86585','90829','61628',
                          '12965','87141','14553','85596','51380',
                          '81964','33950','50643','79340','68254',
                          '33403','41584','60847','77756','12640',
                          '43348','76877','64006','79824','43794',
                          '31004','63184','74603','59560','27857',
                          '32363','47559','80721','60625','15095',
                          '36371','62236','56923','84452','61804',
                          '91207','63538','65430','94403','34425',
                          '74968','53844','38413','98927','99597',
                          '35541','54806','85040','85526','26920',
                          '63834','14951','14424','61182','50720',
                          '29018','33719','89843','71546','12990',
                          '53569','49161','24806','34552','39617',
                          '36263','17620','95441','78812','29173',
                          '53236','70635','15551','21958','21269',
                          '56386','35416','49931','22492','68317',
                          '39985','83725','94408','81996','77917',
                          '88830','54265','53732','94934','76873',
                          '11832','10126','17775','14860','32079',
                          '13725','44044','29881','69721','10423',
                          '82316','46602','55673','97792','57795',
                          '11428','10941','34438','40819','11667',
                          '84841','94221','84923','39262','89113',
                          '19315','25088','20180','22966','29412',
                          '57855','77896','62946','52544','21838',
                          '85289','98700','66356','85940','87660',
                          '97657','58795','88940','29204','54058',
                          '10609','43753','33053','10483','59387',
                          '73920','20296','21878','76798','49857',
                          '46998','11242','12566','86060','71753',
                          '80853','28188','19987','84000')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
