
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '76633','19257','15695','65815','84419','42178',
                          '97491','11973','96271','25014','40579',
                          '31144','46073','89815','27570','20257',
                          '42626','17186','42457','53813','75621',
                          '93796','93307','60769','13282','75367',
                          '11392','70522','94737','13389','29964',
                          '44588','48013','64218','96747','80094',
                          '36499','12308','30689','64806','15796',
                          '85779','79602','46714','48487','77294',
                          '53632','25027','26448','46049','56105',
                          '50895','33481','89725','28144','14657',
                          '33987','18009','79248','78812','60805',
                          '28334','53260','36325','52097','25742',
                          '89529','57466','96911','66358','61092',
                          '15886','23095','19434','11237','57884',
                          '34152','41009','36644','86571','43270',
                          '52390','61763','54667','68143','68937',
                          '81556','95113','11091','70233','52324',
                          '72888','17829','21998','92130','49439',
                          '71991','91157','37146','87728','88956',
                          '88168','69530','41225','26583','99618',
                          '10973','73621','98740','73199','27955',
                          '90357','32682','92103','64719','26461',
                          '31834','15969','74697','65811','60964',
                          '52958','73014','31703','38043','93056',
                          '76502','29522','70297','56927','77885',
                          '96661','77999','50561','51531','25185',
                          '34420','44194','86267','39923','11982',
                          '77299','32062','46211','41626','13304',
                          '57378','65608','40530','13989','57397',
                          '68742','49583','14817','26804','20753',
                          '60677','92567','17947','69920','59902',
                          '38274','73200','64368','53773','70636',
                          '40121','39618','63099','93794','23987',
                          '72984','29727','21786','51232','98148',
                          '31902','15005','14354','41709','76237',
                          '14538','22699','18793','82420','48589',
                          '13629','66886','47606','60597','16218',
                          '97463','81957','25160','29826','29265',
                          '45451','69387','77116','43209','94998',
                          '24576','59190','15973','33537','41421',
                          '23034','99639','11101','56742','46675',
                          '83768','12884','61966','88469','38768',
                          '72294','89595','89830','63400','44525',
                          '65743','32514','24375','16397','97776',
                          '69007','10170','20930','11880','14299',
                          '41747','11144','75083','40617','57729',
                          '10239','34653','55521','22899','42809',
                          '45064','27740','64121','71657','91052',
                          '18194','40962','94308','59473','98130',
                          '86970','17526','36398','58862','73517',
                          '32802','12912','33603','25917','54606',
                          '68721','13070','79964','54214','27842',
                          '90635','72323','42664','26032','14322',
                          '20652','42395','67796','28926','13121',
                          '28172','37603','76114','17889','60834',
                          '44794','33061','50841','56531','53050',
                          '40242','49072','56719','52121','69709',
                          '90293','62255','23778','49522','30826',
                          '50723','22532','91660','89467','64082',
                          '14883','30612','72720','62875','14244',
                          '28929','27733','31160','84604','29482',
                          '29467','29673','37142','11672','34423',
                          '91241','82007','89052','81307','62044',
                          '12574','61660','64058','76259','82230',
                          '47241','64620','99017','69806','18142',
                          '77842','47275','74579','69805','45612',
                          '30403','44858','40457','14942','17272',
                          '37666','19360','23998','86797','23324',
                          '13597','92029','26128','35947','44715',
                          '19310','14106','74553','23442','86855',
                          '35576','84037','75570','43332','29237',
                          '14906','68844','60241','20913','15282',
                          '50522','32619','27043','14011','64989',
                          '27003','79296','63854','66437','71898',
                          '64603','46184','16150','50388','35073',
                          '80795','93144','39327','22120','20336',
                          '36873','46709','14122','84912','39313',
                          '23130','95791','15686','23393','26691',
                          '77286','30515','43384','63178')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
