
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '75240','72396','13627','73826','23154','28533',
                          '73884','56622','42489','54161','92006',
                          '94603','17288','84021','84962','99564',
                          '74288','58363','39662','75205','38665',
                          '25077','10988','92718','16289','72612',
                          '35891','64069','35028','70186','28347',
                          '14008','81616','20324','28874','92059',
                          '23802','46349','34670','35277','23111',
                          '98238','71799','35219','66898','80472',
                          '21322','93675','10406','69447','59060',
                          '12839','12356','54018','62336','27596',
                          '13535','46391','84487','75316','71598',
                          '66978','87940','66261','31981','20928',
                          '55205','10929','76578','52377','27583',
                          '26571','56546','48190','33532','35699',
                          '70891','76731','16927','97432','39971',
                          '69338','18780','57776','20267','51159',
                          '61117','14583','41030','16394','66231',
                          '59807','64095','36921','48384','60036',
                          '33602','11504','98410','16556','23876',
                          '55274','51255','97518','92343','90139',
                          '31615','22539','48541','54093','11110',
                          '72771','38276','69245','13958','38653',
                          '20111','23759','26830','52464','11939',
                          '39814','39313','30621','57594','74730',
                          '56612','81672','30530','69184','59289',
                          '59613','69588','23016','82654','98928',
                          '74141','15850','85807','98288','32392',
                          '27874','98972','68825','56331','12733',
                          '37898','92101','57588','72708','45909',
                          '31483','90308','36603','16116','36956',
                          '76872','17071','11555','35290','28464',
                          '50664','26378','56829','22597','73400',
                          '24663','60409','23044','87240','13019',
                          '63212','76273','19527','16814','26013',
                          '25861','85539','30411','67538','20273',
                          '38911','11349','94430','25057','46317',
                          '90330','59826','10770','74044','64885',
                          '78688','49442','52489','13869','29327',
                          '32022','16618','40650','32691','68063',
                          '13934','59801','24259','25351','25021',
                          '92453','28283','35659','61260','97937',
                          '73333','86294','13171','13041','81884',
                          '88635','61226','24778','16428','32383',
                          '21581','59332','34837','85674','39583',
                          '66894','92859','22954','44347','17572',
                          '95088','79441','47058','45693','49352',
                          '74316','34122','30297','32473','19395',
                          '56264','18595','81300','30999','89661',
                          '71389','49929','47930','17871','97605',
                          '17091','52253','95060','18610','97897',
                          '46303','31549','82655','72048','57631',
                          '97856','25348','73714','65132','44876',
                          '42633','68092','39279','65007','69583',
                          '23060','22140','66710','59876','19177',
                          '62664','96295','68803','22933','61724',
                          '24766','65788','69074','24780','45955',
                          '47612','16923','91025','66109','16150',
                          '98826','40706','56448','95395','21646',
                          '41156','15325','44803','25628','39830',
                          '56248','52981','17525','30567','28930',
                          '48948','35841','60627','74297','62997',
                          '77639','28982','58497','25973','52797',
                          '39338','50516','62420','24907','25058',
                          '74931','24647','19794','34493','20120',
                          '69547','10884','31530','97115','19787',
                          '11104','29837','85307','14437','10478',
                          '39248','97079','50071','51006','27373',
                          '64272','61286','63449','93173','46411',
                          '71154','59716','58106','24110','75933',
                          '86500','59510','99978','33996','75722',
                          '89842','29873','40187','12892','83869',
                          '42553','41300','88369','69210','20558',
                          '86604','49820','31862','21921','94353',
                          '92851','50443','13981','51550','53965',
                          '57625','33856','26323','36109','58861',
                          '84891','23965','33620','34902','38345',
                          '56582','66622','45967','48258','23040',
                          '36017','42147','66076','12682','86162',
                          '65349','68853','17752','26483')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
