
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '59092','40429','15134','49846','74896','85283',
                          '69172','84956','28947','12267','19469',
                          '56247','72522','65517','19999','21287',
                          '65335','27296','38163','32483','12026',
                          '18392','67706','49571','25383','33193',
                          '29405','58224','39249','94355','57687',
                          '66351','54014','76873','70614','56856',
                          '22071','40305','64510','98724','42175',
                          '18069','93108','34531','34521','16152',
                          '59395','36497','49648','15006','84454',
                          '59631','18210','64537','55812','19744',
                          '56399','18446','37287','64392','70082',
                          '34931','53042','78602','38672','36829',
                          '22174','20663','52905','36245','87031',
                          '95829','54106','75809','58620','55544',
                          '54983','18396','15912','56217','10294',
                          '47977','10119','73307','21780','20653',
                          '11575','52242','32892','98482','16251',
                          '96481','88214','16758','78541','11073',
                          '52578','38576','10149','78586','38346',
                          '41777','64157','26967','26534','17519',
                          '41998','37479','22470','34814','90006',
                          '64160','37678','93903','57923','59893',
                          '60583','56129','22742','26349','49499',
                          '94048','88002','72852','25792','41326',
                          '33597','27902','93236','73202','19172',
                          '35584','20298','40278','28536','67507',
                          '12611','22303','83572','39729','53508',
                          '89714','45201','10206','97026','56613',
                          '16146','19646','91852','27322','18206',
                          '52238','22776','53565','10257','37404',
                          '38747','80209','33339','69012','84512',
                          '30287','98710','48117','35239','94958',
                          '87307','65414','33141','24660','94376',
                          '47993','59067','53715','47016','17719',
                          '76308','32547','15556','59747','75827',
                          '36452','71690','37735','65388','64747',
                          '72780','80054','99732','43601','56822',
                          '93843','12369','42291','47850','84726',
                          '45425','91152','87866','19950','74098',
                          '79644','86726','52328','27951','34207',
                          '23905','73458','84568','38382','39528',
                          '40117','96176','85953','16212','48012',
                          '15082','75496','75394','18819','34001',
                          '11989','37609','13208','59588','86174',
                          '38710','56583','37659','30866','42293',
                          '12030','10430','17107','43710','10263',
                          '57329','86243','13112','63030','88533',
                          '67776','41699','94952','46997','35605',
                          '53975','18791','50126','64497','69569',
                          '78838','16083','12504','51623','28995',
                          '64636','48991','96479','27695','41533',
                          '94449','36681','91022','72315','59702',
                          '33386','26612','45041','35874','84280',
                          '91719','39095','97423','11034','28172',
                          '22372','76200','56308','92320','63328',
                          '58557','83629','85700','92665','59296',
                          '40488','28718','77012','50474','24916',
                          '81310','47280','20146','63056','77138',
                          '77300','23680','28979','94372','62202',
                          '93594','55570','46775','22554','47198',
                          '15144','51003','99320','24154','92994',
                          '99043','47641','41868','89394','63932',
                          '95286','39508','74637','41392','72114',
                          '49887','29382','76470','27897','84564',
                          '26804','68438','52737','29706','24480',
                          '43518','62849','52858','10045','90743',
                          '69846','57574','76656','29205','89467',
                          '26276','52163','24768','52103','14901',
                          '82189','38088','52797','54457','33460',
                          '32949','13253','78417','25758','85522',
                          '80407','46809','37354','14428','98646',
                          '25304','18736','56472','72155','39209',
                          '55143','79505','40025','59875','41144',
                          '27476','68461','13943','40113','33715',
                          '17962','92037','13561','13376','83812',
                          '53682','31894','31206','66556','97376',
                          '35934','93255','71098','15030','80537',
                          '86722','44580','11272','36844','48051',
                          '72502','62522','36848','82378')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
