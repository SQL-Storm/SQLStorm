
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '65947','85289','10188','31573','80759','18138',
                          '65240','20352','20296','12225','83225',
                          '52864','21091','50531','75864','55078',
                          '76875','63616','36627','49096','19396',
                          '50525','68324','18914','38091','81209',
                          '39565','47856','88756','66988','97814',
                          '19769','70310','36935','12694','14894',
                          '51489','40649','34824','31836','21840',
                          '83439','67893','77201','99138','65302',
                          '55241','79766','89622','38835','61306',
                          '15387','49450','86477','13598','44302',
                          '69508','59139','32844','23167','73244',
                          '27073','31131','86359','10394','15922',
                          '82031','13729','30711','81917','89184',
                          '74672','17220','27193','47339','48835',
                          '17211','10483','75884','35344','13931',
                          '25177','33630','53329','54323','33535',
                          '58857','46726','33952','16286','50017',
                          '27426','15590','95716','99818','81719',
                          '41796','89163','93400','12519','27394',
                          '69821','63769','71736','59333','59033',
                          '89089','34205','42333','38796','21996',
                          '18083','23651','27282','51720','28524',
                          '94926','92249','12745','39679','17862',
                          '19813','56213','85810','48269','48703',
                          '57690','20057','80530','91544','76676',
                          '29940','31706','49789','34238','98537',
                          '78044','81563','10889','56663','53098',
                          '34046','75969','70355','73193','73427',
                          '23760','11683','44009','58575','25843',
                          '68152','38517','28542','64177','74883',
                          '37241','80470','53307','13321','89822',
                          '82844','90794','72949','20839','37856',
                          '72635','80745','68408','13371','23344',
                          '49492','43994','37761','85977','21251',
                          '59385','40878','55897','42430','42275',
                          '56446','40084','40874','18450','76161',
                          '34743','79646','56933','12601','61435',
                          '37041','25106','27686','74253','11480',
                          '24044','15780','83713','83634','84624',
                          '54118','30918','24399','92923','88403',
                          '50250','92011','30851','59966','28210',
                          '71827','94314','16806','21620','78589',
                          '47211','19278','58337','88628','38388',
                          '33479','17760','97208','53031','31690',
                          '37977','47351','27680','90362','27512',
                          '28887','69687','96364','30616','70804',
                          '61995','61511','12324','26373','72021',
                          '65844','25740','59155','61723','79212',
                          '23022','91739','27205','18891','98556',
                          '96055','18578','81762','34339','79878',
                          '18452','50564','17316','59540','94040',
                          '19225','98625','56783','56311','48151',
                          '39351','86733','90582','22944','17774',
                          '25004','60087','86812','46544','61739',
                          '31062','46096','35085','97667','95108',
                          '96739','39785','93424','91579','14563',
                          '35911','13833','95988','10863','55174',
                          '60644','19285','92693','97903','23963',
                          '47779','27368','23790','48232','27997',
                          '95778','23705','26025','49003','23834',
                          '31169','82108','37813','30204','14142',
                          '19435','19371','69608','36523','48997',
                          '28287','51255','79434','10238','74817',
                          '47371','75781','23134','50949','15647',
                          '38232','95053','10207','75284','27125',
                          '40374','22434','80484','21980','54017',
                          '70075','68320','61882','90570','65244',
                          '24507','54615','79999','61128','67933',
                          '93542','82381','39006','83026','19595',
                          '35835','68929','24392','76631','16713',
                          '77151','61955','99706','74016','71799',
                          '97817','31603','53087','34996','14381',
                          '89375','21901','33215','96607','50467',
                          '27761','62661','39043','51088','43281',
                          '42118','41846','23851','17079','30410',
                          '16288','22210','51559','52646','59839',
                          '67255','60472','99626','28126','35270',
                          '46335','58019','40967','67825','13011',
                          '26556','13496','82656','12482')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 2001
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
