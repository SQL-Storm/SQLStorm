
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '49469','38028','79377','14550','36285','58838',
                          '81481','86871','87082','12358','48228',
                          '78624','43682','42817','27217','93009',
                          '73690','58263','54241','30856','63272',
                          '33731','53388','90263','35277','84064',
                          '40841','27963','84404','17919','13701',
                          '90859','26794','47143','26244','67894',
                          '69933','30365','25445','84781','66700',
                          '37068','67336','76964','59916','46841',
                          '61844','36564','27887','27224','72615',
                          '20214','15429','13350','37626','53657',
                          '70852','93129','39362','87887','38027',
                          '79933','12715','38964','45368','33912',
                          '56757','19572','52285','30891','42910',
                          '35243','88769','88178','78612','66515',
                          '25900','40474','66873','54800','77397',
                          '24904','12329','68133','61145','14136',
                          '38481','18269','65443','14468','38228',
                          '85085','56095','50649','24853','40064',
                          '22982','18154','39989','30157','85111',
                          '53070','24795','88627','17460','90102',
                          '22200','38124','22841','85563','16537',
                          '44031','54445','30744','93693','36988',
                          '27279','39611','10023','42995','77057',
                          '71423','39215','27600','61037','21973',
                          '19305','41800','37683','10399','55602',
                          '51806','21810','34049','38365','35791',
                          '19893','42533','45961','60113','18133',
                          '18456','83976','81570','94036','32321',
                          '96645','49619','48776','14232','22900',
                          '27013','60483','22682','23072','62269',
                          '22295','40177','38973','17814','16780',
                          '11121','12649','24125','25875','24845',
                          '14523','46103','90118','63260','82033',
                          '61012','85457','81582','65455','33153',
                          '32119','13521','95072','70381','24897',
                          '13532','70423','40945','20335','19748',
                          '69950','41106','53521','66439','29221',
                          '28179','17292','16935','93965','24581',
                          '58468','49103','76365','98292','45676',
                          '36297','78945','99830','83373','16806',
                          '20301','81605','15694','92650','13141',
                          '68181','70725','10215','19369','30688',
                          '16204','96519','24321','11521','40616',
                          '90739','45116','91452','40250','40359',
                          '13968','28013','68649','83461','80853',
                          '34788','41298','17433','12570','84069',
                          '78332','52156','30815','85122','65919',
                          '68942','48365','12322','89143','17058',
                          '48549','57675','93641','72060','48659',
                          '77527','15278','70192','20920','61769',
                          '24351','26025','64070','19652','61864',
                          '89116','75806','52836','90590','61197',
                          '25903','54805','79884','74926','34430',
                          '45305','10216','81030','15975','59981',
                          '53278','40650','88494','34450','52140',
                          '49761','25708','29472','78573','85605',
                          '57413','59286','74115','15243','77348',
                          '78481','24914','50887','32125','45113',
                          '15098','34119','24085','89005','36631',
                          '26371','32441','38307','28481','20689',
                          '14314','84981','91410','12296','45808',
                          '15368','14364','26770','23174','86563',
                          '98182','89633','71847','27444','69954',
                          '44563','97085','57482','96576','69956',
                          '70137','53901','26686','13472','32007',
                          '20855','50187','18001','49552','72170',
                          '67353','21527','28382','71033','79693',
                          '37484','34003','15663','76972','77750',
                          '19091','36802','51587','83672','26556',
                          '44896','32529','98281','16480','38061',
                          '24420','55346','84515','39008','18919',
                          '59942','86666','39710','32005','38796',
                          '13139','50794','23994','47358','69955',
                          '65953','98664','42896','44344','67584',
                          '23458','73737','76495','60575','74467',
                          '36615','80612','90394','53836','63395',
                          '63842','42484','95301','74451','58740',
                          '99132','85950','32402','79224','53239',
                          '43705','86991','84723','36644')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 1 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
