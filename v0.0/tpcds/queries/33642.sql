
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '84747','68696','12472','36042','26662','32581',
                          '36452','26154','96091','33188','93061',
                          '32860','19393','48038','39553','58843',
                          '14451','56212','32641','51698','16363',
                          '11351','12856','10883','30967','72492',
                          '53809','57817','95424','37852','10864',
                          '19764','91984','43509','92543','75804',
                          '97575','41075','49016','24745','37623',
                          '15451','57016','17333','97238','23888',
                          '48610','58050','60941','21908','67923',
                          '39798','22090','48296','56400','63750',
                          '27993','37496','32500','42243','91090',
                          '62950','86044','34869','76470','19959',
                          '51255','84575','49321','86320','53100',
                          '97468','65261','18089','89074','83188',
                          '15285','13043','33460','60711','32207',
                          '54161','26007','70268','44671','89961',
                          '48525','33028','42992','11421','86443',
                          '19178','28079','14782','11883','89484',
                          '35500','97041','21680','34013','34556',
                          '38434','21639','32972','74170','21616',
                          '18384','69528','19500','83059','66986',
                          '77422','33080','72483','44089','29349',
                          '42502','26656','12099','41082','31869',
                          '92830','35314','67534','62556','79359',
                          '50490','16499','80227','11072','36551',
                          '91134','32646','12402','16876','14412',
                          '77333','21762','98418','57946','21001',
                          '43624','49786','65880','92187','49521',
                          '19030','48138','67325','52482','34748',
                          '23426','40966','66428','11980','34431',
                          '24102','92178','16766','26994','80607',
                          '33674','44563','33415','10861','42006',
                          '31801','49225','53449','77869','35535',
                          '32587','38929','57766','14890','52881',
                          '31967','89149','69008','88617','75928',
                          '13127','51009','10291','13606','58517',
                          '48292','87594','49888','37824','19981',
                          '83813','42077','32586','80583','32381',
                          '15180','32817','93380','25197','50589',
                          '56816','27511','72788','32505','88277',
                          '94318','12476','67934','14991','14160',
                          '55846','37228','86935','18228','42098',
                          '22409','29892','37977','79898','59411',
                          '27199','13427','93798','13565','94226',
                          '72327','22267','44687','81124','13568',
                          '76944','67556','95179','72738','35701',
                          '35897','79562','58754','21224','73323',
                          '75913','84510','70277','38934','43447',
                          '30674','91514','40597','69699','27914',
                          '92436','33892','35120','85789','46311',
                          '47067','25276','97944','35380','89097',
                          '33619','83157','97045','94991','94115',
                          '86989','72525','77970','15182','52278',
                          '31992','26755','89456','50667','86121',
                          '68133','26057','97812','81367','19968',
                          '23651','17689','38028','52806','71706',
                          '41452','97478','81898','80594','31455',
                          '83706','12506','34371','82377','50905',
                          '28373','81204','70648','44466','61106',
                          '60469','33923','84746','89929','66880',
                          '13607','71664','21263','28549','88563',
                          '86145','60295','59532','73188','90706',
                          '35158','62582','97629','85109','40743',
                          '75010','32788','66728','10358','13037',
                          '25913','43503','25629','65002','57652',
                          '13823','41643','40172','48177','15461',
                          '45103','72933','54242','50682','93294',
                          '34499','29125','54280','23561','80517',
                          '86986','29709','70430','75354','48900',
                          '92124','95150','11568','24030','62055',
                          '15505','39549','23804','25885','20536',
                          '32250','74638','30037','70424','70609',
                          '93589','60040','11569','53693','76104',
                          '61739','91577','32704','48880','27319',
                          '20002','76513','66599','92254','48948',
                          '24686','14484','69338','76616','47066',
                          '32535','28413','53049','31995','27206',
                          '54090','52279','69231','34152','37698',
                          '26047','54665','83310','55859')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1998
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
