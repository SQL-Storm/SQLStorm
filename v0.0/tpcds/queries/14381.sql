
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '19508','38187','11898','22679','53649','95719',
                          '79738','90697','22354','90483','64083',
                          '77586','40742','10270','47723','57438',
                          '67225','59059','48989','50038','93513',
                          '76386','64858','41025','22387','77089',
                          '28846','18448','45886','77075','93814',
                          '19893','55289','86066','89293','27391',
                          '65036','17964','16449','58164','21063',
                          '70965','80562','24078','96519','69340',
                          '45330','56730','35263','52462','59266',
                          '30607','24017','28120','68180','66359',
                          '32637','25679','55539','80337','23140',
                          '54828','24262','17221','71980','19648',
                          '22427','83647','41556','96270','89683',
                          '28549','69050','77588','41278','13230',
                          '68540','20427','13341','71342','88218',
                          '17150','97641','24043','85284','67627',
                          '47213','88830','91275','49540','95417',
                          '41749','37991','78744','33926','57154',
                          '18741','38709','11556','76223','20105',
                          '42161','20437','76456','75475','14802',
                          '15293','66367','95544','65845','40463',
                          '31239','10874','23583','84225','94495',
                          '45847','51018','66648','46853','41217',
                          '33497','89584','53864','95085','77054',
                          '11239','41255','18236','17235','18652',
                          '56741','67136','29178','29646','28081',
                          '66940','90916','52195','20529','76641',
                          '44718','11541','34690','32030','75116',
                          '15406','85601','16289','94295','82487',
                          '22239','77848','35584','21313','91123',
                          '90332','30144','27134','88309','89807',
                          '29018','53590','47159','61938','46734',
                          '10786','12983','33217','92361','67790',
                          '29848','97785','96487','20090','49383',
                          '98652','42512','27745','10708','67519',
                          '31597','84968','47168','54414','76085',
                          '66004','11976','55036','23260','65774',
                          '67678','30713','12098','40172','19531',
                          '16857','19847','33067','33115','24757',
                          '47915','96265','59432','83717','66127',
                          '11013','13815','14803','42238','16879',
                          '57819','78896','31868','80977','22219',
                          '38287','36586','31065','40036','95698',
                          '70532','18112','51958','52318','10446',
                          '48224','38015','64751','25359','42900',
                          '73751','19465','56418','58808','67367',
                          '32628','88990','88465','82874','57862',
                          '53578','62714','22750','17280','12275',
                          '65132','50765','75310','72992','10725',
                          '40748','41090','98674','32817','25763',
                          '87300','93728','45613','30690','31883',
                          '21236','75994','64131','48175','58434',
                          '53824','14434','34130','28838','27706',
                          '19920','77409','26394','90792','77836',
                          '66595','26904','13424','32195','12068',
                          '65730','57738','72892','94175','87818',
                          '84484','52672','19419','98962','23763',
                          '20411','30135','18056','19639','66655',
                          '87218','22333','99594','80317','33823',
                          '35041','73260','57641','46494','54686',
                          '72464','18768','60637','83843','25322',
                          '12548','44294','71670','37047','10361',
                          '86914','15714','60711','59420','45603',
                          '26487','20540','98651','89714','20319',
                          '14546','63145','45184','22339','15031',
                          '30623','27541','62592','70275','39479',
                          '73306','22628','42247','15528','49842',
                          '17048','11603','29084','96970','12771',
                          '99326','69994','79227','88580','82613',
                          '88608','47052','19568','93935','18264',
                          '54058','16162','12728','46251','47190',
                          '57113','43272','71870','92825','13321',
                          '10633','13868','44069','33513','48865',
                          '97583','48951','45122','71595','67002',
                          '74119','30440','85482','76817','95321',
                          '19276','38320','20089','28976','94173',
                          '68027','31364','11471','78496','20403',
                          '83969','43163','71542','30268','13722',
                          '40282','55826','29297','92789')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 2002
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
