
-- end query 62 in stream 0 using template query41.tpl
-- start query 63 in stream 0 using template query8.tpl
select  s_store_name
      ,sum(ss_net_profit)
 from store_sales
     ,date_dim
     ,store,
     (select ca_zip
     from (
      SELECT substr(ca_zip,1,5) ca_zip
      FROM customer_address
      WHERE substr(ca_zip,1,5) IN (
                          '54712','83108','76626','76259','64338','70806',
                          '50625','54913','26930','10327','19119',
                          '48420','27364','23912','88081','89837',
                          '16997','43334','61819','54822','17497',
                          '54761','98311','27688','22501','23546',
                          '54163','20857','65935','13027','68527',
                          '20238','30023','30345','22129','46226',
                          '97765','20382','44239','14379','63343',
                          '43302','36316','72790','77237','65934',
                          '96035','20160','25456','77328','22263',
                          '69934','10728','52333','78819','33832',
                          '25643','36190','53786','27744','73475',
                          '10692','70698','95810','37429','92610',
                          '80185','95870','21740','97371','56066',
                          '34635','17940','38218','26742','24513',
                          '19766','95744','92669','63302','19133',
                          '94152','21562','19579','13357','36333',
                          '92244','87126','36586','34267','79504',
                          '63757','72756','66604','63310','40923',
                          '27482','68770','34493','81950','21409',
                          '44797','21380','81357','94725','81693',
                          '19039','10333','73937','14853','66590',
                          '80020','47012','62668','71176','38256',
                          '86462','17590','18070','10902','22266',
                          '86977','23818','12967','61413','43793',
                          '51292','32164','54289','45892','96403',
                          '26543','10546','65390','72113','16660',
                          '51446','93567','19934','59964','49634',
                          '96244','50346','64381','84026','89261',
                          '34678','53182','22919','56313','60802',
                          '34828','42183','31601','42506','43813',
                          '24971','79226','45271','36615','50994',
                          '66039','67718','20427','22717','78918',
                          '20590','96591','28289','83957','93529',
                          '35098','10990','67994','61638','36925',
                          '76561','51706','92432','69867','41510',
                          '13638','67918','32487','39495','27928',
                          '95619','62962','53326','17571','15902',
                          '31290','82894','95768','42995','27466',
                          '18229','96075','54399','43262','50681',
                          '94678','18210','88095','18553','74632',
                          '35729','30378','42291','96311','27416',
                          '66804','25854','76429','50666','34234',
                          '61515','31486','75217','45174','53528',
                          '67493','75474','43905','83400','66118',
                          '96879','55780','18530','69010','82782',
                          '17252','59084','90285','60955','14875',
                          '53559','55471','53054','15087','38298',
                          '36916','86078','86345','92788','12070',
                          '48900','36605','54130','13892','23210',
                          '57823','88028','40337','98190','11403',
                          '67026','56471','51605','21603','35038',
                          '77407','25500','35068','42379','74319',
                          '96094','31969','91989','30824','39259',
                          '39133','25522','70867','65608','47073',
                          '89185','42847','80154','52150','71471',
                          '36409','26928','18306','75310','58465',
                          '10337','96191','31865','76048','80807',
                          '65360','92714','39189','75710','52731',
                          '74271','29560','63335','99907','87823',
                          '65306','15440','66966','98707','92348',
                          '30981','54231','97527','81502','61666',
                          '76398','83900','48672','27359','53756',
                          '94098','27433','54992','18697','40295',
                          '93672','74290','41476','72209','98591',
                          '50068','35885','74457','40336','61983',
                          '36756','46993','21721','59267','27698',
                          '45458','70528','82652','27642','14396',
                          '99253','63356','57659','13822','33509',
                          '32401','60753','58959','11369','26433',
                          '96822','20872','11047','34037','56337',
                          '41712','93737','64397','14179','27801',
                          '14020','33261','94437','49207','83297',
                          '21191','17373','16955','58420','16798',
                          '15661','92421','61072','55119','84192',
                          '41978','59250','21131','91784','36472',
                          '11422','74345','83489','38380','58032',
                          '26300','45243','80059','45971','48428',
                          '23019','20847','62374','52421','67338',
                          '90819','25110','30650','53771')
     intersect
      select ca_zip
      from (SELECT substr(ca_zip,1,5) ca_zip,count(*) cnt
            FROM customer_address, customer
            WHERE ca_address_sk = c_current_addr_sk and
                  c_preferred_cust_flag='Y'
            group by ca_zip
            having count(*) > 10)A1)A2) V1
 where ss_store_sk = s_store_sk
  and ss_sold_date_sk = d_date_sk
  and d_qoy = 2 and d_year = 1999
  and (substr(s_zip,1,2) = substr(V1.ca_zip,1,2))
 group by s_store_name
 order by s_store_name
 limit 100;
